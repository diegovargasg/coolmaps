<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="Diego Vargas" />
    <title>Air pollution levels during Covid-19 lockdowns</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
      integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
      crossorigin=""
    />

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }

      .b-example-divider {
        height: 3rem;
        background-color: rgba(0, 0, 0, 0.1);
        border: solid rgba(0, 0, 0, 0.15);
        border-width: 1px 0;
        box-shadow: inset 0 0.5em 1.5em rgba(0, 0, 0, 0.1),
          inset 0 0.125em 0.5em rgba(0, 0, 0, 0.15);
      }

      .b-example-vr {
        flex-shrink: 0;
        width: 1.5rem;
        height: 100vh;
      }

      .bi {
        vertical-align: -0.125em;
        fill: currentColor;
      }

      .nav-scroller {
        position: relative;
        z-index: 2;
        height: 2.75rem;
        overflow-y: hidden;
      }

      .nav-scroller .nav {
        display: flex;
        flex-wrap: nowrap;
        padding-bottom: 1rem;
        margin-top: -1px;
        overflow-x: auto;
        text-align: center;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }

      .map {
        height: 650px;
      }

      .legend {
        line-height: 18px;
        color: #555;
      }
      .legend i {
        width: 18px;
        height: 18px;
        float: left;
        margin-right: 8px;
        opacity: 0.7;
      }

      .info {
        padding: 6px 8px;
        background: white;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
        color: #000;
      }
      .info h5 {
        margin: 0 0 5px;
        color: #777;
      }
    </style>
  </head>

  <body>
    <main>
      <div class="container py-4">
        <header class="pb-3 mb-4 border-bottom">
          <a
            href="/"
            class="d-flex align-items-center text-dark text-decoration-none"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              fill="currentColor"
              class="bi bi-globe me-2"
              viewBox="0 0 16 16"
            >
              <path
                d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855.173-.324.33-.682.468-1.068H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"
              />
            </svg>
            <span class="fs-4">Spatial Analysis</span>
          </a>
        </header>

        <div class="p-5 mb-4 bg-light rounded-3">
          <div class="container-fluid py-5">
            <h1 class="display-6 fw-bold">
              Evaluation of the impact of Covid-19 lockdowns on the levels of
              air-pollution in Germany
            </h1>
            <p class="col-md-8 fs-4">
              The Covid-19 lockdowns implemented by the German government during
              the years 2020 to 2022, impacted the day to day lives of its
              citizens, making practices like Home-Office and reduction of air
              traveling the new norm. Provided that burning fossil fuels account
              for more than half of the emissions of harmful substances in the
              atmosphere around the world, and that air pollution is a leading
              cause of death for humans, this project seeks to analyze, evaluate
              and understand any significant change in the concentration of PM10
              during Covid-19 lockdowns and the impact that mobility, air travel
              and commuting has on the environment of the habitants of Germany.
            </p>
          </div>
        </div>

        <div class="row align-items-md-stretch mb-4">
          <div class="col-md-6">
            <h4>PM10 Concentration April 2019</h4>
            <div
              id="map_2019"
              class="p-5 text-white bg-light rounded-3 map"
            ></div>
          </div>
          <div class="col-md-6">
            <h4>PM10 Concentration April 2020</h4>
            <div
              id="map_2020"
              class="p-5 text-white bg-light rounded-3 map"
            ></div>
          </div>
        </div>

        <div class="p-5 mb-4">
          <div class="container-fluid py-5">
            <h3 class="display-6 fw-bold">Input Data</h3>
            <p class="col-md-12 fs-4">
              For the analisys, I needed datasets obtained within the german territory that included: 
            </p>
          </div>
        </div>

        <div class="p-5 mb-4">
          <div class="container-fluid py-5">
            <h3 class="display-6 fw-bold">Methodology</h3>
            <p class="col-md-12 fs-4">
              Methodoloty goes here
            </p>
          </div>
        </div>

        <div class="p-5 mb-4">
          <div class="container-fluid py-5">
            <h3 class="display-6 fw-bold">Results</h3>
            <p class="col-md-12 fs-4">
              Results go here 
            </p>
          </div>
        </div>

        <footer class="pt-3 mt-4 text-muted border-top">
          &copy; 2022 - Diego Vargas
        </footer>
      </div>
    </main>

    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
      integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
      crossorigin=""
    ></script>
    <script>
      let geojson = []
      let info = []
      let layers = {}
      let mapId

      async function initMap(year) {

        mapId = year

        const findLayer = (key, layerId) => {
          return layers[key].find(e => (e._layerId === layerId))
        }

        const highlightFeature = (e) => {

          const highlightStyle = {
            weight: 1.5,
            opacity: 1,
            color: "#666",
            dashArray: "",
            fillOpacity: 0.7
          }

          let layer = e.target

          //highlights all maps with same layerId
          Object.entries(layers).forEach(([key, value]) => {
            let sameLayerOtherMap = findLayer(key, layer._layerId)
            sameLayerOtherMap.setStyle(highlightStyle)

            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
              layer.bringToFront()
            }

            info[key].update(sameLayerOtherMap.feature.properties)
          });
        }

        const resetHighlight = (e) => {
          let layer = e.target
          //reset the other linked maps
          Object.entries(layers).forEach(([key, value]) => {
            let sameLayerOtherMap = findLayer(key, layer._layerId)
            geojson[key].resetStyle(sameLayerOtherMap)
            info[key].update()
          });
        }

        const onEachFeature = (feature, layer) => {
          layer._layerId = feature.properties.fid
          layer.on({
            mouseover: highlightFeature,
            mouseout: resetHighlight
          })
          layers[year].push(layer)
        }

        const getColor = (d) => {
          return d >= 28
            ? "#d7191c"
            : d >= 25 && d < 28
            ? "#ed6e43"
            : d >= 23 && d < 25
            ? "#fdba6f"
            : d >= 21 && d < 23
            ? "#fee8a5"
            : d >= 19 && d < 21
            ? "#e6f4a7"
            : d >= 18 && d < 19
            ? "#b3de76"
            : d >= 15 && d < 18
            ? "#6abc58"
            : d >= 8 && d < 15
            ? "#1a9641"
            : "#1a9641"
        }

        const style = (feature) => {
          return {
            fillColor: getColor(feature.properties.pm10),
            weight: 1.5,
            opacity: 0.1,
            color: "#000",
            fillOpacity: 1
          }
        }

        const response = await fetch(`./resources/${year}.json`)
        const data = await response.json()
        const map = L.map(`map_${year}`, {
          zoomControl: false,
          scrollWheelZoom: false
        }).setView([51.166, 10.4515], 6)
        L.tileLayer(
          "https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",
          {
            zoom: 6,
            attribution: "© OpenStreetMap"
          }
        ).addTo(map)

        layers[year] = [];
        geojson[year] = L.geoJson(data, {
          style: style,
          onEachFeature: onEachFeature
        }).addTo(map)

        info[year] = L.control()

        info[year].onAdd = function (map) {
          this._div = L.DomUtil.create("div", "info") // create a div with a class "info"
          this.update()
          return this._div
        }

        // method that we will use to update the control based on feature properties passed
        info[year].update = function (props) {
          this._div.innerHTML = props
            ? `
              <b>State:</b> ${props.state}<br/>
              <b>District:</b> ${props.district}<br/>
              <b>PM10 Concentration:</b> ${props.pm10.toFixed(2)} µg/m3 <br/>`
            : "Hover over a district"
        }

        info[year].addTo(map)

        let legend = L.control({ position: "bottomleft" })
        legend.onAdd = function (map) {
          let div = L.DomUtil.create("div", "info legend"),
            grades = [28, 25, 23, 21, 19, 18, 15, 8],
            labels = []

          // loop through our density intervals and generate a label with a colored square for each interval
          for (let i = 0; i < grades.length; i++) {
            div.innerHTML +=
              '<i style="background:' +
              getColor(grades[i] + 1) +
              '"></i> ' +
              grades[i] +
              (grades[i + 1] ? "&ndash;" + grades[i + 1] + "<br>" : "+")
          }

          return div
        }

        legend.addTo(map)

        map.on('mouseover', (e) => {
          mapId = year;
        })
      }

      initMap("2019")
      initMap("2020")
    </script>
  </body>
</html>
