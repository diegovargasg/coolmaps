function LL(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in t)){const c=Object.getOwnPropertyDescriptor(i,s);c&&Object.defineProperty(t,s,c.get?c:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(s){if(s.ep)return;s.ep=!0;const c=n(s);fetch(s.href,c)}})();var ML=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pu(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var e2={exports:{}},Kt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rd=Symbol.for("react.element"),kL=Symbol.for("react.portal"),RL=Symbol.for("react.fragment"),zL=Symbol.for("react.strict_mode"),DL=Symbol.for("react.profiler"),OL=Symbol.for("react.provider"),FL=Symbol.for("react.context"),BL=Symbol.for("react.forward_ref"),NL=Symbol.for("react.suspense"),UL=Symbol.for("react.memo"),VL=Symbol.for("react.lazy"),yb=Symbol.iterator;function jL(t){return t===null||typeof t!="object"?null:(t=yb&&t[yb]||t["@@iterator"],typeof t=="function"?t:null)}var t2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},n2=Object.assign,i2={};function Cu(t,e,n){this.props=t,this.context=e,this.refs=i2,this.updater=n||t2}Cu.prototype.isReactComponent={};Cu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Cu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function r2(){}r2.prototype=Cu.prototype;function fv(t,e,n){this.props=t,this.context=e,this.refs=i2,this.updater=n||t2}var pv=fv.prototype=new r2;pv.constructor=fv;n2(pv,Cu.prototype);pv.isPureReactComponent=!0;var vb=Array.isArray,s2=Object.prototype.hasOwnProperty,mv={current:null},o2={key:!0,ref:!0,__self:!0,__source:!0};function a2(t,e,n){var i,s={},c=null,d=null;if(e!=null)for(i in e.ref!==void 0&&(d=e.ref),e.key!==void 0&&(c=""+e.key),e)s2.call(e,i)&&!o2.hasOwnProperty(i)&&(s[i]=e[i]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var y=Array(l),w=0;w<l;w++)y[w]=arguments[w+2];s.children=y}if(t&&t.defaultProps)for(i in l=t.defaultProps,l)s[i]===void 0&&(s[i]=l[i]);return{$$typeof:Rd,type:t,key:c,ref:d,props:s,_owner:mv.current}}function GL(t,e){return{$$typeof:Rd,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function gv(t){return typeof t=="object"&&t!==null&&t.$$typeof===Rd}function WL(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var xb=/\/+/g;function I_(t,e){return typeof t=="object"&&t!==null&&t.key!=null?WL(""+t.key):e.toString(36)}function Op(t,e,n,i,s){var c=typeof t;(c==="undefined"||c==="boolean")&&(t=null);var d=!1;if(t===null)d=!0;else switch(c){case"string":case"number":d=!0;break;case"object":switch(t.$$typeof){case Rd:case kL:d=!0}}if(d)return d=t,s=s(d),t=i===""?"."+I_(d,0):i,vb(s)?(n="",t!=null&&(n=t.replace(xb,"$&/")+"/"),Op(s,e,n,"",function(w){return w})):s!=null&&(gv(s)&&(s=GL(s,n+(!s.key||d&&d.key===s.key?"":(""+s.key).replace(xb,"$&/")+"/")+t)),e.push(s)),1;if(d=0,i=i===""?".":i+":",vb(t))for(var l=0;l<t.length;l++){c=t[l];var y=i+I_(c,l);d+=Op(c,e,n,y,s)}else if(y=jL(t),typeof y=="function")for(t=y.call(t),l=0;!(c=t.next()).done;)c=c.value,y=i+I_(c,l++),d+=Op(c,e,n,y,s);else if(c==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return d}function ep(t,e,n){if(t==null)return t;var i=[],s=0;return Op(t,i,"","",function(c){return e.call(n,c,s++)}),i}function $L(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var yr={current:null},Fp={transition:null},HL={ReactCurrentDispatcher:yr,ReactCurrentBatchConfig:Fp,ReactCurrentOwner:mv};Kt.Children={map:ep,forEach:function(t,e,n){ep(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ep(t,function(){e++}),e},toArray:function(t){return ep(t,function(e){return e})||[]},only:function(t){if(!gv(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Kt.Component=Cu;Kt.Fragment=RL;Kt.Profiler=DL;Kt.PureComponent=fv;Kt.StrictMode=zL;Kt.Suspense=NL;Kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=HL;Kt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=n2({},t.props),s=t.key,c=t.ref,d=t._owner;if(e!=null){if(e.ref!==void 0&&(c=e.ref,d=mv.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(y in e)s2.call(e,y)&&!o2.hasOwnProperty(y)&&(i[y]=e[y]===void 0&&l!==void 0?l[y]:e[y])}var y=arguments.length-2;if(y===1)i.children=n;else if(1<y){l=Array(y);for(var w=0;w<y;w++)l[w]=arguments[w+2];i.children=l}return{$$typeof:Rd,type:t.type,key:s,ref:c,props:i,_owner:d}};Kt.createContext=function(t){return t={$$typeof:FL,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:OL,_context:t},t.Consumer=t};Kt.createElement=a2;Kt.createFactory=function(t){var e=a2.bind(null,t);return e.type=t,e};Kt.createRef=function(){return{current:null}};Kt.forwardRef=function(t){return{$$typeof:BL,render:t}};Kt.isValidElement=gv;Kt.lazy=function(t){return{$$typeof:VL,_payload:{_status:-1,_result:t},_init:$L}};Kt.memo=function(t,e){return{$$typeof:UL,type:t,compare:e===void 0?null:e}};Kt.startTransition=function(t){var e=Fp.transition;Fp.transition={};try{t()}finally{Fp.transition=e}};Kt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Kt.useCallback=function(t,e){return yr.current.useCallback(t,e)};Kt.useContext=function(t){return yr.current.useContext(t)};Kt.useDebugValue=function(){};Kt.useDeferredValue=function(t){return yr.current.useDeferredValue(t)};Kt.useEffect=function(t,e){return yr.current.useEffect(t,e)};Kt.useId=function(){return yr.current.useId()};Kt.useImperativeHandle=function(t,e,n){return yr.current.useImperativeHandle(t,e,n)};Kt.useInsertionEffect=function(t,e){return yr.current.useInsertionEffect(t,e)};Kt.useLayoutEffect=function(t,e){return yr.current.useLayoutEffect(t,e)};Kt.useMemo=function(t,e){return yr.current.useMemo(t,e)};Kt.useReducer=function(t,e,n){return yr.current.useReducer(t,e,n)};Kt.useRef=function(t){return yr.current.useRef(t)};Kt.useState=function(t){return yr.current.useState(t)};Kt.useSyncExternalStore=function(t,e,n){return yr.current.useSyncExternalStore(t,e,n)};Kt.useTransition=function(){return yr.current.useTransition()};Kt.version="18.2.0";e2.exports=Kt;var Be=e2.exports;const uo=Pu(Be);var l2={exports:{}},is={},c2={exports:{}},u2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(nt,Et){var Pt=nt.length;nt.push(Et);e:for(;0<Pt;){var nn=Pt-1>>>1,rn=nt[nn];if(0<s(rn,Et))nt[nn]=Et,nt[Pt]=rn,Pt=nn;else break e}}function n(nt){return nt.length===0?null:nt[0]}function i(nt){if(nt.length===0)return null;var Et=nt[0],Pt=nt.pop();if(Pt!==Et){nt[0]=Pt;e:for(var nn=0,rn=nt.length,rr=rn>>>1;nn<rr;){var ri=2*(nn+1)-1,wi=nt[ri],si=ri+1,un=nt[si];if(0>s(wi,Pt))si<rn&&0>s(un,wi)?(nt[nn]=un,nt[si]=Pt,nn=si):(nt[nn]=wi,nt[ri]=Pt,nn=ri);else if(si<rn&&0>s(un,Pt))nt[nn]=un,nt[si]=Pt,nn=si;else break e}}return Et}function s(nt,Et){var Pt=nt.sortIndex-Et.sortIndex;return Pt!==0?Pt:nt.id-Et.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var d=Date,l=d.now();t.unstable_now=function(){return d.now()-l}}var y=[],w=[],S=1,I=null,P=3,B=!1,G=!1,K=!1,ue=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Z(nt){for(var Et=n(w);Et!==null;){if(Et.callback===null)i(w);else if(Et.startTime<=nt)i(w),Et.sortIndex=Et.expirationTime,e(y,Et);else break;Et=n(w)}}function re(nt){if(K=!1,Z(nt),!G)if(n(y)!==null)G=!0,xt(pe);else{var Et=n(w);Et!==null&&bi(re,Et.startTime-nt)}}function pe(nt,Et){G=!1,K&&(K=!1,q(Fe),Fe=-1),B=!0;var Pt=P;try{for(Z(Et),I=n(y);I!==null&&(!(I.expirationTime>Et)||nt&&!pt());){var nn=I.callback;if(typeof nn=="function"){I.callback=null,P=I.priorityLevel;var rn=nn(I.expirationTime<=Et);Et=t.unstable_now(),typeof rn=="function"?I.callback=rn:I===n(y)&&i(y),Z(Et)}else i(y);I=n(y)}if(I!==null)var rr=!0;else{var ri=n(w);ri!==null&&bi(re,ri.startTime-Et),rr=!1}return rr}finally{I=null,P=Pt,B=!1}}var be=!1,Re=null,Fe=-1,je=5,Ge=-1;function pt(){return!(t.unstable_now()-Ge<je)}function bt(){if(Re!==null){var nt=t.unstable_now();Ge=nt;var Et=!0;try{Et=Re(!0,nt)}finally{Et?St():(be=!1,Re=null)}}else be=!1}var St;if(typeof j=="function")St=function(){j(bt)};else if(typeof MessageChannel<"u"){var kt=new MessageChannel,Wn=kt.port2;kt.port1.onmessage=bt,St=function(){Wn.postMessage(null)}}else St=function(){ue(bt,0)};function xt(nt){Re=nt,be||(be=!0,St())}function bi(nt,Et){Fe=ue(function(){nt(t.unstable_now())},Et)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(nt){nt.callback=null},t.unstable_continueExecution=function(){G||B||(G=!0,xt(pe))},t.unstable_forceFrameRate=function(nt){0>nt||125<nt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):je=0<nt?Math.floor(1e3/nt):5},t.unstable_getCurrentPriorityLevel=function(){return P},t.unstable_getFirstCallbackNode=function(){return n(y)},t.unstable_next=function(nt){switch(P){case 1:case 2:case 3:var Et=3;break;default:Et=P}var Pt=P;P=Et;try{return nt()}finally{P=Pt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(nt,Et){switch(nt){case 1:case 2:case 3:case 4:case 5:break;default:nt=3}var Pt=P;P=nt;try{return Et()}finally{P=Pt}},t.unstable_scheduleCallback=function(nt,Et,Pt){var nn=t.unstable_now();switch(typeof Pt=="object"&&Pt!==null?(Pt=Pt.delay,Pt=typeof Pt=="number"&&0<Pt?nn+Pt:nn):Pt=nn,nt){case 1:var rn=-1;break;case 2:rn=250;break;case 5:rn=1073741823;break;case 4:rn=1e4;break;default:rn=5e3}return rn=Pt+rn,nt={id:S++,callback:Et,priorityLevel:nt,startTime:Pt,expirationTime:rn,sortIndex:-1},Pt>nn?(nt.sortIndex=Pt,e(w,nt),n(y)===null&&nt===n(w)&&(K?(q(Fe),Fe=-1):K=!0,bi(re,Pt-nn))):(nt.sortIndex=rn,e(y,nt),G||B||(G=!0,xt(pe))),nt},t.unstable_shouldYield=pt,t.unstable_wrapCallback=function(nt){var Et=P;return function(){var Pt=P;P=Et;try{return nt.apply(this,arguments)}finally{P=Pt}}}})(u2);c2.exports=u2;var qL=c2.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h2=Be,ts=qL;function We(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var d2=new Set,od={};function Xl(t,e){cu(t,e),cu(t+"Capture",e)}function cu(t,e){for(od[t]=e,t=0;t<e.length;t++)d2.add(e[t])}var $o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Uy=Object.prototype.hasOwnProperty,ZL=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,bb={},wb={};function XL(t){return Uy.call(wb,t)?!0:Uy.call(bb,t)?!1:ZL.test(t)?wb[t]=!0:(bb[t]=!0,!1)}function YL(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function KL(t,e,n,i){if(e===null||typeof e>"u"||YL(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function vr(t,e,n,i,s,c,d){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=c,this.removeEmptyString=d}var ji={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ji[t]=new vr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ji[e]=new vr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ji[t]=new vr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ji[t]=new vr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ji[t]=new vr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ji[t]=new vr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ji[t]=new vr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ji[t]=new vr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ji[t]=new vr(t,5,!1,t.toLowerCase(),null,!1,!1)});var _v=/[\-:]([a-z])/g;function yv(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(_v,yv);ji[e]=new vr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(_v,yv);ji[e]=new vr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(_v,yv);ji[e]=new vr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ji[t]=new vr(t,1,!1,t.toLowerCase(),null,!1,!1)});ji.xlinkHref=new vr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ji[t]=new vr(t,1,!1,t.toLowerCase(),null,!0,!0)});function vv(t,e,n,i){var s=ji.hasOwnProperty(e)?ji[e]:null;(s!==null?s.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(KL(e,n,s,i)&&(n=null),i||s===null?XL(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,i=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Qo=h2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,tp=Symbol.for("react.element"),Bc=Symbol.for("react.portal"),Nc=Symbol.for("react.fragment"),xv=Symbol.for("react.strict_mode"),Vy=Symbol.for("react.profiler"),f2=Symbol.for("react.provider"),p2=Symbol.for("react.context"),bv=Symbol.for("react.forward_ref"),jy=Symbol.for("react.suspense"),Gy=Symbol.for("react.suspense_list"),wv=Symbol.for("react.memo"),Ia=Symbol.for("react.lazy"),m2=Symbol.for("react.offscreen"),Eb=Symbol.iterator;function Th(t){return t===null||typeof t!="object"?null:(t=Eb&&t[Eb]||t["@@iterator"],typeof t=="function"?t:null)}var Gn=Object.assign,L_;function Uh(t){if(L_===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);L_=e&&e[1]||""}return`
`+L_+t}var M_=!1;function k_(t,e){if(!t||M_)return"";M_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var i=w}Reflect.construct(t,[],e)}else{try{e.call()}catch(w){i=w}t.call(e.prototype)}else{try{throw Error()}catch(w){i=w}t()}}catch(w){if(w&&i&&typeof w.stack=="string"){for(var s=w.stack.split(`
`),c=i.stack.split(`
`),d=s.length-1,l=c.length-1;1<=d&&0<=l&&s[d]!==c[l];)l--;for(;1<=d&&0<=l;d--,l--)if(s[d]!==c[l]){if(d!==1||l!==1)do if(d--,l--,0>l||s[d]!==c[l]){var y=`
`+s[d].replace(" at new "," at ");return t.displayName&&y.includes("<anonymous>")&&(y=y.replace("<anonymous>",t.displayName)),y}while(1<=d&&0<=l);break}}}finally{M_=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Uh(t):""}function JL(t){switch(t.tag){case 5:return Uh(t.type);case 16:return Uh("Lazy");case 13:return Uh("Suspense");case 19:return Uh("SuspenseList");case 0:case 2:case 15:return t=k_(t.type,!1),t;case 11:return t=k_(t.type.render,!1),t;case 1:return t=k_(t.type,!0),t;default:return""}}function Wy(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Nc:return"Fragment";case Bc:return"Portal";case Vy:return"Profiler";case xv:return"StrictMode";case jy:return"Suspense";case Gy:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case p2:return(t.displayName||"Context")+".Consumer";case f2:return(t._context.displayName||"Context")+".Provider";case bv:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case wv:return e=t.displayName||null,e!==null?e:Wy(t.type)||"Memo";case Ia:e=t._payload,t=t._init;try{return Wy(t(e))}catch{}}return null}function QL(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Wy(e);case 8:return e===xv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Za(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function g2(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eM(t){var e=g2(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,c=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(d){i=""+d,c.call(this,d)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(d){i=""+d},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function np(t){t._valueTracker||(t._valueTracker=eM(t))}function _2(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=g2(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function sm(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function $y(t,e){var n=e.checked;return Gn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Tb(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Za(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function y2(t,e){e=e.checked,e!=null&&vv(t,"checked",e,!1)}function Hy(t,e){y2(t,e);var n=Za(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?qy(t,e.type,n):e.hasOwnProperty("defaultValue")&&qy(t,e.type,Za(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Sb(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function qy(t,e,n){(e!=="number"||sm(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Vh=Array.isArray;function Qc(t,e,n,i){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Za(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,i&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Zy(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(We(91));return Gn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Ab(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(We(92));if(Vh(n)){if(1<n.length)throw Error(We(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Za(n)}}function v2(t,e){var n=Za(e.value),i=Za(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function Pb(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function x2(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xy(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?x2(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ip,b2=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ip=ip||document.createElement("div"),ip.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ip.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ad(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var qh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tM=["Webkit","ms","Moz","O"];Object.keys(qh).forEach(function(t){tM.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),qh[e]=qh[t]})});function w2(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||qh.hasOwnProperty(t)&&qh[t]?(""+e).trim():e+"px"}function E2(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,s=w2(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,s):t[n]=s}}var nM=Gn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Yy(t,e){if(e){if(nM[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(We(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(We(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(We(61))}if(e.style!=null&&typeof e.style!="object")throw Error(We(62))}}function Ky(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Jy=null;function Ev(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Qy=null,eu=null,tu=null;function Cb(t){if(t=Od(t)){if(typeof Qy!="function")throw Error(We(280));var e=t.stateNode;e&&(e=tg(e),Qy(t.stateNode,t.type,e))}}function T2(t){eu?tu?tu.push(t):tu=[t]:eu=t}function S2(){if(eu){var t=eu,e=tu;if(tu=eu=null,Cb(t),e)for(t=0;t<e.length;t++)Cb(e[t])}}function A2(t,e){return t(e)}function P2(){}var R_=!1;function C2(t,e,n){if(R_)return t(e,n);R_=!0;try{return A2(t,e,n)}finally{R_=!1,(eu!==null||tu!==null)&&(P2(),S2())}}function ld(t,e){var n=t.stateNode;if(n===null)return null;var i=tg(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(We(231,e,typeof n));return n}var e0=!1;if($o)try{var Sh={};Object.defineProperty(Sh,"passive",{get:function(){e0=!0}}),window.addEventListener("test",Sh,Sh),window.removeEventListener("test",Sh,Sh)}catch{e0=!1}function iM(t,e,n,i,s,c,d,l,y){var w=Array.prototype.slice.call(arguments,3);try{e.apply(n,w)}catch(S){this.onError(S)}}var Zh=!1,om=null,am=!1,t0=null,rM={onError:function(t){Zh=!0,om=t}};function sM(t,e,n,i,s,c,d,l,y){Zh=!1,om=null,iM.apply(rM,arguments)}function oM(t,e,n,i,s,c,d,l,y){if(sM.apply(this,arguments),Zh){if(Zh){var w=om;Zh=!1,om=null}else throw Error(We(198));am||(am=!0,t0=w)}}function Yl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function I2(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Ib(t){if(Yl(t)!==t)throw Error(We(188))}function aM(t){var e=t.alternate;if(!e){if(e=Yl(t),e===null)throw Error(We(188));return e!==t?null:t}for(var n=t,i=e;;){var s=n.return;if(s===null)break;var c=s.alternate;if(c===null){if(i=s.return,i!==null){n=i;continue}break}if(s.child===c.child){for(c=s.child;c;){if(c===n)return Ib(s),t;if(c===i)return Ib(s),e;c=c.sibling}throw Error(We(188))}if(n.return!==i.return)n=s,i=c;else{for(var d=!1,l=s.child;l;){if(l===n){d=!0,n=s,i=c;break}if(l===i){d=!0,i=s,n=c;break}l=l.sibling}if(!d){for(l=c.child;l;){if(l===n){d=!0,n=c,i=s;break}if(l===i){d=!0,i=c,n=s;break}l=l.sibling}if(!d)throw Error(We(189))}}if(n.alternate!==i)throw Error(We(190))}if(n.tag!==3)throw Error(We(188));return n.stateNode.current===n?t:e}function L2(t){return t=aM(t),t!==null?M2(t):null}function M2(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=M2(t);if(e!==null)return e;t=t.sibling}return null}var k2=ts.unstable_scheduleCallback,Lb=ts.unstable_cancelCallback,lM=ts.unstable_shouldYield,cM=ts.unstable_requestPaint,ii=ts.unstable_now,uM=ts.unstable_getCurrentPriorityLevel,Tv=ts.unstable_ImmediatePriority,R2=ts.unstable_UserBlockingPriority,lm=ts.unstable_NormalPriority,hM=ts.unstable_LowPriority,z2=ts.unstable_IdlePriority,Km=null,_o=null;function dM(t){if(_o&&typeof _o.onCommitFiberRoot=="function")try{_o.onCommitFiberRoot(Km,t,void 0,(t.current.flags&128)===128)}catch{}}var Vs=Math.clz32?Math.clz32:mM,fM=Math.log,pM=Math.LN2;function mM(t){return t>>>=0,t===0?32:31-(fM(t)/pM|0)|0}var rp=64,sp=4194304;function jh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function cm(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,s=t.suspendedLanes,c=t.pingedLanes,d=n&268435455;if(d!==0){var l=d&~s;l!==0?i=jh(l):(c&=d,c!==0&&(i=jh(c)))}else d=n&~s,d!==0?i=jh(d):c!==0&&(i=jh(c));if(i===0)return 0;if(e!==0&&e!==i&&!(e&s)&&(s=i&-i,c=e&-e,s>=c||s===16&&(c&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Vs(e),s=1<<n,i|=t[n],e&=~s;return i}function gM(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _M(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,s=t.expirationTimes,c=t.pendingLanes;0<c;){var d=31-Vs(c),l=1<<d,y=s[d];y===-1?(!(l&n)||l&i)&&(s[d]=gM(l,e)):y<=e&&(t.expiredLanes|=l),c&=~l}}function n0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function D2(){var t=rp;return rp<<=1,!(rp&4194240)&&(rp=64),t}function z_(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function zd(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Vs(e),t[e]=n}function yM(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Vs(n),c=1<<s;e[s]=0,i[s]=-1,t[s]=-1,n&=~c}}function Sv(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Vs(n),s=1<<i;s&e|t[i]&e&&(t[i]|=e),n&=~s}}var mn=0;function O2(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var F2,Av,B2,N2,U2,i0=!1,op=[],Ba=null,Na=null,Ua=null,cd=new Map,ud=new Map,Ma=[],vM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mb(t,e){switch(t){case"focusin":case"focusout":Ba=null;break;case"dragenter":case"dragleave":Na=null;break;case"mouseover":case"mouseout":Ua=null;break;case"pointerover":case"pointerout":cd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ud.delete(e.pointerId)}}function Ah(t,e,n,i,s,c){return t===null||t.nativeEvent!==c?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:c,targetContainers:[s]},e!==null&&(e=Od(e),e!==null&&Av(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function xM(t,e,n,i,s){switch(e){case"focusin":return Ba=Ah(Ba,t,e,n,i,s),!0;case"dragenter":return Na=Ah(Na,t,e,n,i,s),!0;case"mouseover":return Ua=Ah(Ua,t,e,n,i,s),!0;case"pointerover":var c=s.pointerId;return cd.set(c,Ah(cd.get(c)||null,t,e,n,i,s)),!0;case"gotpointercapture":return c=s.pointerId,ud.set(c,Ah(ud.get(c)||null,t,e,n,i,s)),!0}return!1}function V2(t){var e=kl(t.target);if(e!==null){var n=Yl(e);if(n!==null){if(e=n.tag,e===13){if(e=I2(n),e!==null){t.blockedOn=e,U2(t.priority,function(){B2(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Bp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=r0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Jy=i,n.target.dispatchEvent(i),Jy=null}else return e=Od(n),e!==null&&Av(e),t.blockedOn=n,!1;e.shift()}return!0}function kb(t,e,n){Bp(t)&&n.delete(e)}function bM(){i0=!1,Ba!==null&&Bp(Ba)&&(Ba=null),Na!==null&&Bp(Na)&&(Na=null),Ua!==null&&Bp(Ua)&&(Ua=null),cd.forEach(kb),ud.forEach(kb)}function Ph(t,e){t.blockedOn===e&&(t.blockedOn=null,i0||(i0=!0,ts.unstable_scheduleCallback(ts.unstable_NormalPriority,bM)))}function hd(t){function e(s){return Ph(s,t)}if(0<op.length){Ph(op[0],t);for(var n=1;n<op.length;n++){var i=op[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Ba!==null&&Ph(Ba,t),Na!==null&&Ph(Na,t),Ua!==null&&Ph(Ua,t),cd.forEach(e),ud.forEach(e),n=0;n<Ma.length;n++)i=Ma[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Ma.length&&(n=Ma[0],n.blockedOn===null);)V2(n),n.blockedOn===null&&Ma.shift()}var nu=Qo.ReactCurrentBatchConfig,um=!0;function wM(t,e,n,i){var s=mn,c=nu.transition;nu.transition=null;try{mn=1,Pv(t,e,n,i)}finally{mn=s,nu.transition=c}}function EM(t,e,n,i){var s=mn,c=nu.transition;nu.transition=null;try{mn=4,Pv(t,e,n,i)}finally{mn=s,nu.transition=c}}function Pv(t,e,n,i){if(um){var s=r0(t,e,n,i);if(s===null)W_(t,e,i,hm,n),Mb(t,i);else if(xM(s,t,e,n,i))i.stopPropagation();else if(Mb(t,i),e&4&&-1<vM.indexOf(t)){for(;s!==null;){var c=Od(s);if(c!==null&&F2(c),c=r0(t,e,n,i),c===null&&W_(t,e,i,hm,n),c===s)break;s=c}s!==null&&i.stopPropagation()}else W_(t,e,i,null,n)}}var hm=null;function r0(t,e,n,i){if(hm=null,t=Ev(i),t=kl(t),t!==null)if(e=Yl(t),e===null)t=null;else if(n=e.tag,n===13){if(t=I2(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return hm=t,null}function j2(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uM()){case Tv:return 1;case R2:return 4;case lm:case hM:return 16;case z2:return 536870912;default:return 16}default:return 16}}var Ra=null,Cv=null,Np=null;function G2(){if(Np)return Np;var t,e=Cv,n=e.length,i,s="value"in Ra?Ra.value:Ra.textContent,c=s.length;for(t=0;t<n&&e[t]===s[t];t++);var d=n-t;for(i=1;i<=d&&e[n-i]===s[c-i];i++);return Np=s.slice(t,1<i?1-i:void 0)}function Up(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function ap(){return!0}function Rb(){return!1}function rs(t){function e(n,i,s,c,d){this._reactName=n,this._targetInst=s,this.type=i,this.nativeEvent=c,this.target=d,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(c):c[l]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?ap:Rb,this.isPropagationStopped=Rb,this}return Gn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ap)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ap)},persist:function(){},isPersistent:ap}),e}var Iu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Iv=rs(Iu),Dd=Gn({},Iu,{view:0,detail:0}),TM=rs(Dd),D_,O_,Ch,Jm=Gn({},Dd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lv,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ch&&(Ch&&t.type==="mousemove"?(D_=t.screenX-Ch.screenX,O_=t.screenY-Ch.screenY):O_=D_=0,Ch=t),D_)},movementY:function(t){return"movementY"in t?t.movementY:O_}}),zb=rs(Jm),SM=Gn({},Jm,{dataTransfer:0}),AM=rs(SM),PM=Gn({},Dd,{relatedTarget:0}),F_=rs(PM),CM=Gn({},Iu,{animationName:0,elapsedTime:0,pseudoElement:0}),IM=rs(CM),LM=Gn({},Iu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),MM=rs(LM),kM=Gn({},Iu,{data:0}),Db=rs(kM),RM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},DM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function OM(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=DM[t])?!!e[t]:!1}function Lv(){return OM}var FM=Gn({},Dd,{key:function(t){if(t.key){var e=RM[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Up(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?zM[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lv,charCode:function(t){return t.type==="keypress"?Up(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Up(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),BM=rs(FM),NM=Gn({},Jm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ob=rs(NM),UM=Gn({},Dd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lv}),VM=rs(UM),jM=Gn({},Iu,{propertyName:0,elapsedTime:0,pseudoElement:0}),GM=rs(jM),WM=Gn({},Jm,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),$M=rs(WM),HM=[9,13,27,32],Mv=$o&&"CompositionEvent"in window,Xh=null;$o&&"documentMode"in document&&(Xh=document.documentMode);var qM=$o&&"TextEvent"in window&&!Xh,W2=$o&&(!Mv||Xh&&8<Xh&&11>=Xh),Fb=String.fromCharCode(32),Bb=!1;function $2(t,e){switch(t){case"keyup":return HM.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function H2(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Uc=!1;function ZM(t,e){switch(t){case"compositionend":return H2(e);case"keypress":return e.which!==32?null:(Bb=!0,Fb);case"textInput":return t=e.data,t===Fb&&Bb?null:t;default:return null}}function XM(t,e){if(Uc)return t==="compositionend"||!Mv&&$2(t,e)?(t=G2(),Np=Cv=Ra=null,Uc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return W2&&e.locale!=="ko"?null:e.data;default:return null}}var YM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Nb(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!YM[t.type]:e==="textarea"}function q2(t,e,n,i){T2(i),e=dm(e,"onChange"),0<e.length&&(n=new Iv("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Yh=null,dd=null;function KM(t){rS(t,0)}function Qm(t){var e=Gc(t);if(_2(e))return t}function JM(t,e){if(t==="change")return e}var Z2=!1;if($o){var B_;if($o){var N_="oninput"in document;if(!N_){var Ub=document.createElement("div");Ub.setAttribute("oninput","return;"),N_=typeof Ub.oninput=="function"}B_=N_}else B_=!1;Z2=B_&&(!document.documentMode||9<document.documentMode)}function Vb(){Yh&&(Yh.detachEvent("onpropertychange",X2),dd=Yh=null)}function X2(t){if(t.propertyName==="value"&&Qm(dd)){var e=[];q2(e,dd,t,Ev(t)),C2(KM,e)}}function QM(t,e,n){t==="focusin"?(Vb(),Yh=e,dd=n,Yh.attachEvent("onpropertychange",X2)):t==="focusout"&&Vb()}function ek(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Qm(dd)}function tk(t,e){if(t==="click")return Qm(e)}function nk(t,e){if(t==="input"||t==="change")return Qm(e)}function ik(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ws=typeof Object.is=="function"?Object.is:ik;function fd(t,e){if(Ws(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var s=n[i];if(!Uy.call(e,s)||!Ws(t[s],e[s]))return!1}return!0}function jb(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Gb(t,e){var n=jb(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=jb(n)}}function Y2(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Y2(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function K2(){for(var t=window,e=sm();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=sm(t.document)}return e}function kv(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function rk(t){var e=K2(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Y2(n.ownerDocument.documentElement,n)){if(i!==null&&kv(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,c=Math.min(i.start,s);i=i.end===void 0?c:Math.min(i.end,s),!t.extend&&c>i&&(s=i,i=c,c=s),s=Gb(n,c);var d=Gb(n,i);s&&d&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==d.node||t.focusOffset!==d.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),c>i?(t.addRange(e),t.extend(d.node,d.offset)):(e.setEnd(d.node,d.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var sk=$o&&"documentMode"in document&&11>=document.documentMode,Vc=null,s0=null,Kh=null,o0=!1;function Wb(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;o0||Vc==null||Vc!==sm(i)||(i=Vc,"selectionStart"in i&&kv(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Kh&&fd(Kh,i)||(Kh=i,i=dm(s0,"onSelect"),0<i.length&&(e=new Iv("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Vc)))}function lp(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var jc={animationend:lp("Animation","AnimationEnd"),animationiteration:lp("Animation","AnimationIteration"),animationstart:lp("Animation","AnimationStart"),transitionend:lp("Transition","TransitionEnd")},U_={},J2={};$o&&(J2=document.createElement("div").style,"AnimationEvent"in window||(delete jc.animationend.animation,delete jc.animationiteration.animation,delete jc.animationstart.animation),"TransitionEvent"in window||delete jc.transitionend.transition);function eg(t){if(U_[t])return U_[t];if(!jc[t])return t;var e=jc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in J2)return U_[t]=e[n];return t}var Q2=eg("animationend"),eS=eg("animationiteration"),tS=eg("animationstart"),nS=eg("transitionend"),iS=new Map,$b="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ka(t,e){iS.set(t,e),Xl(e,[t])}for(var V_=0;V_<$b.length;V_++){var j_=$b[V_],ok=j_.toLowerCase(),ak=j_[0].toUpperCase()+j_.slice(1);Ka(ok,"on"+ak)}Ka(Q2,"onAnimationEnd");Ka(eS,"onAnimationIteration");Ka(tS,"onAnimationStart");Ka("dblclick","onDoubleClick");Ka("focusin","onFocus");Ka("focusout","onBlur");Ka(nS,"onTransitionEnd");cu("onMouseEnter",["mouseout","mouseover"]);cu("onMouseLeave",["mouseout","mouseover"]);cu("onPointerEnter",["pointerout","pointerover"]);cu("onPointerLeave",["pointerout","pointerover"]);Xl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Xl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Xl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Xl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Xl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Xl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lk=new Set("cancel close invalid load scroll toggle".split(" ").concat(Gh));function Hb(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,oM(i,e,void 0,t),t.currentTarget=null}function rS(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],s=i.event;i=i.listeners;e:{var c=void 0;if(e)for(var d=i.length-1;0<=d;d--){var l=i[d],y=l.instance,w=l.currentTarget;if(l=l.listener,y!==c&&s.isPropagationStopped())break e;Hb(s,l,w),c=y}else for(d=0;d<i.length;d++){if(l=i[d],y=l.instance,w=l.currentTarget,l=l.listener,y!==c&&s.isPropagationStopped())break e;Hb(s,l,w),c=y}}}if(am)throw t=t0,am=!1,t0=null,t}function Cn(t,e){var n=e[h0];n===void 0&&(n=e[h0]=new Set);var i=t+"__bubble";n.has(i)||(sS(e,t,2,!1),n.add(i))}function G_(t,e,n){var i=0;e&&(i|=4),sS(n,t,i,e)}var cp="_reactListening"+Math.random().toString(36).slice(2);function pd(t){if(!t[cp]){t[cp]=!0,d2.forEach(function(n){n!=="selectionchange"&&(lk.has(n)||G_(n,!1,t),G_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[cp]||(e[cp]=!0,G_("selectionchange",!1,e))}}function sS(t,e,n,i){switch(j2(e)){case 1:var s=wM;break;case 4:s=EM;break;default:s=Pv}n=s.bind(null,e,n,t),s=void 0,!e0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),i?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function W_(t,e,n,i,s){var c=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var d=i.tag;if(d===3||d===4){var l=i.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(d===4)for(d=i.return;d!==null;){var y=d.tag;if((y===3||y===4)&&(y=d.stateNode.containerInfo,y===s||y.nodeType===8&&y.parentNode===s))return;d=d.return}for(;l!==null;){if(d=kl(l),d===null)return;if(y=d.tag,y===5||y===6){i=c=d;continue e}l=l.parentNode}}i=i.return}C2(function(){var w=c,S=Ev(n),I=[];e:{var P=iS.get(t);if(P!==void 0){var B=Iv,G=t;switch(t){case"keypress":if(Up(n)===0)break e;case"keydown":case"keyup":B=BM;break;case"focusin":G="focus",B=F_;break;case"focusout":G="blur",B=F_;break;case"beforeblur":case"afterblur":B=F_;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":B=zb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":B=AM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":B=VM;break;case Q2:case eS:case tS:B=IM;break;case nS:B=GM;break;case"scroll":B=TM;break;case"wheel":B=$M;break;case"copy":case"cut":case"paste":B=MM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":B=Ob}var K=(e&4)!==0,ue=!K&&t==="scroll",q=K?P!==null?P+"Capture":null:P;K=[];for(var j=w,Z;j!==null;){Z=j;var re=Z.stateNode;if(Z.tag===5&&re!==null&&(Z=re,q!==null&&(re=ld(j,q),re!=null&&K.push(md(j,re,Z)))),ue)break;j=j.return}0<K.length&&(P=new B(P,G,null,n,S),I.push({event:P,listeners:K}))}}if(!(e&7)){e:{if(P=t==="mouseover"||t==="pointerover",B=t==="mouseout"||t==="pointerout",P&&n!==Jy&&(G=n.relatedTarget||n.fromElement)&&(kl(G)||G[Ho]))break e;if((B||P)&&(P=S.window===S?S:(P=S.ownerDocument)?P.defaultView||P.parentWindow:window,B?(G=n.relatedTarget||n.toElement,B=w,G=G?kl(G):null,G!==null&&(ue=Yl(G),G!==ue||G.tag!==5&&G.tag!==6)&&(G=null)):(B=null,G=w),B!==G)){if(K=zb,re="onMouseLeave",q="onMouseEnter",j="mouse",(t==="pointerout"||t==="pointerover")&&(K=Ob,re="onPointerLeave",q="onPointerEnter",j="pointer"),ue=B==null?P:Gc(B),Z=G==null?P:Gc(G),P=new K(re,j+"leave",B,n,S),P.target=ue,P.relatedTarget=Z,re=null,kl(S)===w&&(K=new K(q,j+"enter",G,n,S),K.target=Z,K.relatedTarget=ue,re=K),ue=re,B&&G)t:{for(K=B,q=G,j=0,Z=K;Z;Z=Cc(Z))j++;for(Z=0,re=q;re;re=Cc(re))Z++;for(;0<j-Z;)K=Cc(K),j--;for(;0<Z-j;)q=Cc(q),Z--;for(;j--;){if(K===q||q!==null&&K===q.alternate)break t;K=Cc(K),q=Cc(q)}K=null}else K=null;B!==null&&qb(I,P,B,K,!1),G!==null&&ue!==null&&qb(I,ue,G,K,!0)}}e:{if(P=w?Gc(w):window,B=P.nodeName&&P.nodeName.toLowerCase(),B==="select"||B==="input"&&P.type==="file")var pe=JM;else if(Nb(P))if(Z2)pe=nk;else{pe=ek;var be=QM}else(B=P.nodeName)&&B.toLowerCase()==="input"&&(P.type==="checkbox"||P.type==="radio")&&(pe=tk);if(pe&&(pe=pe(t,w))){q2(I,pe,n,S);break e}be&&be(t,P,w),t==="focusout"&&(be=P._wrapperState)&&be.controlled&&P.type==="number"&&qy(P,"number",P.value)}switch(be=w?Gc(w):window,t){case"focusin":(Nb(be)||be.contentEditable==="true")&&(Vc=be,s0=w,Kh=null);break;case"focusout":Kh=s0=Vc=null;break;case"mousedown":o0=!0;break;case"contextmenu":case"mouseup":case"dragend":o0=!1,Wb(I,n,S);break;case"selectionchange":if(sk)break;case"keydown":case"keyup":Wb(I,n,S)}var Re;if(Mv)e:{switch(t){case"compositionstart":var Fe="onCompositionStart";break e;case"compositionend":Fe="onCompositionEnd";break e;case"compositionupdate":Fe="onCompositionUpdate";break e}Fe=void 0}else Uc?$2(t,n)&&(Fe="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Fe="onCompositionStart");Fe&&(W2&&n.locale!=="ko"&&(Uc||Fe!=="onCompositionStart"?Fe==="onCompositionEnd"&&Uc&&(Re=G2()):(Ra=S,Cv="value"in Ra?Ra.value:Ra.textContent,Uc=!0)),be=dm(w,Fe),0<be.length&&(Fe=new Db(Fe,t,null,n,S),I.push({event:Fe,listeners:be}),Re?Fe.data=Re:(Re=H2(n),Re!==null&&(Fe.data=Re)))),(Re=qM?ZM(t,n):XM(t,n))&&(w=dm(w,"onBeforeInput"),0<w.length&&(S=new Db("onBeforeInput","beforeinput",null,n,S),I.push({event:S,listeners:w}),S.data=Re))}rS(I,e)})}function md(t,e,n){return{instance:t,listener:e,currentTarget:n}}function dm(t,e){for(var n=e+"Capture",i=[];t!==null;){var s=t,c=s.stateNode;s.tag===5&&c!==null&&(s=c,c=ld(t,n),c!=null&&i.unshift(md(t,c,s)),c=ld(t,e),c!=null&&i.push(md(t,c,s))),t=t.return}return i}function Cc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function qb(t,e,n,i,s){for(var c=e._reactName,d=[];n!==null&&n!==i;){var l=n,y=l.alternate,w=l.stateNode;if(y!==null&&y===i)break;l.tag===5&&w!==null&&(l=w,s?(y=ld(n,c),y!=null&&d.unshift(md(n,y,l))):s||(y=ld(n,c),y!=null&&d.push(md(n,y,l)))),n=n.return}d.length!==0&&t.push({event:e,listeners:d})}var ck=/\r\n?/g,uk=/\u0000|\uFFFD/g;function Zb(t){return(typeof t=="string"?t:""+t).replace(ck,`
`).replace(uk,"")}function up(t,e,n){if(e=Zb(e),Zb(t)!==e&&n)throw Error(We(425))}function fm(){}var a0=null,l0=null;function c0(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var u0=typeof setTimeout=="function"?setTimeout:void 0,hk=typeof clearTimeout=="function"?clearTimeout:void 0,Xb=typeof Promise=="function"?Promise:void 0,dk=typeof queueMicrotask=="function"?queueMicrotask:typeof Xb<"u"?function(t){return Xb.resolve(null).then(t).catch(fk)}:u0;function fk(t){setTimeout(function(){throw t})}function $_(t,e){var n=e,i=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(i===0){t.removeChild(s),hd(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=s}while(n);hd(e)}function Va(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Yb(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Lu=Math.random().toString(36).slice(2),fo="__reactFiber$"+Lu,gd="__reactProps$"+Lu,Ho="__reactContainer$"+Lu,h0="__reactEvents$"+Lu,pk="__reactListeners$"+Lu,mk="__reactHandles$"+Lu;function kl(t){var e=t[fo];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ho]||n[fo]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Yb(t);t!==null;){if(n=t[fo])return n;t=Yb(t)}return e}t=n,n=t.parentNode}return null}function Od(t){return t=t[fo]||t[Ho],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Gc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(We(33))}function tg(t){return t[gd]||null}var d0=[],Wc=-1;function Ja(t){return{current:t}}function Ln(t){0>Wc||(t.current=d0[Wc],d0[Wc]=null,Wc--)}function An(t,e){Wc++,d0[Wc]=t.current,t.current=e}var Xa={},ir=Ja(Xa),Ir=Ja(!1),Nl=Xa;function uu(t,e){var n=t.type.contextTypes;if(!n)return Xa;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var s={},c;for(c in n)s[c]=e[c];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Lr(t){return t=t.childContextTypes,t!=null}function pm(){Ln(Ir),Ln(ir)}function Kb(t,e,n){if(ir.current!==Xa)throw Error(We(168));An(ir,e),An(Ir,n)}function oS(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var s in i)if(!(s in e))throw Error(We(108,QL(t)||"Unknown",s));return Gn({},n,i)}function mm(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Xa,Nl=ir.current,An(ir,t),An(Ir,Ir.current),!0}function Jb(t,e,n){var i=t.stateNode;if(!i)throw Error(We(169));n?(t=oS(t,e,Nl),i.__reactInternalMemoizedMergedChildContext=t,Ln(Ir),Ln(ir),An(ir,t)):Ln(Ir),An(Ir,n)}var No=null,ng=!1,H_=!1;function aS(t){No===null?No=[t]:No.push(t)}function gk(t){ng=!0,aS(t)}function Qa(){if(!H_&&No!==null){H_=!0;var t=0,e=mn;try{var n=No;for(mn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}No=null,ng=!1}catch(s){throw No!==null&&(No=No.slice(t+1)),k2(Tv,Qa),s}finally{mn=e,H_=!1}}return null}var $c=[],Hc=0,gm=null,_m=0,ys=[],vs=0,Ul=null,jo=1,Go="";function Il(t,e){$c[Hc++]=_m,$c[Hc++]=gm,gm=t,_m=e}function lS(t,e,n){ys[vs++]=jo,ys[vs++]=Go,ys[vs++]=Ul,Ul=t;var i=jo;t=Go;var s=32-Vs(i)-1;i&=~(1<<s),n+=1;var c=32-Vs(e)+s;if(30<c){var d=s-s%5;c=(i&(1<<d)-1).toString(32),i>>=d,s-=d,jo=1<<32-Vs(e)+s|n<<s|i,Go=c+t}else jo=1<<c|n<<s|i,Go=t}function Rv(t){t.return!==null&&(Il(t,1),lS(t,1,0))}function zv(t){for(;t===gm;)gm=$c[--Hc],$c[Hc]=null,_m=$c[--Hc],$c[Hc]=null;for(;t===Ul;)Ul=ys[--vs],ys[vs]=null,Go=ys[--vs],ys[vs]=null,jo=ys[--vs],ys[vs]=null}var Qr=null,Kr=null,Dn=!1,Bs=null;function cS(t,e){var n=xs(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Qb(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Qr=t,Kr=Va(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Qr=t,Kr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ul!==null?{id:jo,overflow:Go}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=xs(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Qr=t,Kr=null,!0):!1;default:return!1}}function f0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function p0(t){if(Dn){var e=Kr;if(e){var n=e;if(!Qb(t,e)){if(f0(t))throw Error(We(418));e=Va(n.nextSibling);var i=Qr;e&&Qb(t,e)?cS(i,n):(t.flags=t.flags&-4097|2,Dn=!1,Qr=t)}}else{if(f0(t))throw Error(We(418));t.flags=t.flags&-4097|2,Dn=!1,Qr=t}}}function ew(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Qr=t}function hp(t){if(t!==Qr)return!1;if(!Dn)return ew(t),Dn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!c0(t.type,t.memoizedProps)),e&&(e=Kr)){if(f0(t))throw uS(),Error(We(418));for(;e;)cS(t,e),e=Va(e.nextSibling)}if(ew(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(We(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Kr=Va(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Kr=null}}else Kr=Qr?Va(t.stateNode.nextSibling):null;return!0}function uS(){for(var t=Kr;t;)t=Va(t.nextSibling)}function hu(){Kr=Qr=null,Dn=!1}function Dv(t){Bs===null?Bs=[t]:Bs.push(t)}var _k=Qo.ReactCurrentBatchConfig;function Os(t,e){if(t&&t.defaultProps){e=Gn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var ym=Ja(null),vm=null,qc=null,Ov=null;function Fv(){Ov=qc=vm=null}function Bv(t){var e=ym.current;Ln(ym),t._currentValue=e}function m0(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function iu(t,e){vm=t,Ov=qc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Cr=!0),t.firstContext=null)}function Es(t){var e=t._currentValue;if(Ov!==t)if(t={context:t,memoizedValue:e,next:null},qc===null){if(vm===null)throw Error(We(308));qc=t,vm.dependencies={lanes:0,firstContext:t}}else qc=qc.next=t;return e}var Rl=null;function Nv(t){Rl===null?Rl=[t]:Rl.push(t)}function hS(t,e,n,i){var s=e.interleaved;return s===null?(n.next=n,Nv(e)):(n.next=s.next,s.next=n),e.interleaved=n,qo(t,i)}function qo(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var La=!1;function Uv(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dS(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Wo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ja(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,an&2){var s=i.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),i.pending=e,qo(t,n)}return s=i.interleaved,s===null?(e.next=e,Nv(i)):(e.next=s.next,s.next=e),i.interleaved=e,qo(t,n)}function Vp(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Sv(t,n)}}function tw(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var s=null,c=null;if(n=n.firstBaseUpdate,n!==null){do{var d={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};c===null?s=c=d:c=c.next=d,n=n.next}while(n!==null);c===null?s=c=e:c=c.next=e}else s=c=e;n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:c,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function xm(t,e,n,i){var s=t.updateQueue;La=!1;var c=s.firstBaseUpdate,d=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var y=l,w=y.next;y.next=null,d===null?c=w:d.next=w,d=y;var S=t.alternate;S!==null&&(S=S.updateQueue,l=S.lastBaseUpdate,l!==d&&(l===null?S.firstBaseUpdate=w:l.next=w,S.lastBaseUpdate=y))}if(c!==null){var I=s.baseState;d=0,S=w=y=null,l=c;do{var P=l.lane,B=l.eventTime;if((i&P)===P){S!==null&&(S=S.next={eventTime:B,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var G=t,K=l;switch(P=e,B=n,K.tag){case 1:if(G=K.payload,typeof G=="function"){I=G.call(B,I,P);break e}I=G;break e;case 3:G.flags=G.flags&-65537|128;case 0:if(G=K.payload,P=typeof G=="function"?G.call(B,I,P):G,P==null)break e;I=Gn({},I,P);break e;case 2:La=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,P=s.effects,P===null?s.effects=[l]:P.push(l))}else B={eventTime:B,lane:P,tag:l.tag,payload:l.payload,callback:l.callback,next:null},S===null?(w=S=B,y=I):S=S.next=B,d|=P;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;P=l,l=P.next,P.next=null,s.lastBaseUpdate=P,s.shared.pending=null}}while(1);if(S===null&&(y=I),s.baseState=y,s.firstBaseUpdate=w,s.lastBaseUpdate=S,e=s.shared.interleaved,e!==null){s=e;do d|=s.lane,s=s.next;while(s!==e)}else c===null&&(s.shared.lanes=0);jl|=d,t.lanes=d,t.memoizedState=I}}function nw(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],s=i.callback;if(s!==null){if(i.callback=null,i=n,typeof s!="function")throw Error(We(191,s));s.call(i)}}}var fS=new h2.Component().refs;function g0(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Gn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ig={isMounted:function(t){return(t=t._reactInternals)?Yl(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=_r(),s=Wa(t),c=Wo(i,s);c.payload=e,n!=null&&(c.callback=n),e=ja(t,c,s),e!==null&&(js(e,t,s,i),Vp(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=_r(),s=Wa(t),c=Wo(i,s);c.tag=1,c.payload=e,n!=null&&(c.callback=n),e=ja(t,c,s),e!==null&&(js(e,t,s,i),Vp(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=_r(),i=Wa(t),s=Wo(n,i);s.tag=2,e!=null&&(s.callback=e),e=ja(t,s,i),e!==null&&(js(e,t,i,n),Vp(e,t,i))}};function iw(t,e,n,i,s,c,d){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,c,d):e.prototype&&e.prototype.isPureReactComponent?!fd(n,i)||!fd(s,c):!0}function pS(t,e,n){var i=!1,s=Xa,c=e.contextType;return typeof c=="object"&&c!==null?c=Es(c):(s=Lr(e)?Nl:ir.current,i=e.contextTypes,c=(i=i!=null)?uu(t,s):Xa),e=new e(n,c),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ig,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=c),e}function rw(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&ig.enqueueReplaceState(e,e.state,null)}function _0(t,e,n,i){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs=fS,Uv(t);var c=e.contextType;typeof c=="object"&&c!==null?s.context=Es(c):(c=Lr(e)?Nl:ir.current,s.context=uu(t,c)),s.state=t.memoizedState,c=e.getDerivedStateFromProps,typeof c=="function"&&(g0(t,e,c,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&ig.enqueueReplaceState(s,s.state,null),xm(t,n,s,i),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ih(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(We(309));var i=n.stateNode}if(!i)throw Error(We(147,t));var s=i,c=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===c?e.ref:(e=function(d){var l=s.refs;l===fS&&(l=s.refs={}),d===null?delete l[c]:l[c]=d},e._stringRef=c,e)}if(typeof t!="string")throw Error(We(284));if(!n._owner)throw Error(We(290,t))}return t}function dp(t,e){throw t=Object.prototype.toString.call(e),Error(We(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function sw(t){var e=t._init;return e(t._payload)}function mS(t){function e(q,j){if(t){var Z=q.deletions;Z===null?(q.deletions=[j],q.flags|=16):Z.push(j)}}function n(q,j){if(!t)return null;for(;j!==null;)e(q,j),j=j.sibling;return null}function i(q,j){for(q=new Map;j!==null;)j.key!==null?q.set(j.key,j):q.set(j.index,j),j=j.sibling;return q}function s(q,j){return q=$a(q,j),q.index=0,q.sibling=null,q}function c(q,j,Z){return q.index=Z,t?(Z=q.alternate,Z!==null?(Z=Z.index,Z<j?(q.flags|=2,j):Z):(q.flags|=2,j)):(q.flags|=1048576,j)}function d(q){return t&&q.alternate===null&&(q.flags|=2),q}function l(q,j,Z,re){return j===null||j.tag!==6?(j=Q_(Z,q.mode,re),j.return=q,j):(j=s(j,Z),j.return=q,j)}function y(q,j,Z,re){var pe=Z.type;return pe===Nc?S(q,j,Z.props.children,re,Z.key):j!==null&&(j.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===Ia&&sw(pe)===j.type)?(re=s(j,Z.props),re.ref=Ih(q,j,Z),re.return=q,re):(re=qp(Z.type,Z.key,Z.props,null,q.mode,re),re.ref=Ih(q,j,Z),re.return=q,re)}function w(q,j,Z,re){return j===null||j.tag!==4||j.stateNode.containerInfo!==Z.containerInfo||j.stateNode.implementation!==Z.implementation?(j=ey(Z,q.mode,re),j.return=q,j):(j=s(j,Z.children||[]),j.return=q,j)}function S(q,j,Z,re,pe){return j===null||j.tag!==7?(j=Fl(Z,q.mode,re,pe),j.return=q,j):(j=s(j,Z),j.return=q,j)}function I(q,j,Z){if(typeof j=="string"&&j!==""||typeof j=="number")return j=Q_(""+j,q.mode,Z),j.return=q,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case tp:return Z=qp(j.type,j.key,j.props,null,q.mode,Z),Z.ref=Ih(q,null,j),Z.return=q,Z;case Bc:return j=ey(j,q.mode,Z),j.return=q,j;case Ia:var re=j._init;return I(q,re(j._payload),Z)}if(Vh(j)||Th(j))return j=Fl(j,q.mode,Z,null),j.return=q,j;dp(q,j)}return null}function P(q,j,Z,re){var pe=j!==null?j.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number")return pe!==null?null:l(q,j,""+Z,re);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case tp:return Z.key===pe?y(q,j,Z,re):null;case Bc:return Z.key===pe?w(q,j,Z,re):null;case Ia:return pe=Z._init,P(q,j,pe(Z._payload),re)}if(Vh(Z)||Th(Z))return pe!==null?null:S(q,j,Z,re,null);dp(q,Z)}return null}function B(q,j,Z,re,pe){if(typeof re=="string"&&re!==""||typeof re=="number")return q=q.get(Z)||null,l(j,q,""+re,pe);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case tp:return q=q.get(re.key===null?Z:re.key)||null,y(j,q,re,pe);case Bc:return q=q.get(re.key===null?Z:re.key)||null,w(j,q,re,pe);case Ia:var be=re._init;return B(q,j,Z,be(re._payload),pe)}if(Vh(re)||Th(re))return q=q.get(Z)||null,S(j,q,re,pe,null);dp(j,re)}return null}function G(q,j,Z,re){for(var pe=null,be=null,Re=j,Fe=j=0,je=null;Re!==null&&Fe<Z.length;Fe++){Re.index>Fe?(je=Re,Re=null):je=Re.sibling;var Ge=P(q,Re,Z[Fe],re);if(Ge===null){Re===null&&(Re=je);break}t&&Re&&Ge.alternate===null&&e(q,Re),j=c(Ge,j,Fe),be===null?pe=Ge:be.sibling=Ge,be=Ge,Re=je}if(Fe===Z.length)return n(q,Re),Dn&&Il(q,Fe),pe;if(Re===null){for(;Fe<Z.length;Fe++)Re=I(q,Z[Fe],re),Re!==null&&(j=c(Re,j,Fe),be===null?pe=Re:be.sibling=Re,be=Re);return Dn&&Il(q,Fe),pe}for(Re=i(q,Re);Fe<Z.length;Fe++)je=B(Re,q,Fe,Z[Fe],re),je!==null&&(t&&je.alternate!==null&&Re.delete(je.key===null?Fe:je.key),j=c(je,j,Fe),be===null?pe=je:be.sibling=je,be=je);return t&&Re.forEach(function(pt){return e(q,pt)}),Dn&&Il(q,Fe),pe}function K(q,j,Z,re){var pe=Th(Z);if(typeof pe!="function")throw Error(We(150));if(Z=pe.call(Z),Z==null)throw Error(We(151));for(var be=pe=null,Re=j,Fe=j=0,je=null,Ge=Z.next();Re!==null&&!Ge.done;Fe++,Ge=Z.next()){Re.index>Fe?(je=Re,Re=null):je=Re.sibling;var pt=P(q,Re,Ge.value,re);if(pt===null){Re===null&&(Re=je);break}t&&Re&&pt.alternate===null&&e(q,Re),j=c(pt,j,Fe),be===null?pe=pt:be.sibling=pt,be=pt,Re=je}if(Ge.done)return n(q,Re),Dn&&Il(q,Fe),pe;if(Re===null){for(;!Ge.done;Fe++,Ge=Z.next())Ge=I(q,Ge.value,re),Ge!==null&&(j=c(Ge,j,Fe),be===null?pe=Ge:be.sibling=Ge,be=Ge);return Dn&&Il(q,Fe),pe}for(Re=i(q,Re);!Ge.done;Fe++,Ge=Z.next())Ge=B(Re,q,Fe,Ge.value,re),Ge!==null&&(t&&Ge.alternate!==null&&Re.delete(Ge.key===null?Fe:Ge.key),j=c(Ge,j,Fe),be===null?pe=Ge:be.sibling=Ge,be=Ge);return t&&Re.forEach(function(bt){return e(q,bt)}),Dn&&Il(q,Fe),pe}function ue(q,j,Z,re){if(typeof Z=="object"&&Z!==null&&Z.type===Nc&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case tp:e:{for(var pe=Z.key,be=j;be!==null;){if(be.key===pe){if(pe=Z.type,pe===Nc){if(be.tag===7){n(q,be.sibling),j=s(be,Z.props.children),j.return=q,q=j;break e}}else if(be.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===Ia&&sw(pe)===be.type){n(q,be.sibling),j=s(be,Z.props),j.ref=Ih(q,be,Z),j.return=q,q=j;break e}n(q,be);break}else e(q,be);be=be.sibling}Z.type===Nc?(j=Fl(Z.props.children,q.mode,re,Z.key),j.return=q,q=j):(re=qp(Z.type,Z.key,Z.props,null,q.mode,re),re.ref=Ih(q,j,Z),re.return=q,q=re)}return d(q);case Bc:e:{for(be=Z.key;j!==null;){if(j.key===be)if(j.tag===4&&j.stateNode.containerInfo===Z.containerInfo&&j.stateNode.implementation===Z.implementation){n(q,j.sibling),j=s(j,Z.children||[]),j.return=q,q=j;break e}else{n(q,j);break}else e(q,j);j=j.sibling}j=ey(Z,q.mode,re),j.return=q,q=j}return d(q);case Ia:return be=Z._init,ue(q,j,be(Z._payload),re)}if(Vh(Z))return G(q,j,Z,re);if(Th(Z))return K(q,j,Z,re);dp(q,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"?(Z=""+Z,j!==null&&j.tag===6?(n(q,j.sibling),j=s(j,Z),j.return=q,q=j):(n(q,j),j=Q_(Z,q.mode,re),j.return=q,q=j),d(q)):n(q,j)}return ue}var du=mS(!0),gS=mS(!1),Fd={},yo=Ja(Fd),_d=Ja(Fd),yd=Ja(Fd);function zl(t){if(t===Fd)throw Error(We(174));return t}function Vv(t,e){switch(An(yd,e),An(_d,t),An(yo,Fd),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Xy(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Xy(e,t)}Ln(yo),An(yo,e)}function fu(){Ln(yo),Ln(_d),Ln(yd)}function _S(t){zl(yd.current);var e=zl(yo.current),n=Xy(e,t.type);e!==n&&(An(_d,t),An(yo,n))}function jv(t){_d.current===t&&(Ln(yo),Ln(_d))}var Un=Ja(0);function bm(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var q_=[];function Gv(){for(var t=0;t<q_.length;t++)q_[t]._workInProgressVersionPrimary=null;q_.length=0}var jp=Qo.ReactCurrentDispatcher,Z_=Qo.ReactCurrentBatchConfig,Vl=0,jn=null,yi=null,Ii=null,wm=!1,Jh=!1,vd=0,yk=0;function Ki(){throw Error(We(321))}function Wv(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ws(t[n],e[n]))return!1;return!0}function $v(t,e,n,i,s,c){if(Vl=c,jn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,jp.current=t===null||t.memoizedState===null?wk:Ek,t=n(i,s),Jh){c=0;do{if(Jh=!1,vd=0,25<=c)throw Error(We(301));c+=1,Ii=yi=null,e.updateQueue=null,jp.current=Tk,t=n(i,s)}while(Jh)}if(jp.current=Em,e=yi!==null&&yi.next!==null,Vl=0,Ii=yi=jn=null,wm=!1,e)throw Error(We(300));return t}function Hv(){var t=vd!==0;return vd=0,t}function ho(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ii===null?jn.memoizedState=Ii=t:Ii=Ii.next=t,Ii}function Ts(){if(yi===null){var t=jn.alternate;t=t!==null?t.memoizedState:null}else t=yi.next;var e=Ii===null?jn.memoizedState:Ii.next;if(e!==null)Ii=e,yi=t;else{if(t===null)throw Error(We(310));yi=t,t={memoizedState:yi.memoizedState,baseState:yi.baseState,baseQueue:yi.baseQueue,queue:yi.queue,next:null},Ii===null?jn.memoizedState=Ii=t:Ii=Ii.next=t}return Ii}function xd(t,e){return typeof e=="function"?e(t):e}function X_(t){var e=Ts(),n=e.queue;if(n===null)throw Error(We(311));n.lastRenderedReducer=t;var i=yi,s=i.baseQueue,c=n.pending;if(c!==null){if(s!==null){var d=s.next;s.next=c.next,c.next=d}i.baseQueue=s=c,n.pending=null}if(s!==null){c=s.next,i=i.baseState;var l=d=null,y=null,w=c;do{var S=w.lane;if((Vl&S)===S)y!==null&&(y=y.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),i=w.hasEagerState?w.eagerState:t(i,w.action);else{var I={lane:S,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};y===null?(l=y=I,d=i):y=y.next=I,jn.lanes|=S,jl|=S}w=w.next}while(w!==null&&w!==c);y===null?d=i:y.next=l,Ws(i,e.memoizedState)||(Cr=!0),e.memoizedState=i,e.baseState=d,e.baseQueue=y,n.lastRenderedState=i}if(t=n.interleaved,t!==null){s=t;do c=s.lane,jn.lanes|=c,jl|=c,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Y_(t){var e=Ts(),n=e.queue;if(n===null)throw Error(We(311));n.lastRenderedReducer=t;var i=n.dispatch,s=n.pending,c=e.memoizedState;if(s!==null){n.pending=null;var d=s=s.next;do c=t(c,d.action),d=d.next;while(d!==s);Ws(c,e.memoizedState)||(Cr=!0),e.memoizedState=c,e.baseQueue===null&&(e.baseState=c),n.lastRenderedState=c}return[c,i]}function yS(){}function vS(t,e){var n=jn,i=Ts(),s=e(),c=!Ws(i.memoizedState,s);if(c&&(i.memoizedState=s,Cr=!0),i=i.queue,qv(wS.bind(null,n,i,t),[t]),i.getSnapshot!==e||c||Ii!==null&&Ii.memoizedState.tag&1){if(n.flags|=2048,bd(9,bS.bind(null,n,i,s,e),void 0,null),Mi===null)throw Error(We(349));Vl&30||xS(n,e,s)}return s}function xS(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=jn.updateQueue,e===null?(e={lastEffect:null,stores:null},jn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function bS(t,e,n,i){e.value=n,e.getSnapshot=i,ES(e)&&TS(t)}function wS(t,e,n){return n(function(){ES(e)&&TS(t)})}function ES(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ws(t,n)}catch{return!0}}function TS(t){var e=qo(t,1);e!==null&&js(e,t,1,-1)}function ow(t){var e=ho();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xd,lastRenderedState:t},e.queue=t,t=t.dispatch=bk.bind(null,jn,t),[e.memoizedState,t]}function bd(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=jn.updateQueue,e===null?(e={lastEffect:null,stores:null},jn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function SS(){return Ts().memoizedState}function Gp(t,e,n,i){var s=ho();jn.flags|=t,s.memoizedState=bd(1|e,n,void 0,i===void 0?null:i)}function rg(t,e,n,i){var s=Ts();i=i===void 0?null:i;var c=void 0;if(yi!==null){var d=yi.memoizedState;if(c=d.destroy,i!==null&&Wv(i,d.deps)){s.memoizedState=bd(e,n,c,i);return}}jn.flags|=t,s.memoizedState=bd(1|e,n,c,i)}function aw(t,e){return Gp(8390656,8,t,e)}function qv(t,e){return rg(2048,8,t,e)}function AS(t,e){return rg(4,2,t,e)}function PS(t,e){return rg(4,4,t,e)}function CS(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function IS(t,e,n){return n=n!=null?n.concat([t]):null,rg(4,4,CS.bind(null,e,t),n)}function Zv(){}function LS(t,e){var n=Ts();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Wv(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function MS(t,e){var n=Ts();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Wv(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function kS(t,e,n){return Vl&21?(Ws(n,e)||(n=D2(),jn.lanes|=n,jl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Cr=!0),t.memoizedState=n)}function vk(t,e){var n=mn;mn=n!==0&&4>n?n:4,t(!0);var i=Z_.transition;Z_.transition={};try{t(!1),e()}finally{mn=n,Z_.transition=i}}function RS(){return Ts().memoizedState}function xk(t,e,n){var i=Wa(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},zS(t))DS(e,n);else if(n=hS(t,e,n,i),n!==null){var s=_r();js(n,t,i,s),OS(n,e,i)}}function bk(t,e,n){var i=Wa(t),s={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(zS(t))DS(e,s);else{var c=t.alternate;if(t.lanes===0&&(c===null||c.lanes===0)&&(c=e.lastRenderedReducer,c!==null))try{var d=e.lastRenderedState,l=c(d,n);if(s.hasEagerState=!0,s.eagerState=l,Ws(l,d)){var y=e.interleaved;y===null?(s.next=s,Nv(e)):(s.next=y.next,y.next=s),e.interleaved=s;return}}catch{}finally{}n=hS(t,e,s,i),n!==null&&(s=_r(),js(n,t,i,s),OS(n,e,i))}}function zS(t){var e=t.alternate;return t===jn||e!==null&&e===jn}function DS(t,e){Jh=wm=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function OS(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Sv(t,n)}}var Em={readContext:Es,useCallback:Ki,useContext:Ki,useEffect:Ki,useImperativeHandle:Ki,useInsertionEffect:Ki,useLayoutEffect:Ki,useMemo:Ki,useReducer:Ki,useRef:Ki,useState:Ki,useDebugValue:Ki,useDeferredValue:Ki,useTransition:Ki,useMutableSource:Ki,useSyncExternalStore:Ki,useId:Ki,unstable_isNewReconciler:!1},wk={readContext:Es,useCallback:function(t,e){return ho().memoizedState=[t,e===void 0?null:e],t},useContext:Es,useEffect:aw,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Gp(4194308,4,CS.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Gp(4194308,4,t,e)},useInsertionEffect:function(t,e){return Gp(4,2,t,e)},useMemo:function(t,e){var n=ho();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=ho();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=xk.bind(null,jn,t),[i.memoizedState,t]},useRef:function(t){var e=ho();return t={current:t},e.memoizedState=t},useState:ow,useDebugValue:Zv,useDeferredValue:function(t){return ho().memoizedState=t},useTransition:function(){var t=ow(!1),e=t[0];return t=vk.bind(null,t[1]),ho().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=jn,s=ho();if(Dn){if(n===void 0)throw Error(We(407));n=n()}else{if(n=e(),Mi===null)throw Error(We(349));Vl&30||xS(i,e,n)}s.memoizedState=n;var c={value:n,getSnapshot:e};return s.queue=c,aw(wS.bind(null,i,c,t),[t]),i.flags|=2048,bd(9,bS.bind(null,i,c,n,e),void 0,null),n},useId:function(){var t=ho(),e=Mi.identifierPrefix;if(Dn){var n=Go,i=jo;n=(i&~(1<<32-Vs(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=vd++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=yk++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Ek={readContext:Es,useCallback:LS,useContext:Es,useEffect:qv,useImperativeHandle:IS,useInsertionEffect:AS,useLayoutEffect:PS,useMemo:MS,useReducer:X_,useRef:SS,useState:function(){return X_(xd)},useDebugValue:Zv,useDeferredValue:function(t){var e=Ts();return kS(e,yi.memoizedState,t)},useTransition:function(){var t=X_(xd)[0],e=Ts().memoizedState;return[t,e]},useMutableSource:yS,useSyncExternalStore:vS,useId:RS,unstable_isNewReconciler:!1},Tk={readContext:Es,useCallback:LS,useContext:Es,useEffect:qv,useImperativeHandle:IS,useInsertionEffect:AS,useLayoutEffect:PS,useMemo:MS,useReducer:Y_,useRef:SS,useState:function(){return Y_(xd)},useDebugValue:Zv,useDeferredValue:function(t){var e=Ts();return yi===null?e.memoizedState=t:kS(e,yi.memoizedState,t)},useTransition:function(){var t=Y_(xd)[0],e=Ts().memoizedState;return[t,e]},useMutableSource:yS,useSyncExternalStore:vS,useId:RS,unstable_isNewReconciler:!1};function pu(t,e){try{var n="",i=e;do n+=JL(i),i=i.return;while(i);var s=n}catch(c){s=`
Error generating stack: `+c.message+`
`+c.stack}return{value:t,source:e,stack:s,digest:null}}function K_(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function y0(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Sk=typeof WeakMap=="function"?WeakMap:Map;function FS(t,e,n){n=Wo(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Sm||(Sm=!0,C0=i),y0(t,e)},n}function BS(t,e,n){n=Wo(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var s=e.value;n.payload=function(){return i(s)},n.callback=function(){y0(t,e)}}var c=t.stateNode;return c!==null&&typeof c.componentDidCatch=="function"&&(n.callback=function(){y0(t,e),typeof i!="function"&&(Ga===null?Ga=new Set([this]):Ga.add(this));var d=e.stack;this.componentDidCatch(e.value,{componentStack:d!==null?d:""})}),n}function lw(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Sk;var s=new Set;i.set(e,s)}else s=i.get(e),s===void 0&&(s=new Set,i.set(e,s));s.has(n)||(s.add(n),t=Nk.bind(null,t,e,n),e.then(t,t))}function cw(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function uw(t,e,n,i,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Wo(-1,1),e.tag=2,ja(n,e,1))),n.lanes|=1),t)}var Ak=Qo.ReactCurrentOwner,Cr=!1;function mr(t,e,n,i){e.child=t===null?gS(e,null,n,i):du(e,t.child,n,i)}function hw(t,e,n,i,s){n=n.render;var c=e.ref;return iu(e,s),i=$v(t,e,n,i,c,s),n=Hv(),t!==null&&!Cr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Zo(t,e,s)):(Dn&&n&&Rv(e),e.flags|=1,mr(t,e,i,s),e.child)}function dw(t,e,n,i,s){if(t===null){var c=n.type;return typeof c=="function"&&!nx(c)&&c.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=c,NS(t,e,c,i,s)):(t=qp(n.type,null,i,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(c=t.child,!(t.lanes&s)){var d=c.memoizedProps;if(n=n.compare,n=n!==null?n:fd,n(d,i)&&t.ref===e.ref)return Zo(t,e,s)}return e.flags|=1,t=$a(c,i),t.ref=e.ref,t.return=e,e.child=t}function NS(t,e,n,i,s){if(t!==null){var c=t.memoizedProps;if(fd(c,i)&&t.ref===e.ref)if(Cr=!1,e.pendingProps=i=c,(t.lanes&s)!==0)t.flags&131072&&(Cr=!0);else return e.lanes=t.lanes,Zo(t,e,s)}return v0(t,e,n,i,s)}function US(t,e,n){var i=e.pendingProps,s=i.children,c=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},An(Xc,Zr),Zr|=n;else{if(!(n&1073741824))return t=c!==null?c.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,An(Xc,Zr),Zr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=c!==null?c.baseLanes:n,An(Xc,Zr),Zr|=i}else c!==null?(i=c.baseLanes|n,e.memoizedState=null):i=n,An(Xc,Zr),Zr|=i;return mr(t,e,s,n),e.child}function VS(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function v0(t,e,n,i,s){var c=Lr(n)?Nl:ir.current;return c=uu(e,c),iu(e,s),n=$v(t,e,n,i,c,s),i=Hv(),t!==null&&!Cr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Zo(t,e,s)):(Dn&&i&&Rv(e),e.flags|=1,mr(t,e,n,s),e.child)}function fw(t,e,n,i,s){if(Lr(n)){var c=!0;mm(e)}else c=!1;if(iu(e,s),e.stateNode===null)Wp(t,e),pS(e,n,i),_0(e,n,i,s),i=!0;else if(t===null){var d=e.stateNode,l=e.memoizedProps;d.props=l;var y=d.context,w=n.contextType;typeof w=="object"&&w!==null?w=Es(w):(w=Lr(n)?Nl:ir.current,w=uu(e,w));var S=n.getDerivedStateFromProps,I=typeof S=="function"||typeof d.getSnapshotBeforeUpdate=="function";I||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(l!==i||y!==w)&&rw(e,d,i,w),La=!1;var P=e.memoizedState;d.state=P,xm(e,i,d,s),y=e.memoizedState,l!==i||P!==y||Ir.current||La?(typeof S=="function"&&(g0(e,n,S,i),y=e.memoizedState),(l=La||iw(e,n,l,i,P,y,w))?(I||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(e.flags|=4194308)):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=y),d.props=i,d.state=y,d.context=w,i=l):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{d=e.stateNode,dS(t,e),l=e.memoizedProps,w=e.type===e.elementType?l:Os(e.type,l),d.props=w,I=e.pendingProps,P=d.context,y=n.contextType,typeof y=="object"&&y!==null?y=Es(y):(y=Lr(n)?Nl:ir.current,y=uu(e,y));var B=n.getDerivedStateFromProps;(S=typeof B=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(l!==I||P!==y)&&rw(e,d,i,y),La=!1,P=e.memoizedState,d.state=P,xm(e,i,d,s);var G=e.memoizedState;l!==I||P!==G||Ir.current||La?(typeof B=="function"&&(g0(e,n,B,i),G=e.memoizedState),(w=La||iw(e,n,w,i,P,G,y)||!1)?(S||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(i,G,y),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(i,G,y)),typeof d.componentDidUpdate=="function"&&(e.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof d.componentDidUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=G),d.props=i,d.state=G,d.context=y,i=w):(typeof d.componentDidUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=1024),i=!1)}return x0(t,e,n,i,c,s)}function x0(t,e,n,i,s,c){VS(t,e);var d=(e.flags&128)!==0;if(!i&&!d)return s&&Jb(e,n,!1),Zo(t,e,c);i=e.stateNode,Ak.current=e;var l=d&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&d?(e.child=du(e,t.child,null,c),e.child=du(e,null,l,c)):mr(t,e,l,c),e.memoizedState=i.state,s&&Jb(e,n,!0),e.child}function jS(t){var e=t.stateNode;e.pendingContext?Kb(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Kb(t,e.context,!1),Vv(t,e.containerInfo)}function pw(t,e,n,i,s){return hu(),Dv(s),e.flags|=256,mr(t,e,n,i),e.child}var b0={dehydrated:null,treeContext:null,retryLane:0};function w0(t){return{baseLanes:t,cachePool:null,transitions:null}}function GS(t,e,n){var i=e.pendingProps,s=Un.current,c=!1,d=(e.flags&128)!==0,l;if((l=d)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(c=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),An(Un,s&1),t===null)return p0(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(d=i.children,t=i.fallback,c?(i=e.mode,c=e.child,d={mode:"hidden",children:d},!(i&1)&&c!==null?(c.childLanes=0,c.pendingProps=d):c=ag(d,i,0,null),t=Fl(t,i,n,null),c.return=e,t.return=e,c.sibling=t,e.child=c,e.child.memoizedState=w0(n),e.memoizedState=b0,t):Xv(e,d));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return Pk(t,e,d,i,l,s,n);if(c){c=i.fallback,d=e.mode,s=t.child,l=s.sibling;var y={mode:"hidden",children:i.children};return!(d&1)&&e.child!==s?(i=e.child,i.childLanes=0,i.pendingProps=y,e.deletions=null):(i=$a(s,y),i.subtreeFlags=s.subtreeFlags&14680064),l!==null?c=$a(l,c):(c=Fl(c,d,n,null),c.flags|=2),c.return=e,i.return=e,i.sibling=c,e.child=i,i=c,c=e.child,d=t.child.memoizedState,d=d===null?w0(n):{baseLanes:d.baseLanes|n,cachePool:null,transitions:d.transitions},c.memoizedState=d,c.childLanes=t.childLanes&~n,e.memoizedState=b0,i}return c=t.child,t=c.sibling,i=$a(c,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Xv(t,e){return e=ag({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function fp(t,e,n,i){return i!==null&&Dv(i),du(e,t.child,null,n),t=Xv(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Pk(t,e,n,i,s,c,d){if(n)return e.flags&256?(e.flags&=-257,i=K_(Error(We(422))),fp(t,e,d,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(c=i.fallback,s=e.mode,i=ag({mode:"visible",children:i.children},s,0,null),c=Fl(c,s,d,null),c.flags|=2,i.return=e,c.return=e,i.sibling=c,e.child=i,e.mode&1&&du(e,t.child,null,d),e.child.memoizedState=w0(d),e.memoizedState=b0,c);if(!(e.mode&1))return fp(t,e,d,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var l=i.dgst;return i=l,c=Error(We(419)),i=K_(c,i,void 0),fp(t,e,d,i)}if(l=(d&t.childLanes)!==0,Cr||l){if(i=Mi,i!==null){switch(d&-d){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(i.suspendedLanes|d)?0:s,s!==0&&s!==c.retryLane&&(c.retryLane=s,qo(t,s),js(i,t,s,-1))}return tx(),i=K_(Error(We(421))),fp(t,e,d,i)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=Uk.bind(null,t),s._reactRetry=e,null):(t=c.treeContext,Kr=Va(s.nextSibling),Qr=e,Dn=!0,Bs=null,t!==null&&(ys[vs++]=jo,ys[vs++]=Go,ys[vs++]=Ul,jo=t.id,Go=t.overflow,Ul=e),e=Xv(e,i.children),e.flags|=4096,e)}function mw(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),m0(t.return,e,n)}function J_(t,e,n,i,s){var c=t.memoizedState;c===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:s}:(c.isBackwards=e,c.rendering=null,c.renderingStartTime=0,c.last=i,c.tail=n,c.tailMode=s)}function WS(t,e,n){var i=e.pendingProps,s=i.revealOrder,c=i.tail;if(mr(t,e,i.children,n),i=Un.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&mw(t,n,e);else if(t.tag===19)mw(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(An(Un,i),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&bm(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),J_(e,!1,s,n,c);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&bm(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}J_(e,!0,n,null,c);break;case"together":J_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Wp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Zo(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),jl|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(We(153));if(e.child!==null){for(t=e.child,n=$a(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=$a(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Ck(t,e,n){switch(e.tag){case 3:jS(e),hu();break;case 5:_S(e);break;case 1:Lr(e.type)&&mm(e);break;case 4:Vv(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,s=e.memoizedProps.value;An(ym,i._currentValue),i._currentValue=s;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(An(Un,Un.current&1),e.flags|=128,null):n&e.child.childLanes?GS(t,e,n):(An(Un,Un.current&1),t=Zo(t,e,n),t!==null?t.sibling:null);An(Un,Un.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return WS(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),An(Un,Un.current),i)break;return null;case 22:case 23:return e.lanes=0,US(t,e,n)}return Zo(t,e,n)}var $S,E0,HS,qS;$S=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};E0=function(){};HS=function(t,e,n,i){var s=t.memoizedProps;if(s!==i){t=e.stateNode,zl(yo.current);var c=null;switch(n){case"input":s=$y(t,s),i=$y(t,i),c=[];break;case"select":s=Gn({},s,{value:void 0}),i=Gn({},i,{value:void 0}),c=[];break;case"textarea":s=Zy(t,s),i=Zy(t,i),c=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=fm)}Yy(n,i);var d;n=null;for(w in s)if(!i.hasOwnProperty(w)&&s.hasOwnProperty(w)&&s[w]!=null)if(w==="style"){var l=s[w];for(d in l)l.hasOwnProperty(d)&&(n||(n={}),n[d]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(od.hasOwnProperty(w)?c||(c=[]):(c=c||[]).push(w,null));for(w in i){var y=i[w];if(l=s!=null?s[w]:void 0,i.hasOwnProperty(w)&&y!==l&&(y!=null||l!=null))if(w==="style")if(l){for(d in l)!l.hasOwnProperty(d)||y&&y.hasOwnProperty(d)||(n||(n={}),n[d]="");for(d in y)y.hasOwnProperty(d)&&l[d]!==y[d]&&(n||(n={}),n[d]=y[d])}else n||(c||(c=[]),c.push(w,n)),n=y;else w==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,l=l?l.__html:void 0,y!=null&&l!==y&&(c=c||[]).push(w,y)):w==="children"?typeof y!="string"&&typeof y!="number"||(c=c||[]).push(w,""+y):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(od.hasOwnProperty(w)?(y!=null&&w==="onScroll"&&Cn("scroll",t),c||l===y||(c=[])):(c=c||[]).push(w,y))}n&&(c=c||[]).push("style",n);var w=c;(e.updateQueue=w)&&(e.flags|=4)}};qS=function(t,e,n,i){n!==i&&(e.flags|=4)};function Lh(t,e){if(!Dn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Ji(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Ik(t,e,n){var i=e.pendingProps;switch(zv(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ji(e),null;case 1:return Lr(e.type)&&pm(),Ji(e),null;case 3:return i=e.stateNode,fu(),Ln(Ir),Ln(ir),Gv(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(hp(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Bs!==null&&(M0(Bs),Bs=null))),E0(t,e),Ji(e),null;case 5:jv(e);var s=zl(yd.current);if(n=e.type,t!==null&&e.stateNode!=null)HS(t,e,n,i,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(We(166));return Ji(e),null}if(t=zl(yo.current),hp(e)){i=e.stateNode,n=e.type;var c=e.memoizedProps;switch(i[fo]=e,i[gd]=c,t=(e.mode&1)!==0,n){case"dialog":Cn("cancel",i),Cn("close",i);break;case"iframe":case"object":case"embed":Cn("load",i);break;case"video":case"audio":for(s=0;s<Gh.length;s++)Cn(Gh[s],i);break;case"source":Cn("error",i);break;case"img":case"image":case"link":Cn("error",i),Cn("load",i);break;case"details":Cn("toggle",i);break;case"input":Tb(i,c),Cn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!c.multiple},Cn("invalid",i);break;case"textarea":Ab(i,c),Cn("invalid",i)}Yy(n,c),s=null;for(var d in c)if(c.hasOwnProperty(d)){var l=c[d];d==="children"?typeof l=="string"?i.textContent!==l&&(c.suppressHydrationWarning!==!0&&up(i.textContent,l,t),s=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(c.suppressHydrationWarning!==!0&&up(i.textContent,l,t),s=["children",""+l]):od.hasOwnProperty(d)&&l!=null&&d==="onScroll"&&Cn("scroll",i)}switch(n){case"input":np(i),Sb(i,c,!0);break;case"textarea":np(i),Pb(i);break;case"select":case"option":break;default:typeof c.onClick=="function"&&(i.onclick=fm)}i=s,e.updateQueue=i,i!==null&&(e.flags|=4)}else{d=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=x2(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=d.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=d.createElement(n,{is:i.is}):(t=d.createElement(n),n==="select"&&(d=t,i.multiple?d.multiple=!0:i.size&&(d.size=i.size))):t=d.createElementNS(t,n),t[fo]=e,t[gd]=i,$S(t,e,!1,!1),e.stateNode=t;e:{switch(d=Ky(n,i),n){case"dialog":Cn("cancel",t),Cn("close",t),s=i;break;case"iframe":case"object":case"embed":Cn("load",t),s=i;break;case"video":case"audio":for(s=0;s<Gh.length;s++)Cn(Gh[s],t);s=i;break;case"source":Cn("error",t),s=i;break;case"img":case"image":case"link":Cn("error",t),Cn("load",t),s=i;break;case"details":Cn("toggle",t),s=i;break;case"input":Tb(t,i),s=$y(t,i),Cn("invalid",t);break;case"option":s=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},s=Gn({},i,{value:void 0}),Cn("invalid",t);break;case"textarea":Ab(t,i),s=Zy(t,i),Cn("invalid",t);break;default:s=i}Yy(n,s),l=s;for(c in l)if(l.hasOwnProperty(c)){var y=l[c];c==="style"?E2(t,y):c==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,y!=null&&b2(t,y)):c==="children"?typeof y=="string"?(n!=="textarea"||y!=="")&&ad(t,y):typeof y=="number"&&ad(t,""+y):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(od.hasOwnProperty(c)?y!=null&&c==="onScroll"&&Cn("scroll",t):y!=null&&vv(t,c,y,d))}switch(n){case"input":np(t),Sb(t,i,!1);break;case"textarea":np(t),Pb(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Za(i.value));break;case"select":t.multiple=!!i.multiple,c=i.value,c!=null?Qc(t,!!i.multiple,c,!1):i.defaultValue!=null&&Qc(t,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=fm)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ji(e),null;case 6:if(t&&e.stateNode!=null)qS(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(We(166));if(n=zl(yd.current),zl(yo.current),hp(e)){if(i=e.stateNode,n=e.memoizedProps,i[fo]=e,(c=i.nodeValue!==n)&&(t=Qr,t!==null))switch(t.tag){case 3:up(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&up(i.nodeValue,n,(t.mode&1)!==0)}c&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[fo]=e,e.stateNode=i}return Ji(e),null;case 13:if(Ln(Un),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Dn&&Kr!==null&&e.mode&1&&!(e.flags&128))uS(),hu(),e.flags|=98560,c=!1;else if(c=hp(e),i!==null&&i.dehydrated!==null){if(t===null){if(!c)throw Error(We(318));if(c=e.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(We(317));c[fo]=e}else hu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ji(e),c=!1}else Bs!==null&&(M0(Bs),Bs=null),c=!0;if(!c)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Un.current&1?vi===0&&(vi=3):tx())),e.updateQueue!==null&&(e.flags|=4),Ji(e),null);case 4:return fu(),E0(t,e),t===null&&pd(e.stateNode.containerInfo),Ji(e),null;case 10:return Bv(e.type._context),Ji(e),null;case 17:return Lr(e.type)&&pm(),Ji(e),null;case 19:if(Ln(Un),c=e.memoizedState,c===null)return Ji(e),null;if(i=(e.flags&128)!==0,d=c.rendering,d===null)if(i)Lh(c,!1);else{if(vi!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(d=bm(t),d!==null){for(e.flags|=128,Lh(c,!1),i=d.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)c=n,t=i,c.flags&=14680066,d=c.alternate,d===null?(c.childLanes=0,c.lanes=t,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=d.childLanes,c.lanes=d.lanes,c.child=d.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=d.memoizedProps,c.memoizedState=d.memoizedState,c.updateQueue=d.updateQueue,c.type=d.type,t=d.dependencies,c.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return An(Un,Un.current&1|2),e.child}t=t.sibling}c.tail!==null&&ii()>mu&&(e.flags|=128,i=!0,Lh(c,!1),e.lanes=4194304)}else{if(!i)if(t=bm(d),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Lh(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!Dn)return Ji(e),null}else 2*ii()-c.renderingStartTime>mu&&n!==1073741824&&(e.flags|=128,i=!0,Lh(c,!1),e.lanes=4194304);c.isBackwards?(d.sibling=e.child,e.child=d):(n=c.last,n!==null?n.sibling=d:e.child=d,c.last=d)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=ii(),e.sibling=null,n=Un.current,An(Un,i?n&1|2:n&1),e):(Ji(e),null);case 22:case 23:return ex(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Zr&1073741824&&(Ji(e),e.subtreeFlags&6&&(e.flags|=8192)):Ji(e),null;case 24:return null;case 25:return null}throw Error(We(156,e.tag))}function Lk(t,e){switch(zv(e),e.tag){case 1:return Lr(e.type)&&pm(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return fu(),Ln(Ir),Ln(ir),Gv(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return jv(e),null;case 13:if(Ln(Un),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(We(340));hu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ln(Un),null;case 4:return fu(),null;case 10:return Bv(e.type._context),null;case 22:case 23:return ex(),null;case 24:return null;default:return null}}var pp=!1,tr=!1,Mk=typeof WeakSet=="function"?WeakSet:Set,mt=null;function Zc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Yn(t,e,i)}else n.current=null}function T0(t,e,n){try{n()}catch(i){Yn(t,e,i)}}var gw=!1;function kk(t,e){if(a0=um,t=K2(),kv(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var s=i.anchorOffset,c=i.focusNode;i=i.focusOffset;try{n.nodeType,c.nodeType}catch{n=null;break e}var d=0,l=-1,y=-1,w=0,S=0,I=t,P=null;t:for(;;){for(var B;I!==n||s!==0&&I.nodeType!==3||(l=d+s),I!==c||i!==0&&I.nodeType!==3||(y=d+i),I.nodeType===3&&(d+=I.nodeValue.length),(B=I.firstChild)!==null;)P=I,I=B;for(;;){if(I===t)break t;if(P===n&&++w===s&&(l=d),P===c&&++S===i&&(y=d),(B=I.nextSibling)!==null)break;I=P,P=I.parentNode}I=B}n=l===-1||y===-1?null:{start:l,end:y}}else n=null}n=n||{start:0,end:0}}else n=null;for(l0={focusedElem:t,selectionRange:n},um=!1,mt=e;mt!==null;)if(e=mt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,mt=t;else for(;mt!==null;){e=mt;try{var G=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(G!==null){var K=G.memoizedProps,ue=G.memoizedState,q=e.stateNode,j=q.getSnapshotBeforeUpdate(e.elementType===e.type?K:Os(e.type,K),ue);q.__reactInternalSnapshotBeforeUpdate=j}break;case 3:var Z=e.stateNode.containerInfo;Z.nodeType===1?Z.textContent="":Z.nodeType===9&&Z.documentElement&&Z.removeChild(Z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(We(163))}}catch(re){Yn(e,e.return,re)}if(t=e.sibling,t!==null){t.return=e.return,mt=t;break}mt=e.return}return G=gw,gw=!1,G}function Qh(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&t)===t){var c=s.destroy;s.destroy=void 0,c!==void 0&&T0(e,n,c)}s=s.next}while(s!==i)}}function sg(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function S0(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function ZS(t){var e=t.alternate;e!==null&&(t.alternate=null,ZS(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[fo],delete e[gd],delete e[h0],delete e[pk],delete e[mk])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function XS(t){return t.tag===5||t.tag===3||t.tag===4}function _w(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||XS(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function A0(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=fm));else if(i!==4&&(t=t.child,t!==null))for(A0(t,e,n),t=t.sibling;t!==null;)A0(t,e,n),t=t.sibling}function P0(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(P0(t,e,n),t=t.sibling;t!==null;)P0(t,e,n),t=t.sibling}var Ui=null,Fs=!1;function Ea(t,e,n){for(n=n.child;n!==null;)YS(t,e,n),n=n.sibling}function YS(t,e,n){if(_o&&typeof _o.onCommitFiberUnmount=="function")try{_o.onCommitFiberUnmount(Km,n)}catch{}switch(n.tag){case 5:tr||Zc(n,e);case 6:var i=Ui,s=Fs;Ui=null,Ea(t,e,n),Ui=i,Fs=s,Ui!==null&&(Fs?(t=Ui,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ui.removeChild(n.stateNode));break;case 18:Ui!==null&&(Fs?(t=Ui,n=n.stateNode,t.nodeType===8?$_(t.parentNode,n):t.nodeType===1&&$_(t,n),hd(t)):$_(Ui,n.stateNode));break;case 4:i=Ui,s=Fs,Ui=n.stateNode.containerInfo,Fs=!0,Ea(t,e,n),Ui=i,Fs=s;break;case 0:case 11:case 14:case 15:if(!tr&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var c=s,d=c.destroy;c=c.tag,d!==void 0&&(c&2||c&4)&&T0(n,e,d),s=s.next}while(s!==i)}Ea(t,e,n);break;case 1:if(!tr&&(Zc(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){Yn(n,e,l)}Ea(t,e,n);break;case 21:Ea(t,e,n);break;case 22:n.mode&1?(tr=(i=tr)||n.memoizedState!==null,Ea(t,e,n),tr=i):Ea(t,e,n);break;default:Ea(t,e,n)}}function yw(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Mk),e.forEach(function(i){var s=Vk.bind(null,t,i);n.has(i)||(n.add(i),i.then(s,s))})}}function Ds(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var s=n[i];try{var c=t,d=e,l=d;e:for(;l!==null;){switch(l.tag){case 5:Ui=l.stateNode,Fs=!1;break e;case 3:Ui=l.stateNode.containerInfo,Fs=!0;break e;case 4:Ui=l.stateNode.containerInfo,Fs=!0;break e}l=l.return}if(Ui===null)throw Error(We(160));YS(c,d,s),Ui=null,Fs=!1;var y=s.alternate;y!==null&&(y.return=null),s.return=null}catch(w){Yn(s,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)KS(e,t),e=e.sibling}function KS(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ds(e,t),oo(t),i&4){try{Qh(3,t,t.return),sg(3,t)}catch(K){Yn(t,t.return,K)}try{Qh(5,t,t.return)}catch(K){Yn(t,t.return,K)}}break;case 1:Ds(e,t),oo(t),i&512&&n!==null&&Zc(n,n.return);break;case 5:if(Ds(e,t),oo(t),i&512&&n!==null&&Zc(n,n.return),t.flags&32){var s=t.stateNode;try{ad(s,"")}catch(K){Yn(t,t.return,K)}}if(i&4&&(s=t.stateNode,s!=null)){var c=t.memoizedProps,d=n!==null?n.memoizedProps:c,l=t.type,y=t.updateQueue;if(t.updateQueue=null,y!==null)try{l==="input"&&c.type==="radio"&&c.name!=null&&y2(s,c),Ky(l,d);var w=Ky(l,c);for(d=0;d<y.length;d+=2){var S=y[d],I=y[d+1];S==="style"?E2(s,I):S==="dangerouslySetInnerHTML"?b2(s,I):S==="children"?ad(s,I):vv(s,S,I,w)}switch(l){case"input":Hy(s,c);break;case"textarea":v2(s,c);break;case"select":var P=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!c.multiple;var B=c.value;B!=null?Qc(s,!!c.multiple,B,!1):P!==!!c.multiple&&(c.defaultValue!=null?Qc(s,!!c.multiple,c.defaultValue,!0):Qc(s,!!c.multiple,c.multiple?[]:"",!1))}s[gd]=c}catch(K){Yn(t,t.return,K)}}break;case 6:if(Ds(e,t),oo(t),i&4){if(t.stateNode===null)throw Error(We(162));s=t.stateNode,c=t.memoizedProps;try{s.nodeValue=c}catch(K){Yn(t,t.return,K)}}break;case 3:if(Ds(e,t),oo(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{hd(e.containerInfo)}catch(K){Yn(t,t.return,K)}break;case 4:Ds(e,t),oo(t);break;case 13:Ds(e,t),oo(t),s=t.child,s.flags&8192&&(c=s.memoizedState!==null,s.stateNode.isHidden=c,!c||s.alternate!==null&&s.alternate.memoizedState!==null||(Jv=ii())),i&4&&yw(t);break;case 22:if(S=n!==null&&n.memoizedState!==null,t.mode&1?(tr=(w=tr)||S,Ds(e,t),tr=w):Ds(e,t),oo(t),i&8192){if(w=t.memoizedState!==null,(t.stateNode.isHidden=w)&&!S&&t.mode&1)for(mt=t,S=t.child;S!==null;){for(I=mt=S;mt!==null;){switch(P=mt,B=P.child,P.tag){case 0:case 11:case 14:case 15:Qh(4,P,P.return);break;case 1:Zc(P,P.return);var G=P.stateNode;if(typeof G.componentWillUnmount=="function"){i=P,n=P.return;try{e=i,G.props=e.memoizedProps,G.state=e.memoizedState,G.componentWillUnmount()}catch(K){Yn(i,n,K)}}break;case 5:Zc(P,P.return);break;case 22:if(P.memoizedState!==null){xw(I);continue}}B!==null?(B.return=P,mt=B):xw(I)}S=S.sibling}e:for(S=null,I=t;;){if(I.tag===5){if(S===null){S=I;try{s=I.stateNode,w?(c=s.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none"):(l=I.stateNode,y=I.memoizedProps.style,d=y!=null&&y.hasOwnProperty("display")?y.display:null,l.style.display=w2("display",d))}catch(K){Yn(t,t.return,K)}}}else if(I.tag===6){if(S===null)try{I.stateNode.nodeValue=w?"":I.memoizedProps}catch(K){Yn(t,t.return,K)}}else if((I.tag!==22&&I.tag!==23||I.memoizedState===null||I===t)&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===t)break e;for(;I.sibling===null;){if(I.return===null||I.return===t)break e;S===I&&(S=null),I=I.return}S===I&&(S=null),I.sibling.return=I.return,I=I.sibling}}break;case 19:Ds(e,t),oo(t),i&4&&yw(t);break;case 21:break;default:Ds(e,t),oo(t)}}function oo(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(XS(n)){var i=n;break e}n=n.return}throw Error(We(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(ad(s,""),i.flags&=-33);var c=_w(t);P0(t,c,s);break;case 3:case 4:var d=i.stateNode.containerInfo,l=_w(t);A0(t,l,d);break;default:throw Error(We(161))}}catch(y){Yn(t,t.return,y)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Rk(t,e,n){mt=t,JS(t)}function JS(t,e,n){for(var i=(t.mode&1)!==0;mt!==null;){var s=mt,c=s.child;if(s.tag===22&&i){var d=s.memoizedState!==null||pp;if(!d){var l=s.alternate,y=l!==null&&l.memoizedState!==null||tr;l=pp;var w=tr;if(pp=d,(tr=y)&&!w)for(mt=s;mt!==null;)d=mt,y=d.child,d.tag===22&&d.memoizedState!==null?bw(s):y!==null?(y.return=d,mt=y):bw(s);for(;c!==null;)mt=c,JS(c),c=c.sibling;mt=s,pp=l,tr=w}vw(t)}else s.subtreeFlags&8772&&c!==null?(c.return=s,mt=c):vw(t)}}function vw(t){for(;mt!==null;){var e=mt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:tr||sg(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!tr)if(n===null)i.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Os(e.type,n.memoizedProps);i.componentDidUpdate(s,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var c=e.updateQueue;c!==null&&nw(e,c,i);break;case 3:var d=e.updateQueue;if(d!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}nw(e,d,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var y=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":y.autoFocus&&n.focus();break;case"img":y.src&&(n.src=y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var S=w.memoizedState;if(S!==null){var I=S.dehydrated;I!==null&&hd(I)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(We(163))}tr||e.flags&512&&S0(e)}catch(P){Yn(e,e.return,P)}}if(e===t){mt=null;break}if(n=e.sibling,n!==null){n.return=e.return,mt=n;break}mt=e.return}}function xw(t){for(;mt!==null;){var e=mt;if(e===t){mt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,mt=n;break}mt=e.return}}function bw(t){for(;mt!==null;){var e=mt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{sg(4,e)}catch(y){Yn(e,n,y)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var s=e.return;try{i.componentDidMount()}catch(y){Yn(e,s,y)}}var c=e.return;try{S0(e)}catch(y){Yn(e,c,y)}break;case 5:var d=e.return;try{S0(e)}catch(y){Yn(e,d,y)}}}catch(y){Yn(e,e.return,y)}if(e===t){mt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,mt=l;break}mt=e.return}}var zk=Math.ceil,Tm=Qo.ReactCurrentDispatcher,Yv=Qo.ReactCurrentOwner,bs=Qo.ReactCurrentBatchConfig,an=0,Mi=null,di=null,Vi=0,Zr=0,Xc=Ja(0),vi=0,wd=null,jl=0,og=0,Kv=0,ed=null,Pr=null,Jv=0,mu=1/0,Bo=null,Sm=!1,C0=null,Ga=null,mp=!1,za=null,Am=0,td=0,I0=null,$p=-1,Hp=0;function _r(){return an&6?ii():$p!==-1?$p:$p=ii()}function Wa(t){return t.mode&1?an&2&&Vi!==0?Vi&-Vi:_k.transition!==null?(Hp===0&&(Hp=D2()),Hp):(t=mn,t!==0||(t=window.event,t=t===void 0?16:j2(t.type)),t):1}function js(t,e,n,i){if(50<td)throw td=0,I0=null,Error(We(185));zd(t,n,i),(!(an&2)||t!==Mi)&&(t===Mi&&(!(an&2)&&(og|=n),vi===4&&ka(t,Vi)),Mr(t,i),n===1&&an===0&&!(e.mode&1)&&(mu=ii()+500,ng&&Qa()))}function Mr(t,e){var n=t.callbackNode;_M(t,e);var i=cm(t,t===Mi?Vi:0);if(i===0)n!==null&&Lb(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Lb(n),e===1)t.tag===0?gk(ww.bind(null,t)):aS(ww.bind(null,t)),dk(function(){!(an&6)&&Qa()}),n=null;else{switch(O2(i)){case 1:n=Tv;break;case 4:n=R2;break;case 16:n=lm;break;case 536870912:n=z2;break;default:n=lm}n=oA(n,QS.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function QS(t,e){if($p=-1,Hp=0,an&6)throw Error(We(327));var n=t.callbackNode;if(ru()&&t.callbackNode!==n)return null;var i=cm(t,t===Mi?Vi:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Pm(t,i);else{e=i;var s=an;an|=2;var c=tA();(Mi!==t||Vi!==e)&&(Bo=null,mu=ii()+500,Ol(t,e));do try{Fk();break}catch(l){eA(t,l)}while(1);Fv(),Tm.current=c,an=s,di!==null?e=0:(Mi=null,Vi=0,e=vi)}if(e!==0){if(e===2&&(s=n0(t),s!==0&&(i=s,e=L0(t,s))),e===1)throw n=wd,Ol(t,0),ka(t,i),Mr(t,ii()),n;if(e===6)ka(t,i);else{if(s=t.current.alternate,!(i&30)&&!Dk(s)&&(e=Pm(t,i),e===2&&(c=n0(t),c!==0&&(i=c,e=L0(t,c))),e===1))throw n=wd,Ol(t,0),ka(t,i),Mr(t,ii()),n;switch(t.finishedWork=s,t.finishedLanes=i,e){case 0:case 1:throw Error(We(345));case 2:Ll(t,Pr,Bo);break;case 3:if(ka(t,i),(i&130023424)===i&&(e=Jv+500-ii(),10<e)){if(cm(t,0)!==0)break;if(s=t.suspendedLanes,(s&i)!==i){_r(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=u0(Ll.bind(null,t,Pr,Bo),e);break}Ll(t,Pr,Bo);break;case 4:if(ka(t,i),(i&4194240)===i)break;for(e=t.eventTimes,s=-1;0<i;){var d=31-Vs(i);c=1<<d,d=e[d],d>s&&(s=d),i&=~c}if(i=s,i=ii()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*zk(i/1960))-i,10<i){t.timeoutHandle=u0(Ll.bind(null,t,Pr,Bo),i);break}Ll(t,Pr,Bo);break;case 5:Ll(t,Pr,Bo);break;default:throw Error(We(329))}}}return Mr(t,ii()),t.callbackNode===n?QS.bind(null,t):null}function L0(t,e){var n=ed;return t.current.memoizedState.isDehydrated&&(Ol(t,e).flags|=256),t=Pm(t,e),t!==2&&(e=Pr,Pr=n,e!==null&&M0(e)),t}function M0(t){Pr===null?Pr=t:Pr.push.apply(Pr,t)}function Dk(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var s=n[i],c=s.getSnapshot;s=s.value;try{if(!Ws(c(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ka(t,e){for(e&=~Kv,e&=~og,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Vs(e),i=1<<n;t[n]=-1,e&=~i}}function ww(t){if(an&6)throw Error(We(327));ru();var e=cm(t,0);if(!(e&1))return Mr(t,ii()),null;var n=Pm(t,e);if(t.tag!==0&&n===2){var i=n0(t);i!==0&&(e=i,n=L0(t,i))}if(n===1)throw n=wd,Ol(t,0),ka(t,e),Mr(t,ii()),n;if(n===6)throw Error(We(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ll(t,Pr,Bo),Mr(t,ii()),null}function Qv(t,e){var n=an;an|=1;try{return t(e)}finally{an=n,an===0&&(mu=ii()+500,ng&&Qa())}}function Gl(t){za!==null&&za.tag===0&&!(an&6)&&ru();var e=an;an|=1;var n=bs.transition,i=mn;try{if(bs.transition=null,mn=1,t)return t()}finally{mn=i,bs.transition=n,an=e,!(an&6)&&Qa()}}function ex(){Zr=Xc.current,Ln(Xc)}function Ol(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,hk(n)),di!==null)for(n=di.return;n!==null;){var i=n;switch(zv(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&pm();break;case 3:fu(),Ln(Ir),Ln(ir),Gv();break;case 5:jv(i);break;case 4:fu();break;case 13:Ln(Un);break;case 19:Ln(Un);break;case 10:Bv(i.type._context);break;case 22:case 23:ex()}n=n.return}if(Mi=t,di=t=$a(t.current,null),Vi=Zr=e,vi=0,wd=null,Kv=og=jl=0,Pr=ed=null,Rl!==null){for(e=0;e<Rl.length;e++)if(n=Rl[e],i=n.interleaved,i!==null){n.interleaved=null;var s=i.next,c=n.pending;if(c!==null){var d=c.next;c.next=s,i.next=d}n.pending=i}Rl=null}return t}function eA(t,e){do{var n=di;try{if(Fv(),jp.current=Em,wm){for(var i=jn.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}wm=!1}if(Vl=0,Ii=yi=jn=null,Jh=!1,vd=0,Yv.current=null,n===null||n.return===null){vi=1,wd=e,di=null;break}e:{var c=t,d=n.return,l=n,y=e;if(e=Vi,l.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){var w=y,S=l,I=S.tag;if(!(S.mode&1)&&(I===0||I===11||I===15)){var P=S.alternate;P?(S.updateQueue=P.updateQueue,S.memoizedState=P.memoizedState,S.lanes=P.lanes):(S.updateQueue=null,S.memoizedState=null)}var B=cw(d);if(B!==null){B.flags&=-257,uw(B,d,l,c,e),B.mode&1&&lw(c,w,e),e=B,y=w;var G=e.updateQueue;if(G===null){var K=new Set;K.add(y),e.updateQueue=K}else G.add(y);break e}else{if(!(e&1)){lw(c,w,e),tx();break e}y=Error(We(426))}}else if(Dn&&l.mode&1){var ue=cw(d);if(ue!==null){!(ue.flags&65536)&&(ue.flags|=256),uw(ue,d,l,c,e),Dv(pu(y,l));break e}}c=y=pu(y,l),vi!==4&&(vi=2),ed===null?ed=[c]:ed.push(c),c=d;do{switch(c.tag){case 3:c.flags|=65536,e&=-e,c.lanes|=e;var q=FS(c,y,e);tw(c,q);break e;case 1:l=y;var j=c.type,Z=c.stateNode;if(!(c.flags&128)&&(typeof j.getDerivedStateFromError=="function"||Z!==null&&typeof Z.componentDidCatch=="function"&&(Ga===null||!Ga.has(Z)))){c.flags|=65536,e&=-e,c.lanes|=e;var re=BS(c,l,e);tw(c,re);break e}}c=c.return}while(c!==null)}iA(n)}catch(pe){e=pe,di===n&&n!==null&&(di=n=n.return);continue}break}while(1)}function tA(){var t=Tm.current;return Tm.current=Em,t===null?Em:t}function tx(){(vi===0||vi===3||vi===2)&&(vi=4),Mi===null||!(jl&268435455)&&!(og&268435455)||ka(Mi,Vi)}function Pm(t,e){var n=an;an|=2;var i=tA();(Mi!==t||Vi!==e)&&(Bo=null,Ol(t,e));do try{Ok();break}catch(s){eA(t,s)}while(1);if(Fv(),an=n,Tm.current=i,di!==null)throw Error(We(261));return Mi=null,Vi=0,vi}function Ok(){for(;di!==null;)nA(di)}function Fk(){for(;di!==null&&!lM();)nA(di)}function nA(t){var e=sA(t.alternate,t,Zr);t.memoizedProps=t.pendingProps,e===null?iA(t):di=e,Yv.current=null}function iA(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Lk(n,e),n!==null){n.flags&=32767,di=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{vi=6,di=null;return}}else if(n=Ik(n,e,Zr),n!==null){di=n;return}if(e=e.sibling,e!==null){di=e;return}di=e=t}while(e!==null);vi===0&&(vi=5)}function Ll(t,e,n){var i=mn,s=bs.transition;try{bs.transition=null,mn=1,Bk(t,e,n,i)}finally{bs.transition=s,mn=i}return null}function Bk(t,e,n,i){do ru();while(za!==null);if(an&6)throw Error(We(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(We(177));t.callbackNode=null,t.callbackPriority=0;var c=n.lanes|n.childLanes;if(yM(t,c),t===Mi&&(di=Mi=null,Vi=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||mp||(mp=!0,oA(lm,function(){return ru(),null})),c=(n.flags&15990)!==0,n.subtreeFlags&15990||c){c=bs.transition,bs.transition=null;var d=mn;mn=1;var l=an;an|=4,Yv.current=null,kk(t,n),KS(n,t),rk(l0),um=!!a0,l0=a0=null,t.current=n,Rk(n),cM(),an=l,mn=d,bs.transition=c}else t.current=n;if(mp&&(mp=!1,za=t,Am=s),c=t.pendingLanes,c===0&&(Ga=null),dM(n.stateNode),Mr(t,ii()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],i(s.value,{componentStack:s.stack,digest:s.digest});if(Sm)throw Sm=!1,t=C0,C0=null,t;return Am&1&&t.tag!==0&&ru(),c=t.pendingLanes,c&1?t===I0?td++:(td=0,I0=t):td=0,Qa(),null}function ru(){if(za!==null){var t=O2(Am),e=bs.transition,n=mn;try{if(bs.transition=null,mn=16>t?16:t,za===null)var i=!1;else{if(t=za,za=null,Am=0,an&6)throw Error(We(331));var s=an;for(an|=4,mt=t.current;mt!==null;){var c=mt,d=c.child;if(mt.flags&16){var l=c.deletions;if(l!==null){for(var y=0;y<l.length;y++){var w=l[y];for(mt=w;mt!==null;){var S=mt;switch(S.tag){case 0:case 11:case 15:Qh(8,S,c)}var I=S.child;if(I!==null)I.return=S,mt=I;else for(;mt!==null;){S=mt;var P=S.sibling,B=S.return;if(ZS(S),S===w){mt=null;break}if(P!==null){P.return=B,mt=P;break}mt=B}}}var G=c.alternate;if(G!==null){var K=G.child;if(K!==null){G.child=null;do{var ue=K.sibling;K.sibling=null,K=ue}while(K!==null)}}mt=c}}if(c.subtreeFlags&2064&&d!==null)d.return=c,mt=d;else e:for(;mt!==null;){if(c=mt,c.flags&2048)switch(c.tag){case 0:case 11:case 15:Qh(9,c,c.return)}var q=c.sibling;if(q!==null){q.return=c.return,mt=q;break e}mt=c.return}}var j=t.current;for(mt=j;mt!==null;){d=mt;var Z=d.child;if(d.subtreeFlags&2064&&Z!==null)Z.return=d,mt=Z;else e:for(d=j;mt!==null;){if(l=mt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:sg(9,l)}}catch(pe){Yn(l,l.return,pe)}if(l===d){mt=null;break e}var re=l.sibling;if(re!==null){re.return=l.return,mt=re;break e}mt=l.return}}if(an=s,Qa(),_o&&typeof _o.onPostCommitFiberRoot=="function")try{_o.onPostCommitFiberRoot(Km,t)}catch{}i=!0}return i}finally{mn=n,bs.transition=e}}return!1}function Ew(t,e,n){e=pu(n,e),e=FS(t,e,1),t=ja(t,e,1),e=_r(),t!==null&&(zd(t,1,e),Mr(t,e))}function Yn(t,e,n){if(t.tag===3)Ew(t,t,n);else for(;e!==null;){if(e.tag===3){Ew(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Ga===null||!Ga.has(i))){t=pu(n,t),t=BS(e,t,1),e=ja(e,t,1),t=_r(),e!==null&&(zd(e,1,t),Mr(e,t));break}}e=e.return}}function Nk(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=_r(),t.pingedLanes|=t.suspendedLanes&n,Mi===t&&(Vi&n)===n&&(vi===4||vi===3&&(Vi&130023424)===Vi&&500>ii()-Jv?Ol(t,0):Kv|=n),Mr(t,e)}function rA(t,e){e===0&&(t.mode&1?(e=sp,sp<<=1,!(sp&130023424)&&(sp=4194304)):e=1);var n=_r();t=qo(t,e),t!==null&&(zd(t,e,n),Mr(t,n))}function Uk(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),rA(t,n)}function Vk(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(We(314))}i!==null&&i.delete(e),rA(t,n)}var sA;sA=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ir.current)Cr=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Cr=!1,Ck(t,e,n);Cr=!!(t.flags&131072)}else Cr=!1,Dn&&e.flags&1048576&&lS(e,_m,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Wp(t,e),t=e.pendingProps;var s=uu(e,ir.current);iu(e,n),s=$v(null,e,i,t,s,n);var c=Hv();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Lr(i)?(c=!0,mm(e)):c=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Uv(e),s.updater=ig,e.stateNode=s,s._reactInternals=e,_0(e,i,t,n),e=x0(null,e,i,!0,c,n)):(e.tag=0,Dn&&c&&Rv(e),mr(null,e,s,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Wp(t,e),t=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=Gk(i),t=Os(i,t),s){case 0:e=v0(null,e,i,t,n);break e;case 1:e=fw(null,e,i,t,n);break e;case 11:e=hw(null,e,i,t,n);break e;case 14:e=dw(null,e,i,Os(i.type,t),n);break e}throw Error(We(306,i,""))}return e;case 0:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Os(i,s),v0(t,e,i,s,n);case 1:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Os(i,s),fw(t,e,i,s,n);case 3:e:{if(jS(e),t===null)throw Error(We(387));i=e.pendingProps,c=e.memoizedState,s=c.element,dS(t,e),xm(e,i,null,n);var d=e.memoizedState;if(i=d.element,c.isDehydrated)if(c={element:i,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},e.updateQueue.baseState=c,e.memoizedState=c,e.flags&256){s=pu(Error(We(423)),e),e=pw(t,e,i,n,s);break e}else if(i!==s){s=pu(Error(We(424)),e),e=pw(t,e,i,n,s);break e}else for(Kr=Va(e.stateNode.containerInfo.firstChild),Qr=e,Dn=!0,Bs=null,n=gS(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(hu(),i===s){e=Zo(t,e,n);break e}mr(t,e,i,n)}e=e.child}return e;case 5:return _S(e),t===null&&p0(e),i=e.type,s=e.pendingProps,c=t!==null?t.memoizedProps:null,d=s.children,c0(i,s)?d=null:c!==null&&c0(i,c)&&(e.flags|=32),VS(t,e),mr(t,e,d,n),e.child;case 6:return t===null&&p0(e),null;case 13:return GS(t,e,n);case 4:return Vv(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=du(e,null,i,n):mr(t,e,i,n),e.child;case 11:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Os(i,s),hw(t,e,i,s,n);case 7:return mr(t,e,e.pendingProps,n),e.child;case 8:return mr(t,e,e.pendingProps.children,n),e.child;case 12:return mr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,s=e.pendingProps,c=e.memoizedProps,d=s.value,An(ym,i._currentValue),i._currentValue=d,c!==null)if(Ws(c.value,d)){if(c.children===s.children&&!Ir.current){e=Zo(t,e,n);break e}}else for(c=e.child,c!==null&&(c.return=e);c!==null;){var l=c.dependencies;if(l!==null){d=c.child;for(var y=l.firstContext;y!==null;){if(y.context===i){if(c.tag===1){y=Wo(-1,n&-n),y.tag=2;var w=c.updateQueue;if(w!==null){w=w.shared;var S=w.pending;S===null?y.next=y:(y.next=S.next,S.next=y),w.pending=y}}c.lanes|=n,y=c.alternate,y!==null&&(y.lanes|=n),m0(c.return,n,e),l.lanes|=n;break}y=y.next}}else if(c.tag===10)d=c.type===e.type?null:c.child;else if(c.tag===18){if(d=c.return,d===null)throw Error(We(341));d.lanes|=n,l=d.alternate,l!==null&&(l.lanes|=n),m0(d,n,e),d=c.sibling}else d=c.child;if(d!==null)d.return=c;else for(d=c;d!==null;){if(d===e){d=null;break}if(c=d.sibling,c!==null){c.return=d.return,d=c;break}d=d.return}c=d}mr(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,i=e.pendingProps.children,iu(e,n),s=Es(s),i=i(s),e.flags|=1,mr(t,e,i,n),e.child;case 14:return i=e.type,s=Os(i,e.pendingProps),s=Os(i.type,s),dw(t,e,i,s,n);case 15:return NS(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Os(i,s),Wp(t,e),e.tag=1,Lr(i)?(t=!0,mm(e)):t=!1,iu(e,n),pS(e,i,s),_0(e,i,s,n),x0(null,e,i,!0,t,n);case 19:return WS(t,e,n);case 22:return US(t,e,n)}throw Error(We(156,e.tag))};function oA(t,e){return k2(t,e)}function jk(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xs(t,e,n,i){return new jk(t,e,n,i)}function nx(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Gk(t){if(typeof t=="function")return nx(t)?1:0;if(t!=null){if(t=t.$$typeof,t===bv)return 11;if(t===wv)return 14}return 2}function $a(t,e){var n=t.alternate;return n===null?(n=xs(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function qp(t,e,n,i,s,c){var d=2;if(i=t,typeof t=="function")nx(t)&&(d=1);else if(typeof t=="string")d=5;else e:switch(t){case Nc:return Fl(n.children,s,c,e);case xv:d=8,s|=8;break;case Vy:return t=xs(12,n,e,s|2),t.elementType=Vy,t.lanes=c,t;case jy:return t=xs(13,n,e,s),t.elementType=jy,t.lanes=c,t;case Gy:return t=xs(19,n,e,s),t.elementType=Gy,t.lanes=c,t;case m2:return ag(n,s,c,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case f2:d=10;break e;case p2:d=9;break e;case bv:d=11;break e;case wv:d=14;break e;case Ia:d=16,i=null;break e}throw Error(We(130,t==null?t:typeof t,""))}return e=xs(d,n,e,s),e.elementType=t,e.type=i,e.lanes=c,e}function Fl(t,e,n,i){return t=xs(7,t,i,e),t.lanes=n,t}function ag(t,e,n,i){return t=xs(22,t,i,e),t.elementType=m2,t.lanes=n,t.stateNode={isHidden:!1},t}function Q_(t,e,n){return t=xs(6,t,null,e),t.lanes=n,t}function ey(t,e,n){return e=xs(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Wk(t,e,n,i,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=z_(0),this.expirationTimes=z_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=z_(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function ix(t,e,n,i,s,c,d,l,y){return t=new Wk(t,e,n,l,y),e===1?(e=1,c===!0&&(e|=8)):e=0,c=xs(3,null,null,e),t.current=c,c.stateNode=t,c.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Uv(c),t}function $k(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Bc,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function aA(t){if(!t)return Xa;t=t._reactInternals;e:{if(Yl(t)!==t||t.tag!==1)throw Error(We(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Lr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(We(171))}if(t.tag===1){var n=t.type;if(Lr(n))return oS(t,n,e)}return e}function lA(t,e,n,i,s,c,d,l,y){return t=ix(n,i,!0,t,s,c,d,l,y),t.context=aA(null),n=t.current,i=_r(),s=Wa(n),c=Wo(i,s),c.callback=e??null,ja(n,c,s),t.current.lanes=s,zd(t,s,i),Mr(t,i),t}function lg(t,e,n,i){var s=e.current,c=_r(),d=Wa(s);return n=aA(n),e.context===null?e.context=n:e.pendingContext=n,e=Wo(c,d),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=ja(s,e,d),t!==null&&(js(t,s,d,c),Vp(t,s,d)),d}function Cm(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Tw(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function rx(t,e){Tw(t,e),(t=t.alternate)&&Tw(t,e)}function Hk(){return null}var cA=typeof reportError=="function"?reportError:function(t){console.error(t)};function sx(t){this._internalRoot=t}cg.prototype.render=sx.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(We(409));lg(t,e,null,null)};cg.prototype.unmount=sx.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Gl(function(){lg(null,t,null,null)}),e[Ho]=null}};function cg(t){this._internalRoot=t}cg.prototype.unstable_scheduleHydration=function(t){if(t){var e=N2();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ma.length&&e!==0&&e<Ma[n].priority;n++);Ma.splice(n,0,t),n===0&&V2(t)}};function ox(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ug(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Sw(){}function qk(t,e,n,i,s){if(s){if(typeof i=="function"){var c=i;i=function(){var w=Cm(d);c.call(w)}}var d=lA(e,i,t,0,null,!1,!1,"",Sw);return t._reactRootContainer=d,t[Ho]=d.current,pd(t.nodeType===8?t.parentNode:t),Gl(),d}for(;s=t.lastChild;)t.removeChild(s);if(typeof i=="function"){var l=i;i=function(){var w=Cm(y);l.call(w)}}var y=ix(t,0,!1,null,null,!1,!1,"",Sw);return t._reactRootContainer=y,t[Ho]=y.current,pd(t.nodeType===8?t.parentNode:t),Gl(function(){lg(e,y,n,i)}),y}function hg(t,e,n,i,s){var c=n._reactRootContainer;if(c){var d=c;if(typeof s=="function"){var l=s;s=function(){var y=Cm(d);l.call(y)}}lg(e,d,t,s)}else d=qk(n,e,t,s,i);return Cm(d)}F2=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=jh(e.pendingLanes);n!==0&&(Sv(e,n|1),Mr(e,ii()),!(an&6)&&(mu=ii()+500,Qa()))}break;case 13:Gl(function(){var i=qo(t,1);if(i!==null){var s=_r();js(i,t,1,s)}}),rx(t,1)}};Av=function(t){if(t.tag===13){var e=qo(t,134217728);if(e!==null){var n=_r();js(e,t,134217728,n)}rx(t,134217728)}};B2=function(t){if(t.tag===13){var e=Wa(t),n=qo(t,e);if(n!==null){var i=_r();js(n,t,e,i)}rx(t,e)}};N2=function(){return mn};U2=function(t,e){var n=mn;try{return mn=t,e()}finally{mn=n}};Qy=function(t,e,n){switch(e){case"input":if(Hy(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var s=tg(i);if(!s)throw Error(We(90));_2(i),Hy(i,s)}}}break;case"textarea":v2(t,n);break;case"select":e=n.value,e!=null&&Qc(t,!!n.multiple,e,!1)}};A2=Qv;P2=Gl;var Zk={usingClientEntryPoint:!1,Events:[Od,Gc,tg,T2,S2,Qv]},Mh={findFiberByHostInstance:kl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Xk={bundleType:Mh.bundleType,version:Mh.version,rendererPackageName:Mh.rendererPackageName,rendererConfig:Mh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Qo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=L2(t),t===null?null:t.stateNode},findFiberByHostInstance:Mh.findFiberByHostInstance||Hk,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gp.isDisabled&&gp.supportsFiber)try{Km=gp.inject(Xk),_o=gp}catch{}}is.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zk;is.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ox(e))throw Error(We(200));return $k(t,e,null,n)};is.createRoot=function(t,e){if(!ox(t))throw Error(We(299));var n=!1,i="",s=cA;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=ix(t,1,!1,null,null,n,!1,i,s),t[Ho]=e.current,pd(t.nodeType===8?t.parentNode:t),new sx(e)};is.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(We(188)):(t=Object.keys(t).join(","),Error(We(268,t)));return t=L2(e),t=t===null?null:t.stateNode,t};is.flushSync=function(t){return Gl(t)};is.hydrate=function(t,e,n){if(!ug(e))throw Error(We(200));return hg(null,t,e,!0,n)};is.hydrateRoot=function(t,e,n){if(!ox(t))throw Error(We(405));var i=n!=null&&n.hydratedSources||null,s=!1,c="",d=cA;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),e=lA(e,null,t,1,n??null,s,!1,c,d),t[Ho]=e.current,pd(t),i)for(t=0;t<i.length;t++)n=i[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new cg(e)};is.render=function(t,e,n){if(!ug(e))throw Error(We(200));return hg(null,t,e,!1,n)};is.unmountComponentAtNode=function(t){if(!ug(t))throw Error(We(40));return t._reactRootContainer?(Gl(function(){hg(null,null,t,!1,function(){t._reactRootContainer=null,t[Ho]=null})}),!0):!1};is.unstable_batchedUpdates=Qv;is.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!ug(n))throw Error(We(200));if(t==null||t._reactInternals===void 0)throw Error(We(38));return hg(t,e,n,!1,i)};is.version="18.2.0-next-9e3b772b8-20220608";function uA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(uA)}catch(t){console.error(t)}}uA(),l2.exports=is;var ax=l2.exports,hA,Aw=ax;hA=Aw.createRoot,Aw.hydrateRoot;const Yk="modulepreload",Kk=function(t){return"/"+t},Pw={},Jk=function(e,n,i){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(c=>{if(c=Kk(c),c in Pw)return;Pw[c]=!0;const d=c.endsWith(".css"),l=d?'[rel="stylesheet"]':"";if(!!i)for(let S=s.length-1;S>=0;S--){const I=s[S];if(I.href===c&&(!d||I.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${l}`))return;const w=document.createElement("link");if(w.rel=d?"stylesheet":Yk,d||(w.as="script",w.crossOrigin=""),w.href=c,document.head.appendChild(w),d)return new Promise((S,I)=>{w.addEventListener("load",S),w.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${c}`)))})})).then(()=>e()).catch(c=>{const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c})},Qk=Be.createContext(null);function e3(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,s=Array.isArray(e)?e[0]:e?e.x:0,c=Array.isArray(e)?e[1]:e?e.y:0;return n===s&&i===c}function Uo(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Uo(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const s of n)if(!e.hasOwnProperty(s)||!Uo(t[s],e[s]))return!1;return!0}return!1}function t3(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function Cw(t,e){if(!t.getProjection)return;const n=t.getProjection(),i=e.getProjection();Uo(n,i)||e.setProjection(n)}function Iw(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Lw(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const s=t.center;t.center=new s.constructor(n.longitude,n.latitude),i=i||s!==t.center}if("zoom"in n){const s=t.zoom;t.zoom=n.zoom,i=i||s!==t.zoom}if("bearing"in n){const s=t.bearing;t.bearing=n.bearing,i=i||s!==t.bearing}if("pitch"in n){const s=t.pitch;t.pitch=n.pitch,i=i||s!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const n3=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Mw(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let s=null;"interactive"in i&&(s=Object.assign({},i),delete s.interactive);const c=e[i.ref];if(c){s=s||Object.assign({},i),delete s.ref;for(const d of n3)d in c&&(s[d]=c[d])}return s||i});return{...t,layers:n}}const kw={version:8,sources:{},layers:[]},Rw={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},ty={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},zw={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},i3=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],r3=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class gu{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=s=>{const c=this.props[zw[s.type]];c?c(s):s.type==="error"&&console.error(s.error)},this._onPointerEvent=s=>{(s.type==="mousemove"||s.type==="mouseout")&&this._updateHover(s);const c=this.props[Rw[s.type]];c&&(this.props.interactiveLayerIds&&s.type!=="mouseover"&&s.type!=="mouseout"&&(s.features=this._hoveredFeatures||this._queryRenderedFeatures(s.point)),c(s),delete s.features)},this._onCameraEvent=s=>{if(!this._internalUpdate){const c=this.props[ty[s.type]];c&&c(s)}s.type in this._deferredEvents&&(this._deferredEvents[s.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const s=this._updateSize(e),c=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||s||c&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=gu.savedMaps.pop();if(!i)return null;const s=i.map,c=s.getContainer();for(n.className=c.className;c.childNodes.length>0;)n.appendChild(c.childNodes[0]);s._container=n;const d=s._resizeObserver;d&&(d.disconnect(),d.observe(n)),i.setProps({...e,styleDiffing:!1}),s.resize();const{initialViewState:l}=e;return l&&(l.bounds?s.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):i._updateViewState(l,!1)),s.isStyleLoaded()?s.fire("load"):s.once("styledata",()=>s.fire("load")),s._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=kw}=n,s={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||s3()||null,container:e,style:Mw(i)},c=s.initialViewState||s.viewState||s;if(Object.assign(s,{center:[c.longitude||0,c.latitude||0],zoom:c.zoom||0,pitch:c.pitch||0,bearing:c.bearing||0}),n.gl){const S=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=S,n.gl)}const d=new this._MapClass(s);c.padding&&d.setPadding(c.padding),n.cursor&&(d.getCanvas().style.cursor=n.cursor),this._createShadowTransform(d);const l=d._render;d._render=S=>{this._inRender=!0,l.call(d,S),this._inRender=!1};const y=d._renderTaskQueue.run;d._renderTaskQueue.run=S=>{y.call(d._renderTaskQueue,S),this._onBeforeRepaint()},d.on("render",()=>this._onAfterRepaint());const w=d.fire;d.fire=this._fireEvent.bind(this,w),d.on("resize",()=>{this._renderTransform.resize(d.transform.width,d.transform.height)}),d.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Cw(d.transform,this._renderTransform)}),d.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const S in Rw)d.on(S,this._onPointerEvent);for(const S in ty)d.on(S,this._onCameraEvent);for(const S in zw)d.on(S,this._onEvent);this._map=d}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),gu.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=t3(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,s=this._renderTransform,{zoom:c,pitch:d,bearing:l}=s,y=i.isMoving();y&&(s.cameraElevationReference="sea");const w=Lw(s,{...Iw(i.transform),...e});if(y&&(s.cameraElevationReference="ground"),w&&n){const S=this._deferredEvents;S.move=!0,S.zoom||(S.zoom=c!==s.zoom),S.rotate||(S.rotate=l!==s.bearing),S.pitch||(S.pitch=d!==s.pitch)}return y||Lw(i.transform,e),w}_updateSettings(e,n){const i=this._map;let s=!1;for(const c of i3)if(c in e&&!Uo(e[c],n[c])){s=!0;const d=i[`set${c[0].toUpperCase()}${c.slice(1)}`];d==null||d.call(i,e[c])}return s}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=kw,styleDiffing:s=!0}=e,c={diff:s};return"localIdeographFontFamily"in e&&(c.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Mw(i),c),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let s=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!Uo(e.light,n.light)&&(s=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!Uo(e.fog,n.fog)&&(s=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!Uo(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(s=!0,i.setTerrain(e.terrain))),s}_updateHandlers(e,n){var i,s;const c=this._map;let d=!1;for(const l of r3){const y=(i=e[l])!==null&&i!==void 0?i:!0,w=(s=n[l])!==null&&s!==void 0?s:!0;Uo(y,w)||(d=!0,y?c[l].enable(y):c[l].disable())}return d}_queryRenderedFeatures(e){const n=this._map,i=n.transform,{interactiveLayerIds:s=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:s.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=i}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const c=e.type,d=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,l=this._queryRenderedFeatures(e.point),y=l.length>0;!y&&d&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,y&&!d&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=c}else this._hoveredFeatures=null}_fireEvent(e,n,i){const s=this._map,c=s.transform,d=typeof n=="string"?n:n.type;return d==="move"&&this._updateViewState(this.props,!1),d in ty&&(typeof n=="object"&&(n.viewState=Iw(c)),this._map.isMoving())?(s.transform=this._renderTransform,e.call(s,n,i),s.transform=c,s):(e.call(s,n,i),s)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{Cw(this._renderTransform,n),e.transform=n}}}gu.savedMaps=[];function s3(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const o3=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function a3(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:i=>{const s=e.transform;e.transform=t.transform;const c=e.project(i);return e.transform=s,c},unproject:i=>{const s=e.transform;e.transform=t.transform;const c=e.unproject(i);return e.transform=s,c},queryTerrainElevation:(i,s)=>{const c=e.transform;e.transform=t.transform;const d=e.queryTerrainElevation(i,s);return e.transform=c,d},queryRenderedFeatures:(i,s)=>{const c=e.transform;e.transform=t.transform;const d=e.queryRenderedFeatures(i,s);return e.transform=c,d}};for(const i of l3(e))!(i in n)&&!o3.includes(i)&&(n[i]=e[i].bind(e));return n}function l3(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const c3=typeof document<"u"?Be.useLayoutEffect:Be.useEffect,u3=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function h3(t,e){for(const i of u3)i in e&&(t[i]=e[i]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,i=>{i&&console.error(i)},!0)}const dg=Be.createContext(null);function d3(t,e,n){const i=Be.useContext(Qk),[s,c]=Be.useState(null),d=Be.useRef(),{current:l}=Be.useRef({mapLib:null,map:null});Be.useEffect(()=>{const S=t.mapLib;let I=!0,P;return Promise.resolve(S||n).then(B=>{if(!I)return;if(!B)throw new Error("Invalid mapLib");const G="Map"in B?B:B.default;if(!G.Map)throw new Error("Invalid mapLib");if(h3(G,t),!G.supported||G.supported(t))t.reuseMaps&&(P=gu.reuse(t,d.current)),P||(P=new gu(G.Map,t,d.current)),l.map=a3(P),l.mapLib=G,c(P),i==null||i.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(B=>{const{onError:G}=t;G?G({type:"error",target:null,originalEvent:null,error:B}):console.error(B)}),()=>{I=!1,P&&(i==null||i.onMapUnmount(t.id),t.reuseMaps?P.recycle():P.destroy())}},[]),c3(()=>{s&&s.setProps(t)}),Be.useImperativeHandle(e,()=>l.map,[s]);const y=Be.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),w={height:"100%"};return Be.createElement("div",{id:t.id,ref:d,style:y},s&&Be.createElement(dg.Provider,{value:l},Be.createElement("div",{"mapboxgl-children":"",style:w},t.children)))}const f3=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Kl(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const s=e[i];Number.isFinite(s)&&!f3.test(i)?n[i]=`${s}px`:n[i]=s}}function p3(t,e){const{map:n,mapLib:i}=Be.useContext(dg),s=Be.useRef({props:t});s.current.props=t;const c=Be.useMemo(()=>{let K=!1;Be.Children.forEach(t.children,j=>{j&&(K=!0)});const ue={...t,element:K?document.createElement("div"):null},q=new i.Marker(ue);return q.setLngLat([t.longitude,t.latitude]),q.getElement().addEventListener("click",j=>{var Z,re;(re=(Z=s.current.props).onClick)===null||re===void 0||re.call(Z,{type:"click",target:q,originalEvent:j})}),q.on("dragstart",j=>{var Z,re;const pe=j;pe.lngLat=c.getLngLat(),(re=(Z=s.current.props).onDragStart)===null||re===void 0||re.call(Z,pe)}),q.on("drag",j=>{var Z,re;const pe=j;pe.lngLat=c.getLngLat(),(re=(Z=s.current.props).onDrag)===null||re===void 0||re.call(Z,pe)}),q.on("dragend",j=>{var Z,re;const pe=j;pe.lngLat=c.getLngLat(),(re=(Z=s.current.props).onDragEnd)===null||re===void 0||re.call(Z,pe)}),q},[]);Be.useEffect(()=>(c.addTo(n.getMap()),()=>{c.remove()}),[]);const{longitude:d,latitude:l,offset:y,style:w,draggable:S=!1,popup:I=null,rotation:P=0,rotationAlignment:B="auto",pitchAlignment:G="auto"}=t;return Be.useEffect(()=>{Kl(c.getElement(),w)},[w]),Be.useImperativeHandle(e,()=>c,[]),(c.getLngLat().lng!==d||c.getLngLat().lat!==l)&&c.setLngLat([d,l]),y&&!e3(c.getOffset(),y)&&c.setOffset(y),c.isDraggable()!==S&&c.setDraggable(S),c.getRotation()!==P&&c.setRotation(P),c.getRotationAlignment()!==B&&c.setRotationAlignment(B),c.getPitchAlignment()!==G&&c.setPitchAlignment(G),c.getPopup()!==I&&c.setPopup(I),ax.createPortal(t.children,c.getElement())}Be.memo(Be.forwardRef(p3));function Dw(t){return new Set(t?t.trim().split(/\s+/):[])}function m3(t,e){const{map:n,mapLib:i}=Be.useContext(dg),s=Be.useMemo(()=>document.createElement("div"),[]),c=Be.useRef({props:t});c.current.props=t;const d=Be.useMemo(()=>{const l={...t},y=new i.Popup(l);return y.setLngLat([t.longitude,t.latitude]),y.once("open",w=>{var S,I;(I=(S=c.current.props).onOpen)===null||I===void 0||I.call(S,w)}),y},[]);if(Be.useEffect(()=>{const l=y=>{var w,S;(S=(w=c.current.props).onClose)===null||S===void 0||S.call(w,y)};return d.on("close",l),d.setDOMContent(s).addTo(n.getMap()),()=>{d.off("close",l),d.isOpen()&&d.remove()}},[]),Be.useEffect(()=>{Kl(d.getElement(),t.style)},[t.style]),Be.useImperativeHandle(e,()=>d,[]),d.isOpen()&&((d.getLngLat().lng!==t.longitude||d.getLngLat().lat!==t.latitude)&&d.setLngLat([t.longitude,t.latitude]),t.offset&&!Uo(d.options.offset,t.offset)&&d.setOffset(t.offset),(d.options.anchor!==t.anchor||d.options.maxWidth!==t.maxWidth)&&(d.options.anchor=t.anchor,d.setMaxWidth(t.maxWidth)),d.options.className!==t.className)){const l=Dw(d.options.className),y=Dw(t.className);for(const w of l)y.has(w)||d.removeClassName(w);for(const w of y)l.has(w)||d.addClassName(w);d.options.className=t.className}return ax.createPortal(t.children,s)}Be.memo(Be.forwardRef(m3));function Bd(t,e,n,i){const s=Be.useContext(dg),c=Be.useMemo(()=>t(s),[]);return Be.useEffect(()=>{const d=i||n||e,l=typeof e=="function"&&typeof n=="function"?e:null,y=typeof n=="function"?n:typeof e=="function"?e:null,{map:w}=s;return w.hasControl(c)||(w.addControl(c,d==null?void 0:d.position),l&&l(s)),()=>{y&&y(s),w.hasControl(c)&&w.removeControl(c)}},[]),c}function g3(t){const e=Bd(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return Be.useEffect(()=>{Kl(e._container,t.style)},[t.style]),null}Be.memo(g3);function _3(t){const e=Bd(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return Be.useEffect(()=>{Kl(e._controlContainer,t.style)},[t.style]),null}Be.memo(_3);function y3(t,e){const n=Be.useRef({props:t}),i=Bd(({mapLib:s})=>{const c=new s.GeolocateControl(t),d=c._setupUI;return c._setupUI=l=>{c._container.hasChildNodes()||d(l)},c.on("geolocate",l=>{var y,w;(w=(y=n.current.props).onGeolocate)===null||w===void 0||w.call(y,l)}),c.on("error",l=>{var y,w;(w=(y=n.current.props).onError)===null||w===void 0||w.call(y,l)}),c.on("outofmaxbounds",l=>{var y,w;(w=(y=n.current.props).onOutOfMaxBounds)===null||w===void 0||w.call(y,l)}),c.on("trackuserlocationstart",l=>{var y,w;(w=(y=n.current.props).onTrackUserLocationStart)===null||w===void 0||w.call(y,l)}),c.on("trackuserlocationend",l=>{var y,w;(w=(y=n.current.props).onTrackUserLocationEnd)===null||w===void 0||w.call(y,l)}),c},{position:t.position});return n.current.props=t,Be.useImperativeHandle(e,()=>i,[]),Be.useEffect(()=>{Kl(i._container,t.style)},[t.style]),null}Be.memo(Be.forwardRef(y3));function v3(t){const e=Bd(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return Be.useEffect(()=>{Kl(e._container,t.style)},[t.style]),null}Be.memo(v3);function x3(t){const e=Bd(({mapLib:c})=>new c.ScaleControl(t),{position:t.position}),n=Be.useRef(t),i=n.current;n.current=t;const{style:s}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),Be.useEffect(()=>{Kl(e._container,s)},[s]),null}Be.memo(x3);const b3=Jk(()=>import("./__vite-optional-peer-dep_mapbox-gl_react-map-gl-b25bb000.js"),[]),w3=(()=>Be.forwardRef(function(e,n){return d3(e,n,b3)}))();var dA={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(ML,function(){var n,i,s;function c(l,y){if(!n)n=y;else if(!i)i=y;else{var w="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",S={};n(S),s=y(S),typeof window<"u"&&(s.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}c(["exports"],function(l){var y=w;function w(a,r,u,f){this.cx=3*a,this.bx=3*(u-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=r,this.p2x=u,this.p2y=f}function S(a,r,u,f){const g=new y(a,r,u,f);return function(v){return g.solve(v)}}w.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,r){if(r===void 0&&(r=1e-6),a<0)return 0;if(a>1)return 1;for(var u=a,f=0;f<8;f++){var g=this.sampleCurveX(u)-a;if(Math.abs(g)<r)return u;var v=this.sampleCurveDerivativeX(u);if(Math.abs(v)<1e-6)break;u-=g/v}var b=0,T=1;for(u=a,f=0;f<20&&(g=this.sampleCurveX(u),!(Math.abs(g-a)<r));f++)a>g?b=u:T=u,u=.5*(T-b)+b;return u},solve:function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))}};const I=S(.25,.1,.25,1);function P(a,r,u){return Math.min(u,Math.max(r,a))}function B(a,r,u){const f=u-r,g=((a-r)%f+f)%f+r;return g===r?u:g}function G(a,...r){for(const u of r)for(const f in u)a[f]=u[f];return a}let K=1;function ue(a,r){a.forEach(u=>{r[u]&&(r[u]=r[u].bind(r))})}function q(a,r,u){const f={};for(const g in a)f[g]=r.call(u||this,a[g],g,a);return f}function j(a,r,u){const f={};for(const g in a)r.call(u||this,a[g],g,a)&&(f[g]=a[g]);return f}function Z(a){return Array.isArray(a)?a.map(Z):typeof a=="object"&&a?q(a,Z):a}const re={};function pe(a){re[a]||(typeof console<"u"&&console.warn(a),re[a]=!0)}function be(a,r,u){return(u.y-a.y)*(r.x-a.x)>(r.y-a.y)*(u.x-a.x)}function Re(a){let r=0;for(let u,f,g=0,v=a.length,b=v-1;g<v;b=g++)u=a[g],f=a[b],r+=(f.x-u.x)*(u.y+f.y);return r}function Fe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function je(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,g,v)=>{const b=g||v;return r[f]=!b||b.toLowerCase(),""}),r["max-age"]){const u=parseInt(r["max-age"],10);isNaN(u)?delete r["max-age"]:r["max-age"]=u}return r}let Ge,pt,bt=null;function St(a){if(bt==null){const r=a.navigator?a.navigator.userAgent:null;bt=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return bt}function kt(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Wn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){const r=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(a,r=0){const u=window.document.createElement("canvas"),f=u.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return u.width=a.width,u.height=a.height,f.drawImage(a,0,0,a.width,a.height),f.getImageData(-r,-r,a.width+2*r,a.height+2*r)},resolveURL:a=>(Ge||(Ge=document.createElement("a")),Ge.href=a,Ge.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(pt==null&&(pt=matchMedia("(prefers-reduced-motion: reduce)")),pt.matches)}};var xt=bi;function bi(a,r){this.x=a,this.y=r}bi.prototype={clone:function(){return new bi(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,u=a.y-this.y;return r*r+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),u=Math.sin(a),f=u*this.x+r*this.y;return this.x=r*this.x-u*this.y,this.y=f,this},_rotateAround:function(a,r){var u=Math.cos(a),f=Math.sin(a),g=r.y+f*(this.x-r.x)+u*(this.y-r.y);return this.x=r.x+u*(this.x-r.x)-f*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},bi.convert=function(a){return a instanceof bi?a:Array.isArray(a)?new bi(a[0],a[1]):a};const nt={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Et="mapbox-tiles";let Pt,nn,rn=500,rr=50;function ri(){typeof caches>"u"||Pt||(Pt=caches.open(Et))}let wi=1/0;const si={supported:!1,testSupport:function(a){!qt&&Ei&&(On?ss(a):un=a)}};let un,Ei,qt=!1,On=!1;function ss(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Ei),a.isContextLost())return;si.supported=!0}catch{}a.deleteTexture(r),qt=!0}typeof document<"u"&&(Ei=document.createElement("img"),Ei.onload=function(){un&&ss(un),un=null,On=!0},Ei.onerror=function(){qt=!0,un=null},Ei.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ki={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ki);class Kn extends Error{constructor(r,u,f,g){super(`AJAXError: ${u} (${r}): ${f}`),this.status=r,this.statusText=u,this.url=f,this.body=g}}const Rr=Fe()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Gi(a,r){const u=new AbortController,f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Rr(),signal:u.signal});let g=!1,v=!1;return a.type==="json"&&f.headers.set("Accept","application/json"),((b,T,A)=>{if(v)return;const M=Date.now();fetch(f).then(z=>z.ok?((O,V,H)=>{(a.type==="arrayBuffer"?O.arrayBuffer():a.type==="json"?O.json():O.text()).then(X=>{v||(V&&H&&function(ae,oe,ve){if(ri(),!Pt)return;const Se={status:oe.status,statusText:oe.statusText,headers:new Headers};oe.headers.forEach((Ee,De)=>Se.headers.set(De,Ee));const ye=je(oe.headers.get("Cache-Control")||"");ye["no-store"]||(ye["max-age"]&&Se.headers.set("Expires",new Date(ve+1e3*ye["max-age"]).toUTCString()),new Date(Se.headers.get("Expires")).getTime()-ve<42e4||function(Ee,De){if(nn===void 0)try{new Response(new ReadableStream),nn=!0}catch{nn=!1}nn?De(Ee.body):Ee.blob().then(De)}(oe,Ee=>{const De=new Response(Ee,Se);ri(),Pt&&Pt.then(ze=>ze.put(function(rt){const ct=rt.indexOf("?");return ct<0?rt:rt.slice(0,ct)}(ae.url),De)).catch(ze=>pe(ze.message))}))}(f,V,H),g=!0,r(null,X,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(X=>{v||r(new Error(X.message))})})(z,null,M):z.blob().then(O=>r(new Kn(z.status,z.statusText,a.url,O)))).catch(z=>{z.code!==20&&r(new Error(z.message))})})(),{cancel:()=>{v=!0,g||u.abort()}}}const fi=function(a,r){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(Fe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r);if(!Fe()){const f=a.url.substring(0,a.url.indexOf("://"));return(nt.REGISTERED_PROTOCOLS[f]||Gi)(a,r)}}if(!(/^file:/.test(u=a.url)||/^file:/.test(Rr())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Gi(a,r);if(Fe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var u;return function(f,g){const v=new XMLHttpRequest;v.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(v.responseType="arraybuffer");for(const b in f.headers)v.setRequestHeader(b,f.headers[b]);return f.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=f.credentials==="include",v.onerror=()=>{g(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let b=v.response;if(f.type==="json")try{b=JSON.parse(v.response)}catch(T){return g(T)}g(null,b,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else{const b=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});g(new Kn(v.status,v.statusText,f.url,b))}},v.send(f.body),{cancel:()=>v.abort()}}(a,r)},Wi=function(a,r){return fi(G(a,{type:"arrayBuffer"}),r)};function $s(a){const r=window.document.createElement("a");return r.href=a,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}const Gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ri,Fn;Ri=[],Fn=0;const os=function(a,r){if(si.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Fn>=nt.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Ri.push(v),v}Fn++;let u=!1;const f=()=>{if(!u)for(u=!0,Fn--;Ri.length&&Fn<nt.MAX_PARALLEL_IMAGE_REQUESTS;){const v=Ri.shift(),{requestParameters:b,callback:T,cancelled:A}=v;A||(v.cancel=os(b,T).cancel)}},g=Wi(a,(v,b,T,A)=>{f(),v?r(v):b&&function(M,z){typeof createImageBitmap=="function"?function(O,V){const H=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(H).then(X=>{V(null,X)}).catch(X=>{V(new Error(`Could not load image because of ${X.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(M,z):function(O,V){const H=new Image;H.onload=()=>{V(null,H),URL.revokeObjectURL(H.src),H.onload=null,window.requestAnimationFrame(()=>{H.src=Gt})},H.onerror=()=>V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const X=new Blob([new Uint8Array(O)],{type:"image/png"});H.src=O.byteLength?URL.createObjectURL(X):Gt}(M,z)}(b,(M,z)=>{M!=null?r(M):z!=null&&r(null,z,{cacheControl:T,expires:A})})});return{cancel:()=>{g.cancel(),f()}}};function bo(a,r,u){u[a]&&u[a].indexOf(r)!==-1||(u[a]=u[a]||[],u[a].push(r))}function zr(a,r,u){if(u&&u[a]){const f=u[a].indexOf(r);f!==-1&&u[a].splice(f,1)}}class Dr{constructor(r,u={}){G(this,u),this.type=r}}class Hs extends Dr{constructor(r,u={}){super("error",G({error:r},u))}}class xr{on(r,u){return this._listeners=this._listeners||{},bo(r,u,this._listeners),this}off(r,u){return zr(r,u,this._listeners),zr(r,u,this._oneTimeListeners),this}once(r,u){return this._oneTimeListeners=this._oneTimeListeners||{},bo(r,u,this._oneTimeListeners),this}fire(r,u){typeof r=="string"&&(r=new Dr(r,u||{}));const f=r.type;if(this.listens(f)){r.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of g)T.call(this,r);const v=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of v)zr(f,T,this._oneTimeListeners),T.call(this,r);const b=this._eventedParent;b&&(G(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(r))}else r instanceof Hs&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,u){return this._eventedParent=r,this._eventedParentData=u,this}}var Le={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class qe{constructor(r,u,f,g){this.message=(r?`${r}: `:"")+f,g&&(this.identifier=g),u!=null&&u.__line__&&(this.line=u.__line__)}}function as(a){const r=a.value;return r?[new qe(a.key,r,"constants have been deprecated as of v8")]:[]}function Ti(a,...r){for(const u of r)for(const f in u)a[f]=u[f];return a}function Ut(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function $i(a){if(Array.isArray(a))return a.map($i);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const u in a)r[u]=$i(a[u]);return r}return Ut(a)}class zi extends Error{constructor(r,u){super(u),this.message=u,this.key=r}}class Di{constructor(r,u=[]){this.parent=r,this.bindings={};for(const[f,g]of u)this.bindings[f]=g}concat(r){return new Di(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const ls={kind:"null"},He={kind:"number"},Lt={kind:"string"},It={kind:"boolean"},Jn={kind:"color"},Or={kind:"object"},Ct={kind:"value"},sr={kind:"collator"},$n={kind:"formatted"},qs={kind:"padding"},Mn={kind:"resolvedImage"};function oi(a,r){return{kind:"array",itemType:a,N:r}}function en(a){if(a.kind==="array"){const r=en(a.itemType);return typeof a.N=="number"?`array<${r}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${r}>`}return a.kind}const Zs=[ls,He,Lt,It,Jn,$n,Or,oi(Ct),qs,Mn];function br(a,r){if(r.kind==="error")return null;if(a.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!br(a.itemType,r.itemType))&&(typeof a.N!="number"||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if(a.kind==="value"){for(const u of Zs)if(!br(u,r))return null}}return`Expected ${en(a)} but found ${en(r)} instead.`}function wr(a,r){return r.some(u=>u.kind===a.kind)}function As(a,r){return r.some(u=>u==="null"?a===null:u==="array"?Array.isArray(a):u==="object"?a&&!Array.isArray(a)&&typeof a=="object":u===typeof a)}var Xs,cs={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ee(a){return(a=Math.round(a))<0?0:a>255?255:a}function R(a){return ee(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function F(a){return(r=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:r>1?1:r;var r}function Y(a,r,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?a+(r-a)*u*6:2*u<1?r:3*u<2?a+(r-a)*(2/3-u)*6:a}try{Xs={}.parseCSSColor=function(a){var r,u=a.replace(/ /g,"").toLowerCase();if(u in cs)return cs[u].slice();if(u[0]==="#")return u.length===4?(r=parseInt(u.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:u.length===7&&(r=parseInt(u.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var f=u.indexOf("("),g=u.indexOf(")");if(f!==-1&&g+1===u.length){var v=u.substr(0,f),b=u.substr(f+1,g-(f+1)).split(","),T=1;switch(v){case"rgba":if(b.length!==4)return null;T=F(b.pop());case"rgb":return b.length!==3?null:[R(b[0]),R(b[1]),R(b[2]),T];case"hsla":if(b.length!==4)return null;T=F(b.pop());case"hsl":if(b.length!==3)return null;var A=(parseFloat(b[0])%360+360)%360/360,M=F(b[1]),z=F(b[2]),O=z<=.5?z*(M+1):z+M-z*M,V=2*z-O;return[ee(255*Y(V,O,A+1/3)),ee(255*Y(V,O,A)),ee(255*Y(V,O,A-1/3)),T];default:return null}}return null}}catch{}class J{constructor(r,u,f,g=1){this.r=r,this.g=u,this.b=f,this.a=g}static parse(r){if(!r)return;if(r instanceof J)return r;if(typeof r!="string")return;const u=Xs(r);return u?new J(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[r,u,f,g]=this.toArray();return`rgba(${Math.round(r)},${Math.round(u)},${Math.round(f)},${g})`}toArray(){const{r,g:u,b:f,a:g}=this;return g===0?[0,0,0,0]:[255*r/g,255*u/g,255*f/g,g]}}J.black=new J(0,0,0,1),J.white=new J(1,1,1,1),J.transparent=new J(0,0,0,0),J.red=new J(1,0,0,1);class ce{constructor(r,u,f){this.sensitivity=r?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,u){return this.collator.compare(r,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class me{constructor(r,u,f,g,v){this.text=r,this.image=u,this.scale=f,this.fontStack=g,this.textColor=v}}class de{constructor(r){this.sections=r}static fromString(r){return new de([new me(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof de?r:de.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class le{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof le)return r;if(typeof r=="number")return new le([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const u of r)if(typeof u!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new le(r)}}toString(){return JSON.stringify(this.values)}}class ge{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new ge({name:r,available:!1}):null}}function Ce(a,r,u,f){return typeof a=="number"&&a>=0&&a<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[a,r,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[a,r,u,f]:[a,r,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Oe(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof J||a instanceof ce||a instanceof de||a instanceof le||a instanceof ge)return!0;if(Array.isArray(a)){for(const r of a)if(!Oe(r))return!1;return!0}if(typeof a=="object"){for(const r in a)if(!Oe(a[r]))return!1;return!0}return!1}function Pe(a){if(a===null)return ls;if(typeof a=="string")return Lt;if(typeof a=="boolean")return It;if(typeof a=="number")return He;if(a instanceof J)return Jn;if(a instanceof ce)return sr;if(a instanceof de)return $n;if(a instanceof le)return qs;if(a instanceof ge)return Mn;if(Array.isArray(a)){const r=a.length;let u;for(const f of a){const g=Pe(f);if(u){if(u===g)continue;u=Ct;break}u=g}return oi(u||Ct,r)}return Or}function st(a){const r=typeof a;return a===null?"":r==="string"||r==="number"||r==="boolean"?String(a):a instanceof J||a instanceof de||a instanceof le||a instanceof ge?a.toString():JSON.stringify(a)}class lt{constructor(r,u){this.type=r,this.value=u}static parse(r,u){if(r.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Oe(r[1]))return u.error("invalid value");const f=r[1];let g=Pe(f);const v=u.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new lt(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ke{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const gt={string:Lt,number:He,boolean:It,object:Or};class dt{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");let f,g=1;const v=r[0];if(v==="array"){let T,A;if(r.length>2){const M=r[1];if(typeof M!="string"||!(M in gt)||M==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);T=gt[M],g++}else T=Ct;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return u.error('The length argument to "array" must be a positive integer literal',2);A=r[2],g++}f=oi(T,A)}else{if(!gt[v])throw new Error(`Types doesn't contain name = ${v}`);f=gt[v]}const b=[];for(;g<r.length;g++){const T=u.parse(r[g],g,Ct);if(!T)return null;b.push(T)}return new dt(f,b)}evaluate(r){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(r);if(!br(this.type,Pe(f)))return f;if(u===this.args.length-1)throw new Ke(`Expected value to be of type ${en(this.type)}, but found ${en(Pe(f))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Rt={"to-boolean":It,"to-color":Jn,"to-number":He,"to-string":Lt};class vt{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");const f=r[0];if(!Rt[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&r.length!==2)return u.error("Expected one argument.");const g=Rt[f],v=[];for(let b=1;b<r.length;b++){const T=u.parse(r[b],b,Ct);if(!T)return null;v.push(T)}return new vt(g,v)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let u,f;for(const g of this.args){if(u=g.evaluate(r),f=null,u instanceof J)return u;if(typeof u=="string"){const v=r.parseColor(u);if(v)return v}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Ce(u[0],u[1],u[2],u[3]),!f))return new J(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Ke(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="padding"){let u;for(const f of this.args){u=f.evaluate(r);const g=le.parse(u);if(g)return g}throw new Ke(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="number"){let u=null;for(const f of this.args){if(u=f.evaluate(r),u===null)return 0;const g=Number(u);if(!isNaN(g))return g}throw new Ke(`Could not convert ${JSON.stringify(u)} to number.`)}return this.type.kind==="formatted"?de.fromString(st(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?ge.fromString(st(this.args[0].evaluate(r))):st(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const At=["Unknown","Point","LineString","Polygon"];class Ft{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?At[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let u=this._parseColorCache[r];return u||(u=this._parseColorCache[r]=J.parse(r)),u}}class Vt{constructor(r,u,f,g){this.name=r,this.type=u,this._evaluate=f,this.args=g}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,u){const f=r[0],g=Vt.definitions[f];if(!g)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=b.filter(([M])=>!Array.isArray(M)||M.length===r.length-1);let A=null;for(const[M,z]of T){A=new Ue(u.registry,u.path,null,u.scope);const O=[];let V=!1;for(let H=1;H<r.length;H++){const X=r[H],ae=Array.isArray(M)?M[H-1]:M.type,oe=A.parse(X,1+O.length,ae);if(!oe){V=!0;break}O.push(oe)}if(!V)if(Array.isArray(M)&&M.length!==O.length)A.error(`Expected ${M.length} arguments, but found ${O.length} instead.`);else{for(let H=0;H<O.length;H++){const X=Array.isArray(M)?M[H]:M.type,ae=O[H];A.concat(H+1).checkSubtype(X,ae.type)}if(A.errors.length===0)return new Vt(f,v,z,O)}}if(T.length===1)u.errors.push(...A.errors);else{const M=(T.length?T:b).map(([O])=>{return V=O,Array.isArray(V)?`(${V.map(en).join(", ")})`:`(${en(V.type)}...)`;var V}).join(" | "),z=[];for(let O=1;O<r.length;O++){const V=u.parse(r[O],1+z.length);if(!V)return null;z.push(en(V.type))}u.error(`Expected arguments of type ${M}, but found (${z.join(", ")}) instead.`)}return null}static register(r,u){Vt.definitions=u;for(const f in u)r[f]=Vt}}class dn{constructor(r,u,f){this.type=sr,this.locale=f,this.caseSensitive=r,this.diacriticSensitive=u}static parse(r,u){if(r.length!==2)return u.error("Expected one argument.");const f=r[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const g=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,It);if(!g)return null;const v=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,It);if(!v)return null;let b=null;return f.locale&&(b=u.parse(f.locale,1,Lt),!b)?null:new dn(g,v,b)}evaluate(r){return new ce(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}const fn=8192;function Qn(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function Fr(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function pi(a,r){const u=(180+a[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(u*g*fn),Math.round(f*g*fn)]}function Xt(a,r,u){const f=a[0]-r[0],g=a[1]-r[1],v=a[0]-u[0],b=a[1]-u[1];return f*b-v*g==0&&f*v<=0&&g*b<=0}function wo(a,r){let u=!1;for(let b=0,T=r.length;b<T;b++){const A=r[b];for(let M=0,z=A.length;M<z-1;M++){if(Xt(a,A[M],A[M+1]))return!1;(g=A[M])[1]>(f=a)[1]!=(v=A[M+1])[1]>f[1]&&f[0]<(v[0]-g[0])*(f[1]-g[1])/(v[1]-g[1])+g[0]&&(u=!u)}}var f,g,v;return u}function Eo(a,r){for(let u=0;u<r.length;u++)if(wo(a,r[u]))return!0;return!1}function ia(a,r,u,f){const g=f[0]-u[0],v=f[1]-u[1],b=(a[0]-u[0])*v-g*(a[1]-u[1]),T=(r[0]-u[0])*v-g*(r[1]-u[1]);return b>0&&T<0||b<0&&T>0}function ra(a,r,u){for(const M of u)for(let z=0;z<M.length-1;++z)if((T=[(b=M[z+1])[0]-(v=M[z])[0],b[1]-v[1]])[0]*(A=[(g=r)[0]-(f=a)[0],g[1]-f[1]])[1]-T[1]*A[0]!=0&&ia(f,g,v,b)&&ia(v,b,f,g))return!0;var f,g,v,b,T,A;return!1}function Ys(a,r){for(let u=0;u<a.length;++u)if(!wo(a[u],r))return!1;for(let u=0;u<a.length-1;++u)if(ra(a[u],a[u+1],r))return!1;return!0}function Br(a,r){for(let u=0;u<r.length;u++)if(Ys(a,r[u]))return!0;return!1}function sa(a,r,u){const f=[];for(let g=0;g<a.length;g++){const v=[];for(let b=0;b<a[g].length;b++){const T=pi(a[g][b],u);Qn(r,T),v.push(T)}f.push(v)}return f}function oa(a,r,u){const f=[];for(let g=0;g<a.length;g++){const v=sa(a[g],r,u);f.push(v)}return f}function aa(a,r,u,f){if(a[0]<u[0]||a[0]>u[2]){const g=.5*f;let v=a[0]-u[0]>g?-f:u[0]-a[0]>g?f:0;v===0&&(v=a[0]-u[2]>g?-f:u[2]-a[0]>g?f:0),a[0]+=v}Qn(r,a)}function el(a,r,u,f){const g=Math.pow(2,f.z)*fn,v=[f.x*fn,f.y*fn],b=[];for(const T of a)for(const A of T){const M=[A.x+v[0],A.y+v[1]];aa(M,r,u,g),b.push(M)}return b}function tc(a,r,u,f){const g=Math.pow(2,f.z)*fn,v=[f.x*fn,f.y*fn],b=[];for(const A of a){const M=[];for(const z of A){const O=[z.x+v[0],z.y+v[1]];Qn(r,O),M.push(O)}b.push(M)}if(r[2]-r[0]<=g/2){(T=r)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const A of b)for(const M of A)aa(M,r,u,g)}var T;return b}class Ps{constructor(r,u){this.type=It,this.geojson=r,this.geometries=u}static parse(r,u){if(r.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Oe(r[1])){const f=r[1];if(f.type==="FeatureCollection")for(let g=0;g<f.features.length;++g){const v=f.features[g].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Ps(f,f.features[g].geometry)}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ps(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Ps(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(f.type==="Polygon"){const T=sa(f.coordinates,v,b),A=el(u.geometry(),g,v,b);if(!Fr(g,v))return!1;for(const M of A)if(!wo(M,T))return!1}if(f.type==="MultiPolygon"){const T=oa(f.coordinates,v,b),A=el(u.geometry(),g,v,b);if(!Fr(g,v))return!1;for(const M of A)if(!Eo(M,T))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(f.type==="Polygon"){const T=sa(f.coordinates,v,b),A=tc(u.geometry(),g,v,b);if(!Fr(g,v))return!1;for(const M of A)if(!Ys(M,T))return!1}if(f.type==="MultiPolygon"){const T=oa(f.coordinates,v,b),A=tc(u.geometry(),g,v,b);if(!Fr(g,v))return!1;for(const M of A)if(!Br(M,T))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function $(a){if(a instanceof Vt&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ps)return!1;let r=!0;return a.eachChild(u=>{r&&!$(u)&&(r=!1)}),r}function Q(a){if(a instanceof Vt&&a.name==="feature-state")return!1;let r=!0;return a.eachChild(u=>{r&&!Q(u)&&(r=!1)}),r}function he(a,r){if(a instanceof Vt&&r.indexOf(a.name)>=0)return!1;let u=!0;return a.eachChild(f=>{u&&!he(f,r)&&(u=!1)}),u}class Ae{constructor(r,u){this.type=u.type,this.name=r,this.boundExpression=u}static parse(r,u){if(r.length!==2||typeof r[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=r[1];return u.scope.has(f)?new Ae(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Ue{constructor(r,u=[],f,g=new Di,v=[]){this.registry=r,this.path=u,this.key=u.map(b=>`[${b}]`).join(""),this.scope=g,this.errors=v,this.expectedType=f}parse(r,u,f,g,v={}){return u?this.concat(u,f,g)._parse(r,v):this._parse(r,v)}_parse(r,u){function f(g,v,b){return b==="assert"?new dt(v,[g]):b==="coerce"?new vt(v,[g]):g}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=r[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let b=v.parse(r,this);if(!b)return null;if(this.expectedType){const T=this.expectedType,A=b.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||A.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string")if(T.kind!=="padding"||A.kind!=="value"&&A.kind!=="number"&&A.kind!=="array"){if(this.checkSubtype(T,A))return null}else b=f(b,T,u.typeAnnotation||"coerce");else b=f(b,T,u.typeAnnotation||"coerce");else b=f(b,T,u.typeAnnotation||"assert")}if(!(b instanceof lt)&&b.type.kind!=="resolvedImage"&&at(b)){const T=new Ft;try{b=new lt(b.type,b.evaluate(T))}catch(A){return this.error(A.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,u,f){const g=typeof r=="number"?this.path.concat(r):this.path,v=f?this.scope.concat(f):this.scope;return new Ue(this.registry,g,u||null,v,this.errors)}error(r,...u){const f=`${this.key}${u.map(g=>`[${g}]`).join("")}`;this.errors.push(new zi(f,r))}checkSubtype(r,u){const f=br(r,u);return f&&this.error(f),f}}function at(a){if(a instanceof Ae)return at(a.boundExpression);if(a instanceof Vt&&a.name==="error"||a instanceof dn||a instanceof Ps)return!1;const r=a instanceof vt||a instanceof dt;let u=!0;return a.eachChild(f=>{u=r?u&&at(f):u&&f instanceof lt}),!!u&&$(a)&&he(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Bt(a,r){const u=a.length-1;let f,g,v=0,b=u,T=0;for(;v<=b;)if(T=Math.floor((v+b)/2),f=a[T],g=a[T+1],f<=r){if(T===u||r<g)return T;v=T+1}else{if(!(f>r))throw new Ke("Input is not a number.");b=T-1}return 0}class En{constructor(r,u,f){this.type=r,this.input=u,this.labels=[],this.outputs=[];for(const[g,v]of f)this.labels.push(g),this.outputs.push(v)}static parse(r,u){if(r.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(r[1],1,He);if(!f)return null;const g=[];let v=null;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);for(let b=1;b<r.length;b+=2){const T=b===1?-1/0:r[b],A=r[b+1],M=b,z=b+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(g.length&&g[g.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const O=u.parse(A,z,v);if(!O)return null;v=v||O.type,g.push([T,O])}return new En(v,f,g)}evaluate(r){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(r);const g=this.input.evaluate(r);if(g<=u[0])return f[0].evaluate(r);const v=u.length;return g>=u[v-1]?f[v-1].evaluate(r):f[Bt(u,g)].evaluate(r)}eachChild(r){r(this.input);for(const u of this.outputs)r(u)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function zt(a,r,u){return a*(1-u)+r*u}var Bn=Object.freeze({__proto__:null,number:zt,color:function(a,r,u){return new J(zt(a.r,r.r,u),zt(a.g,r.g,u),zt(a.b,r.b,u),zt(a.a,r.a,u))},array:function(a,r,u){return a.map((f,g)=>zt(f,r[g],u))},padding:function(a,r,u){const f=a.values,g=r.values;return new le([zt(f[0],g[0],u),zt(f[1],g[1],u),zt(f[2],g[2],u),zt(f[3],g[3],u)])}});const or=.95047,Jd=1.08883,ku=4/29,nc=6/29,Qd=3*nc*nc,Ag=Math.PI/180,Pg=180/Math.PI;function Ru(a){return a>.008856451679035631?Math.pow(a,1/3):a/Qd+ku}function zu(a){return a>nc?a*a*a:Qd*(a-ku)}function Du(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Ou(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Jt(a){const r=Ou(a.r),u=Ou(a.g),f=Ou(a.b),g=Ru((.4124564*r+.3575761*u+.1804375*f)/or),v=Ru((.2126729*r+.7151522*u+.072175*f)/1);return{l:116*v-16,a:500*(g-v),b:200*(v-Ru((.0193339*r+.119192*u+.9503041*f)/Jd)),alpha:a.a}}function ef(a){let r=(a.l+16)/116,u=isNaN(a.a)?r:r+a.a/500,f=isNaN(a.b)?r:r-a.b/200;return r=1*zu(r),u=or*zu(u),f=Jd*zu(f),new J(Du(3.2404542*u-1.5371385*r-.4985314*f),Du(-.969266*u+1.8760108*r+.041556*f),Du(.0556434*u-.2040259*r+1.0572252*f),a.alpha)}function Cg(a,r,u){const f=r-a;return a+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const tl={forward:Jt,reverse:ef,interpolate:function(a,r,u){return{l:zt(a.l,r.l,u),a:zt(a.a,r.a,u),b:zt(a.b,r.b,u),alpha:zt(a.alpha,r.alpha,u)}}},nl={forward:function(a){const{l:r,a:u,b:f}=Jt(a),g=Math.atan2(f,u)*Pg;return{h:g<0?g+360:g,c:Math.sqrt(u*u+f*f),l:r,alpha:a.a}},reverse:function(a){const r=a.h*Ag,u=a.c;return ef({l:a.l,a:Math.cos(r)*u,b:Math.sin(r)*u,alpha:a.alpha})},interpolate:function(a,r,u){return{h:Cg(a.h,r.h,u),c:zt(a.c,r.c,u),l:zt(a.l,r.l,u),alpha:zt(a.alpha,r.alpha,u)}}};var tf=Object.freeze({__proto__:null,lab:tl,hcl:nl});class ar{constructor(r,u,f,g,v){this.type=r,this.operator=u,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[b,T]of v)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(r,u,f,g){let v=0;if(r.name==="exponential")v=Fu(u,r.base,f,g);else if(r.name==="linear")v=Fu(u,1,f,g);else if(r.name==="cubic-bezier"){const b=r.controlPoints;v=new y(b[0],b[1],b[2],b[3]).solve(Fu(u,1,f,g))}return v}static parse(r,u){let[f,g,v,...b]=r;if(!Array.isArray(g)||g.length===0)return u.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const M=g[1];if(typeof M!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:M}}else{if(g[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const M=g.slice(1);if(M.length!==4||M.some(z=>typeof z!="number"||z<0||z>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:M}}}if(r.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(v=u.parse(v,2,He),!v)return null;const T=[];let A=null;f==="interpolate-hcl"||f==="interpolate-lab"?A=Jn:u.expectedType&&u.expectedType.kind!=="value"&&(A=u.expectedType);for(let M=0;M<b.length;M+=2){const z=b[M],O=b[M+1],V=M+3,H=M+4;if(typeof z!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(T.length&&T[T.length-1][0]>=z)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const X=u.parse(O,H,A);if(!X)return null;A=A||X.type,T.push([z,X])}return A.kind==="number"||A.kind==="color"||A.kind==="padding"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new ar(A,f,g,v,T):u.error(`Type ${en(A)} is not interpolatable.`)}evaluate(r){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(r);const g=this.input.evaluate(r);if(g<=u[0])return f[0].evaluate(r);const v=u.length;if(g>=u[v-1])return f[v-1].evaluate(r);const b=Bt(u,g),T=ar.interpolationFactor(this.interpolation,g,u[b],u[b+1]),A=f[b].evaluate(r),M=f[b+1].evaluate(r);return this.operator==="interpolate"?Bn[this.type.kind.toLowerCase()](A,M,T):this.operator==="interpolate-hcl"?nl.reverse(nl.interpolate(nl.forward(A),nl.forward(M),T)):tl.reverse(tl.interpolate(tl.forward(A),tl.forward(M),T))}eachChild(r){r(this.input);for(const u of this.outputs)r(u)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function Fu(a,r,u,f){const g=f-u,v=a-u;return g===0?0:r===1?v/g:(Math.pow(r,v)-1)/(Math.pow(r,g)-1)}class ic{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expectected at least one argument.");let f=null;const g=u.expectedType;g&&g.kind!=="value"&&(f=g);const v=[];for(const T of r.slice(1)){const A=u.parse(T,1+v.length,f,void 0,{typeAnnotation:"omit"});if(!A)return null;f=f||A.type,v.push(A)}if(!f)throw new Error("No output type");const b=g&&v.some(T=>br(g,T.type));return new ic(b?Ct:f,v)}evaluate(r){let u,f=null,g=0;for(const v of this.args)if(g++,f=v.evaluate(r),f&&f instanceof ge&&!f.available&&(u||(u=f.name),f=null,g===this.args.length&&(f=u)),f!==null)break;return f}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}class rc{constructor(r,u){this.type=u.type,this.bindings=[].concat(r),this.result=u}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const u of this.bindings)r(u[1]);r(this.result)}static parse(r,u){if(r.length<4)return u.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const f=[];for(let v=1;v<r.length-1;v+=2){const b=r[v];if(typeof b!="string")return u.error(`Expected string, but found ${typeof b} instead.`,v);if(/[^a-zA-Z0-9_]/.test(b))return u.error("Variable names must contain only alphanumeric characters or '_'.",v);const T=u.parse(r[v+1],v+1);if(!T)return null;f.push([b,T])}const g=u.parse(r[r.length-1],r.length-1,u.expectedType,f);return g?new rc(f,g):null}outputDefined(){return this.result.outputDefined()}}class Bu{constructor(r,u,f){this.type=r,this.index=u,this.input=f}static parse(r,u){if(r.length!==3)return u.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,He),g=u.parse(r[2],2,oi(u.expectedType||Ct));return f&&g?new Bu(g.type.itemType,f,g):null}evaluate(r){const u=this.index.evaluate(r),f=this.input.evaluate(r);if(u<0)throw new Ke(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new Ke(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new Ke(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Nu{constructor(r,u){this.type=It,this.needle=r,this.haystack=u}static parse(r,u){if(r.length!==3)return u.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,Ct),g=u.parse(r[2],2,Ct);return f&&g?wr(f.type,[It,Lt,He,ls,Ct])?new Nu(f,g):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${en(f.type)} instead`):null}evaluate(r){const u=this.needle.evaluate(r),f=this.haystack.evaluate(r);if(!f)return!1;if(!As(u,["boolean","string","number","null"]))throw new Ke(`Expected first argument to be of type boolean, string, number or null, but found ${en(Pe(u))} instead.`);if(!As(f,["string","array"]))throw new Ke(`Expected second argument to be of type array or string, but found ${en(Pe(f))} instead.`);return f.indexOf(u)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class sc{constructor(r,u,f){this.type=He,this.needle=r,this.haystack=u,this.fromIndex=f}static parse(r,u){if(r.length<=2||r.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,Ct),g=u.parse(r[2],2,Ct);if(!f||!g)return null;if(!wr(f.type,[It,Lt,He,ls,Ct]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${en(f.type)} instead`);if(r.length===4){const v=u.parse(r[3],3,He);return v?new sc(f,g,v):null}return new sc(f,g)}evaluate(r){const u=this.needle.evaluate(r),f=this.haystack.evaluate(r);if(!As(u,["boolean","string","number","null"]))throw new Ke(`Expected first argument to be of type boolean, string, number or null, but found ${en(Pe(u))} instead.`);if(!As(f,["string","array"]))throw new Ke(`Expected second argument to be of type array or string, but found ${en(Pe(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(r);return f.indexOf(u,g)}return f.indexOf(u)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Uu{constructor(r,u,f,g,v,b){this.inputType=r,this.type=u,this.input=f,this.cases=g,this.outputs=v,this.otherwise=b}static parse(r,u){if(r.length<5)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return u.error("Expected an even number of arguments.");let f,g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const v={},b=[];for(let M=2;M<r.length-1;M+=2){let z=r[M];const O=r[M+1];Array.isArray(z)||(z=[z]);const V=u.concat(M);if(z.length===0)return V.error("Expected at least one branch label.");for(const X of z){if(typeof X!="number"&&typeof X!="string")return V.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return V.error("Numeric branch labels must be integer values.");if(f){if(V.checkSubtype(f,Pe(X)))return null}else f=Pe(X);if(v[String(X)]!==void 0)return V.error("Branch labels must be unique.");v[String(X)]=b.length}const H=u.parse(O,M,g);if(!H)return null;g=g||H.type,b.push(H)}const T=u.parse(r[1],1,Ct);if(!T)return null;const A=u.parse(r[r.length-1],r.length-1,g);return A?T.type.kind!=="value"&&u.concat(1).checkSubtype(f,T.type)?null:new Uu(f,g,T,v,b,A):null}evaluate(r){const u=this.input.evaluate(r);return(Pe(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class Vu{constructor(r,u,f){this.type=r,this.branches=u,this.otherwise=f}static parse(r,u){if(r.length<4)return u.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const g=[];for(let b=1;b<r.length-1;b+=2){const T=u.parse(r[b],b,It);if(!T)return null;const A=u.parse(r[b+1],b+1,f);if(!A)return null;g.push([T,A]),f=f||A.type}const v=u.parse(r[r.length-1],r.length-1,f);if(!v)return null;if(!f)throw new Error("Can't infer output type");return new Vu(f,g,v)}evaluate(r){for(const[u,f]of this.branches)if(u.evaluate(r))return f.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[u,f]of this.branches)r(u),r(f);r(this.otherwise)}outputDefined(){return this.branches.every(([r,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class oc{constructor(r,u,f,g){this.type=r,this.input=u,this.beginIndex=f,this.endIndex=g}static parse(r,u){if(r.length<=2||r.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,Ct),g=u.parse(r[2],2,He);if(!f||!g)return null;if(!wr(f.type,[oi(Ct),Lt,Ct]))return u.error(`Expected first argument to be of type array or string, but found ${en(f.type)} instead`);if(r.length===4){const v=u.parse(r[3],3,He);return v?new oc(f.type,f,g,v):null}return new oc(f.type,f,g)}evaluate(r){const u=this.input.evaluate(r),f=this.beginIndex.evaluate(r);if(!As(u,["string","array"]))throw new Ke(`Expected first argument to be of type array or string, but found ${en(Pe(u))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(r);return u.slice(f,g)}return u.slice(f)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function nf(a,r){return a==="=="||a==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function rf(a,r,u,f){return f.compare(r,u)===0}function la(a,r,u){const f=a!=="=="&&a!=="!=";return class fA{constructor(v,b,T){this.type=It,this.lhs=v,this.rhs=b,this.collator=T,this.hasUntypedArgument=v.type.kind==="value"||b.type.kind==="value"}static parse(v,b){if(v.length!==3&&v.length!==4)return b.error("Expected two or three arguments.");const T=v[0];let A=b.parse(v[1],1,Ct);if(!A)return null;if(!nf(T,A.type))return b.concat(1).error(`"${T}" comparisons are not supported for type '${en(A.type)}'.`);let M=b.parse(v[2],2,Ct);if(!M)return null;if(!nf(T,M.type))return b.concat(2).error(`"${T}" comparisons are not supported for type '${en(M.type)}'.`);if(A.type.kind!==M.type.kind&&A.type.kind!=="value"&&M.type.kind!=="value")return b.error(`Cannot compare types '${en(A.type)}' and '${en(M.type)}'.`);f&&(A.type.kind==="value"&&M.type.kind!=="value"?A=new dt(M.type,[A]):A.type.kind!=="value"&&M.type.kind==="value"&&(M=new dt(A.type,[M])));let z=null;if(v.length===4){if(A.type.kind!=="string"&&M.type.kind!=="string"&&A.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(z=b.parse(v[3],3,sr),!z)return null}return new fA(A,M,z)}evaluate(v){const b=this.lhs.evaluate(v),T=this.rhs.evaluate(v);if(f&&this.hasUntypedArgument){const A=Pe(b),M=Pe(T);if(A.kind!==M.kind||A.kind!=="string"&&A.kind!=="number")throw new Ke(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${A.kind}, ${M.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const A=Pe(b),M=Pe(T);if(A.kind!=="string"||M.kind!=="string")return r(v,b,T)}return this.collator?u(v,b,T,this.collator.evaluate(v)):r(v,b,T)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const Ig=la("==",function(a,r,u){return r===u},rf),Lg=la("!=",function(a,r,u){return r!==u},function(a,r,u,f){return!rf(0,r,u,f)}),Mg=la("<",function(a,r,u){return r<u},function(a,r,u,f){return f.compare(r,u)<0}),kg=la(">",function(a,r,u){return r>u},function(a,r,u,f){return f.compare(r,u)>0}),Rg=la("<=",function(a,r,u){return r<=u},function(a,r,u,f){return f.compare(r,u)<=0}),zg=la(">=",function(a,r,u){return r>=u},function(a,r,u,f){return f.compare(r,u)>=0});class ju{constructor(r,u,f,g,v){this.type=Lt,this.number=r,this.locale=u,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(r,u){if(r.length!==3)return u.error("Expected two arguments.");const f=u.parse(r[1],1,He);if(!f)return null;const g=r[2];if(typeof g!="object"||Array.isArray(g))return u.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=u.parse(g.locale,1,Lt),!v))return null;let b=null;if(g.currency&&(b=u.parse(g.currency,1,Lt),!b))return null;let T=null;if(g["min-fraction-digits"]&&(T=u.parse(g["min-fraction-digits"],1,He),!T))return null;let A=null;return g["max-fraction-digits"]&&(A=u.parse(g["max-fraction-digits"],1,He),!A)?null:new ju(f,v,b,T,A)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class ac{constructor(r){this.type=$n,this.sections=r}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");const f=r[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const g=[];let v=!1;for(let b=1;b<=r.length-1;++b){const T=r[b];if(v&&typeof T=="object"&&!Array.isArray(T)){v=!1;let A=null;if(T["font-scale"]&&(A=u.parse(T["font-scale"],1,He),!A))return null;let M=null;if(T["text-font"]&&(M=u.parse(T["text-font"],1,oi(Lt)),!M))return null;let z=null;if(T["text-color"]&&(z=u.parse(T["text-color"],1,Jn),!z))return null;const O=g[g.length-1];O.scale=A,O.font=M,O.textColor=z}else{const A=u.parse(r[b],1,Ct);if(!A)return null;const M=A.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:A,scale:null,font:null,textColor:null})}}return new ac(g)}evaluate(r){return new de(this.sections.map(u=>{const f=u.content.evaluate(r);return Pe(f)===Mn?new me("",f,null,null,null):new me(st(f),null,u.scale?u.scale.evaluate(r):null,u.font?u.font.evaluate(r).join(","):null,u.textColor?u.textColor.evaluate(r):null)}))}eachChild(r){for(const u of this.sections)r(u.content),u.scale&&r(u.scale),u.font&&r(u.font),u.textColor&&r(u.textColor)}outputDefined(){return!1}}class Gu{constructor(r){this.type=Mn,this.input=r}static parse(r,u){if(r.length!==2)return u.error("Expected two arguments.");const f=u.parse(r[1],1,Lt);return f?new Gu(f):u.error("No image name provided.")}evaluate(r){const u=this.input.evaluate(r),f=ge.fromString(u);return f&&r.availableImages&&(f.available=r.availableImages.indexOf(u)>-1),f}eachChild(r){r(this.input)}outputDefined(){return!1}}class Wu{constructor(r){this.type=He,this.input=r}static parse(r,u){if(r.length!==2)return u.error(`Expected 1 argument, but found ${r.length-1} instead.`);const f=u.parse(r[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${en(f.type)} instead.`):new Wu(f):null}evaluate(r){const u=this.input.evaluate(r);if(typeof u=="string"||Array.isArray(u))return u.length;throw new Ke(`Expected value to be of type string or array, but found ${en(Pe(u))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const ca={"==":Ig,"!=":Lg,">":kg,"<":Mg,">=":zg,"<=":Rg,array:dt,at:Bu,boolean:dt,case:Vu,coalesce:ic,collator:dn,format:ac,image:Gu,in:Nu,"index-of":sc,interpolate:ar,"interpolate-hcl":ar,"interpolate-lab":ar,length:Wu,let:rc,literal:lt,match:Uu,number:dt,"number-format":ju,object:dt,slice:oc,step:En,string:dt,"to-boolean":vt,"to-color":vt,"to-number":vt,"to-string":vt,var:Ae,within:Ps};function sf(a,[r,u,f,g]){r=r.evaluate(a),u=u.evaluate(a),f=f.evaluate(a);const v=g?g.evaluate(a):1,b=Ce(r,u,f,v);if(b)throw new Ke(b);return new J(r/255*v,u/255*v,f/255*v,v)}function of(a,r){return a in r}function lc(a,r){const u=r[a];return u===void 0?null:u}function To(a){return{type:a}}function af(a){return{result:"success",value:a}}function ua(a){return{result:"error",value:a}}function gn(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function lf(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Wt(a){return!!a.expression&&a.expression.interpolated}function Qt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function pn(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function vn(a){return a}function il(a,r){const u=r.type==="color",f=a.stops&&typeof a.stops[0][0]=="object",g=f||!(f||a.property!==void 0),v=a.type||(Wt(r)?"exponential":"interval");if(u||r.type==="padding"){const M=u?J.parse:le.parse;(a=Ti({},a)).stops&&(a.stops=a.stops.map(z=>[z[0],M(z[1])])),a.default=M(a.default?a.default:r.default)}if(a.colorSpace&&a.colorSpace!=="rgb"&&!tf[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let b,T,A;if(v==="exponential")b=cf;else if(v==="interval")b=Og;else if(v==="categorical"){b=Dg,T=Object.create(null);for(const M of a.stops)T[M[0]]=M[1];A=typeof a.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);b=Fg}if(f){const M={},z=[];for(let H=0;H<a.stops.length;H++){const X=a.stops[H],ae=X[0].zoom;M[ae]===void 0&&(M[ae]={zoom:ae,type:a.type,property:a.property,default:a.default,stops:[]},z.push(ae)),M[ae].stops.push([X[0].value,X[1]])}const O=[];for(const H of z)O.push([M[H].zoom,il(M[H],r)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:ar.interpolationFactor.bind(void 0,V),zoomStops:O.map(H=>H[0]),evaluate:({zoom:H},X)=>cf({stops:O,base:a.base},r,H).evaluate(H,X)}}if(g){const M=v==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:ar.interpolationFactor.bind(void 0,M),zoomStops:a.stops.map(z=>z[0]),evaluate:({zoom:z})=>b(a,r,z,T,A)}}return{kind:"source",evaluate(M,z){const O=z&&z.properties?z.properties[a.property]:void 0;return O===void 0?ha(a.default,r.default):b(a,r,O,T,A)}}}function ha(a,r,u){return a!==void 0?a:r!==void 0?r:u!==void 0?u:void 0}function Dg(a,r,u,f,g){return ha(typeof u===g?f[u]:void 0,a.default,r.default)}function Og(a,r,u){if(Qt(u)!=="number")return ha(a.default,r.default);const f=a.stops.length;if(f===1||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[f-1][0])return a.stops[f-1][1];const g=Bt(a.stops.map(v=>v[0]),u);return a.stops[g][1]}function cf(a,r,u){const f=a.base!==void 0?a.base:1;if(Qt(u)!=="number")return ha(a.default,r.default);const g=a.stops.length;if(g===1||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[g-1][0])return a.stops[g-1][1];const v=Bt(a.stops.map(z=>z[0]),u),b=function(z,O,V,H){const X=H-V,ae=z-V;return X===0?0:O===1?ae/X:(Math.pow(O,ae)-1)/(Math.pow(O,X)-1)}(u,f,a.stops[v][0],a.stops[v+1][0]),T=a.stops[v][1],A=a.stops[v+1][1];let M=Bn[r.type]||vn;if(a.colorSpace&&a.colorSpace!=="rgb"){const z=tf[a.colorSpace];M=(O,V)=>z.reverse(z.interpolate(z.forward(O),z.forward(V),b))}return typeof T.evaluate=="function"?{evaluate(...z){const O=T.evaluate.apply(void 0,z),V=A.evaluate.apply(void 0,z);if(O!==void 0&&V!==void 0)return M(O,V,b)}}:M(T,A,b)}function Fg(a,r,u){switch(r.type){case"color":u=J.parse(u);break;case"formatted":u=de.fromString(u.toString());break;case"resolvedImage":u=ge.fromString(u.toString());break;case"padding":u=le.parse(u);break;default:Qt(u)===r.type||r.type==="enum"&&r.values[u]||(u=void 0)}return ha(u,a.default,r.default)}Vt.register(ca,{error:[{kind:"error"},[Lt],(a,[r])=>{throw new Ke(r.evaluate(a))}],typeof:[Lt,[Ct],(a,[r])=>en(Pe(r.evaluate(a)))],"to-rgba":[oi(He,4),[Jn],(a,[r])=>r.evaluate(a).toArray()],rgb:[Jn,[He,He,He],sf],rgba:[Jn,[He,He,He,He],sf],has:{type:It,overloads:[[[Lt],(a,[r])=>of(r.evaluate(a),a.properties())],[[Lt,Or],(a,[r,u])=>of(r.evaluate(a),u.evaluate(a))]]},get:{type:Ct,overloads:[[[Lt],(a,[r])=>lc(r.evaluate(a),a.properties())],[[Lt,Or],(a,[r,u])=>lc(r.evaluate(a),u.evaluate(a))]]},"feature-state":[Ct,[Lt],(a,[r])=>lc(r.evaluate(a),a.featureState||{})],properties:[Or,[],a=>a.properties()],"geometry-type":[Lt,[],a=>a.geometryType()],id:[Ct,[],a=>a.id()],zoom:[He,[],a=>a.globals.zoom],"heatmap-density":[He,[],a=>a.globals.heatmapDensity||0],"line-progress":[He,[],a=>a.globals.lineProgress||0],accumulated:[Ct,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[He,To(He),(a,r)=>{let u=0;for(const f of r)u+=f.evaluate(a);return u}],"*":[He,To(He),(a,r)=>{let u=1;for(const f of r)u*=f.evaluate(a);return u}],"-":{type:He,overloads:[[[He,He],(a,[r,u])=>r.evaluate(a)-u.evaluate(a)],[[He],(a,[r])=>-r.evaluate(a)]]},"/":[He,[He,He],(a,[r,u])=>r.evaluate(a)/u.evaluate(a)],"%":[He,[He,He],(a,[r,u])=>r.evaluate(a)%u.evaluate(a)],ln2:[He,[],()=>Math.LN2],pi:[He,[],()=>Math.PI],e:[He,[],()=>Math.E],"^":[He,[He,He],(a,[r,u])=>Math.pow(r.evaluate(a),u.evaluate(a))],sqrt:[He,[He],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[He,[He],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[He,[He],(a,[r])=>Math.log(r.evaluate(a))],log2:[He,[He],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[He,[He],(a,[r])=>Math.sin(r.evaluate(a))],cos:[He,[He],(a,[r])=>Math.cos(r.evaluate(a))],tan:[He,[He],(a,[r])=>Math.tan(r.evaluate(a))],asin:[He,[He],(a,[r])=>Math.asin(r.evaluate(a))],acos:[He,[He],(a,[r])=>Math.acos(r.evaluate(a))],atan:[He,[He],(a,[r])=>Math.atan(r.evaluate(a))],min:[He,To(He),(a,r)=>Math.min(...r.map(u=>u.evaluate(a)))],max:[He,To(He),(a,r)=>Math.max(...r.map(u=>u.evaluate(a)))],abs:[He,[He],(a,[r])=>Math.abs(r.evaluate(a))],round:[He,[He],(a,[r])=>{const u=r.evaluate(a);return u<0?-Math.round(-u):Math.round(u)}],floor:[He,[He],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[He,[He],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[It,[Lt,Ct],(a,[r,u])=>a.properties()[r.value]===u.value],"filter-id-==":[It,[Ct],(a,[r])=>a.id()===r.value],"filter-type-==":[It,[Lt],(a,[r])=>a.geometryType()===r.value],"filter-<":[It,[Lt,Ct],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f<g}],"filter-id-<":[It,[Ct],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u<f}],"filter->":[It,[Lt,Ct],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f>g}],"filter-id->":[It,[Ct],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u>f}],"filter-<=":[It,[Lt,Ct],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[It,[Ct],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u<=f}],"filter->=":[It,[Lt,Ct],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[It,[Ct],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u>=f}],"filter-has":[It,[Ct],(a,[r])=>r.value in a.properties()],"filter-has-id":[It,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[It,[oi(Lt)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[It,[oi(Ct)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[It,[Lt,oi(Ct)],(a,[r,u])=>u.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[It,[Lt,oi(Ct)],(a,[r,u])=>function(f,g,v,b){for(;v<=b;){const T=v+b>>1;if(g[T]===f)return!0;g[T]>f?b=T-1:v=T+1}return!1}(a.properties()[r.value],u.value,0,u.value.length-1)],all:{type:It,overloads:[[[It,It],(a,[r,u])=>r.evaluate(a)&&u.evaluate(a)],[To(It),(a,r)=>{for(const u of r)if(!u.evaluate(a))return!1;return!0}]]},any:{type:It,overloads:[[[It,It],(a,[r,u])=>r.evaluate(a)||u.evaluate(a)],[To(It),(a,r)=>{for(const u of r)if(u.evaluate(a))return!0;return!1}]]},"!":[It,[It],(a,[r])=>!r.evaluate(a)],"is-supported-script":[It,[Lt],(a,[r])=>{const u=a.globals&&a.globals.isSupportedScript;return!u||u(r.evaluate(a))}],upcase:[Lt,[Lt],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[Lt,[Lt],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[Lt,To(Ct),(a,r)=>r.map(u=>st(u.evaluate(a))).join("")],"resolved-locale":[Lt,[sr],(a,[r])=>r.evaluate(a).resolvedLocale()]});class cc{constructor(r,u){this.expression=r,this._warningHistory={},this._evaluator=new Ft,this._defaultValue=u?function(f){return f.type==="color"&&pn(f.default)?new J(0,0,0,0):f.type==="color"?J.parse(f.default)||null:f.type==="padding"?le.parse(f.default)||null:f.default===void 0?null:f.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(r,u,f,g,v,b){return this._evaluator.globals=r,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(r,u,f,g,v,b){this._evaluator.globals=r,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Ke(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function rl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in ca}function sl(a,r){const u=new Ue(ca,[],r?function(g){const v={color:Jn,string:Lt,number:He,enum:Lt,boolean:It,formatted:$n,padding:qs,resolvedImage:Mn};return g.type==="array"?oi(v[g.value]||Ct,g.length):v[g.type]}(r):void 0),f=u.parse(a,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?af(new cc(f,r)):ua(u.errors)}class ol{constructor(r,u){this.kind=r,this._styleExpression=u,this.isStateDependent=r!=="constant"&&!Q(u.expression)}evaluateWithoutErrorHandling(r,u,f,g,v,b){return this._styleExpression.evaluateWithoutErrorHandling(r,u,f,g,v,b)}evaluate(r,u,f,g,v,b){return this._styleExpression.evaluate(r,u,f,g,v,b)}}class $u{constructor(r,u,f,g){this.kind=r,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=r!=="camera"&&!Q(u.expression),this.interpolationType=g}evaluateWithoutErrorHandling(r,u,f,g,v,b){return this._styleExpression.evaluateWithoutErrorHandling(r,u,f,g,v,b)}evaluate(r,u,f,g,v,b){return this._styleExpression.evaluate(r,u,f,g,v,b)}interpolationFactor(r,u,f){return this.interpolationType?ar.interpolationFactor(this.interpolationType,r,u,f):0}}function uf(a,r){const u=sl(a,r);if(u.result==="error")return u;const f=u.value.expression,g=$(f);if(!g&&!gn(r))return ua([new zi("","data expressions not supported")]);const v=he(f,["zoom"]);if(!v&&!lf(r))return ua([new zi("","zoom expressions not supported")]);const b=hc(f);return b||v?b instanceof zi?ua([b]):b instanceof ar&&!Wt(r)?ua([new zi("",'"interpolate" expressions cannot be used with this property')]):af(b?new $u(g?"camera":"composite",u.value,b.labels,b instanceof ar?b.interpolation:void 0):new ol(g?"constant":"source",u.value)):ua([new zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class uc{constructor(r,u){this._parameters=r,this._specification=u,Ti(this,il(this._parameters,this._specification))}static deserialize(r){return new uc(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function hc(a){let r=null;if(a instanceof rc)r=hc(a.result);else if(a instanceof ic){for(const u of a.args)if(r=hc(u),r)break}else(a instanceof En||a instanceof ar)&&a.input instanceof Vt&&a.input.name==="zoom"&&(r=a);return r instanceof zi||a.eachChild(u=>{const f=hc(u);f instanceof zi?r=f:!r&&f?r=new zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&f&&r!==f&&(r=new zi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Nr(a){const r=a.key,u=a.value,f=a.valueSpec||{},g=a.objectElementValidators||{},v=a.style,b=a.styleSpec;let T=[];const A=Qt(u);if(A!=="object")return[new qe(r,u,`object expected, ${A} found`)];for(const M in u){const z=M.split(".")[0],O=f[z]||f["*"];let V;if(g[z])V=g[z];else if(f[z])V=cr;else if(g["*"])V=g["*"];else{if(!f["*"]){T.push(new qe(r,u[M],`unknown property "${M}"`));continue}V=cr}T=T.concat(V({key:(r&&`${r}.`)+M,value:u[M],valueSpec:O,style:v,styleSpec:b,object:u,objectKey:M},u))}for(const M in f)g[M]||f[M].required&&f[M].default===void 0&&u[M]===void 0&&T.push(new qe(r,u,`missing required property "${M}"`));return T}function hf(a){const r=a.value,u=a.valueSpec,f=a.style,g=a.styleSpec,v=a.key,b=a.arrayElementValidator||cr;if(Qt(r)!=="array")return[new qe(v,r,`array expected, ${Qt(r)} found`)];if(u.length&&r.length!==u.length)return[new qe(v,r,`array length ${u.length} expected, length ${r.length} found`)];if(u["min-length"]&&r.length<u["min-length"])return[new qe(v,r,`array length at least ${u["min-length"]} expected, length ${r.length} found`)];let T={type:u.value,values:u.values};g.$version<7&&(T.function=u.function),Qt(u.value)==="object"&&(T=u.value);let A=[];for(let M=0;M<r.length;M++)A=A.concat(b({array:r,arrayIndex:M,value:r[M],valueSpec:T,style:f,styleSpec:g,key:`${v}[${M}]`}));return A}function Hu(a){const r=a.key,u=a.value,f=a.valueSpec;let g=Qt(u);return g==="number"&&u!=u&&(g="NaN"),g!=="number"?[new qe(r,u,`number expected, ${g} found`)]:"minimum"in f&&u<f.minimum?[new qe(r,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new qe(r,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function df(a){const r=a.valueSpec,u=Ut(a.value.type);let f,g,v,b={};const T=u!=="categorical"&&a.value.property===void 0,A=!T,M=Qt(a.value.stops)==="array"&&Qt(a.value.stops[0])==="array"&&Qt(a.value.stops[0][0])==="object",z=Nr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(H){if(u==="identity")return[new qe(H.key,H.value,'identity function may not have a "stops" property')];let X=[];const ae=H.value;return X=X.concat(hf({key:H.key,value:ae,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:O})),Qt(ae)==="array"&&ae.length===0&&X.push(new qe(H.key,ae,"array must have at least one stop")),X},default:function(H){return cr({key:H.key,value:H.value,valueSpec:r,style:H.style,styleSpec:H.styleSpec})}}});return u==="identity"&&T&&z.push(new qe(a.key,a.value,'missing required property "property"')),u==="identity"||a.value.stops||z.push(new qe(a.key,a.value,'missing required property "stops"')),u==="exponential"&&a.valueSpec.expression&&!Wt(a.valueSpec)&&z.push(new qe(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(A&&!gn(a.valueSpec)?z.push(new qe(a.key,a.value,"property functions not supported")):T&&!lf(a.valueSpec)&&z.push(new qe(a.key,a.value,"zoom functions not supported"))),u!=="categorical"&&!M||a.value.property!==void 0||z.push(new qe(a.key,a.value,'"property" property is required')),z;function O(H){let X=[];const ae=H.value,oe=H.key;if(Qt(ae)!=="array")return[new qe(oe,ae,`array expected, ${Qt(ae)} found`)];if(ae.length!==2)return[new qe(oe,ae,`array length 2 expected, length ${ae.length} found`)];if(M){if(Qt(ae[0])!=="object")return[new qe(oe,ae,`object expected, ${Qt(ae[0])} found`)];if(ae[0].zoom===void 0)return[new qe(oe,ae,"object stop key must have zoom")];if(ae[0].value===void 0)return[new qe(oe,ae,"object stop key must have value")];if(v&&v>Ut(ae[0].zoom))return[new qe(oe,ae[0].zoom,"stop zoom values must appear in ascending order")];Ut(ae[0].zoom)!==v&&(v=Ut(ae[0].zoom),g=void 0,b={}),X=X.concat(Nr({key:`${oe}[0]`,value:ae[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:Hu,value:V}}))}else X=X.concat(V({key:`${oe}[0]`,value:ae[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},ae));return rl($i(ae[1]))?X.concat([new qe(`${oe}[1]`,ae[1],"expressions are not allowed in function stops.")]):X.concat(cr({key:`${oe}[1]`,value:ae[1],valueSpec:r,style:H.style,styleSpec:H.styleSpec}))}function V(H,X){const ae=Qt(H.value),oe=Ut(H.value),ve=H.value!==null?H.value:X;if(f){if(ae!==f)return[new qe(H.key,ve,`${ae} stop domain type must match previous stop domain type ${f}`)]}else f=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean")return[new qe(H.key,ve,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&u!=="categorical"){let Se=`number expected, ${ae} found`;return gn(r)&&u===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new qe(H.key,ve,Se)]}return u!=="categorical"||ae!=="number"||isFinite(oe)&&Math.floor(oe)===oe?u!=="categorical"&&ae==="number"&&g!==void 0&&oe<g?[new qe(H.key,ve,"stop domain values must appear in ascending order")]:(g=oe,u==="categorical"&&oe in b?[new qe(H.key,ve,"stop domain values must be unique")]:(b[oe]=!0,[])):[new qe(H.key,ve,`integer expected, found ${oe}`)]}}function So(a){const r=(a.expressionContext==="property"?uf:sl)($i(a.value),a.valueSpec);if(r.result==="error")return r.value.map(f=>new qe(`${a.key}${f.key}`,a.value,f.message));const u=r.value.expression||r.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!u.outputDefined())return[new qe(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Q(u))return[new qe(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Q(u))return[new qe(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!he(u,["zoom","feature-state"]))return[new qe(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!$(u))return[new qe(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function al(a){const r=a.key,u=a.value,f=a.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(Ut(u))===-1&&g.push(new qe(r,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(Ut(u))===-1&&g.push(new qe(r,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),g}function da(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!da(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const Bg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function dc(a){if(a==null)return{filter:()=>!0,needGeometry:!1};da(a)||(a=ll(a));const r=sl(a,Bg);if(r.result==="error")throw new Error(r.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,g)=>r.value.evaluate(u,f,{},g),needGeometry:pf(a)}}function ff(a,r){return a<r?-1:a>r?1:0}function pf(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let r=1;r<a.length;r++)if(pf(a[r]))return!0;return!1}function ll(a){if(!a)return!0;const r=a[0];return a.length<=1?r!=="any":r==="=="?qu(a[1],a[2],"=="):r==="!="?fa(qu(a[1],a[2],"==")):r==="<"||r===">"||r==="<="||r===">="?qu(a[1],a[2],r):r==="any"?(u=a.slice(1),["any"].concat(u.map(ll))):r==="all"?["all"].concat(a.slice(1).map(ll)):r==="none"?["all"].concat(a.slice(1).map(ll).map(fa)):r==="in"?fc(a[1],a.slice(2)):r==="!in"?fa(fc(a[1],a.slice(2))):r==="has"?cl(a[1]):r==="!has"?fa(cl(a[1])):r!=="within"||a;var u}function qu(a,r,u){switch(a){case"$type":return[`filter-type-${u}`,r];case"$id":return[`filter-id-${u}`,r];default:return[`filter-${u}`,a,r]}}function fc(a,r){if(r.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(u=>typeof u!=typeof r[0])?["filter-in-large",a,["literal",r.sort(ff)]]:["filter-in-small",a,["literal",r]]}}function cl(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function fa(a){return["!",a]}function ul(a){return da($i(a.value))?So(Ti({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):mf(a)}function mf(a){const r=a.value,u=a.key;if(Qt(r)!=="array")return[new qe(u,r,`array expected, ${Qt(r)} found`)];const f=a.styleSpec;let g,v=[];if(r.length<1)return[new qe(u,r,"filter array must have at least 1 element")];switch(v=v.concat(al({key:`${u}[0]`,value:r[0],valueSpec:f.filter_operator,style:a.style,styleSpec:a.styleSpec})),Ut(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Ut(r[1])==="$type"&&v.push(new qe(u,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new qe(u,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=Qt(r[1]),g!=="string"&&v.push(new qe(`${u}[1]`,r[1],`string expected, ${g} found`)));for(let b=2;b<r.length;b++)g=Qt(r[b]),Ut(r[1])==="$type"?v=v.concat(al({key:`${u}[${b}]`,value:r[b],valueSpec:f.geometry_type,style:a.style,styleSpec:a.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new qe(`${u}[${b}]`,r[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)v=v.concat(mf({key:`${u}[${b}]`,value:r[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":g=Qt(r[1]),r.length!==2?v.push(new qe(u,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new qe(`${u}[1]`,r[1],`string expected, ${g} found`));break;case"within":g=Qt(r[1]),r.length!==2?v.push(new qe(u,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="object"&&v.push(new qe(`${u}[1]`,r[1],`object expected, ${g} found`))}return v}function hl(a,r){const u=a.key,f=a.style,g=a.styleSpec,v=a.value,b=a.objectKey,T=g[`${r}_${a.layerType}`];if(!T)return[];const A=b.match(/^(.*)-transition$/);if(r==="paint"&&A&&T[A[1]]&&T[A[1]].transition)return cr({key:u,value:v,valueSpec:g.transition,style:f,styleSpec:g});const M=a.valueSpec||T[b];if(!M)return[new qe(u,v,`unknown property "${b}"`)];let z;if(Qt(v)==="string"&&gn(M)&&!M.tokens&&(z=/^{([^}]+)}$/.exec(v)))return[new qe(u,v,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const O=[];return a.layerType==="symbol"&&(b==="text-field"&&f&&!f.glyphs&&O.push(new qe(u,v,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&pn($i(v))&&Ut(v.type)==="identity"&&O.push(new qe(u,v,'"text-font" does not support identity functions'))),O.concat(cr({key:a.key,value:v,valueSpec:M,style:f,styleSpec:g,expressionContext:"property",propertyType:r,propertyKey:b}))}function gf(a){return hl(a,"paint")}function _f(a){return hl(a,"layout")}function yf(a){let r=[];const u=a.value,f=a.key,g=a.style,v=a.styleSpec;u.type||u.ref||r.push(new qe(f,u,'either "type" or "ref" is required'));let b=Ut(u.type);const T=Ut(u.ref);if(u.id){const A=Ut(u.id);for(let M=0;M<a.arrayIndex;M++){const z=g.layers[M];Ut(z.id)===A&&r.push(new qe(f,u.id,`duplicate layer id "${u.id}", previously used at line ${z.id.__line__}`))}}if("ref"in u){let A;["type","source","source-layer","filter","layout"].forEach(M=>{M in u&&r.push(new qe(f,u[M],`"${M}" is prohibited for ref layers`))}),g.layers.forEach(M=>{Ut(M.id)===T&&(A=M)}),A?A.ref?r.push(new qe(f,u.ref,"ref cannot reference another ref layer")):b=Ut(A.type):r.push(new qe(f,u.ref,`ref layer "${T}" not found`))}else if(b!=="background")if(u.source){const A=g.sources&&g.sources[u.source],M=A&&Ut(A.type);A?M==="vector"&&b==="raster"?r.push(new qe(f,u.source,`layer "${u.id}" requires a raster source`)):M==="raster"&&b!=="raster"?r.push(new qe(f,u.source,`layer "${u.id}" requires a vector source`)):M!=="vector"||u["source-layer"]?M==="raster-dem"&&b!=="hillshade"?r.push(new qe(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!u.paint||!u.paint["line-gradient"]||M==="geojson"&&A.lineMetrics||r.push(new qe(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new qe(f,u,`layer "${u.id}" must specify a "source-layer"`)):r.push(new qe(f,u.source,`source "${u.source}" not found`))}else r.push(new qe(f,u,'missing required property "source"'));return r=r.concat(Nr({key:f,value:u,valueSpec:v.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>cr({key:`${f}.type`,value:u.type,valueSpec:v.layer.type,style:a.style,styleSpec:a.styleSpec,object:u,objectKey:"type"}),filter:ul,layout:A=>Nr({layer:u,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":M=>_f(Ti({layerType:b},M))}}),paint:A=>Nr({layer:u,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":M=>gf(Ti({layerType:b},M))}})}})),r}function pa(a){const r=a.value,u=a.key,f=Qt(r);return f!=="string"?[new qe(u,r,`string expected, ${f} found`)]:[]}const vf={promoteId:function({key:a,value:r}){if(Qt(r)==="string")return pa({key:a,value:r});{const u=[];for(const f in r)u.push(...pa({key:`${a}.${f}`,value:r[f]}));return u}}};function dl(a){const r=a.value,u=a.key,f=a.styleSpec,g=a.style;if(!r.type)return[new qe(u,r,'"type" is required')];const v=Ut(r.type);let b;switch(v){case"vector":case"raster":case"raster-dem":return b=Nr({key:u,value:r,valueSpec:f[`source_${v.replace("-","_")}`],style:a.style,styleSpec:f,objectElementValidators:vf}),b;case"geojson":if(b=Nr({key:u,value:r,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:vf}),r.cluster)for(const T in r.clusterProperties){const[A,M]=r.clusterProperties[T],z=typeof A=="string"?[A,["accumulated"],["get",T]]:A;b.push(...So({key:`${u}.${T}.map`,value:M,expressionContext:"cluster-map"})),b.push(...So({key:`${u}.${T}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return b;case"video":return Nr({key:u,value:r,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return Nr({key:u,value:r,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new qe(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return al({key:`${u}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:f})}}function fl(a){const r=a.value,u=a.styleSpec,f=u.light,g=a.style;let v=[];const b=Qt(r);if(r===void 0)return v;if(b!=="object")return v=v.concat([new qe("light",r,`object expected, ${b} found`)]),v;for(const T in r){const A=T.match(/^(.*)-transition$/);v=v.concat(A&&f[A[1]]&&f[A[1]].transition?cr({key:T,value:r[T],valueSpec:u.transition,style:g,styleSpec:u}):f[T]?cr({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:u}):[new qe(T,r[T],`unknown property "${T}"`)])}return v}function lr(a){const r=a.value,u=a.styleSpec,f=u.terrain,g=a.style;let v=[];const b=Qt(r);if(r===void 0)return v;if(b!=="object")return v=v.concat([new qe("terrain",r,`object expected, ${b} found`)]),v;for(const T in r)v=v.concat(f[T]?cr({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:u}):[new qe(T,r[T],`unknown property "${T}"`)]);return v}const pl={"*":()=>[],array:hf,boolean:function(a){const r=a.value,u=a.key,f=Qt(r);return f!=="boolean"?[new qe(u,r,`boolean expected, ${f} found`)]:[]},number:Hu,color:function(a){const r=a.key,u=a.value,f=Qt(u);return f!=="string"?[new qe(r,u,`color expected, ${f} found`)]:Xs(u)===null?[new qe(r,u,`color expected, "${u}" found`)]:[]},constants:as,enum:al,filter:ul,function:df,layer:yf,object:Nr,source:dl,light:fl,terrain:lr,string:pa,formatted:function(a){return pa(a).length===0?[]:So(a)},resolvedImage:function(a){return pa(a).length===0?[]:So(a)},padding:function(a){const r=a.key,u=a.value;if(Qt(u)==="array"){if(u.length<1||u.length>4)return[new qe(r,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let g=[];for(let v=0;v<u.length;v++)g=g.concat(cr({key:`${r}[${v}]`,value:u[v],valueSpec:f}));return g}return Hu({key:r,value:u,valueSpec:{}})}};function cr(a){const r=a.value,u=a.valueSpec,f=a.styleSpec;return u.expression&&pn(Ut(r))?df(a):u.expression&&rl($i(r))?So(a):u.type&&pl[u.type]?pl[u.type](a):Nr(Ti({},a,{valueSpec:u.type?f[u.type]:u}))}function Ng(a){const r=a.value,u=a.key,f=pa(a);return f.length||(r.indexOf("{fontstack}")===-1&&f.push(new qe(u,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&f.push(new qe(u,r,'"glyphs" url must include a "{range}" token'))),f}function Ks(a,r=Le){let u=[];return u=u.concat(cr({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,objectElementValidators:{glyphs:Ng,"*":()=>[]}})),a.constants&&(u=u.concat(as({key:"constants",value:a.constants,style:a,styleSpec:r}))),xf(u)}function xf(a){return[].concat(a).sort((r,u)=>r.line-u.line)}function Cs(a){return function(...r){return xf(a.apply(this,r))}}Ks.source=Cs(dl),Ks.light=Cs(fl),Ks.terrain=Cs(lr),Ks.layer=Cs(yf),Ks.filter=Cs(ul),Ks.paintProperty=Cs(gf),Ks.layoutProperty=Cs(_f);const ml=Ks,Zu=ml.light,Ug=ml.paintProperty,Vg=ml.layoutProperty;function pc(a,r){let u=!1;if(r&&r.length)for(const f of r)a.fire(new Hs(new Error(f.message))),u=!0;return u}class gl{constructor(r,u,f){const g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const b=new Int32Array(this.arrayBuffer);r=b[0],this.d=(u=b[1])+2*(f=b[2]);for(let A=0;A<this.d*this.d;A++){const M=b[3+A],z=b[3+A+1];g.push(M===z?null:b.subarray(M,z))}const T=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],T),this.bboxes=b.subarray(T),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=r,this.padding=f,this.scale=u/r,this.uid=0;const v=f/u*r;this.min=-v,this.max=r+v}insert(r,u,f,g,v){this._forEachCell(u,f,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,u,f,g,v,b){this.cells[v].push(b)}query(r,u,f,g,v){const b=this.min,T=this.max;if(r<=b&&u<=b&&T<=f&&T<=g&&!v)return Array.prototype.slice.call(this.keys);{const A=[];return this._forEachCell(r,u,f,g,this._queryCell,A,{},v),A}}_queryCell(r,u,f,g,v,b,T,A){const M=this.cells[v];if(M!==null){const z=this.keys,O=this.bboxes;for(let V=0;V<M.length;V++){const H=M[V];if(T[H]===void 0){const X=4*H;(A?A(O[X+0],O[X+1],O[X+2],O[X+3]):r<=O[X+2]&&u<=O[X+3]&&f>=O[X+0]&&g>=O[X+1])?(T[H]=!0,b.push(z[H])):T[H]=!1}}}}_forEachCell(r,u,f,g,v,b,T,A){const M=this._convertToCellCoord(r),z=this._convertToCellCoord(u),O=this._convertToCellCoord(f),V=this._convertToCellCoord(g);for(let H=M;H<=O;H++)for(let X=z;X<=V;X++){const ae=this.d*X+H;if((!A||A(this._convertFromCellCoord(H),this._convertFromCellCoord(X),this._convertFromCellCoord(H+1),this._convertFromCellCoord(X+1)))&&v.call(this,r,u,f,g,ae,b,T,A))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,u=3+this.cells.length+1+1;let f=0;for(let b=0;b<this.cells.length;b++)f+=this.cells[b].length;const g=new Int32Array(u+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=u;for(let b=0;b<r.length;b++){const T=r[b];g[3+b]=v,g.set(T,v),v+=T.length}return g[3+r.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+r.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(r,u){const f=r.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(r){return new gl(r.buffer)}}const Is={};function ot(a,r,u={}){if(Is[a])throw new Error(`${a} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:a,writeable:!1}),Is[a]={klass:r,omit:u.omit||[],shallow:u.shallow||[]}}ot("Object",Object),ot("TransferableGridIndex",gl),ot("Color",J),ot("Error",Error),ot("AJAXError",Kn),ot("ResolvedImage",ge),ot("StylePropertyFunction",uc),ot("StyleExpression",cc,{omit:["_evaluator"]}),ot("ZoomDependentExpression",$u),ot("ZoomConstantExpression",ol),ot("CompoundExpression",Vt,{omit:["_evaluate"]});for(const a in ca)ca[a]._classRegistryKey||ot(`Expression_${a}`,ca[a]);function bf(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Ao(a,r){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(bf(a)||kt(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const u=a;return r&&r.push(u.buffer),u}if(a instanceof ImageData)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const u=[];for(const f of a)u.push(Ao(f,r));return u}if(typeof a=="object"){const u=a.constructor,f=u._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");if(!Is[f])throw new Error(`${f} is not registered.`);const g=u.serialize?u.serialize(a,r):{};if(u.serialize){if(r&&g===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in a){if(!a.hasOwnProperty(v)||Is[f].omit.indexOf(v)>=0)continue;const b=a[v];g[v]=Is[f].shallow.indexOf(v)>=0?b:Ao(b,r)}a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof a)}function Js(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||bf(a)||kt(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Js);if(typeof a=="object"){const r=a.$name||"Object";if(!Is[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:u}=Is[r];if(!u)throw new Error(`can't deserialize unregistered class ${r}`);if(u.deserialize)return u.deserialize(a);const f=Object.create(u.prototype);for(const g of Object.keys(a)){if(g==="$name")continue;const v=a[g];f[g]=Is[r].shallow.indexOf(g)>=0?v:Js(v)}return f}throw new Error("can't deserialize object of type "+typeof a)}class Xu{constructor(){this.first=!0}update(r,u){const f=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=f,!0))}}const Je={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function mc(a){for(const r of a)if(Ku(r.charCodeAt(0)))return!0;return!1}function jg(a){for(const r of a)if(!Yu(r.charCodeAt(0)))return!1;return!0}function Yu(a){return!(Je.Arabic(a)||Je["Arabic Supplement"](a)||Je["Arabic Extended-A"](a)||Je["Arabic Presentation Forms-A"](a)||Je["Arabic Presentation Forms-B"](a))}function Ku(a){return!(a!==746&&a!==747&&(a<4352||!(Je["Bopomofo Extended"](a)||Je.Bopomofo(a)||Je["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Je["CJK Compatibility Ideographs"](a)||Je["CJK Compatibility"](a)||Je["CJK Radicals Supplement"](a)||Je["CJK Strokes"](a)||!(!Je["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Je["CJK Unified Ideographs Extension A"](a)||Je["CJK Unified Ideographs"](a)||Je["Enclosed CJK Letters and Months"](a)||Je["Hangul Compatibility Jamo"](a)||Je["Hangul Jamo Extended-A"](a)||Je["Hangul Jamo Extended-B"](a)||Je["Hangul Jamo"](a)||Je["Hangul Syllables"](a)||Je.Hiragana(a)||Je["Ideographic Description Characters"](a)||Je.Kanbun(a)||Je["Kangxi Radicals"](a)||Je["Katakana Phonetic Extensions"](a)||Je.Katakana(a)&&a!==12540||!(!Je["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Je["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Je["Unified Canadian Aboriginal Syllabics"](a)||Je["Unified Canadian Aboriginal Syllabics Extended"](a)||Je["Vertical Forms"](a)||Je["Yijing Hexagram Symbols"](a)||Je["Yi Syllables"](a)||Je["Yi Radicals"](a))))}function wf(a){return!(Ku(a)||function(r){return!!(Je["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Je["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Je["Letterlike Symbols"](r)||Je["Number Forms"](r)||Je["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Je["Control Pictures"](r)&&r!==9251||Je["Optical Character Recognition"](r)||Je["Enclosed Alphanumerics"](r)||Je["Geometric Shapes"](r)||Je["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Je["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Je["CJK Symbols and Punctuation"](r)||Je.Katakana(r)||Je["Private Use Area"](r)||Je["CJK Compatibility Forms"](r)||Je["Small Form Variants"](r)||Je["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(a))}function Ef(a){return a>=1424&&a<=2303||Je["Arabic Presentation Forms-A"](a)||Je["Arabic Presentation Forms-B"](a)}function Gg(a,r){return!(!r&&Ef(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Je.Khmer(a))}function Tf(a){for(const r of a)if(Ef(r.charCodeAt(0)))return!0;return!1}const Ju="deferred",Qu="loading",eh="loaded";let th=null,Hi="unavailable",Qs=null;const Sf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Hi="error"),th&&th(a)};function ma(){nh.fire(new Dr("pluginStateChange",{pluginStatus:Hi,pluginURL:Qs}))}const nh=new xr,_l=function(){return Hi},Af=function(){if(Hi!==Ju||!Qs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Hi=Qu,ma(),Qs&&Wi({url:Qs},a=>{a?Sf(a):(Hi=eh,ma())})},Er={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Hi===eh||Er.applyArabicShaping!=null,isLoading:()=>Hi===Qu,setState(a){if(!Fe())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Hi=a.pluginStatus,Qs=a.pluginURL},isParsed(){if(!Fe())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Er.applyArabicShaping!=null&&Er.processBidirectionalText!=null&&Er.processStyledBidirectionalText!=null},getPluginURL(){if(!Fe())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Qs}};class xn{constructor(r,u){this.zoom=r,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Xu,this.transition={})}isSupportedScript(r){return function(u,f){for(const g of u)if(!Gg(g.charCodeAt(0),f))return!1;return!0}(r,Er.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,u=r-Math.floor(r),f=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class yl{constructor(r,u){this.property=r,this.value=u,this.expression=function(f,g){if(pn(f))return new uc(f,g);if(rl(f)){const v=uf(f,g);if(v.result==="error")throw new Error(v.value.map(b=>`${b.key}: ${b.message}`).join(", "));return v.value}{let v=f;return g.type==="color"&&typeof f=="string"?v=J.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)||(v=le.parse(f)),{kind:"constant",evaluate:()=>v}}}(u===void 0?r.specification.default:u,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,u,f){return this.property.possiblyEvaluate(this,r,u,f)}}class gc{constructor(r){this.property=r,this.value=new yl(r,void 0)}transitioned(r,u){return new Cf(this.property,this.value,u,G({},r.transition,this.transition),r.now)}untransitioned(){return new Cf(this.property,this.value,null,{},0)}}class Pf{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Z(this._values[r].value.value)}setValue(r,u){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new gc(this._values[r].property)),this._values[r].value=new yl(this._values[r].property,u===null?void 0:Z(u))}getTransition(r){return Z(this._values[r].transition)}setTransition(r,u){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new gc(this._values[r].property)),this._values[r].transition=Z(u)||void 0}serialize(){const r={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(r[u]=f);const g=this.getTransition(u);g!==void 0&&(r[`${u}-transition`]=g)}return r}transitioned(r,u){const f=new If(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(r,u._values[g]);return f}untransitioned(){const r=new If(this._properties);for(const u of Object.keys(this._values))r._values[u]=this._values[u].untransitioned();return r}}class Cf{constructor(r,u,f,g,v){this.property=r,this.value=u,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,r.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(r,u,f){const g=r.now||0,v=this.value.possiblyEvaluate(r,u,f),b=this.prior;if(b){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return b.possiblyEvaluate(r,u,f);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(r,u,f),v,function(A){if(A<=0)return 0;if(A>=1)return 1;const M=A*A,z=M*A;return 4*(A<.5?z:3*(A-M)+z-.75)}(T))}}return v}}class If{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,u,f){const g=new vl(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(r,u,f);return g}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Wg{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Z(this._values[r].value)}setValue(r,u){this._values[r]=new yl(this._values[r].property,u===null?void 0:Z(u))}serialize(){const r={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(r[u]=f)}return r}possiblyEvaluate(r,u,f){const g=new vl(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(r,u,f);return g}}class us{constructor(r,u,f){this.property=r,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,u,f,g){return this.property.evaluate(this.value,this.parameters,r,u,f,g)}}class vl{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class ht{constructor(r){this.specification=r}possiblyEvaluate(r,u){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(u)}interpolate(r,u,f){const g=Bn[this.specification.type];return g?g(r,u,f):r}}class wt{constructor(r,u){this.specification=r,this.overrides=u}possiblyEvaluate(r,u,f,g){return new us(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(u,null,{},f,g)}:r.expression,u)}interpolate(r,u,f){if(r.value.kind!=="constant"||u.value.kind!=="constant")return r;if(r.value.value===void 0||u.value.value===void 0)return new us(this,{kind:"constant",value:void 0},r.parameters);const g=Bn[this.specification.type];return g?new us(this,{kind:"constant",value:g(r.value.value,u.value.value,f)},r.parameters):r}evaluate(r,u,f,g,v,b){return r.kind==="constant"?r.value:r.evaluate(u,f,g,v,b)}}class ga extends wt{possiblyEvaluate(r,u,f,g){if(r.value===void 0)return new us(this,{kind:"constant",value:void 0},u);if(r.expression.kind==="constant"){const v=r.expression.evaluate(u,null,{},f,g),b=r.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,T=this._calculate(b,b,b,u);return new us(this,{kind:"constant",value:T},u)}if(r.expression.kind==="camera"){const v=this._calculate(r.expression.evaluate({zoom:u.zoom-1}),r.expression.evaluate({zoom:u.zoom}),r.expression.evaluate({zoom:u.zoom+1}),u);return new us(this,{kind:"constant",value:v},u)}return new us(this,r.expression,u)}evaluate(r,u,f,g,v,b){if(r.kind==="source"){const T=r.evaluate(u,f,g,v,b);return this._calculate(T,T,T,u)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(u.zoom)-1},f,g),r.evaluate({zoom:Math.floor(u.zoom)},f,g),r.evaluate({zoom:Math.floor(u.zoom)+1},f,g),u):r.value}_calculate(r,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:u}:{from:f,to:u}}interpolate(r){return r}}class ih{constructor(r){this.specification=r}possiblyEvaluate(r,u,f,g){if(r.value!==void 0){if(r.expression.kind==="constant"){const v=r.expression.evaluate(u,null,{},f,g);return this._calculate(v,v,v,u)}return this._calculate(r.expression.evaluate(new xn(Math.floor(u.zoom-1),u)),r.expression.evaluate(new xn(Math.floor(u.zoom),u)),r.expression.evaluate(new xn(Math.floor(u.zoom+1),u)),u)}}_calculate(r,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:u}:{from:f,to:u}}interpolate(r){return r}}class eo{constructor(r){this.specification=r}possiblyEvaluate(r,u,f,g){return!!r.expression.evaluate(u,null,{},f,g)}interpolate(){return!1}}class mi{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in r){const f=r[u];f.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new yl(f,void 0),v=this.defaultTransitionablePropertyValues[u]=new gc(f);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate({})}}}ot("DataDrivenProperty",wt),ot("DataConstantProperty",ht),ot("CrossFadedDataDrivenProperty",ga),ot("CrossFadedProperty",ih),ot("ColorRampProperty",eo);const to="-transition";class hs extends xr{constructor(r,u){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),u.layout&&(this._unevaluatedLayout=new Wg(u.layout)),u.paint)){this._transitionablePaint=new Pf(u.paint);for(const f in r.paint)this.setPaintProperty(f,r.paint[f],{validate:!1});for(const f in r.layout)this.setLayoutProperty(f,r.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vl(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,u,f={}){u!=null&&this._validate(Vg,`layers.${this.id}.layout.${r}`,r,u,f)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,u):this.visibility=u)}getPaintProperty(r){return r.endsWith(to)?this._transitionablePaint.getTransition(r.slice(0,-to.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,u,f={}){if(u!=null&&this._validate(Ug,`layers.${this.id}.paint.${r}`,r,u,f))return!1;if(r.endsWith(to))return this._transitionablePaint.setTransition(r.slice(0,-to.length),u||void 0),!1;{const g=this._transitionablePaint._values[r],v=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(r,u),this._handleSpecialPaintPropertyUpdate(r);const A=this._transitionablePaint._values[r].value;return A.isDataDriven()||b||v||this._handleOverridablePaintPropertyUpdate(r,T,A)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,u,f){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,u){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,u)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),j(r,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(r,u,f,g,v={}){return(!v||v.validate!==!1)&&pc(this,r.call(ml,{key:u,layerType:this.type,objectKey:f,value:g,styleSpec:Le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const u=this.paint.get(r);if(u instanceof us&&gn(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const Lf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class no{constructor(r,u){this._structArray=r,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,u){return r._trim(),u&&(r.isTransferred=!0,u.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const u=Object.create(this.prototype);return u.arrayBuffer=r.arrayBuffer,u.length=r.length,u.capacity=r.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Hn(a,r=1){let u=0,f=0;return{members:a.map(g=>{const v=Lf[g.type].BYTES_PER_ELEMENT,b=u=rh(u,Math.max(r,v)),T=g.components||1;return f=Math.max(f,v),u+=v*T,{name:g.name,type:g.type,components:T,offset:b}}),size:rh(u,Math.max(f,r)),alignment:r}}function rh(a,r){return Math.ceil(a/r)*r}class Po extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.int16[g+0]=u,this.int16[g+1]=f,r}}Po.prototype.bytesPerElement=4,ot("StructArrayLayout2i4",Po);class m extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,u,f,g)}emplace(r,u,f,g,v){const b=4*r;return this.int16[b+0]=u,this.int16[b+1]=f,this.int16[b+2]=g,this.int16[b+3]=v,r}}m.prototype.bytesPerElement=8,ot("StructArrayLayout4i8",m);class o extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,v,b)}emplace(r,u,f,g,v,b,T){const A=6*r;return this.int16[A+0]=u,this.int16[A+1]=f,this.int16[A+2]=g,this.int16[A+3]=v,this.int16[A+4]=b,this.int16[A+5]=T,r}}o.prototype.bytesPerElement=12,ot("StructArrayLayout2i4i12",o);class h extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,v,b)}emplace(r,u,f,g,v,b,T){const A=4*r,M=8*r;return this.int16[A+0]=u,this.int16[A+1]=f,this.uint8[M+4]=g,this.uint8[M+5]=v,this.uint8[M+6]=b,this.uint8[M+7]=T,r}}h.prototype.bytesPerElement=8,ot("StructArrayLayout2i4ub8",h);class p extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.float32[g+0]=u,this.float32[g+1]=f,r}}p.prototype.bytesPerElement=8,ot("StructArrayLayout2f8",p);class _ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,M,z){const O=this.length;return this.resize(O+1),this.emplace(O,r,u,f,g,v,b,T,A,M,z)}emplace(r,u,f,g,v,b,T,A,M,z,O){const V=10*r;return this.uint16[V+0]=u,this.uint16[V+1]=f,this.uint16[V+2]=g,this.uint16[V+3]=v,this.uint16[V+4]=b,this.uint16[V+5]=T,this.uint16[V+6]=A,this.uint16[V+7]=M,this.uint16[V+8]=z,this.uint16[V+9]=O,r}}_.prototype.bytesPerElement=20,ot("StructArrayLayout10ui20",_);class x extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,M,z,O,V){const H=this.length;return this.resize(H+1),this.emplace(H,r,u,f,g,v,b,T,A,M,z,O,V)}emplace(r,u,f,g,v,b,T,A,M,z,O,V,H){const X=12*r;return this.int16[X+0]=u,this.int16[X+1]=f,this.int16[X+2]=g,this.int16[X+3]=v,this.uint16[X+4]=b,this.uint16[X+5]=T,this.uint16[X+6]=A,this.uint16[X+7]=M,this.int16[X+8]=z,this.int16[X+9]=O,this.int16[X+10]=V,this.int16[X+11]=H,r}}x.prototype.bytesPerElement=24,ot("StructArrayLayout4i4ui4i24",x);class E extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=3*r;return this.float32[v+0]=u,this.float32[v+1]=f,this.float32[v+2]=g,r}}E.prototype.bytesPerElement=12,ot("StructArrayLayout3f12",E);class C extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.uint32[1*r+0]=u,r}}C.prototype.bytesPerElement=4,ot("StructArrayLayout1ul4",C);class L extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,M){const z=this.length;return this.resize(z+1),this.emplace(z,r,u,f,g,v,b,T,A,M)}emplace(r,u,f,g,v,b,T,A,M,z){const O=10*r,V=5*r;return this.int16[O+0]=u,this.int16[O+1]=f,this.int16[O+2]=g,this.int16[O+3]=v,this.int16[O+4]=b,this.int16[O+5]=T,this.uint32[V+3]=A,this.uint16[O+8]=M,this.uint16[O+9]=z,r}}L.prototype.bytesPerElement=20,ot("StructArrayLayout6i1ul2ui20",L);class k extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,v,b)}emplace(r,u,f,g,v,b,T){const A=6*r;return this.int16[A+0]=u,this.int16[A+1]=f,this.int16[A+2]=g,this.int16[A+3]=v,this.int16[A+4]=b,this.int16[A+5]=T,r}}k.prototype.bytesPerElement=12,ot("StructArrayLayout2i2i2i12",k);class D extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v){const b=this.length;return this.resize(b+1),this.emplace(b,r,u,f,g,v)}emplace(r,u,f,g,v,b){const T=4*r,A=8*r;return this.float32[T+0]=u,this.float32[T+1]=f,this.float32[T+2]=g,this.int16[A+6]=v,this.int16[A+7]=b,r}}D.prototype.bytesPerElement=16,ot("StructArrayLayout2f1f2i16",D);class N extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,u,f,g)}emplace(r,u,f,g,v){const b=12*r,T=3*r;return this.uint8[b+0]=u,this.uint8[b+1]=f,this.float32[T+1]=g,this.float32[T+2]=v,r}}N.prototype.bytesPerElement=12,ot("StructArrayLayout2ub2f12",N);class W extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=3*r;return this.uint16[v+0]=u,this.uint16[v+1]=f,this.uint16[v+2]=g,r}}W.prototype.bytesPerElement=6,ot("StructArrayLayout3ui6",W);class ie extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,M,z,O,V,H,X,ae,oe,ve){const Se=this.length;return this.resize(Se+1),this.emplace(Se,r,u,f,g,v,b,T,A,M,z,O,V,H,X,ae,oe,ve)}emplace(r,u,f,g,v,b,T,A,M,z,O,V,H,X,ae,oe,ve,Se){const ye=24*r,Ee=12*r,De=48*r;return this.int16[ye+0]=u,this.int16[ye+1]=f,this.uint16[ye+2]=g,this.uint16[ye+3]=v,this.uint32[Ee+2]=b,this.uint32[Ee+3]=T,this.uint32[Ee+4]=A,this.uint16[ye+10]=M,this.uint16[ye+11]=z,this.uint16[ye+12]=O,this.float32[Ee+7]=V,this.float32[Ee+8]=H,this.uint8[De+36]=X,this.uint8[De+37]=ae,this.uint8[De+38]=oe,this.uint32[Ee+10]=ve,this.int16[ye+22]=Se,r}}ie.prototype.bytesPerElement=48,ot("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ie);class te extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,M,z,O,V,H,X,ae,oe,ve,Se,ye,Ee,De,ze,rt,ct,Qe,Xe,$e,et){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,r,u,f,g,v,b,T,A,M,z,O,V,H,X,ae,oe,ve,Se,ye,Ee,De,ze,rt,ct,Qe,Xe,$e,et)}emplace(r,u,f,g,v,b,T,A,M,z,O,V,H,X,ae,oe,ve,Se,ye,Ee,De,ze,rt,ct,Qe,Xe,$e,et,Ye){const Ve=34*r,yt=17*r;return this.int16[Ve+0]=u,this.int16[Ve+1]=f,this.int16[Ve+2]=g,this.int16[Ve+3]=v,this.int16[Ve+4]=b,this.int16[Ve+5]=T,this.int16[Ve+6]=A,this.int16[Ve+7]=M,this.uint16[Ve+8]=z,this.uint16[Ve+9]=O,this.uint16[Ve+10]=V,this.uint16[Ve+11]=H,this.uint16[Ve+12]=X,this.uint16[Ve+13]=ae,this.uint16[Ve+14]=oe,this.uint16[Ve+15]=ve,this.uint16[Ve+16]=Se,this.uint16[Ve+17]=ye,this.uint16[Ve+18]=Ee,this.uint16[Ve+19]=De,this.uint16[Ve+20]=ze,this.uint16[Ve+21]=rt,this.uint16[Ve+22]=ct,this.uint32[yt+12]=Qe,this.float32[yt+13]=Xe,this.float32[yt+14]=$e,this.float32[yt+15]=et,this.float32[yt+16]=Ye,r}}te.prototype.bytesPerElement=68,ot("StructArrayLayout8i15ui1ul4f68",te);class ne extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.float32[1*r+0]=u,r}}ne.prototype.bytesPerElement=4,ot("StructArrayLayout1f4",ne);class fe extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=3*r;return this.int16[v+0]=u,this.int16[v+1]=f,this.int16[v+2]=g,r}}fe.prototype.bytesPerElement=6,ot("StructArrayLayout3i6",fe);class _e extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=4*r;return this.uint32[2*r+0]=u,this.uint16[v+2]=f,this.uint16[v+3]=g,r}}_e.prototype.bytesPerElement=8,ot("StructArrayLayout1ul2ui8",_e);class xe extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.uint16[g+0]=u,this.uint16[g+1]=f,r}}xe.prototype.bytesPerElement=4,ot("StructArrayLayout2ui4",xe);class se extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.uint16[1*r+0]=u,r}}se.prototype.bytesPerElement=2,ot("StructArrayLayout1ui2",se);class Te extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,u,f,g)}emplace(r,u,f,g,v){const b=4*r;return this.float32[b+0]=u,this.float32[b+1]=f,this.float32[b+2]=g,this.float32[b+3]=v,r}}Te.prototype.bytesPerElement=16,ot("StructArrayLayout4f16",Te);class we extends no{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new xt(this.anchorPointX,this.anchorPointY)}}we.prototype.size=20;class Me extends L{get(r){return new we(this,r)}}ot("CollisionBoxArray",Me);class ke extends no{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ke.prototype.size=48;class Ne extends ie{get(r){return new ke(this,r)}}ot("PlacedSymbolArray",Ne);class Ie extends no{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Ie.prototype.size=68;class tt extends te{get(r){return new Ie(this,r)}}ot("SymbolInstanceArray",tt);class Ze extends ne{getoffsetX(r){return this.float32[1*r+0]}}ot("GlyphOffsetArray",Ze);class it extends fe{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}ot("SymbolLineVertexArray",it);class Mt extends no{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Mt.prototype.size=8;class Dt extends _e{get(r){return new Mt(this,r)}}ot("FeatureIndexArray",Dt);class _t extends Po{}class sn extends Po{}class on extends Po{}class $t extends o{}class Ht extends h{}class ln extends p{}class ai extends _{}class ds extends x{}class Ur extends E{}class fs extends C{}class io extends k{}class Tr extends N{}class qi extends W{}class Ls extends xe{}const _c=Hn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ei}=_c;class Nt{constructor(r=[]){this.segments=r}prepareSegment(r,u,f,g){let v=this.segments[this.segments.length-1];return r>Nt.MAX_VERTEX_ARRAY_LENGTH&&pe(`Max vertices per segment is ${Nt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!v||v.vertexLength+r>Nt.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g)&&(v={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(v.sortKey=g),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const r of this.segments)for(const u in r.vaos)r.vaos[u].destroy()}static simpleSegment(r,u,f,g){return new Nt([{vertexOffset:r,primitiveOffset:u,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function tn(a,r){return 256*(a=P(Math.floor(a),0,255))+P(Math.floor(r),0,255)}Nt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ot("SegmentVector",Nt);const li=Hn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ci={exports:{}},bn={exports:{}};bn.exports=function(a,r){var u,f,g,v,b,T,A,M;for(f=a.length-(u=3&a.length),g=r,b=3432918353,T=461845907,M=0;M<f;)A=255&a.charCodeAt(M)|(255&a.charCodeAt(++M))<<8|(255&a.charCodeAt(++M))<<16|(255&a.charCodeAt(++M))<<24,++M,g=27492+(65535&(v=5*(65535&(g=(g^=A=(65535&(A=(A=(65535&A)*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(A=0,u){case 3:A^=(255&a.charCodeAt(M+2))<<16;case 2:A^=(255&a.charCodeAt(M+1))<<8;case 1:g^=A=(65535&(A=(A=(65535&(A^=255&a.charCodeAt(M)))*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Sr={exports:{}};Sr.exports=function(a,r){for(var u,f=a.length,g=r^f,v=0;f>=4;)u=1540483477*(65535&(u=255&a.charCodeAt(v)|(255&a.charCodeAt(++v))<<8|(255&a.charCodeAt(++v))<<16|(255&a.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:g^=(255&a.charCodeAt(v+2))<<16;case 2:g^=(255&a.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Co=bn.exports,sh=Sr.exports;ci.exports=Co,ci.exports.murmur3=Co,ci.exports.murmur2=sh;class _a{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,u,f,g){this.ids.push(Mf(r)),this.positions.push(u,f,g)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Mf(r);let f=0,g=this.ids.length-1;for(;f<g;){const b=f+g>>1;this.ids[b]>=u?g=b:f=b+1}const v=[];for(;this.ids[f]===u;)v.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return v}static serialize(r,u){const f=new Float64Array(r.ids),g=new Uint32Array(r.positions);return oh(f,g,0,f.length-1),u&&u.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(r){const u=new _a;return u.ids=r.ids,u.positions=r.positions,u.indexed=!0,u}}function Mf(a){const r=+a;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:ci.exports(String(a))}function oh(a,r,u,f){for(;u<f;){const g=a[u+f>>1];let v=u-1,b=f+1;for(;;){do v++;while(a[v]<g);do b--;while(a[b]>g);if(v>=b)break;ro(a,v,b),ro(r,3*v,3*b),ro(r,3*v+1,3*b+1),ro(r,3*v+2,3*b+2)}b-u<f-b?(oh(a,r,u,b),u=b+1):(oh(a,r,b+1,f),f=b)}}function ro(a,r,u){const f=a[r];a[r]=a[u],a[u]=f}ot("FeaturePositionMap",_a);class Io{constructor(r,u){this.gl=r.gl,this.location=u}}class Lo extends Io{constructor(r,u){super(r,u),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class yc extends Io{constructor(r,u){super(r,u),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Yx extends Io{constructor(r,u){super(r,u),this.current=J.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const jC=new Float32Array(16);function $g(a){return[tn(255*a.r,255*a.g),tn(255*a.b,255*a.a)]}class ah{constructor(r,u,f){this.value=r,this.uniformNames=u.map(g=>`u_${g}`),this.type=f}setUniform(r,u,f){r.set(f.constantOr(this.value))}getBinding(r,u,f){return this.type==="color"?new Yx(r,u):new Lo(r,u)}}class vc{constructor(r,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=r.tlbr}setUniform(r,u,f,g){const v=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&r.set(v)}getBinding(r,u,f){return f.substr(0,9)==="u_pattern"?new yc(r,u):new Lo(r,u)}}class Mo{constructor(r,u,f,g){this.expression=r,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(v=>({name:`a_${v}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,u,f,g,v){const b=this.paintVertexArray.length,T=this.expression.evaluate(new xn(0),u,{},g,[],v);this.paintVertexArray.resize(r),this._setPaintValue(b,r,T)}updatePaintArray(r,u,f,g){const v=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(r,u,v)}_setPaintValue(r,u,f){if(this.type==="color"){const g=$g(f);for(let v=r;v<u;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=r;g<u;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ms{constructor(r,u,f,g,v,b){this.expression=r,this.uniformNames=u.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=u.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(r,u,f,g,v){const b=this.expression.evaluate(new xn(this.zoom),u,{},g,[],v),T=this.expression.evaluate(new xn(this.zoom+1),u,{},g,[],v),A=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(A,r,b,T)}updatePaintArray(r,u,f,g){const v=this.expression.evaluate({zoom:this.zoom},f,g),b=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(r,u,v,b)}_setPaintValue(r,u,f,g){if(this.type==="color"){const v=$g(f),b=$g(g);for(let T=r;T<u;T++)this.paintVertexArray.emplace(T,v[0],v[1],b[0],b[1])}else{for(let v=r;v<u;v++)this.paintVertexArray.emplace(v,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,g=P(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);r.set(g)}getBinding(r,u,f){return new Lo(r,u)}}class ya{constructor(r,u,f,g,v,b){this.expression=r,this.type=u,this.useIntegerZoom=f,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(r,u,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(g,r,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(r,u,f,g,v){this._setPaintValues(r,u,f.patterns&&f.patterns[this.layerId],v)}_setPaintValues(r,u,f,g){if(!g||!f)return;const{min:v,mid:b,max:T}=f,A=g[v],M=g[b],z=g[T];if(A&&M&&z)for(let O=r;O<u;O++)this.zoomInPaintVertexArray.emplace(O,M.tl[0],M.tl[1],M.br[0],M.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],M.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,M.tl[0],M.tl[1],M.br[0],M.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],M.pixelRatio,z.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,li.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,li.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Kx{constructor(r,u,f){this.binders={},this._buffers=[];const g=[];for(const v in r.paint._values){if(!f(v))continue;const b=r.paint.get(v);if(!(b instanceof us&&gn(b.property.specification)))continue;const T=GC(v,r.type),A=b.value,M=b.property.specification.type,z=b.property.useIntegerZoom,O=b.property.specification["property-type"],V=O==="cross-faded"||O==="cross-faded-data-driven";if(A.kind==="constant")this.binders[v]=V?new vc(A.value,T):new ah(A.value,T,M),g.push(`/u_${v}`);else if(A.kind==="source"||V){const H=Jx(v,M,"source");this.binders[v]=V?new ya(A,M,z,u,H,r.id):new Mo(A,T,M,H),g.push(`/a_${v}`)}else{const H=Jx(v,M,"composite");this.binders[v]=new Ms(A,T,M,z,u,H),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(r){const u=this.binders[r];return u instanceof Mo||u instanceof Ms?u.maxValue:0}populatePaintArrays(r,u,f,g,v){for(const b in this.binders){const T=this.binders[b];(T instanceof Mo||T instanceof Ms||T instanceof ya)&&T.populatePaintArray(r,u,f,g,v)}}setConstantPatternPositions(r,u){for(const f in this.binders){const g=this.binders[f];g instanceof vc&&g.setConstantPatternPositions(r,u)}}updatePaintArrays(r,u,f,g,v){let b=!1;for(const T in r){const A=u.getPositions(T);for(const M of A){const z=f.feature(M.index);for(const O in this.binders){const V=this.binders[O];if((V instanceof Mo||V instanceof Ms||V instanceof ya)&&V.expression.isStateDependent===!0){const H=g.paint.get(O);V.expression=H.value,V.updatePaintArray(M.start,M.end,z,r[T],v),b=!0}}}}return b}defines(){const r=[];for(const u in this.binders){const f=this.binders[u];(f instanceof ah||f instanceof vc)&&r.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return r}getBinderAttributes(){const r=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Mo||f instanceof Ms)for(let g=0;g<f.paintVertexAttributes.length;g++)r.push(f.paintVertexAttributes[g].name);else if(f instanceof ya)for(let g=0;g<li.members.length;g++)r.push(li.members[g].name)}return r}getBinderUniforms(){const r=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof ah||f instanceof vc||f instanceof Ms)for(const g of f.uniformNames)r.push(g)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,u){const f=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof ah||v instanceof vc||v instanceof Ms){for(const b of v.uniformNames)if(u[b]){const T=v.getBinding(r,u[b],b);f.push({name:b,property:g,binding:T})}}}return f}setUniforms(r,u,f,g){for(const{name:v,property:b,binding:T}of u)this.binders[b].setUniform(T,g,f.get(b),v)}updatePaintBuffers(r){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(r&&f instanceof ya){const g=r.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof Mo||f instanceof Ms)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(r){for(const u in this.binders){const f=this.binders[u];(f instanceof Mo||f instanceof Ms||f instanceof ya)&&f.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const u=this.binders[r];(u instanceof Mo||u instanceof Ms||u instanceof ya)&&u.destroy()}}}class xl{constructor(r,u,f=()=>!0){this.programConfigurations={};for(const g of r)this.programConfigurations[g.id]=new Kx(g,u,f);this.needsUpload=!1,this._featureMap=new _a,this._bufferOffset=0}populatePaintArrays(r,u,f,g,v,b){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(r,u,g,v,b);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,u,f,g){for(const v of f)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(r,this._featureMap,u,v,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function GC(a,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}function Jx(a,r,u){const f={color:{source:p,composite:Te},number:{source:ne,composite:p}},g=function(v){return{"line-pattern":{source:ai,composite:ai},"fill-pattern":{source:ai,composite:ai},"fill-extrusion-pattern":{source:ai,composite:ai}}[v]}(a);return g&&g[u]||f[r][u]}ot("ConstantBinder",ah),ot("CrossFadedConstantBinder",vc),ot("SourceExpressionBinder",Mo),ot("CrossFadedCompositeBinder",ya),ot("CompositeExpressionBinder",Ms),ot("ProgramConfiguration",Kx,{omit:["_buffers"]}),ot("ProgramConfigurationSet",xl);var ti=8192;const Hg=Math.pow(2,14)-1,Qx=-Hg-1;function bl(a){const r=ti/a.extent,u=a.loadGeometry();for(let f=0;f<u.length;f++){const g=u[f];for(let v=0;v<g.length;v++){const b=g[v],T=Math.round(b.x*r),A=Math.round(b.y*r);b.x=P(T,Qx,Hg),b.y=P(A,Qx,Hg),(T<b.x||T>b.x+1||A<b.y||A>b.y+1)&&pe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function wl(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?bl(a):[]}}function kf(a,r,u,f,g){a.emplaceBack(2*r+(f+1)/2,2*u+(g+1)/2)}class qg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new sn,this.indexArray=new qi,this.segments=new Nt,this.programConfigurations=new xl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){const g=this.layers[0],v=[];let b=null,T=!1;g.type==="circle"&&(b=g.layout.get("circle-sort-key"),T=!b.isConstant());for(const{feature:A,id:M,index:z,sourceLayerIndex:O}of r){const V=this.layers[0]._featureFilter.needGeometry,H=wl(A,V);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),H,f))continue;const X=T?b.evaluate(H,{},f):void 0,ae={id:M,properties:A.properties,type:A.type,sourceLayerIndex:O,index:z,geometry:V?H.geometry:bl(A),patterns:{},sortKey:X};v.push(ae)}T&&v.sort((A,M)=>A.sortKey-M.sortKey);for(const A of v){const{geometry:M,index:z,sourceLayerIndex:O}=A,V=r[z].feature;this.addFeature(A,M,z,f),u.featureIndex.insert(V,M,z,O,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ei),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,u,f,g){for(const v of u)for(const b of v){const T=b.x,A=b.y;if(T<0||T>=ti||A<0||A>=ti)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),z=M.vertexLength;kf(this.layoutVertexArray,T,A,-1,-1),kf(this.layoutVertexArray,T,A,1,-1),kf(this.layoutVertexArray,T,A,1,1),kf(this.layoutVertexArray,T,A,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,{},g)}}function e1(a,r){for(let u=0;u<a.length;u++)if(xc(r,a[u]))return!0;for(let u=0;u<r.length;u++)if(xc(a,r[u]))return!0;return!!Zg(a,r)}function WC(a,r,u){return!!xc(a,r)||!!Xg(r,a,u)}function t1(a,r){if(a.length===1)return i1(r,a[0]);for(let u=0;u<r.length;u++){const f=r[u];for(let g=0;g<f.length;g++)if(xc(a,f[g]))return!0}for(let u=0;u<a.length;u++)if(i1(r,a[u]))return!0;for(let u=0;u<r.length;u++)if(Zg(a,r[u]))return!0;return!1}function $C(a,r,u){if(a.length>1){if(Zg(a,r))return!0;for(let f=0;f<r.length;f++)if(Xg(r[f],a,u))return!0}for(let f=0;f<a.length;f++)if(Xg(a[f],r,u))return!0;return!1}function Zg(a,r){if(a.length===0||r.length===0)return!1;for(let u=0;u<a.length-1;u++){const f=a[u],g=a[u+1];for(let v=0;v<r.length-1;v++)if(HC(f,g,r[v],r[v+1]))return!0}return!1}function HC(a,r,u,f){return be(a,u,f)!==be(r,u,f)&&be(a,r,u)!==be(a,r,f)}function Xg(a,r,u){const f=u*u;if(r.length===1)return a.distSqr(r[0])<f;for(let g=1;g<r.length;g++)if(n1(a,r[g-1],r[g])<f)return!0;return!1}function n1(a,r,u){const f=r.distSqr(u);if(f===0)return a.distSqr(r);const g=((a.x-r.x)*(u.x-r.x)+(a.y-r.y)*(u.y-r.y))/f;return a.distSqr(g<0?r:g>1?u:u.sub(r)._mult(g)._add(r))}function i1(a,r){let u,f,g,v=!1;for(let b=0;b<a.length;b++){u=a[b];for(let T=0,A=u.length-1;T<u.length;A=T++)f=u[T],g=u[A],f.y>r.y!=g.y>r.y&&r.x<(g.x-f.x)*(r.y-f.y)/(g.y-f.y)+f.x&&(v=!v)}return v}function xc(a,r){let u=!1;for(let f=0,g=a.length-1;f<a.length;g=f++){const v=a[f],b=a[g];v.y>r.y!=b.y>r.y&&r.x<(b.x-v.x)*(r.y-v.y)/(b.y-v.y)+v.x&&(u=!u)}return u}function qC(a,r,u){const f=u[0],g=u[2];if(a.x<f.x&&r.x<f.x||a.x>g.x&&r.x>g.x||a.y<f.y&&r.y<f.y||a.y>g.y&&r.y>g.y)return!1;const v=be(a,r,u[0]);return v!==be(a,r,u[1])||v!==be(a,r,u[2])||v!==be(a,r,u[3])}function lh(a,r,u){const f=r.paint.get(a).value;return f.kind==="constant"?f.value:u.programConfigurations.get(r.id).getMaxValue(a)}function Rf(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function zf(a,r,u,f,g){if(!r[0]&&!r[1])return a;const v=xt.convert(r)._mult(g);u==="viewport"&&v._rotate(-f);const b=[];for(let T=0;T<a.length;T++)b.push(a[T].sub(v));return b}ot("CircleBucket",qg,{omit:["layers"]});const ZC=new mi({"circle-sort-key":new wt(Le.layout_circle["circle-sort-key"])});var XC={paint:new mi({"circle-radius":new wt(Le.paint_circle["circle-radius"]),"circle-color":new wt(Le.paint_circle["circle-color"]),"circle-blur":new wt(Le.paint_circle["circle-blur"]),"circle-opacity":new wt(Le.paint_circle["circle-opacity"]),"circle-translate":new ht(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new ht(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ht(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ht(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wt(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wt(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wt(Le.paint_circle["circle-stroke-opacity"])}),layout:ZC},Zi=1e-6,Xi=typeof Float32Array<"u"?Float32Array:Array;function r1(){var a=new Xi(9);return Xi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Yg(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function s1(a,r,u){var f=r[0],g=r[1],v=r[2],b=r[3],T=r[4],A=r[5],M=r[6],z=r[7],O=r[8],V=r[9],H=r[10],X=r[11],ae=r[12],oe=r[13],ve=r[14],Se=r[15],ye=u[0],Ee=u[1],De=u[2],ze=u[3];return a[0]=ye*f+Ee*T+De*O+ze*ae,a[1]=ye*g+Ee*A+De*V+ze*oe,a[2]=ye*v+Ee*M+De*H+ze*ve,a[3]=ye*b+Ee*z+De*X+ze*Se,a[4]=(ye=u[4])*f+(Ee=u[5])*T+(De=u[6])*O+(ze=u[7])*ae,a[5]=ye*g+Ee*A+De*V+ze*oe,a[6]=ye*v+Ee*M+De*H+ze*ve,a[7]=ye*b+Ee*z+De*X+ze*Se,a[8]=(ye=u[8])*f+(Ee=u[9])*T+(De=u[10])*O+(ze=u[11])*ae,a[9]=ye*g+Ee*A+De*V+ze*oe,a[10]=ye*v+Ee*M+De*H+ze*ve,a[11]=ye*b+Ee*z+De*X+ze*Se,a[12]=(ye=u[12])*f+(Ee=u[13])*T+(De=u[14])*O+(ze=u[15])*ae,a[13]=ye*g+Ee*A+De*V+ze*oe,a[14]=ye*v+Ee*M+De*H+ze*ve,a[15]=ye*b+Ee*z+De*X+ze*Se,a}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var ch,YC=s1;function o1(){var a=new Xi(3);return Xi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function a1(a,r,u){var f=new Xi(3);return f[0]=a,f[1]=r,f[2]=u,f}function Df(a,r,u){var f=r[0],g=r[1],v=r[2],b=r[3];return a[0]=u[0]*f+u[4]*g+u[8]*v+u[12]*b,a[1]=u[1]*f+u[5]*g+u[9]*v+u[13]*b,a[2]=u[2]*f+u[6]*g+u[10]*v+u[14]*b,a[3]=u[3]*f+u[7]*g+u[11]*v+u[15]*b,a}function l1(){var a=new Xi(4);return Xi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function c1(a,r){const u=Df([],[a.x,a.y,0,1],r);return new xt(u[0]/u[3],u[1]/u[3])}o1(),ch=new Xi(4),Xi!=Float32Array&&(ch[0]=0,ch[1]=0,ch[2]=0,ch[3]=0),o1(),a1(1,0,0),a1(0,1,0),l1(),l1(),r1(),function(){var a;a=new Xi(2),Xi!=Float32Array&&(a[0]=0,a[1]=0)}();class u1 extends qg{}ot("HeatmapBucket",u1,{omit:["layers"]});var KC={paint:new mi({"heatmap-radius":new wt(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wt(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ht(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new eo(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ht(Le.paint_heatmap["heatmap-opacity"])})};function Kg(a,{width:r,height:u},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==r*u*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${r*u*f}`)}else g=new Uint8Array(r*u*f);return a.width=r,a.height=u,a.data=g,a}function h1(a,{width:r,height:u},f){if(r===a.width&&u===a.height)return;const g=Kg({},{width:r,height:u},f);Jg(a,g,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,r),height:Math.min(a.height,u)},f),a.width=r,a.height=u,a.data=g.data}function Jg(a,r,u,f,g,v){if(g.width===0||g.height===0)return r;if(g.width>a.width||g.height>a.height||u.x>a.width-g.width||u.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||f.x>r.width-g.width||f.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,T=r.data;if(b===T)throw new Error("srcData equals dstData, so image is already copied");for(let A=0;A<g.height;A++){const M=((u.y+A)*a.width+u.x)*v,z=((f.y+A)*r.width+f.x)*v;for(let O=0;O<g.width*v;O++)T[z+O]=b[M+O]}return r}class uh{constructor(r,u){Kg(this,r,1,u)}resize(r){h1(this,r,1)}clone(){return new uh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,u,f,g,v){Jg(r,u,f,g,v,1)}}class Vr{constructor(r,u){Kg(this,r,4,u)}resize(r){h1(this,r,4)}replace(r,u){u?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Vr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,u,f,g,v){Jg(r,u,f,g,v,4)}}function d1(a){const r={},u=a.resolution||256,f=a.clips?a.clips.length:1,g=a.image||new Vr({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const v=(b,T,A)=>{r[a.evaluationKey]=A;const M=a.expression.evaluate(r);g.data[b+T+0]=Math.floor(255*M.r/M.a),g.data[b+T+1]=Math.floor(255*M.g/M.a),g.data[b+T+2]=Math.floor(255*M.b/M.a),g.data[b+T+3]=Math.floor(255*M.a)};if(a.clips)for(let b=0,T=0;b<f;++b,T+=4*u)for(let A=0,M=0;A<u;A++,M+=4){const z=A/(u-1),{start:O,end:V}=a.clips[b];v(T,M,O*(1-z)+V*z)}else for(let b=0,T=0;b<u;b++,T+=4)v(0,T,b/(u-1));return g}ot("AlphaImage",uh),ot("RGBAImage",Vr);var JC={paint:new mi({"hillshade-illumination-direction":new ht(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ht(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ht(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ht(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ht(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ht(Le.paint_hillshade["hillshade-accent-color"])})};const QC=Hn([{name:"a_pos",components:2,type:"Int16"}],4),{members:eI}=QC;var Of={exports:{}};function Ff(a,r,u){u=u||2;var f,g,v,b,T,A,M,z=r&&r.length,O=z?r[0]*u:a.length,V=f1(a,0,O,u,!0),H=[];if(!V||V.next===V.prev)return H;if(z&&(V=function(ae,oe,ve,Se){var ye,Ee,De,ze=[];for(ye=0,Ee=oe.length;ye<Ee;ye++)(De=f1(ae,oe[ye]*Se,ye<Ee-1?oe[ye+1]*Se:ae.length,Se,!1))===De.next&&(De.steiner=!0),ze.push(lI(De));for(ze.sort(sI),ye=0;ye<ze.length;ye++)ve=oI(ze[ye],ve);return ve}(a,r,V,u)),a.length>80*u){f=v=a[0],g=b=a[1];for(var X=u;X<O;X+=u)(T=a[X])<f&&(f=T),(A=a[X+1])<g&&(g=A),T>v&&(v=T),A>b&&(b=A);M=(M=Math.max(v-f,b-g))!==0?32767/M:0}return hh(V,H,u,f,g,M,0),H}function f1(a,r,u,f,g){var v,b;if(g===t_(a,r,u,f)>0)for(v=r;v<u;v+=f)b=g1(v,a[v],a[v+1],b);else for(v=u-f;v>=r;v-=f)b=g1(v,a[v],a[v+1],b);return b&&Bf(b,b.next)&&(fh(b),b=b.next),b}function El(a,r){if(!a)return a;r||(r=a);var u,f=a;do if(u=!1,f.steiner||!Bf(f,f.next)&&Nn(f.prev,f,f.next)!==0)f=f.next;else{if(fh(f),(f=r=f.prev)===f.next)break;u=!0}while(u||f!==r);return r}function hh(a,r,u,f,g,v,b){if(a){!b&&v&&function(z,O,V,H){var X=z;do X.z===0&&(X.z=Qg(X.x,X.y,O,V,H)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==z);X.prevZ.nextZ=null,X.prevZ=null,function(ae){var oe,ve,Se,ye,Ee,De,ze,rt,ct=1;do{for(ve=ae,ae=null,Ee=null,De=0;ve;){for(De++,Se=ve,ze=0,oe=0;oe<ct&&(ze++,Se=Se.nextZ);oe++);for(rt=ct;ze>0||rt>0&&Se;)ze!==0&&(rt===0||!Se||ve.z<=Se.z)?(ye=ve,ve=ve.nextZ,ze--):(ye=Se,Se=Se.nextZ,rt--),Ee?Ee.nextZ=ye:ae=ye,ye.prevZ=Ee,Ee=ye;ve=Se}Ee.nextZ=null,ct*=2}while(De>1)}(X)}(a,f,g,v);for(var T,A,M=a;a.prev!==a.next;)if(T=a.prev,A=a.next,v?nI(a,f,g,v):tI(a))r.push(T.i/u|0),r.push(a.i/u|0),r.push(A.i/u|0),fh(a),a=A.next,M=A.next;else if((a=A)===M){b?b===1?hh(a=iI(El(a),r,u),r,u,f,g,v,2):b===2&&rI(a,r,u,f,g,v):hh(El(a),r,u,f,g,v,1);break}}}function tI(a){var r=a.prev,u=a,f=a.next;if(Nn(r,u,f)>=0)return!1;for(var g=r.x,v=u.x,b=f.x,T=r.y,A=u.y,M=f.y,z=g<v?g<b?g:b:v<b?v:b,O=T<A?T<M?T:M:A<M?A:M,V=g>v?g>b?g:b:v>b?v:b,H=T>A?T>M?T:M:A>M?A:M,X=f.next;X!==r;){if(X.x>=z&&X.x<=V&&X.y>=O&&X.y<=H&&bc(g,T,v,A,b,M,X.x,X.y)&&Nn(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function nI(a,r,u,f){var g=a.prev,v=a,b=a.next;if(Nn(g,v,b)>=0)return!1;for(var T=g.x,A=v.x,M=b.x,z=g.y,O=v.y,V=b.y,H=T<A?T<M?T:M:A<M?A:M,X=z<O?z<V?z:V:O<V?O:V,ae=T>A?T>M?T:M:A>M?A:M,oe=z>O?z>V?z:V:O>V?O:V,ve=Qg(H,X,r,u,f),Se=Qg(ae,oe,r,u,f),ye=a.prevZ,Ee=a.nextZ;ye&&ye.z>=ve&&Ee&&Ee.z<=Se;){if(ye.x>=H&&ye.x<=ae&&ye.y>=X&&ye.y<=oe&&ye!==g&&ye!==b&&bc(T,z,A,O,M,V,ye.x,ye.y)&&Nn(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,Ee.x>=H&&Ee.x<=ae&&Ee.y>=X&&Ee.y<=oe&&Ee!==g&&Ee!==b&&bc(T,z,A,O,M,V,Ee.x,Ee.y)&&Nn(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;ye&&ye.z>=ve;){if(ye.x>=H&&ye.x<=ae&&ye.y>=X&&ye.y<=oe&&ye!==g&&ye!==b&&bc(T,z,A,O,M,V,ye.x,ye.y)&&Nn(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;Ee&&Ee.z<=Se;){if(Ee.x>=H&&Ee.x<=ae&&Ee.y>=X&&Ee.y<=oe&&Ee!==g&&Ee!==b&&bc(T,z,A,O,M,V,Ee.x,Ee.y)&&Nn(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function iI(a,r,u){var f=a;do{var g=f.prev,v=f.next.next;!Bf(g,v)&&p1(g,f,f.next,v)&&dh(g,v)&&dh(v,g)&&(r.push(g.i/u|0),r.push(f.i/u|0),r.push(v.i/u|0),fh(f),fh(f.next),f=a=v),f=f.next}while(f!==a);return El(f)}function rI(a,r,u,f,g,v){var b=a;do{for(var T=b.next.next;T!==b.prev;){if(b.i!==T.i&&cI(b,T)){var A=m1(b,T);return b=El(b,b.next),A=El(A,A.next),hh(b,r,u,f,g,v,0),void hh(A,r,u,f,g,v,0)}T=T.next}b=b.next}while(b!==a)}function sI(a,r){return a.x-r.x}function oI(a,r){var u=function(g,v){var b,T=v,A=g.x,M=g.y,z=-1/0;do{if(M<=T.y&&M>=T.next.y&&T.next.y!==T.y){var O=T.x+(M-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(O<=A&&O>z&&(z=O,b=T.x<T.next.x?T:T.next,O===A))return b}T=T.next}while(T!==v);if(!b)return null;var V,H=b,X=b.x,ae=b.y,oe=1/0;T=b;do A>=T.x&&T.x>=X&&A!==T.x&&bc(M<ae?A:z,M,X,ae,M<ae?z:A,M,T.x,T.y)&&(V=Math.abs(M-T.y)/(A-T.x),dh(T,g)&&(V<oe||V===oe&&(T.x>b.x||T.x===b.x&&aI(b,T)))&&(b=T,oe=V)),T=T.next;while(T!==H);return b}(a,r);if(!u)return r;var f=m1(u,a);return El(f,f.next),El(u,u.next)}function aI(a,r){return Nn(a.prev,a,r.prev)<0&&Nn(r.next,a,a.next)<0}function Qg(a,r,u,f,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-u)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-f)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function lI(a){var r=a,u=a;do(r.x<u.x||r.x===u.x&&r.y<u.y)&&(u=r),r=r.next;while(r!==a);return u}function bc(a,r,u,f,g,v,b,T){return(g-b)*(r-T)>=(a-b)*(v-T)&&(a-b)*(f-T)>=(u-b)*(r-T)&&(u-b)*(v-T)>=(g-b)*(f-T)}function cI(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(u,f){var g=u;do{if(g.i!==u.i&&g.next.i!==u.i&&g.i!==f.i&&g.next.i!==f.i&&p1(g,g.next,u,f))return!0;g=g.next}while(g!==u);return!1}(a,r)&&(dh(a,r)&&dh(r,a)&&function(u,f){var g=u,v=!1,b=(u.x+f.x)/2,T=(u.y+f.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&b<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==u);return v}(a,r)&&(Nn(a.prev,a,r.prev)||Nn(a,r.prev,r))||Bf(a,r)&&Nn(a.prev,a,a.next)>0&&Nn(r.prev,r,r.next)>0)}function Nn(a,r,u){return(r.y-a.y)*(u.x-r.x)-(r.x-a.x)*(u.y-r.y)}function Bf(a,r){return a.x===r.x&&a.y===r.y}function p1(a,r,u,f){var g=Uf(Nn(a,r,u)),v=Uf(Nn(a,r,f)),b=Uf(Nn(u,f,a)),T=Uf(Nn(u,f,r));return g!==v&&b!==T||!(g!==0||!Nf(a,u,r))||!(v!==0||!Nf(a,f,r))||!(b!==0||!Nf(u,a,f))||!(T!==0||!Nf(u,r,f))}function Nf(a,r,u){return r.x<=Math.max(a.x,u.x)&&r.x>=Math.min(a.x,u.x)&&r.y<=Math.max(a.y,u.y)&&r.y>=Math.min(a.y,u.y)}function Uf(a){return a>0?1:a<0?-1:0}function dh(a,r){return Nn(a.prev,a,a.next)<0?Nn(a,r,a.next)>=0&&Nn(a,a.prev,r)>=0:Nn(a,r,a.prev)<0||Nn(a,a.next,r)<0}function m1(a,r){var u=new e_(a.i,a.x,a.y),f=new e_(r.i,r.x,r.y),g=a.next,v=r.prev;return a.next=r,r.prev=a,u.next=g,g.prev=u,f.next=u,u.prev=f,v.next=f,f.prev=v,f}function g1(a,r,u,f){var g=new e_(a,r,u);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function fh(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function e_(a,r,u){this.i=a,this.x=r,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function t_(a,r,u,f){for(var g=0,v=r,b=u-f;v<u;v+=f)g+=(a[b]-a[v])*(a[v+1]+a[b+1]),b=v;return g}function uI(a,r,u,f,g){_1(a,r,u||0,f||a.length-1,g||hI)}function _1(a,r,u,f,g){for(;f>u;){if(f-u>600){var v=f-u+1,b=r-u+1,T=Math.log(v),A=.5*Math.exp(2*T/3),M=.5*Math.sqrt(T*A*(v-A)/v)*(b-v/2<0?-1:1);_1(a,r,Math.max(u,Math.floor(r-b*A/v+M)),Math.min(f,Math.floor(r+(v-b)*A/v+M)),g)}var z=a[r],O=u,V=f;for(ph(a,u,r),g(a[f],z)>0&&ph(a,u,f);O<V;){for(ph(a,O,V),O++,V--;g(a[O],z)<0;)O++;for(;g(a[V],z)>0;)V--}g(a[u],z)===0?ph(a,u,V):ph(a,++V,f),V<=r&&(u=V+1),r<=V&&(f=V-1)}}function ph(a,r,u){var f=a[r];a[r]=a[u],a[u]=f}function hI(a,r){return a<r?-1:a>r?1:0}function n_(a,r){const u=a.length;if(u<=1)return[a];const f=[];let g,v;for(let b=0;b<u;b++){const T=Re(a[b]);T!==0&&(a[b].area=Math.abs(T),v===void 0&&(v=T<0),v===T<0?(g&&f.push(g),g=[a[b]]):g.push(a[b]))}if(g&&f.push(g),r>1)for(let b=0;b<f.length;b++)f[b].length<=r||(uI(f[b],r,1,f[b].length-1,dI),f[b]=f[b].slice(0,r));return f}function dI(a,r){return r.area-a.area}function i_(a,r,u){const f=u.patternDependencies;let g=!1;for(const v of r){const b=v.paint.get(`${a}-pattern`);b.isConstant()||(g=!0);const T=b.constantOr(null);T&&(g=!0,f[T.to]=!0,f[T.from]=!0)}return g}function r_(a,r,u,f,g){const v=g.patternDependencies;for(const b of r){const T=b.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let A=T.evaluate({zoom:f-1},u,{},g.availableImages),M=T.evaluate({zoom:f},u,{},g.availableImages),z=T.evaluate({zoom:f+1},u,{},g.availableImages);A=A&&A.name?A.name:A,M=M&&M.name?M.name:M,z=z&&z.name?z.name:z,v[A]=!0,v[M]=!0,v[z]=!0,u.patterns[b.id]={min:A,mid:M,max:z}}}return u}Of.exports=Ff,Of.exports.default=Ff,Ff.deviation=function(a,r,u,f){var g=r&&r.length,v=Math.abs(t_(a,0,g?r[0]*u:a.length,u));if(g)for(var b=0,T=r.length;b<T;b++)v-=Math.abs(t_(a,r[b]*u,b<T-1?r[b+1]*u:a.length,u));var A=0;for(b=0;b<f.length;b+=3){var M=f[b]*u,z=f[b+1]*u,O=f[b+2]*u;A+=Math.abs((a[M]-a[O])*(a[z+1]-a[M+1])-(a[M]-a[z])*(a[O+1]-a[M+1]))}return v===0&&A===0?0:Math.abs((A-v)/v)},Ff.flatten=function(a){for(var r=a[0][0].length,u={vertices:[],holes:[],dimensions:r},f=0,g=0;g<a.length;g++){for(var v=0;v<a[g].length;v++)for(var b=0;b<r;b++)u.vertices.push(a[g][v][b]);g>0&&u.holes.push(f+=a[g-1].length)}return u};class s_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new on,this.indexArray=new qi,this.indexArray2=new Ls,this.programConfigurations=new xl(r.layers,r.zoom),this.segments=new Nt,this.segments2=new Nt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.hasPattern=i_("fill",this.layers,u);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),b=[];for(const{feature:T,id:A,index:M,sourceLayerIndex:z}of r){const O=this.layers[0]._featureFilter.needGeometry,V=wl(T,O);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),V,f))continue;const H=v?g.evaluate(V,{},f,u.availableImages):void 0,X={id:A,properties:T.properties,type:T.type,sourceLayerIndex:z,index:M,geometry:O?V.geometry:bl(T),patterns:{},sortKey:H};b.push(X)}v&&b.sort((T,A)=>T.sortKey-A.sortKey);for(const T of b){const{geometry:A,index:M,sourceLayerIndex:z}=T;if(this.hasPattern){const O=r_("fill",this.layers,T,this.zoom,u);this.patternFeatures.push(O)}else this.addFeature(T,A,M,f,{});u.featureIndex.insert(r[M].feature,A,M,z,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}addFeatures(r,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,eI),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,u,f,g,v){for(const b of n_(u,500)){let T=0;for(const H of b)T+=H.length;const A=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),M=A.vertexLength,z=[],O=[];for(const H of b){if(H.length===0)continue;H!==b[0]&&O.push(z.length/2);const X=this.segments2.prepareSegment(H.length,this.layoutVertexArray,this.indexArray2),ae=X.vertexLength;this.layoutVertexArray.emplaceBack(H[0].x,H[0].y),this.indexArray2.emplaceBack(ae+H.length-1,ae),z.push(H[0].x),z.push(H[0].y);for(let oe=1;oe<H.length;oe++)this.layoutVertexArray.emplaceBack(H[oe].x,H[oe].y),this.indexArray2.emplaceBack(ae+oe-1,ae+oe),z.push(H[oe].x),z.push(H[oe].y);X.vertexLength+=H.length,X.primitiveLength+=H.length}const V=Of.exports(z,O);for(let H=0;H<V.length;H+=3)this.indexArray.emplaceBack(M+V[H],M+V[H+1],M+V[H+2]);A.vertexLength+=T,A.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,v,g)}}ot("FillBucket",s_,{omit:["layers","patternFeatures"]});const fI=new mi({"fill-sort-key":new wt(Le.layout_fill["fill-sort-key"])});var pI={paint:new mi({"fill-antialias":new ht(Le.paint_fill["fill-antialias"]),"fill-opacity":new wt(Le.paint_fill["fill-opacity"]),"fill-color":new wt(Le.paint_fill["fill-color"]),"fill-outline-color":new wt(Le.paint_fill["fill-outline-color"]),"fill-translate":new ht(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new ht(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new ga(Le.paint_fill["fill-pattern"])}),layout:fI};const mI=Hn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),gI=Hn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:_I}=mI;var va={},yI=xt,y1=wc;function wc(a,r,u,f,g){this.properties={},this.extent=u,this.type=0,this._pbf=a,this._geometry=-1,this._keys=f,this._values=g,a.readFields(vI,this,r)}function vI(a,r,u){a==1?r.id=u.readVarint():a==2?function(f,g){for(var v=f.readVarint()+f.pos;f.pos<v;){var b=g._keys[f.readVarint()],T=g._values[f.readVarint()];g.properties[b]=T}}(u,r):a==3?r.type=u.readVarint():a==4&&(r._geometry=u.pos)}function xI(a){for(var r,u,f=0,g=0,v=a.length,b=v-1;g<v;b=g++)f+=((u=a[b]).x-(r=a[g]).x)*(r.y+u.y);return f}wc.types=["Unknown","Point","LineString","Polygon"],wc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,u=a.readVarint()+a.pos,f=1,g=0,v=0,b=0,T=[];a.pos<u;){if(g<=0){var A=a.readVarint();f=7&A,g=A>>3}if(g--,f===1||f===2)v+=a.readSVarint(),b+=a.readSVarint(),f===1&&(r&&T.push(r),r=[]),r.push(new yI(v,b));else{if(f!==7)throw new Error("unknown command "+f);r&&r.push(r[0].clone())}}return r&&T.push(r),T},wc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,u=1,f=0,g=0,v=0,b=1/0,T=-1/0,A=1/0,M=-1/0;a.pos<r;){if(f<=0){var z=a.readVarint();u=7&z,f=z>>3}if(f--,u===1||u===2)(g+=a.readSVarint())<b&&(b=g),g>T&&(T=g),(v+=a.readSVarint())<A&&(A=v),v>M&&(M=v);else if(u!==7)throw new Error("unknown command "+u)}return[b,A,T,M]},wc.prototype.toGeoJSON=function(a,r,u){var f,g,v=this.extent*Math.pow(2,u),b=this.extent*a,T=this.extent*r,A=this.loadGeometry(),M=wc.types[this.type];function z(H){for(var X=0;X<H.length;X++){var ae=H[X];H[X]=[360*(ae.x+b)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(ae.y+T)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(f=0;f<A.length;f++)O[f]=A[f][0];z(A=O);break;case 2:for(f=0;f<A.length;f++)z(A[f]);break;case 3:for(A=function(H){var X=H.length;if(X<=1)return[H];for(var ae,oe,ve=[],Se=0;Se<X;Se++){var ye=xI(H[Se]);ye!==0&&(oe===void 0&&(oe=ye<0),oe===ye<0?(ae&&ve.push(ae),ae=[H[Se]]):ae.push(H[Se]))}return ae&&ve.push(ae),ve}(A),f=0;f<A.length;f++)for(g=0;g<A[f].length;g++)z(A[f][g])}A.length===1?A=A[0]:M="Multi"+M;var V={type:"Feature",geometry:{type:M,coordinates:A},properties:this.properties};return"id"in this&&(V.id=this.id),V};var bI=y1,v1=x1;function x1(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(wI,this,r),this.length=this._features.length}function wI(a,r,u){a===15?r.version=u.readVarint():a===1?r.name=u.readString():a===5?r.extent=u.readVarint():a===2?r._features.push(u.pos):a===3?r._keys.push(u.readString()):a===4&&r._values.push(function(f){for(var g=null,v=f.readVarint()+f.pos;f.pos<v;){var b=f.readVarint()>>3;g=b===1?f.readString():b===2?f.readFloat():b===3?f.readDouble():b===4?f.readVarint64():b===5?f.readVarint():b===6?f.readSVarint():b===7?f.readBoolean():null}return g}(u))}x1.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new bI(this._pbf,r,this.extent,this._keys,this._values)};var EI=v1;function TI(a,r,u){if(a===3){var f=new EI(u,u.readVarint()+u.pos);f.length&&(r[f.name]=f)}}va.VectorTile=function(a,r){this.layers=a.readFields(TI,{},r)},va.VectorTileFeature=y1,va.VectorTileLayer=v1;const SI=va.VectorTileFeature.types,o_=Math.pow(2,13);function mh(a,r,u,f,g,v,b,T){a.emplaceBack(r,u,2*Math.floor(f*o_)+b,g*o_*2,v*o_*2,Math.round(T))}class a_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new $t,this.centroidVertexArray=new _t,this.indexArray=new qi,this.programConfigurations=new xl(r.layers,r.zoom),this.segments=new Nt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.features=[],this.hasPattern=i_("fill-extrusion",this.layers,u);for(const{feature:g,id:v,index:b,sourceLayerIndex:T}of r){const A=this.layers[0]._featureFilter.needGeometry,M=wl(g,A);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),M,f))continue;const z={id:v,sourceLayerIndex:T,index:b,geometry:A?M.geometry:bl(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(r_("fill-extrusion",this.layers,z,this.zoom,u)):this.addFeature(z,z.geometry,b,f,{}),u.featureIndex.insert(g,z.geometry,b,T,this.index,!0)}}addFeatures(r,u,f){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,u,f)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,_I),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,gI.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,u,f,g,v){const b={x:0,y:0,vertexCount:0};for(const T of n_(u,500)){let A=0;for(const X of T)A+=X.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const X of T){if(X.length===0||PI(X))continue;let ae=0;for(let oe=0;oe<X.length;oe++){const ve=X[oe];if(oe>=1){const Se=X[oe-1];if(!AI(ve,Se)){M.vertexLength+4>Nt.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ye=ve.sub(Se)._perp()._unit(),Ee=Se.dist(ve);ae+Ee>32768&&(ae=0),mh(this.layoutVertexArray,ve.x,ve.y,ye.x,ye.y,0,0,ae),mh(this.layoutVertexArray,ve.x,ve.y,ye.x,ye.y,0,1,ae),b.x+=2*ve.x,b.y+=2*ve.y,b.vertexCount+=2,ae+=Ee,mh(this.layoutVertexArray,Se.x,Se.y,ye.x,ye.y,0,0,ae),mh(this.layoutVertexArray,Se.x,Se.y,ye.x,ye.y,0,1,ae),b.x+=2*Se.x,b.y+=2*Se.y,b.vertexCount+=2;const De=M.vertexLength;this.indexArray.emplaceBack(De,De+2,De+1),this.indexArray.emplaceBack(De+1,De+2,De+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+A>Nt.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),SI[r.type]!=="Polygon")continue;const z=[],O=[],V=M.vertexLength;for(const X of T)if(X.length!==0){X!==T[0]&&O.push(z.length/2);for(let ae=0;ae<X.length;ae++){const oe=X[ae];mh(this.layoutVertexArray,oe.x,oe.y,0,0,1,1,0),b.x+=oe.x,b.y+=oe.y,b.vertexCount+=1,z.push(oe.x),z.push(oe.y)}}const H=Of.exports(z,O);for(let X=0;X<H.length;X+=3)this.indexArray.emplaceBack(V+H[X],V+H[X+2],V+H[X+1]);M.primitiveLength+=H.length/3,M.vertexLength+=A}for(let T=0;T<b.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,v,g)}}function AI(a,r){return a.x===r.x&&(a.x<0||a.x>ti)||a.y===r.y&&(a.y<0||a.y>ti)}function PI(a){return a.every(r=>r.x<0)||a.every(r=>r.x>ti)||a.every(r=>r.y<0)||a.every(r=>r.y>ti)}ot("FillExtrusionBucket",a_,{omit:["layers","features"]});var CI={paint:new mi({"fill-extrusion-opacity":new ht(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wt(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ht(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ht(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ga(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wt(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wt(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ht(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function gh(a,r){return a.x*r.x+a.y*r.y}function b1(a,r){if(a.length===1){let u=0;const f=r[u++];let g;for(;!g||f.equals(g);)if(g=r[u++],!g)return 1/0;for(;u<r.length;u++){const v=r[u],b=a[0],T=g.sub(f),A=v.sub(f),M=b.sub(f),z=gh(T,T),O=gh(T,A),V=gh(A,A),H=gh(M,T),X=gh(M,A),ae=z*V-O*O,oe=(V*H-O*X)/ae,ve=(z*X-O*H)/ae,Se=f.z*(1-oe-ve)+g.z*oe+v.z*ve;if(isFinite(Se))return Se}return 1/0}{let u=1/0;for(const f of r)u=Math.min(u,f.z);return u}}const II=Hn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:LI}=II,MI=Hn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:kI}=MI,RI=va.VectorTileFeature.types,zI=Math.cos(Math.PI/180*37.5),w1=Math.pow(2,14)/.5;class l_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Ht,this.layoutVertexArray2=new ln,this.indexArray=new qi,this.programConfigurations=new xl(r.layers,r.zoom),this.segments=new Nt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.hasPattern=i_("line",this.layers,u);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),b=[];for(const{feature:T,id:A,index:M,sourceLayerIndex:z}of r){const O=this.layers[0]._featureFilter.needGeometry,V=wl(T,O);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),V,f))continue;const H=v?g.evaluate(V,{},f):void 0,X={id:A,properties:T.properties,type:T.type,sourceLayerIndex:z,index:M,geometry:O?V.geometry:bl(T),patterns:{},sortKey:H};b.push(X)}v&&b.sort((T,A)=>T.sortKey-A.sortKey);for(const T of b){const{geometry:A,index:M,sourceLayerIndex:z}=T;if(this.hasPattern){const O=r_("line",this.layers,T,this.zoom,u);this.patternFeatures.push(O)}else this.addFeature(T,A,M,f,{});u.featureIndex.insert(r[M].feature,A,M,z,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}addFeatures(r,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,kI)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,LI),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,u,f,g,v){const b=this.layers[0].layout,T=b.get("line-join").evaluate(r,{}),A=b.get("line-cap"),M=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const O of u)this.addLine(O,r,T,A,M,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,v,g)}addLine(r,u,f,g,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<r.length-1;ve++)this.totalDistance+=r[ve].dist(r[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=RI[u.type]==="Polygon";let A=r.length;for(;A>=2&&r[A-1].equals(r[A-2]);)A--;let M=0;for(;M<A-1&&r[M].equals(r[M+1]);)M++;if(A<(T?3:2))return;f==="bevel"&&(v=1.05);const z=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let V,H,X,ae,oe;this.e1=this.e2=-1,T&&(V=r[A-2],oe=r[M].sub(V)._unit()._perp());for(let ve=M;ve<A;ve++){if(X=ve===A-1?T?r[M+1]:void 0:r[ve+1],X&&r[ve].equals(X))continue;oe&&(ae=oe),V&&(H=V),V=r[ve],oe=X?X.sub(V)._unit()._perp():ae,ae=ae||oe;let Se=ae.add(oe);Se.x===0&&Se.y===0||Se._unit();const ye=ae.x*oe.x+ae.y*oe.y,Ee=Se.x*oe.x+Se.y*oe.y,De=Ee!==0?1/Ee:1/0,ze=2*Math.sqrt(2-2*Ee),rt=Ee<zI&&H&&X,ct=ae.x*oe.y-ae.y*oe.x>0;if(rt&&ve>M){const $e=V.dist(H);if($e>2*z){const et=V.sub(V.sub(H)._mult(z/$e)._round());this.updateDistance(H,et),this.addCurrentVertex(et,ae,0,0,O),H=et}}const Qe=H&&X;let Xe=Qe?f:T?"butt":g;if(Qe&&Xe==="round"&&(De<b?Xe="miter":De<=2&&(Xe="fakeround")),Xe==="miter"&&De>v&&(Xe="bevel"),Xe==="bevel"&&(De>2&&(Xe="flipbevel"),De<v&&(Xe="miter")),H&&this.updateDistance(H,V),Xe==="miter")Se._mult(De),this.addCurrentVertex(V,Se,0,0,O);else if(Xe==="flipbevel"){if(De>100)Se=oe.mult(-1);else{const $e=De*ae.add(oe).mag()/ae.sub(oe).mag();Se._perp()._mult($e*(ct?-1:1))}this.addCurrentVertex(V,Se,0,0,O),this.addCurrentVertex(V,Se.mult(-1),0,0,O)}else if(Xe==="bevel"||Xe==="fakeround"){const $e=-Math.sqrt(De*De-1),et=ct?$e:0,Ye=ct?0:$e;if(H&&this.addCurrentVertex(V,ae,et,Ye,O),Xe==="fakeround"){const Ve=Math.round(180*ze/Math.PI/20);for(let yt=1;yt<Ve;yt++){let ft=yt/Ve;if(ft!==.5){const _n=ft-.5;ft+=ft*_n*(ft-1)*((1.0904+ye*(ye*(3.55645-1.43519*ye)-3.2452))*_n*_n+(.848013+ye*(.215638*ye-1.06021)))}const Ot=oe.sub(ae)._mult(ft)._add(ae)._unit()._mult(ct?-1:1);this.addHalfVertex(V,Ot.x,Ot.y,!1,ct,0,O)}}X&&this.addCurrentVertex(V,oe,-et,-Ye,O)}else if(Xe==="butt")this.addCurrentVertex(V,Se,0,0,O);else if(Xe==="square"){const $e=H?1:-1;this.addCurrentVertex(V,Se,$e,$e,O)}else Xe==="round"&&(H&&(this.addCurrentVertex(V,ae,0,0,O),this.addCurrentVertex(V,ae,1,1,O,!0)),X&&(this.addCurrentVertex(V,oe,-1,-1,O,!0),this.addCurrentVertex(V,oe,0,0,O)));if(rt&&ve<A-1){const $e=V.dist(X);if($e>2*z){const et=V.add(X.sub(V)._mult(z/$e)._round());this.updateDistance(V,et),this.addCurrentVertex(et,oe,0,0,O),V=et}}}}addCurrentVertex(r,u,f,g,v,b=!1){const T=u.y*g-u.x,A=-u.y-u.x*g;this.addHalfVertex(r,u.x+u.y*f,u.y-u.x*f,b,!1,f,v),this.addHalfVertex(r,T,A,b,!0,-g,v),this.distance>w1/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(r,u,f,g,v,b))}addHalfVertex({x:r,y:u},f,g,v,b,T,A){const M=.5*(this.lineClips?this.scaledDistance*(w1-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(v?1:0),(u<<1)+(b?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),A.primitiveLength++),b?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,u){this.distance+=r.dist(u),this.updateScaledDistance()}}ot("LineBucket",l_,{omit:["layers","patternFeatures"]});const DI=new mi({"line-cap":new ht(Le.layout_line["line-cap"]),"line-join":new wt(Le.layout_line["line-join"]),"line-miter-limit":new ht(Le.layout_line["line-miter-limit"]),"line-round-limit":new ht(Le.layout_line["line-round-limit"]),"line-sort-key":new wt(Le.layout_line["line-sort-key"])});var E1={paint:new mi({"line-opacity":new wt(Le.paint_line["line-opacity"]),"line-color":new wt(Le.paint_line["line-color"]),"line-translate":new ht(Le.paint_line["line-translate"]),"line-translate-anchor":new ht(Le.paint_line["line-translate-anchor"]),"line-width":new wt(Le.paint_line["line-width"]),"line-gap-width":new wt(Le.paint_line["line-gap-width"]),"line-offset":new wt(Le.paint_line["line-offset"]),"line-blur":new wt(Le.paint_line["line-blur"]),"line-dasharray":new ih(Le.paint_line["line-dasharray"]),"line-pattern":new ga(Le.paint_line["line-pattern"]),"line-gradient":new eo(Le.paint_line["line-gradient"])}),layout:DI};const T1=new class extends wt{possiblyEvaluate(a,r){return r=new xn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(a,r)}evaluate(a,r,u,f){return r=G({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(a,r,u,f)}}(E1.paint.properties["line-width"].specification);function S1(a,r){return r>0?r+2*a:a}T1.useIntegerZoom=!0;const OI=Hn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),FI=Hn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Hn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const BI=Hn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Hn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const A1=Hn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),NI=Hn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function UI(a,r,u){return a.sections.forEach(f=>{f.text=function(g,v,b){const T=v.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),Er.applyArabicShaping&&(g=Er.applyArabicShaping(g)),g}(f.text,r,u)}),a}Hn([{name:"triangle",components:3,type:"Uint16"}]),Hn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Hn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Hn([{type:"Float32",name:"offsetX"}]),Hn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const _h={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var gi=24,c_=hn,P1=function(a,r,u,f,g){var v,b,T=8*g-f-1,A=(1<<T)-1,M=A>>1,z=-7,O=u?g-1:0,V=u?-1:1,H=a[r+O];for(O+=V,v=H&(1<<-z)-1,H>>=-z,z+=T;z>0;v=256*v+a[r+O],O+=V,z-=8);for(b=v&(1<<-z)-1,v>>=-z,z+=f;z>0;b=256*b+a[r+O],O+=V,z-=8);if(v===0)v=1-M;else{if(v===A)return b?NaN:1/0*(H?-1:1);b+=Math.pow(2,f),v-=M}return(H?-1:1)*b*Math.pow(2,v-f)},C1=function(a,r,u,f,g,v){var b,T,A,M=8*v-g-1,z=(1<<M)-1,O=z>>1,V=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=f?0:v-1,X=f?1:-1,ae=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(T=isNaN(r)?1:0,b=z):(b=Math.floor(Math.log(r)/Math.LN2),r*(A=Math.pow(2,-b))<1&&(b--,A*=2),(r+=b+O>=1?V/A:V*Math.pow(2,1-O))*A>=2&&(b++,A/=2),b+O>=z?(T=0,b=z):b+O>=1?(T=(r*A-1)*Math.pow(2,g),b+=O):(T=r*Math.pow(2,O-1)*Math.pow(2,g),b=0));g>=8;a[u+H]=255&T,H+=X,T/=256,g-=8);for(b=b<<g|T,M+=g;M>0;a[u+H]=255&b,H+=X,b/=256,M-=8);a[u+H-X]|=128*ae};function hn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}hn.Varint=0,hn.Fixed64=1,hn.Bytes=2,hn.Fixed32=5;var xa,u_=4294967296,I1=1/u_,L1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ko(a){return a.type===hn.Bytes?a.readVarint()+a.pos:a.pos+1}function Ec(a,r,u){return u?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}function M1(a,r,u){var f=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));u.realloc(f);for(var g=u.pos-1;g>=a;g--)u.buf[g+f]=u.buf[g]}function VI(a,r){for(var u=0;u<a.length;u++)r.writeVarint(a[u])}function jI(a,r){for(var u=0;u<a.length;u++)r.writeSVarint(a[u])}function GI(a,r){for(var u=0;u<a.length;u++)r.writeFloat(a[u])}function WI(a,r){for(var u=0;u<a.length;u++)r.writeDouble(a[u])}function $I(a,r){for(var u=0;u<a.length;u++)r.writeBoolean(a[u])}function HI(a,r){for(var u=0;u<a.length;u++)r.writeFixed32(a[u])}function qI(a,r){for(var u=0;u<a.length;u++)r.writeSFixed32(a[u])}function ZI(a,r){for(var u=0;u<a.length;u++)r.writeFixed64(a[u])}function XI(a,r){for(var u=0;u<a.length;u++)r.writeSFixed64(a[u])}function Vf(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function Tc(a,r,u){a[u]=r,a[u+1]=r>>>8,a[u+2]=r>>>16,a[u+3]=r>>>24}function k1(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}function YI(a,r,u){a===1&&u.readMessage(KI,r)}function KI(a,r,u){if(a===3){const{id:f,bitmap:g,width:v,height:b,left:T,top:A,advance:M}=u.readMessage(JI,{});r.push({id:f,bitmap:new uh({width:v+6,height:b+6},g),metrics:{width:v,height:b,left:T,top:A,advance:M}})}}function JI(a,r,u){a===1?r.id=u.readVarint():a===2?r.bitmap=u.readBytes():a===3?r.width=u.readVarint():a===4?r.height=u.readVarint():a===5?r.left=u.readSVarint():a===6?r.top=u.readSVarint():a===7&&(r.advance=u.readVarint())}function R1(a){let r=0,u=0;for(const b of a)r+=b.w*b.h,u=Math.max(u,b.w);a.sort((b,T)=>T.h-b.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),u),h:1/0}];let g=0,v=0;for(const b of a)for(let T=f.length-1;T>=0;T--){const A=f[T];if(!(b.w>A.w||b.h>A.h)){if(b.x=A.x,b.y=A.y,v=Math.max(v,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===A.w&&b.h===A.h){const M=f.pop();T<f.length&&(f[T]=M)}else b.h===A.h?(A.x+=b.w,A.w-=b.w):b.w===A.w?(A.y+=b.h,A.h-=b.h):(f.push({x:A.x+b.w,y:A.y,w:A.w-b.w,h:b.h}),A.y+=b.h,A.h-=b.h);break}}return{w:g,h:v,fill:r/(g*v)||0}}hn.prototype={destroy:function(){this.buf=null},readFields:function(a,r,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),g=f>>3,v=this.pos;this.type=7&f,a(g,r,this),this.pos===v&&this.skip(f)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=Vf(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=k1(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Vf(this.buf,this.pos)+Vf(this.buf,this.pos+4)*u_;return this.pos+=8,a},readSFixed64:function(){var a=Vf(this.buf,this.pos)+k1(this.buf,this.pos+4)*u_;return this.pos+=8,a},readFloat:function(){var a=P1(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=P1(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,u,f=this.buf;return r=127&(u=f[this.pos++]),u<128?r:(r|=(127&(u=f[this.pos++]))<<7,u<128?r:(r|=(127&(u=f[this.pos++]))<<14,u<128?r:(r|=(127&(u=f[this.pos++]))<<21,u<128?r:function(g,v,b){var T,A,M=b.buf;if(T=(112&(A=M[b.pos++]))>>4,A<128||(T|=(127&(A=M[b.pos++]))<<3,A<128)||(T|=(127&(A=M[b.pos++]))<<10,A<128)||(T|=(127&(A=M[b.pos++]))<<17,A<128)||(T|=(127&(A=M[b.pos++]))<<24,A<128)||(T|=(1&(A=M[b.pos++]))<<31,A<128))return Ec(g,T,v);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(u=f[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&L1?function(u,f,g){return L1.decode(u.subarray(f,g))}(this.buf,r,a):function(u,f,g){for(var v="",b=f;b<g;){var T,A,M,z=u[b],O=null,V=z>239?4:z>223?3:z>191?2:1;if(b+V>g)break;V===1?z<128&&(O=z):V===2?(192&(T=u[b+1]))==128&&(O=(31&z)<<6|63&T)<=127&&(O=null):V===3?(A=u[b+2],(192&(T=u[b+1]))==128&&(192&A)==128&&((O=(15&z)<<12|(63&T)<<6|63&A)<=2047||O>=55296&&O<=57343)&&(O=null)):V===4&&(A=u[b+2],M=u[b+3],(192&(T=u[b+1]))==128&&(192&A)==128&&(192&M)==128&&((O=(15&z)<<18|(63&T)<<12|(63&A)<<6|63&M)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,V=1):O>65535&&(O-=65536,v+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),v+=String.fromCharCode(O),b+=V}return v}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==hn.Bytes)return a.push(this.readVarint(r));var u=ko(this);for(a=a||[];this.pos<u;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==hn.Bytes)return a.push(this.readSVarint());var r=ko(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==hn.Bytes)return a.push(this.readBoolean());var r=ko(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==hn.Bytes)return a.push(this.readFloat());var r=ko(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==hn.Bytes)return a.push(this.readDouble());var r=ko(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==hn.Bytes)return a.push(this.readFixed32());var r=ko(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==hn.Bytes)return a.push(this.readSFixed32());var r=ko(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==hn.Bytes)return a.push(this.readFixed64());var r=ko(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==hn.Bytes)return a.push(this.readSFixed64());var r=ko(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===hn.Varint)for(;this.buf[this.pos++]>127;);else if(r===hn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===hn.Fixed32)this.pos+=4;else{if(r!==hn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var u=new Uint8Array(r);u.set(this.buf),this.buf=u,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Tc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Tc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Tc(this.buf,-1&a,this.pos),Tc(this.buf,Math.floor(a*I1),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Tc(this.buf,-1&a,this.pos),Tc(this.buf,Math.floor(a*I1),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,u){var f,g;if(r>=0?(f=r%4294967296|0,g=r/4294967296|0):(g=~(-r/4294967296),4294967295^(f=~(-r%4294967296))?f=f+1|0:(f=0,g=g+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(v,b,T){T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,T.buf[T.pos]=127&(v>>>=7)}(f,0,u),function(v,b){var T=(7&v)<<4;b.buf[b.pos++]|=T|((v>>>=3)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v)))))}(g,u)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(f,g,v){for(var b,T,A=0;A<g.length;A++){if((b=g.charCodeAt(A))>55295&&b<57344){if(!T){b>56319||A+1===g.length?(f[v++]=239,f[v++]=191,f[v++]=189):T=b;continue}if(b<56320){f[v++]=239,f[v++]=191,f[v++]=189,T=b;continue}b=T-55296<<10|b-56320|65536,T=null}else T&&(f[v++]=239,f[v++]=191,f[v++]=189,T=null);b<128?f[v++]=b:(b<2048?f[v++]=b>>6|192:(b<65536?f[v++]=b>>12|224:(f[v++]=b>>18|240,f[v++]=b>>12&63|128),f[v++]=b>>6&63|128),f[v++]=63&b|128)}return v}(this.buf,a,this.pos);var u=this.pos-r;u>=128&&M1(r,u,this),this.pos=r-1,this.writeVarint(u),this.pos+=u},writeFloat:function(a){this.realloc(4),C1(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),C1(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var u=0;u<r;u++)this.buf[this.pos++]=a[u]},writeRawMessage:function(a,r){this.pos++;var u=this.pos;a(r,this);var f=this.pos-u;f>=128&&M1(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(a,r,u){this.writeTag(a,hn.Bytes),this.writeRawMessage(r,u)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,VI,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,jI,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,$I,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,GI,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,WI,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,HI,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,qI,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,ZI,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,XI,r)},writeBytesField:function(a,r){this.writeTag(a,hn.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,hn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,hn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,hn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,hn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,hn.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,hn.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,hn.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,hn.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,hn.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,!!r)}};class h_{constructor(r,{pixelRatio:u,version:f,stretchX:g,stretchY:v,content:b}){this.paddedRect=r,this.pixelRatio=u,this.stretchX=g,this.stretchY=v,this.content=b,this.version=f}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class z1{constructor(r,u){const f={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(r,f,v),this.addImages(u,g,v);const{w:b,h:T}=R1(v),A=new Vr({width:b||1,height:T||1});for(const M in r){const z=r[M],O=f[M].paddedRect;Vr.copy(z.data,A,{x:0,y:0},{x:O.x+1,y:O.y+1},z.data)}for(const M in u){const z=u[M],O=g[M].paddedRect,V=O.x+1,H=O.y+1,X=z.data.width,ae=z.data.height;Vr.copy(z.data,A,{x:0,y:0},{x:V,y:H},z.data),Vr.copy(z.data,A,{x:0,y:ae-1},{x:V,y:H-1},{width:X,height:1}),Vr.copy(z.data,A,{x:0,y:0},{x:V,y:H+ae},{width:X,height:1}),Vr.copy(z.data,A,{x:X-1,y:0},{x:V-1,y:H},{width:1,height:ae}),Vr.copy(z.data,A,{x:0,y:0},{x:V+X,y:H},{width:1,height:ae})}this.image=A,this.iconPositions=f,this.patternPositions=g}addImages(r,u,f){for(const g in r){const v=r[g],b={x:0,y:0,w:v.data.width+2,h:v.data.height+2};f.push(b),u[g]=new h_(b,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(r,u){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in r.updatedImages)this.patchUpdatedImage(this.iconPositions[f],r.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],r.getImage(f),u)}patchUpdatedImage(r,u,f){if(!r||!u||r.version===u.version)return;r.version=u.version;const[g,v]=r.tl;f.update(u.data,void 0,{x:g,y:v})}}ot("ImagePosition",h_),ot("ImageAtlas",z1),l.WritingMode=void 0,(xa=l.WritingMode||(l.WritingMode={}))[xa.none=0]="none",xa[xa.horizontal=1]="horizontal",xa[xa.vertical=2]="vertical",xa[xa.horizontalOnly=3]="horizontalOnly";const jf=-17;class yh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,u){const f=new yh;return f.scale=r||1,f.fontStack=u,f}static forImage(r){const u=new yh;return u.imageName=r,u}}class Sc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,u){const f=new Sc;for(let g=0;g<r.sections.length;g++){const v=r.sections[g];v.image?f.addImageSection(v):f.addTextSection(v,u)}return f}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let u="";for(let f=0;f<r.length;f++){const g=r.charCodeAt(f+1)||null,v=r.charCodeAt(f-1)||null;u+=g&&wf(g)&&!_h[r[f+1]]||v&&wf(v)&&!_h[r[f-1]]||!_h[r[f]]?r[f]:_h[r[f]]}return u}(this.text)}trim(){let r=0;for(let f=0;f<this.text.length&&Wf[this.text.charCodeAt(f)];f++)r++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=r&&Wf[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(r,u),this.sectionIndex=this.sectionIndex.slice(r,u)}substring(r,u){const f=new Sc;return f.text=this.text.substring(r,u),f.sectionIndex=this.sectionIndex.slice(r,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,u)=>Math.max(r,this.sections[u].scale),0)}addTextSection(r,u){this.text+=r.text,this.sections.push(yh.forText(r.scale,r.fontStack||u));const f=this.sections.length-1;for(let g=0;g<r.text.length;++g)this.sectionIndex.push(f)}addImageSection(r){const u=r.image?r.image.name:"";if(u.length===0)return void pe("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(yh.forImage(u)),this.sectionIndex.push(this.sections.length-1)):pe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Gf(a,r,u,f,g,v,b,T,A,M,z,O,V,H,X,ae){const oe=Sc.fromFeature(a,g);let ve;O===l.WritingMode.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:Se,processStyledBidirectionalText:ye}=Er;if(Se&&oe.sections.length===1){ve=[];const ze=Se(oe.toString(),d_(oe,M,v,r,f,H,X));for(const rt of ze){const ct=new Sc;ct.text=rt,ct.sections=oe.sections;for(let Qe=0;Qe<rt.length;Qe++)ct.sectionIndex.push(0);ve.push(ct)}}else if(ye){ve=[];const ze=ye(oe.text,oe.sectionIndex,d_(oe,M,v,r,f,H,X));for(const rt of ze){const ct=new Sc;ct.text=rt[0],ct.sectionIndex=rt[1],ct.sections=oe.sections,ve.push(ct)}}else ve=function(ze,rt){const ct=[],Qe=ze.text;let Xe=0;for(const $e of rt)ct.push(ze.substring(Xe,$e)),Xe=$e;return Xe<Qe.length&&ct.push(ze.substring(Xe,Qe.length)),ct}(oe,d_(oe,M,v,r,f,H,X));const Ee=[],De={positionedLines:Ee,text:oe.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(ze,rt,ct,Qe,Xe,$e,et,Ye,Ve,yt,ft,Ot){let _n=0,wn=jf,ni=0,Gr=0;const Si=Ye==="right"?1:Ye==="left"?0:.5;let qn=0;for(const Zn of Xe){Zn.trim();const Pi=Zn.getMaxScale(),Fi=(Pi-1)*gi,Yi={positionedGlyphs:[],lineOffset:0};ze.positionedLines[qn]=Yi;const hr=Yi.positionedGlyphs;let dr=0;if(!Zn.length()){wn+=$e,++qn;continue}for(let hi=0;hi<Zn.length();hi++){const jt=Zn.getSection(hi),Ar=Zn.getSectionIndex(hi),Ci=Zn.getCharCode(hi);let Bi=0,ps=null,ks=null,Rs=null,zo=gi;const ms=!(Ve===l.WritingMode.horizontal||!ft&&!Ku(Ci)||ft&&(Wf[Ci]||(ui=Ci,Je.Arabic(ui)||Je["Arabic Supplement"](ui)||Je["Arabic Extended-A"](ui)||Je["Arabic Presentation Forms-A"](ui)||Je["Arabic Presentation Forms-B"](ui))));if(jt.imageName){const Wr=Qe[jt.imageName];if(!Wr)continue;Rs=jt.imageName,ze.iconsInText=ze.iconsInText||!0,ks=Wr.paddedRect;const fr=Wr.displaySize;jt.scale=jt.scale*gi/Ot,ps={width:fr[0],height:fr[1],left:1,top:-3,advance:ms?fr[1]:fr[0]},Bi=Fi+(gi-fr[1]*jt.scale),zo=ps.advance;const Do=ms?fr[0]*jt.scale-gi*Pi:fr[1]*jt.scale-gi*Pi;Do>0&&Do>dr&&(dr=Do)}else{const Wr=ct[jt.fontStack],fr=Wr&&Wr[Ci];if(fr&&fr.rect)ks=fr.rect,ps=fr.metrics;else{const Do=rt[jt.fontStack],bh=Do&&Do[Ci];if(!bh)continue;ps=bh.metrics}Bi=(Pi-jt.scale)*gi}ms?(ze.verticalizable=!0,hr.push({glyph:Ci,imageName:Rs,x:_n,y:wn+Bi,vertical:ms,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Ar,metrics:ps,rect:ks}),_n+=zo*jt.scale+yt):(hr.push({glyph:Ci,imageName:Rs,x:_n,y:wn+Bi,vertical:ms,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Ar,metrics:ps,rect:ks}),_n+=ps.advance*jt.scale+yt)}hr.length!==0&&(ni=Math.max(_n-yt,ni),tL(hr,0,hr.length-1,Si,dr)),_n=0;const Tn=$e*Pi+dr;Yi.lineOffset=Math.max(dr,Fi),wn+=Tn,Gr=Math.max(Tn,Gr),++qn}var ui;const Ai=wn-jf,{horizontalAlign:Oi,verticalAlign:ur}=f_(et);(function(Zn,Pi,Fi,Yi,hr,dr,Tn,hi,jt){const Ar=(Pi-Fi)*hr;let Ci=0;Ci=dr!==Tn?-hi*Yi-jf:(-Yi*jt+.5)*Tn;for(const Bi of Zn)for(const ps of Bi.positionedGlyphs)ps.x+=Ar,ps.y+=Ci})(ze.positionedLines,Si,Oi,ur,ni,Gr,$e,Ai,Xe.length),ze.top+=-ur*Ai,ze.bottom=ze.top+Ai,ze.left+=-Oi*ni,ze.right=ze.left+ni}(De,r,u,f,ve,b,T,A,O,M,V,ae),!function(ze){for(const rt of ze)if(rt.positionedGlyphs.length!==0)return!1;return!0}(Ee)&&De}const Wf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},QI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function D1(a,r,u,f,g,v){if(r.imageName){const b=f[r.imageName];return b?b.displaySize[0]*r.scale*gi/v+g:0}{const b=u[r.fontStack],T=b&&b[a];return T?T.metrics.advance*r.scale+g:0}}function O1(a,r,u,f){const g=Math.pow(a-r,2);return f?a<r?g/2:2*g:g+Math.abs(u)*u}function eL(a,r,u){let f=0;return a===10&&(f-=1e4),u&&(f+=150),a!==40&&a!==65288||(f+=50),r!==41&&r!==65289||(f+=50),f}function F1(a,r,u,f,g,v){let b=null,T=O1(r,u,g,v);for(const A of f){const M=O1(r-A.x,u,g,v)+A.badness;M<=T&&(b=A,T=M)}return{index:a,x:r,priorBreak:b,badness:T}}function B1(a){return a?B1(a.priorBreak).concat(a.index):[]}function d_(a,r,u,f,g,v,b){if(v!=="point")return[];if(!a)return[];const T=[],A=function(V,H,X,ae,oe,ve){let Se=0;for(let ye=0;ye<V.length();ye++){const Ee=V.getSection(ye);Se+=D1(V.getCharCode(ye),Ee,ae,oe,H,ve)}return Se/Math.max(1,Math.ceil(Se/X))}(a,r,u,f,g,b),M=a.text.indexOf("​")>=0;let z=0;for(let V=0;V<a.length();V++){const H=a.getSection(V),X=a.getCharCode(V);if(Wf[X]||(z+=D1(X,H,f,g,r,b)),V<a.length()-1){const ae=!((O=X)<11904||!(Je["Bopomofo Extended"](O)||Je.Bopomofo(O)||Je["CJK Compatibility Forms"](O)||Je["CJK Compatibility Ideographs"](O)||Je["CJK Compatibility"](O)||Je["CJK Radicals Supplement"](O)||Je["CJK Strokes"](O)||Je["CJK Symbols and Punctuation"](O)||Je["CJK Unified Ideographs Extension A"](O)||Je["CJK Unified Ideographs"](O)||Je["Enclosed CJK Letters and Months"](O)||Je["Halfwidth and Fullwidth Forms"](O)||Je.Hiragana(O)||Je["Ideographic Description Characters"](O)||Je["Kangxi Radicals"](O)||Je["Katakana Phonetic Extensions"](O)||Je.Katakana(O)||Je["Vertical Forms"](O)||Je["Yi Radicals"](O)||Je["Yi Syllables"](O)));(QI[X]||ae||H.imageName)&&T.push(F1(V+1,z,A,T,eL(X,a.getCharCode(V+1),ae&&M),!1))}}var O;return B1(F1(a.length(),z,A,T,0,!0))}function f_(a){let r=.5,u=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:r,verticalAlign:u}}function tL(a,r,u,f,g){if(!f&&!g)return;const v=a[u],b=(a[u].x+v.metrics.advance*v.scale)*f;for(let T=r;T<=u;T++)a[T].x-=b,a[T].y+=g}function nL(a,r,u){const{horizontalAlign:f,verticalAlign:g}=f_(u),v=r[0]-a.displaySize[0]*f,b=r[1]-a.displaySize[1]*g;return{image:a,top:b,bottom:b+a.displaySize[1],left:v,right:v+a.displaySize[0]}}function N1(a,r,u,f,g,v){const b=a.image;let T;if(b.content){const oe=b.content,ve=b.pixelRatio||1;T=[oe[0]/ve,oe[1]/ve,b.displaySize[0]-oe[2]/ve,b.displaySize[1]-oe[3]/ve]}const A=r.left*v,M=r.right*v;let z,O,V,H;u==="width"||u==="both"?(H=g[0]+A-f[3],O=g[0]+M+f[1]):(H=g[0]+(A+M-b.displaySize[0])/2,O=H+b.displaySize[0]);const X=r.top*v,ae=r.bottom*v;return u==="height"||u==="both"?(z=g[1]+X-f[0],V=g[1]+ae+f[2]):(z=g[1]+(X+ae-b.displaySize[1])/2,V=z+b.displaySize[1]),{image:b,top:z,right:O,bottom:V,left:H,collisionPadding:T}}const Ro=128;function U1(a,r){const{expression:u}=r;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new xn(a+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=u;let v=0;for(;v<f.length&&f[v]<=a;)v++;v=Math.max(0,v-1);let b=v;for(;b<f.length&&f[b]<a+1;)b++;b=Math.min(f.length-1,b);const T=f[v],A=f[b];return u.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:A,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:A,minSize:u.evaluate(new xn(T)),maxSize:u.evaluate(new xn(A)),interpolationType:g}}}class ba extends xt{constructor(r,u,f,g){super(r,u),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new ba(this.x,this.y,this.angle,this.segment)}}function V1(a,r,u,f,g){if(r.segment===void 0)return!0;let v=r,b=r.segment+1,T=0;for(;T>-u/2;){if(b--,b<0)return!1;T-=a[b].dist(v),v=a[b]}T+=a[b].dist(a[b+1]),b++;const A=[];let M=0;for(;T<u/2;){const z=a[b],O=a[b+1];if(!O)return!1;let V=a[b-1].angleTo(z)-z.angleTo(O);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:T,angleDelta:V}),M+=V;T-A[0].distance>f;)M-=A.shift().angleDelta;if(M>g)return!1;b++,T+=z.dist(O)}return!0}function j1(a){let r=0;for(let u=0;u<a.length-1;u++)r+=a[u].dist(a[u+1]);return r}function G1(a,r,u){return a?.6*r*u:0}function W1(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function iL(a,r,u,f,g,v){const b=G1(u,g,v),T=W1(u,f)*v;let A=0;const M=j1(a)/2;for(let z=0;z<a.length-1;z++){const O=a[z],V=a[z+1],H=O.dist(V);if(A+H>M){const X=(M-A)/H,ae=zt(O.x,V.x,X),oe=zt(O.y,V.y,X),ve=new ba(ae,oe,V.angleTo(O),z);return ve._round(),!b||V1(a,ve,T,b,r)?ve:void 0}A+=H}}function rL(a,r,u,f,g,v,b,T,A){const M=G1(f,v,b),z=W1(f,g),O=z*b,V=a[0].x===0||a[0].x===A||a[0].y===0||a[0].y===A;return r-O<r/4&&(r=O+r/4),$1(a,V?r/2*T%r:(z/2+2*v)*b*T%r,r,M,u,O,V,!1,A)}function $1(a,r,u,f,g,v,b,T,A){const M=v/2,z=j1(a);let O=0,V=r-u,H=[];for(let X=0;X<a.length-1;X++){const ae=a[X],oe=a[X+1],ve=ae.dist(oe),Se=oe.angleTo(ae);for(;V+u<O+ve;){V+=u;const ye=(V-O)/ve,Ee=zt(ae.x,oe.x,ye),De=zt(ae.y,oe.y,ye);if(Ee>=0&&Ee<A&&De>=0&&De<A&&V-M>=0&&V+M<=z){const ze=new ba(Ee,De,Se,X);ze._round(),f&&!V1(a,ze,v,f,g)||H.push(ze)}}O+=ve}return T||H.length||b||(H=$1(a,O/2,u,f,g,v,b,!0,A)),H}function H1(a,r,u,f,g){const v=[];for(let b=0;b<a.length;b++){const T=a[b];let A;for(let M=0;M<T.length-1;M++){let z=T[M],O=T[M+1];z.x<r&&O.x<r||(z.x<r?z=new xt(r,z.y+(r-z.x)/(O.x-z.x)*(O.y-z.y))._round():O.x<r&&(O=new xt(r,z.y+(r-z.x)/(O.x-z.x)*(O.y-z.y))._round()),z.y<u&&O.y<u||(z.y<u?z=new xt(z.x+(u-z.y)/(O.y-z.y)*(O.x-z.x),u)._round():O.y<u&&(O=new xt(z.x+(u-z.y)/(O.y-z.y)*(O.x-z.x),u)._round()),z.x>=f&&O.x>=f||(z.x>=f?z=new xt(f,z.y+(f-z.x)/(O.x-z.x)*(O.y-z.y))._round():O.x>=f&&(O=new xt(f,z.y+(f-z.x)/(O.x-z.x)*(O.y-z.y))._round()),z.y>=g&&O.y>=g||(z.y>=g?z=new xt(z.x+(g-z.y)/(O.y-z.y)*(O.x-z.x),g)._round():O.y>=g&&(O=new xt(z.x+(g-z.y)/(O.y-z.y)*(O.x-z.x),g)._round()),A&&z.equals(A[A.length-1])||(A=[z],v.push(A)),A.push(O)))))}}return v}function q1(a,r,u,f){const g=[],v=a.image,b=v.pixelRatio,T=v.paddedRect.w-2,A=v.paddedRect.h-2,M=a.right-a.left,z=a.bottom-a.top,O=v.stretchX||[[0,T]],V=v.stretchY||[[0,A]],H=($e,et)=>$e+et[1]-et[0],X=O.reduce(H,0),ae=V.reduce(H,0),oe=T-X,ve=A-ae;let Se=0,ye=X,Ee=0,De=ae,ze=0,rt=oe,ct=0,Qe=ve;if(v.content&&f){const $e=v.content;Se=$f(O,0,$e[0]),Ee=$f(V,0,$e[1]),ye=$f(O,$e[0],$e[2]),De=$f(V,$e[1],$e[3]),ze=$e[0]-Se,ct=$e[1]-Ee,rt=$e[2]-$e[0]-ye,Qe=$e[3]-$e[1]-De}const Xe=($e,et,Ye,Ve)=>{const yt=Hf($e.stretch-Se,ye,M,a.left),ft=qf($e.fixed-ze,rt,$e.stretch,X),Ot=Hf(et.stretch-Ee,De,z,a.top),_n=qf(et.fixed-ct,Qe,et.stretch,ae),wn=Hf(Ye.stretch-Se,ye,M,a.left),ni=qf(Ye.fixed-ze,rt,Ye.stretch,X),Gr=Hf(Ve.stretch-Ee,De,z,a.top),Si=qf(Ve.fixed-ct,Qe,Ve.stretch,ae),qn=new xt(yt,Ot),ui=new xt(wn,Ot),Ai=new xt(wn,Gr),Oi=new xt(yt,Gr),ur=new xt(ft/b,_n/b),Zn=new xt(ni/b,Si/b),Pi=r*Math.PI/180;if(Pi){const hr=Math.sin(Pi),dr=Math.cos(Pi),Tn=[dr,-hr,hr,dr];qn._matMult(Tn),ui._matMult(Tn),Oi._matMult(Tn),Ai._matMult(Tn)}const Fi=$e.stretch+$e.fixed,Yi=et.stretch+et.fixed;return{tl:qn,tr:ui,bl:Oi,br:Ai,tex:{x:v.paddedRect.x+1+Fi,y:v.paddedRect.y+1+Yi,w:Ye.stretch+Ye.fixed-Fi,h:Ve.stretch+Ve.fixed-Yi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ur,pixelOffsetBR:Zn,minFontScaleX:rt/b/M,minFontScaleY:Qe/b/z,isSDF:u}};if(f&&(v.stretchX||v.stretchY)){const $e=Z1(O,oe,X),et=Z1(V,ve,ae);for(let Ye=0;Ye<$e.length-1;Ye++){const Ve=$e[Ye],yt=$e[Ye+1];for(let ft=0;ft<et.length-1;ft++)g.push(Xe(Ve,et[ft],yt,et[ft+1]))}}else g.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return g}function $f(a,r,u){let f=0;for(const g of a)f+=Math.max(r,Math.min(u,g[1]))-Math.max(r,Math.min(u,g[0]));return f}function Z1(a,r,u){const f=[{fixed:-1,stretch:0}];for(const[g,v]of a){const b=f[f.length-1];f.push({fixed:g-b.stretch,stretch:b.stretch}),f.push({fixed:g-b.stretch,stretch:b.stretch+(v-g)})}return f.push({fixed:r+1,stretch:u}),f}function Hf(a,r,u,f){return a/r*u+f}function qf(a,r,u,f){return a-r*u/f}ot("Anchor",ba);class Zf{constructor(r,u,f,g,v,b,T,A,M,z){if(this.boxStartIndex=r.length,M){let O=b.top,V=b.bottom;const H=b.collisionPadding;H&&(O-=H[1],V+=H[3]);let X=V-O;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{let O=b.top*T-A[0],V=b.bottom*T+A[2],H=b.left*T-A[3],X=b.right*T+A[1];const ae=b.collisionPadding;if(ae&&(H-=ae[0]*T,O-=ae[1]*T,X+=ae[2]*T,V+=ae[3]*T),z){const oe=new xt(H,O),ve=new xt(X,O),Se=new xt(H,V),ye=new xt(X,V),Ee=z*Math.PI/180;oe._rotate(Ee),ve._rotate(Ee),Se._rotate(Ee),ye._rotate(Ee),H=Math.min(oe.x,ve.x,Se.x,ye.x),X=Math.max(oe.x,ve.x,Se.x,ye.x),O=Math.min(oe.y,ve.y,Se.y,ye.y),V=Math.max(oe.y,ve.y,Se.y,ye.y)}r.emplaceBack(u.x,u.y,H,O,X,V,f,g,v)}this.boxEndIndex=r.length}}class sL{constructor(r=[],u=oL){if(this.data=r,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:u,compare:f}=this,g=u[r];for(;r>0;){const v=r-1>>1,b=u[v];if(f(g,b)>=0)break;u[r]=b,r=v}u[r]=g}_down(r){const{data:u,compare:f}=this,g=this.length>>1,v=u[r];for(;r<g;){let b=1+(r<<1),T=u[b];const A=b+1;if(A<this.length&&f(u[A],T)<0&&(b=A,T=u[A]),f(T,v)>=0)break;u[r]=T,r=b}u[r]=v}}function oL(a,r){return a<r?-1:a>r?1:0}function aL(a,r=1,u=!1){let f=1/0,g=1/0,v=-1/0,b=-1/0;const T=a[0];for(let H=0;H<T.length;H++){const X=T[H];(!H||X.x<f)&&(f=X.x),(!H||X.y<g)&&(g=X.y),(!H||X.x>v)&&(v=X.x),(!H||X.y>b)&&(b=X.y)}const A=Math.min(v-f,b-g);let M=A/2;const z=new sL([],lL);if(A===0)return new xt(f,g);for(let H=f;H<v;H+=A)for(let X=g;X<b;X+=A)z.push(new Ac(H+M,X+M,M,a));let O=function(H){let X=0,ae=0,oe=0;const ve=H[0];for(let Se=0,ye=ve.length,Ee=ye-1;Se<ye;Ee=Se++){const De=ve[Se],ze=ve[Ee],rt=De.x*ze.y-ze.x*De.y;ae+=(De.x+ze.x)*rt,oe+=(De.y+ze.y)*rt,X+=3*rt}return new Ac(ae/X,oe/X,0,H)}(a),V=z.length;for(;z.length;){const H=z.pop();(H.d>O.d||!O.d)&&(O=H,u&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,V)),H.max-O.d<=r||(M=H.h/2,z.push(new Ac(H.p.x-M,H.p.y-M,M,a)),z.push(new Ac(H.p.x+M,H.p.y-M,M,a)),z.push(new Ac(H.p.x-M,H.p.y+M,M,a)),z.push(new Ac(H.p.x+M,H.p.y+M,M,a)),V+=4)}return u&&(console.log(`num probes: ${V}`),console.log(`best distance: ${O.d}`)),O.p}function lL(a,r){return r.max-a.max}function Ac(a,r,u,f){this.p=new xt(a,r),this.h=u,this.d=function(g,v){let b=!1,T=1/0;for(let A=0;A<v.length;A++){const M=v[A];for(let z=0,O=M.length,V=O-1;z<O;V=z++){const H=M[z],X=M[V];H.y>g.y!=X.y>g.y&&g.x<(X.x-H.x)*(g.y-H.y)/(X.y-H.y)+H.x&&(b=!b),T=Math.min(T,n1(g,H,X))}}return(b?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}const p_=Number.POSITIVE_INFINITY;function X1(a,r){return r[1]!==p_?function(u,f,g){let v=0,b=0;switch(f=Math.abs(f),g=Math.abs(g),u){case"top-right":case"top-left":case"top":b=g-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-g}switch(u){case"top-right":case"bottom-right":case"right":v=-f;break;case"top-left":case"bottom-left":case"left":v=f}return[v,b]}(a,r[0],r[1]):function(u,f){let g=0,v=0;f<0&&(f=0);const b=f/Math.sqrt(2);switch(u){case"top-right":case"top-left":v=b-7;break;case"bottom-right":case"bottom-left":v=7-b;break;case"bottom":v=7-f;break;case"top":v=f-7}switch(u){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=f;break;case"right":g=-f}return[g,v]}(a,r[0])}function m_(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cL(a,r,u,f,g,v,b,T,A,M,z){let O=v.textMaxSize.evaluate(r,{});O===void 0&&(O=b);const V=a.layers[0].layout,H=V.get("icon-offset").evaluate(r,{},z),X=K1(u.horizontal),ae=b/24,oe=a.tilePixelRatio*ae,ve=a.tilePixelRatio*O/24,Se=a.tilePixelRatio*T,ye=a.tilePixelRatio*V.get("symbol-spacing"),Ee=V.get("text-padding")*a.tilePixelRatio,De=function(Ve,yt,ft,Ot=1){const _n=Ve.get("icon-padding").evaluate(yt,{},ft),wn=_n&&_n.values;return[wn[0]*Ot,wn[1]*Ot,wn[2]*Ot,wn[3]*Ot]}(V,r,z,a.tilePixelRatio),ze=V.get("text-max-angle")/180*Math.PI,rt=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",ct=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Qe=V.get("symbol-placement"),Xe=ye/2,$e=V.get("icon-text-fit");let et;f&&$e!=="none"&&(a.allowVerticalPlacement&&u.vertical&&(et=N1(f,u.vertical,$e,V.get("icon-text-fit-padding"),H,ae)),X&&(f=N1(f,X,$e,V.get("icon-text-fit-padding"),H,ae)));const Ye=(Ve,yt)=>{yt.x<0||yt.x>=ti||yt.y<0||yt.y>=ti||function(ft,Ot,_n,wn,ni,Gr,Si,qn,ui,Ai,Oi,ur,Zn,Pi,Fi,Yi,hr,dr,Tn,hi,jt,Ar,Ci,Bi,ps){const ks=ft.addToLineVertexArray(Ot,_n);let Rs,zo,ms,Wr,fr=0,Do=0,bh=0,fb=0,S_=-1,A_=-1;const Oo={};let pb=ci.exports(""),P_=0,C_=0;if(qn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[P_,C_]=qn.layout.get("text-offset").evaluate(jt,{},Bi).map(pr=>pr*gi):(P_=qn.layout.get("text-radial-offset").evaluate(jt,{},Bi)*gi,C_=p_),ft.allowVerticalPlacement&&wn.vertical){const pr=qn.layout.get("text-rotate").evaluate(jt,{},Bi)+90;ms=new Zf(ui,Ot,Ai,Oi,ur,wn.vertical,Zn,Pi,Fi,pr),Si&&(Wr=new Zf(ui,Ot,Ai,Oi,ur,Si,hr,dr,Fi,pr))}if(ni){const pr=qn.layout.get("icon-rotate").evaluate(jt,{}),so=qn.layout.get("icon-text-fit")!=="none",wh=q1(ni,pr,Ci,so),Eh=Si?q1(Si,pr,Ci,so):void 0;zo=new Zf(ui,Ot,Ai,Oi,ur,ni,hr,dr,!1,pr),fr=4*wh.length;const _b=ft.iconSizeData;let Sl=null;_b.kind==="source"?(Sl=[Ro*qn.layout.get("icon-size").evaluate(jt,{})],Sl[0]>wa&&pe(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):_b.kind==="composite"&&(Sl=[Ro*Ar.compositeIconSizes[0].evaluate(jt,{},Bi),Ro*Ar.compositeIconSizes[1].evaluate(jt,{},Bi)],(Sl[0]>wa||Sl[1]>wa)&&pe(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,wh,Sl,hi,Tn,jt,l.WritingMode.none,Ot,ks.lineStartIndex,ks.lineLength,-1,Bi),S_=ft.icon.placedSymbolArray.length-1,Eh&&(Do=4*Eh.length,ft.addSymbols(ft.icon,Eh,Sl,hi,Tn,jt,l.WritingMode.vertical,Ot,ks.lineStartIndex,ks.lineLength,-1,Bi),A_=ft.icon.placedSymbolArray.length-1)}const mb=Object.keys(wn.horizontal);for(const pr of mb){const so=wn.horizontal[pr];if(!Rs){pb=ci.exports(so.text);const Eh=qn.layout.get("text-rotate").evaluate(jt,{},Bi);Rs=new Zf(ui,Ot,Ai,Oi,ur,so,Zn,Pi,Fi,Eh)}const wh=so.positionedLines.length===1;if(bh+=Y1(ft,Ot,so,Gr,qn,Fi,jt,Yi,ks,wn.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,wh?mb:[pr],Oo,S_,Ar,Bi),wh)break}wn.vertical&&(fb+=Y1(ft,Ot,wn.vertical,Gr,qn,Fi,jt,Yi,ks,l.WritingMode.vertical,["vertical"],Oo,A_,Ar,Bi));const wL=Rs?Rs.boxStartIndex:ft.collisionBoxArray.length,EL=Rs?Rs.boxEndIndex:ft.collisionBoxArray.length,TL=ms?ms.boxStartIndex:ft.collisionBoxArray.length,SL=ms?ms.boxEndIndex:ft.collisionBoxArray.length,AL=zo?zo.boxStartIndex:ft.collisionBoxArray.length,PL=zo?zo.boxEndIndex:ft.collisionBoxArray.length,CL=Wr?Wr.boxStartIndex:ft.collisionBoxArray.length,IL=Wr?Wr.boxEndIndex:ft.collisionBoxArray.length;let zs=-1;const Qf=(pr,so)=>pr&&pr.circleDiameter?Math.max(pr.circleDiameter,so):so;zs=Qf(Rs,zs),zs=Qf(ms,zs),zs=Qf(zo,zs),zs=Qf(Wr,zs);const gb=zs>-1?1:0;gb&&(zs*=ps/gi),ft.glyphOffsetArray.length>=Pc.MAX_GLYPHS&&pe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jt.sortKey!==void 0&&ft.addToSortKeyRanges(ft.symbolInstances.length,jt.sortKey),ft.symbolInstances.emplaceBack(Ot.x,Ot.y,Oo.right>=0?Oo.right:-1,Oo.center>=0?Oo.center:-1,Oo.left>=0?Oo.left:-1,Oo.vertical||-1,S_,A_,pb,wL,EL,TL,SL,AL,PL,CL,IL,Ai,bh,fb,fr,Do,gb,0,Zn,P_,C_,zs)}(a,yt,Ve,u,f,g,et,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,oe,[Ee,Ee,Ee,Ee],rt,A,Se,De,ct,H,r,v,M,z,b)};if(Qe==="line")for(const Ve of H1(r.geometry,0,0,ti,ti)){const yt=rL(Ve,ye,ze,u.vertical||X,f,24,ve,a.overscaling,ti);for(const ft of yt){const Ot=X;Ot&&uL(a,Ot.text,Xe,ft)||Ye(Ve,ft)}}else if(Qe==="line-center"){for(const Ve of r.geometry)if(Ve.length>1){const yt=iL(Ve,ze,u.vertical||X,f,24,ve);yt&&Ye(Ve,yt)}}else if(r.type==="Polygon")for(const Ve of n_(r.geometry,0)){const yt=aL(Ve,16);Ye(Ve[0],new ba(yt.x,yt.y,0))}else if(r.type==="LineString")for(const Ve of r.geometry)Ye(Ve,new ba(Ve[0].x,Ve[0].y,0));else if(r.type==="Point")for(const Ve of r.geometry)for(const yt of Ve)Ye([yt],new ba(yt.x,yt.y,0))}const wa=32640;function Y1(a,r,u,f,g,v,b,T,A,M,z,O,V,H,X){const ae=function(Se,ye,Ee,De,ze,rt,ct,Qe){const Xe=De.layout.get("text-rotate").evaluate(rt,{})*Math.PI/180,$e=[];for(const et of ye.positionedLines)for(const Ye of et.positionedGlyphs){if(!Ye.rect)continue;const Ve=Ye.rect||{};let yt=4,ft=!0,Ot=1,_n=0;const wn=(ze||Qe)&&Ye.vertical,ni=Ye.metrics.advance*Ye.scale/2;if(Qe&&ye.verticalizable){const Tn=(Ye.scale-1)*gi,hi=(gi-Ye.metrics.width*Ye.scale)/2;_n=et.lineOffset/2-(Ye.imageName?-hi:Tn)}if(Ye.imageName){const Tn=ct[Ye.imageName];ft=Tn.sdf,Ot=Tn.pixelRatio,yt=1/Ot}const Gr=ze?[Ye.x+ni,Ye.y]:[0,0];let Si=ze?[0,0]:[Ye.x+ni+Ee[0],Ye.y+Ee[1]-_n],qn=[0,0];wn&&(qn=Si,Si=[0,0]);const ui=(Ye.metrics.left-yt)*Ye.scale-ni+Si[0],Ai=(-Ye.metrics.top-yt)*Ye.scale+Si[1],Oi=ui+Ve.w*Ye.scale/Ot,ur=Ai+Ve.h*Ye.scale/Ot,Zn=new xt(ui,Ai),Pi=new xt(Oi,Ai),Fi=new xt(ui,ur),Yi=new xt(Oi,ur);if(wn){const Tn=new xt(-ni,ni-jf),hi=-Math.PI/2,jt=12-ni,Ar=new xt(22-jt,-(Ye.imageName?jt:0)),Ci=new xt(...qn);Zn._rotateAround(hi,Tn)._add(Ar)._add(Ci),Pi._rotateAround(hi,Tn)._add(Ar)._add(Ci),Fi._rotateAround(hi,Tn)._add(Ar)._add(Ci),Yi._rotateAround(hi,Tn)._add(Ar)._add(Ci)}if(Xe){const Tn=Math.sin(Xe),hi=Math.cos(Xe),jt=[hi,-Tn,Tn,hi];Zn._matMult(jt),Pi._matMult(jt),Fi._matMult(jt),Yi._matMult(jt)}const hr=new xt(0,0),dr=new xt(0,0);$e.push({tl:Zn,tr:Pi,bl:Fi,br:Yi,tex:Ve,writingMode:ye.writingMode,glyphOffset:Gr,sectionIndex:Ye.sectionIndex,isSDF:ft,pixelOffsetTL:hr,pixelOffsetBR:dr,minFontScaleX:0,minFontScaleY:0})}return $e}(0,u,T,g,v,b,f,a.allowVerticalPlacement),oe=a.textSizeData;let ve=null;oe.kind==="source"?(ve=[Ro*g.layout.get("text-size").evaluate(b,{})],ve[0]>wa&&pe(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):oe.kind==="composite"&&(ve=[Ro*H.compositeTextSizes[0].evaluate(b,{},X),Ro*H.compositeTextSizes[1].evaluate(b,{},X)],(ve[0]>wa||ve[1]>wa)&&pe(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,ae,ve,T,v,b,M,r,A.lineStartIndex,A.lineLength,V,X);for(const Se of z)O[Se]=a.text.placedSymbolArray.length-1;return 4*ae.length}function K1(a){for(const r in a)return a[r];return null}function uL(a,r,u,f){const g=a.compareText;if(r in g){const v=g[r];for(let b=v.length-1;b>=0;b--)if(f.dist(v[b])<u)return!0}else g[r]=[];return g[r].push(f),!1}const hL=va.VectorTileFeature.types,dL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xf(a,r,u,f,g,v,b,T,A,M,z,O,V){const H=T?Math.min(wa,Math.round(T[0])):0,X=T?Math.min(wa,Math.round(T[1])):0;a.emplaceBack(r,u,Math.round(32*f),Math.round(32*g),v,b,(H<<1)+(A?1:0),X,16*M,16*z,256*O,256*V)}function g_(a,r,u){a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u)}function fL(a){for(const r of a.sections)if(Tf(r.text))return!0;return!1}class __{constructor(r){this.layoutVertexArray=new ds,this.indexArray=new qi,this.programConfigurations=r,this.segments=new Nt,this.dynamicLayoutVertexArray=new Ur,this.opacityVertexArray=new fs,this.placedSymbolArray=new Ne}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,u,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,OI.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,FI.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,dL,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ot("SymbolBuffers",__);class y_{constructor(r,u,f){this.layoutVertexArray=new r,this.layoutAttributes=u,this.indexArray=new f,this.segments=new Nt,this.collisionVertexArray=new Tr}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,BI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ot("CollisionBuffers",y_);class Pc{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(b=>b.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Yg([]),this.placementViewportMatrix=Yg([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=U1(this.zoom,u["text-size"]),this.iconSizeData=U1(this.zoom,u["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),v=f.get("symbol-z-order");this.canOverlap=x_(f,"text-overlap","text-allow-overlap")!=="never"||x_(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(b=>l.WritingMode[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=r.sourceID}createArrays(){this.text=new __(new xl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new __(new xl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new Ze,this.lineVertexArray=new it,this.symbolInstances=new tt}calculateGlyphDependencies(r,u,f,g,v){for(let b=0;b<r.length;b++)if(u[r.charCodeAt(b)]=!0,(f||g)&&v){const T=_h[r.charAt(b)];T&&(u[T.charCodeAt(0)]=!0)}}populate(r,u,f){const g=this.layers[0],v=g.layout,b=v.get("text-font"),T=v.get("text-field"),A=v.get("icon-image"),M=(T.value.kind!=="constant"||T.value.value instanceof de&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,O=v.get("symbol-sort-key");if(this.features=[],!M&&!z)return;const V=u.iconDependencies,H=u.glyphDependencies,X=u.availableImages,ae=new xn(this.zoom);for(const{feature:oe,id:ve,index:Se,sourceLayerIndex:ye}of r){const Ee=g._featureFilter.needGeometry,De=wl(oe,Ee);if(!g._featureFilter.filter(ae,De,f))continue;let ze,rt;if(Ee||(De.geometry=bl(oe)),M){const Qe=g.getValueAndResolveTokens("text-field",De,f,X),Xe=de.factory(Qe);fL(Xe)&&(this.hasRTLText=!0),(!this.hasRTLText||_l()==="unavailable"||this.hasRTLText&&Er.isParsed())&&(ze=UI(Xe,g,De))}if(z){const Qe=g.getValueAndResolveTokens("icon-image",De,f,X);rt=Qe instanceof ge?Qe:ge.fromString(Qe)}if(!ze&&!rt)continue;const ct=this.sortFeaturesByKey?O.evaluate(De,{},f):void 0;if(this.features.push({id:ve,text:ze,icon:rt,index:Se,sourceLayerIndex:ye,geometry:De.geometry,properties:oe.properties,type:hL[oe.type],sortKey:ct}),rt&&(V[rt.name]=!0),ze){const Qe=b.evaluate(De,{},f).join(","),Xe=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const $e of ze.sections)if($e.image)V[$e.image.name]=!0;else{const et=mc(ze.toString()),Ye=$e.fontStack||Qe,Ve=H[Ye]=H[Ye]||{};this.calculateGlyphDependencies($e.text,Ve,Xe,this.allowVerticalPlacement,et)}}}v.get("symbol-placement")==="line"&&(this.features=function(oe){const ve={},Se={},ye=[];let Ee=0;function De(Qe){ye.push(oe[Qe]),Ee++}function ze(Qe,Xe,$e){const et=Se[Qe];return delete Se[Qe],Se[Xe]=et,ye[et].geometry[0].pop(),ye[et].geometry[0]=ye[et].geometry[0].concat($e[0]),et}function rt(Qe,Xe,$e){const et=ve[Xe];return delete ve[Xe],ve[Qe]=et,ye[et].geometry[0].shift(),ye[et].geometry[0]=$e[0].concat(ye[et].geometry[0]),et}function ct(Qe,Xe,$e){const et=$e?Xe[0][Xe[0].length-1]:Xe[0][0];return`${Qe}:${et.x}:${et.y}`}for(let Qe=0;Qe<oe.length;Qe++){const Xe=oe[Qe],$e=Xe.geometry,et=Xe.text?Xe.text.toString():null;if(!et){De(Qe);continue}const Ye=ct(et,$e),Ve=ct(et,$e,!0);if(Ye in Se&&Ve in ve&&Se[Ye]!==ve[Ve]){const yt=rt(Ye,Ve,$e),ft=ze(Ye,Ve,ye[yt].geometry);delete ve[Ye],delete Se[Ve],Se[ct(et,ye[ft].geometry,!0)]=ft,ye[yt].geometry=null}else Ye in Se?ze(Ye,Ve,$e):Ve in ve?rt(Ye,Ve,$e):(De(Qe),ve[Ye]=Ee-1,Se[Ve]=Ee-1)}return ye.filter(Qe=>Qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((oe,ve)=>oe.sortKey-ve.sortKey)}update(r,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(r,u,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,u){const f=this.lineVertexArray.length;if(r.segment!==void 0){let g=r.dist(u[r.segment+1]),v=r.dist(u[r.segment]);const b={};for(let T=r.segment+1;T<u.length;T++)b[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:g},T<u.length-1&&(g+=u[T+1].dist(u[T]));for(let T=r.segment||0;T>=0;T--)b[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:v},T>0&&(v+=u[T-1].dist(u[T]));for(let T=0;T<u.length;T++){const A=b[T];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(r,u,f,g,v,b,T,A,M,z,O,V){const H=r.indexArray,X=r.layoutVertexArray,ae=r.segments.prepareSegment(4*u.length,X,H,this.canOverlap?b.sortKey:void 0),oe=this.glyphOffsetArray.length,ve=ae.vertexLength,Se=this.allowVerticalPlacement&&T===l.WritingMode.vertical?Math.PI/2:0,ye=b.text&&b.text.sections;for(let Ee=0;Ee<u.length;Ee++){const{tl:De,tr:ze,bl:rt,br:ct,tex:Qe,pixelOffsetTL:Xe,pixelOffsetBR:$e,minFontScaleX:et,minFontScaleY:Ye,glyphOffset:Ve,isSDF:yt,sectionIndex:ft}=u[Ee],Ot=ae.vertexLength,_n=Ve[1];Xf(X,A.x,A.y,De.x,_n+De.y,Qe.x,Qe.y,f,yt,Xe.x,Xe.y,et,Ye),Xf(X,A.x,A.y,ze.x,_n+ze.y,Qe.x+Qe.w,Qe.y,f,yt,$e.x,Xe.y,et,Ye),Xf(X,A.x,A.y,rt.x,_n+rt.y,Qe.x,Qe.y+Qe.h,f,yt,Xe.x,$e.y,et,Ye),Xf(X,A.x,A.y,ct.x,_n+ct.y,Qe.x+Qe.w,Qe.y+Qe.h,f,yt,$e.x,$e.y,et,Ye),g_(r.dynamicLayoutVertexArray,A,Se),H.emplaceBack(Ot,Ot+1,Ot+2),H.emplaceBack(Ot+1,Ot+2,Ot+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ve[0]),Ee!==u.length-1&&ft===u[Ee+1].sectionIndex||r.programConfigurations.populatePaintArrays(X.length,b,b.index,{},V,ye&&ye[ft])}r.placedSymbolArray.emplaceBack(A.x,A.y,oe,this.glyphOffsetArray.length-oe,ve,M,z,A.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,O)}_addCollisionDebugVertex(r,u,f,g,v,b){return u.emplaceBack(0,0),r.emplaceBack(f.x,f.y,g,v,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(r,u,f,g,v,b,T){const A=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),M=A.vertexLength,z=v.layoutVertexArray,O=v.collisionVertexArray,V=T.anchorX,H=T.anchorY;this._addCollisionDebugVertex(z,O,b,V,H,new xt(r,u)),this._addCollisionDebugVertex(z,O,b,V,H,new xt(f,u)),this._addCollisionDebugVertex(z,O,b,V,H,new xt(f,g)),this._addCollisionDebugVertex(z,O,b,V,H,new xt(r,g)),A.vertexLength+=4;const X=v.indexArray;X.emplaceBack(M,M+1),X.emplaceBack(M+1,M+2),X.emplaceBack(M+2,M+3),X.emplaceBack(M+3,M),A.primitiveLength+=4}addDebugCollisionBoxes(r,u,f,g){for(let v=r;v<u;v++){const b=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new y_(io,A1.members,Ls),this.iconCollisionBox=new y_(io,A1.members,Ls);for(let r=0;r<this.symbolInstances.length;r++){const u=this.symbolInstances.get(r);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(r,u,f,g,v,b,T,A,M){const z={};for(let O=u;O<f;O++){const V=r.get(O);z.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.textFeatureIndex=V.featureIndex;break}for(let O=g;O<v;O++){const V=r.get(O);z.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.verticalTextFeatureIndex=V.featureIndex;break}for(let O=b;O<T;O++){const V=r.get(O);z.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.iconFeatureIndex=V.featureIndex;break}for(let O=A;O<M;O++){const V=r.get(O);z.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.verticalIconFeatureIndex=V.featureIndex;break}return z}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,u){const f=r.placedSymbolArray.get(u),g=f.vertexStartIndex+4*f.numGlyphs;for(let v=f.vertexStartIndex;v<g;v+=4)r.indexArray.emplaceBack(v,v+1,v+2),r.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(r),f=Math.cos(r),g=[],v=[],b=[];for(let T=0;T<this.symbolInstances.length;++T){b.push(T);const A=this.symbolInstances.get(T);g.push(0|Math.round(u*A.anchorX+f*A.anchorY)),v.push(A.featureIndex)}return b.sort((T,A)=>g[T]-g[A]||v[A]-v[T]),b}addToSortKeyRanges(r,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,v,b)=>{g>=0&&b.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ot("SymbolBucket",Pc,{omit:["layers","collisionBoxArray","features","compareText"]}),Pc.MAX_GLYPHS=65535,Pc.addDynamicAttributes=g_;const pL=new mi({"symbol-placement":new ht(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new ht(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ht(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wt(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ht(Le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ht(Le.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ht(Le.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ht(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new ht(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ht(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new wt(Le.layout_symbol["icon-size"]),"icon-text-fit":new ht(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ht(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new wt(Le.layout_symbol["icon-image"]),"icon-rotate":new wt(Le.layout_symbol["icon-rotate"]),"icon-padding":new wt(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new ht(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new wt(Le.layout_symbol["icon-offset"]),"icon-anchor":new wt(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ht(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ht(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ht(Le.layout_symbol["text-rotation-alignment"]),"text-field":new wt(Le.layout_symbol["text-field"]),"text-font":new wt(Le.layout_symbol["text-font"]),"text-size":new wt(Le.layout_symbol["text-size"]),"text-max-width":new wt(Le.layout_symbol["text-max-width"]),"text-line-height":new ht(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new wt(Le.layout_symbol["text-letter-spacing"]),"text-justify":new wt(Le.layout_symbol["text-justify"]),"text-radial-offset":new wt(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ht(Le.layout_symbol["text-variable-anchor"]),"text-anchor":new wt(Le.layout_symbol["text-anchor"]),"text-max-angle":new ht(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new ht(Le.layout_symbol["text-writing-mode"]),"text-rotate":new wt(Le.layout_symbol["text-rotate"]),"text-padding":new ht(Le.layout_symbol["text-padding"]),"text-keep-upright":new ht(Le.layout_symbol["text-keep-upright"]),"text-transform":new wt(Le.layout_symbol["text-transform"]),"text-offset":new wt(Le.layout_symbol["text-offset"]),"text-allow-overlap":new ht(Le.layout_symbol["text-allow-overlap"]),"text-overlap":new ht(Le.layout_symbol["text-overlap"]),"text-ignore-placement":new ht(Le.layout_symbol["text-ignore-placement"]),"text-optional":new ht(Le.layout_symbol["text-optional"])});var v_={paint:new mi({"icon-opacity":new wt(Le.paint_symbol["icon-opacity"]),"icon-color":new wt(Le.paint_symbol["icon-color"]),"icon-halo-color":new wt(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new wt(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wt(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new ht(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new ht(Le.paint_symbol["icon-translate-anchor"]),"text-opacity":new wt(Le.paint_symbol["text-opacity"]),"text-color":new wt(Le.paint_symbol["text-color"],{runtimeType:Jn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new wt(Le.paint_symbol["text-halo-color"]),"text-halo-width":new wt(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new wt(Le.paint_symbol["text-halo-blur"]),"text-translate":new ht(Le.paint_symbol["text-translate"]),"text-translate-anchor":new ht(Le.paint_symbol["text-translate-anchor"])}),layout:pL};class J1{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:ls,this.defaultValue=r}evaluate(r){if(r.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(r.formattedSection))return u.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ot("FormatSectionOverride",J1,{omit:["defaultValue"]});class Yf extends hs{constructor(r){super(r,v_)}recalculate(r,u){if(super.recalculate(r,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const v of f)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,u,f,g){const v=this.layout.get(r).evaluate(u,{},f,g),b=this._unevaluatedLayout._values[r];return b.isDataDriven()||rl(b.value)||!v?v:function(T,A){return A.replace(/{([^{}]+)}/g,(M,z)=>z in T?String(T[z]):"")}(u.properties,v)}createBucket(r){return new Pc(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of v_.paint.overridableProperties){if(!Yf.hasPaintOverride(this.layout,r))continue;const u=this.paint.get(r),f=new J1(u),g=new cc(f,u.property.specification);let v=null;v=u.value.kind==="constant"||u.value.kind==="source"?new ol("source",g):new $u("composite",g,u.value.zoomStops),this.paint._values[r]=new us(u.property,v,u.parameters)}}_handleOverridablePaintPropertyUpdate(r,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&Yf.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,u){const f=r.get("text-field"),g=v_.paint.properties[u];let v=!1;const b=T=>{for(const A of T)if(g.overrides&&g.overrides.hasOverride(A))return void(v=!0)};if(f.value.kind==="constant"&&f.value.value instanceof de)b(f.value.value.sections);else if(f.value.kind==="source"){const T=M=>{v||(M instanceof lt&&Pe(M.value)===$n?b(M.value.sections):M instanceof ac?b(M.sections):M.eachChild(T))},A=f.value;A._styleExpression&&T(A._styleExpression.expression)}return v}}function x_(a,r,u){let f="never";const g=a.get(r);return g?f=g:a.get(u)&&(f="always"),f}var mL={paint:new mi({"background-color":new ht(Le.paint_background["background-color"]),"background-pattern":new ih(Le.paint_background["background-pattern"]),"background-opacity":new ht(Le.paint_background["background-opacity"])})},gL={paint:new mi({"raster-opacity":new ht(Le.paint_raster["raster-opacity"]),"raster-hue-rotate":new ht(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ht(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ht(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new ht(Le.paint_raster["raster-saturation"]),"raster-contrast":new ht(Le.paint_raster["raster-contrast"]),"raster-resampling":new ht(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new ht(Le.paint_raster["raster-fade-duration"])})};class _L extends hs{constructor(r){super(r,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const yL={circle:class extends hs{constructor(a){super(a,XC)}createBucket(a){return new qg(a)}queryRadius(a){const r=a;return lh("circle-radius",this,r)+lh("circle-stroke-width",this,r)+Rf(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,u,f,g,v,b,T){const A=zf(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,b),M=this.paint.get("circle-radius").evaluate(r,u)+this.paint.get("circle-stroke-width").evaluate(r,u),z=this.paint.get("circle-pitch-alignment")==="map",O=z?A:function(H,X){return H.map(ae=>c1(ae,X))}(A,T),V=z?M*b:M;for(const H of f)for(const X of H){const ae=z?X:c1(X,T);let oe=V;const ve=Df([],[X.x,X.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?oe*=ve[3]/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(oe*=v.cameraToCenterDistance/ve[3]),WC(O,ae,oe))return!0}return!1}},heatmap:class extends hs{constructor(a){super(a,KC),this._updateColorRamp()}createBucket(a){return new u1(a)}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=d1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends hs{constructor(a){super(a,JC)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends hs{constructor(a){super(a,pI)}recalculate(a,r){super.recalculate(a,r);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new s_(a)}queryRadius(){return Rf(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,u,f,g,v,b){return t1(zf(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,b),f)}isTileClipped(){return!0}},"fill-extrusion":class extends hs{constructor(a){super(a,CI)}createBucket(a){return new a_(a)}queryRadius(){return Rf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,r,u,f,g,v,b,T){const A=zf(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,b),M=this.paint.get("fill-extrusion-height").evaluate(r,u),z=this.paint.get("fill-extrusion-base").evaluate(r,u),O=function(H,X,ae,oe){const ve=[];for(const Se of H){const ye=[Se.x,Se.y,0,1];Df(ye,ye,X),ve.push(new xt(ye[0]/ye[3],ye[1]/ye[3]))}return ve}(A,T),V=function(H,X,ae,oe){const ve=[],Se=[],ye=oe[8]*X,Ee=oe[9]*X,De=oe[10]*X,ze=oe[11]*X,rt=oe[8]*ae,ct=oe[9]*ae,Qe=oe[10]*ae,Xe=oe[11]*ae;for(const $e of H){const et=[],Ye=[];for(const Ve of $e){const yt=Ve.x,ft=Ve.y,Ot=oe[0]*yt+oe[4]*ft+oe[12],_n=oe[1]*yt+oe[5]*ft+oe[13],wn=oe[2]*yt+oe[6]*ft+oe[14],ni=oe[3]*yt+oe[7]*ft+oe[15],Gr=wn+De,Si=ni+ze,qn=Ot+rt,ui=_n+ct,Ai=wn+Qe,Oi=ni+Xe,ur=new xt((Ot+ye)/Si,(_n+Ee)/Si);ur.z=Gr/Si,et.push(ur);const Zn=new xt(qn/Oi,ui/Oi);Zn.z=Ai/Oi,Ye.push(Zn)}ve.push(et),Se.push(Ye)}return[ve,Se]}(f,z,M,T);return function(H,X,ae){let oe=1/0;t1(ae,X)&&(oe=b1(ae,X[0]));for(let ve=0;ve<X.length;ve++){const Se=X[ve],ye=H[ve];for(let Ee=0;Ee<Se.length-1;Ee++){const De=Se[Ee],ze=[De,Se[Ee+1],ye[Ee+1],ye[Ee],De];e1(ae,ze)&&(oe=Math.min(oe,b1(ae,ze)))}}return oe!==1/0&&oe}(V[0],V[1],O)}},line:class extends hs{constructor(a){super(a,E1),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){a==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof En,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=T1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new l_(a)}queryRadius(a){const r=a,u=S1(lh("line-width",this,r),lh("line-gap-width",this,r)),f=lh("line-offset",this,r);return u/2+Math.abs(f)+Rf(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,u,f,g,v,b){const T=zf(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,b),A=b/2*S1(this.paint.get("line-width").evaluate(r,u),this.paint.get("line-gap-width").evaluate(r,u)),M=this.paint.get("line-offset").evaluate(r,u);return M&&(f=function(z,O){const V=[];for(let H=0;H<z.length;H++){const X=z[H],ae=[];for(let oe=0;oe<X.length;oe++){const ve=X[oe-1],Se=X[oe],ye=X[oe+1],Ee=oe===0?new xt(0,0):Se.sub(ve)._unit()._perp(),De=oe===X.length-1?new xt(0,0):ye.sub(Se)._unit()._perp(),ze=Ee._add(De)._unit(),rt=ze.x*De.x+ze.y*De.y;rt!==0&&ze._mult(1/rt),ae.push(ze._mult(O)._add(Se))}V.push(ae)}return V}(f,M*b)),function(z,O,V){for(let H=0;H<O.length;H++){const X=O[H];if(z.length>=3){for(let ae=0;ae<X.length;ae++)if(xc(z,X[ae]))return!0}if($C(z,X,V))return!0}return!1}(T,f,A)}isTileClipped(){return!0}},symbol:Yf,background:class extends hs{constructor(a){super(a,mL)}},raster:class extends hs{constructor(a){super(a,gL)}}};class vL{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Q1=63710088e-1;class Rn{constructor(r,u){if(isNaN(r)||isNaN(u))throw new Error(`Invalid LngLat object: (${r}, ${u})`);if(this.lng=+r,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Rn(B(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const u=Math.PI/180,f=this.lat*u,g=r.lat*u,v=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((r.lng-this.lng)*u);return Q1*Math.acos(Math.min(v,1))}toBounds(r=0){const u=360*r/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new Tl(new Rn(this.lng-f,this.lat-u),new Rn(this.lng+f,this.lat+u))}static convert(r){if(r instanceof Rn)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Rn(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Rn(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Tl{constructor(r,u){r&&(u?this.setSouthWest(r).setNorthEast(u):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Rn?new Rn(r.lng,r.lat):Rn.convert(r),this}setSouthWest(r){return this._sw=r instanceof Rn?new Rn(r.lng,r.lat):Rn.convert(r),this}extend(r){const u=this._sw,f=this._ne;let g,v;if(r instanceof Rn)g=r,v=r;else{if(!(r instanceof Tl))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Tl.convert(r)):this.extend(Rn.convert(r)):this;if(g=r._sw,v=r._ne,!g||!v)return this}return u||f?(u.lng=Math.min(g.lng,u.lng),u.lat=Math.min(g.lat,u.lat),f.lng=Math.max(v.lng,f.lng),f.lat=Math.max(v.lat,f.lat)):(this._sw=new Rn(g.lng,g.lat),this._ne=new Rn(v.lng,v.lat)),this}getCenter(){return new Rn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Rn(this.getWest(),this.getNorth())}getSouthEast(){return new Rn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:u,lat:f}=Rn.convert(r);let g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}static convert(r){return r instanceof Tl?r:r&&new Tl(r)}}const eb=2*Math.PI*Q1;function tb(a){return eb*Math.cos(a*Math.PI/180)}function nb(a){return(180+a)/360}function ib(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function rb(a,r){return a/tb(r)}function b_(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class Kf{constructor(r,u,f=0){this.x=+r,this.y=+u,this.z=+f}static fromLngLat(r,u=0){const f=Rn.convert(r);return new Kf(nb(f.lng),ib(f.lat),rb(u,f.lat))}toLngLat(){return new Rn(360*this.x-180,b_(this.y))}toAltitude(){return this.z*tb(b_(this.y))}meterInMercatorCoordinateUnits(){return 1/eb*(r=b_(this.y),1/Math.cos(r*Math.PI/180));var r}}function sb(a,r,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[a*f-2*Math.PI*6378137/2,r*f-2*Math.PI*6378137/2]}class w_{constructor(r,u,f){if(r<0||r>25||f<0||f>=Math.pow(2,r)||u<0||u>=Math.pow(2,r))throw new Error(`x=${u}, y=${f}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=u,this.y=f,this.key=vh(0,r,r,u,f)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,u,f){const g=(b=this.y,T=this.z,A=sb(256*(v=this.x),256*(b=Math.pow(2,T)-b-1),T),M=sb(256*(v+1),256*(b+1),T),A[0]+","+A[1]+","+M[0]+","+M[1]);var v,b,T,A,M;const z=function(O,V,H){let X,ae="";for(let oe=O;oe>0;oe--)X=1<<oe-1,ae+=(V&X?1:0)+(H&X?2:0);return ae}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,g)}isChildOf(r){const u=this.z-r.z;return u>0&&r.x===this.x>>u&&r.y===this.y>>u}getTilePoint(r){const u=Math.pow(2,this.z);return new xt((r.x*u-this.x)*ti,(r.y*u-this.y)*ti)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ob{constructor(r,u){this.wrap=r,this.canonical=u,this.key=vh(r,u.z,u.z,u.x,u.y)}}class jr{constructor(r,u,f,g,v){if(r<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${f}`);this.overscaledZ=r,this.wrap=u,this.canonical=new w_(f,+g,+v),this.key=vh(u,r,f,g,v)}clone(){return new jr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-r;return r>this.canonical.z?new jr(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new jr(r,this.wrap,r,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(r,u){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-r;return r>this.canonical.z?vh(this.wrap*+u,r,this.canonical.z,this.canonical.x,this.canonical.y):vh(this.wrap*+u,r,r,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const u=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>u&&r.canonical.y===this.canonical.y>>u}children(r){if(this.overscaledZ>=r)return[new jr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new jr(u,this.wrap,u,f,g),new jr(u,this.wrap,u,f+1,g),new jr(u,this.wrap,u,f,g+1),new jr(u,this.wrap,u,f+1,g+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new jr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new jr(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ob(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new Kf(r.x-this.wrap,r.y))}}function vh(a,r,u,f,g){(a*=2)<0&&(a=-1*a-1);const v=1<<u;return(v*v*a+v*g+f).toString(36)+u.toString(36)+r.toString(36)}ot("CanonicalTileID",w_),ot("OverscaledTileID",jr,{omit:["posMatrix"]});class ab{constructor(r,u,f){if(this.uid=r,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void pe(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const g=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=f||"mapbox";for(let v=0;v<g;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(g,v)]=this.data[this._idx(g-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,g)]=this.data[this._idx(v,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let v=0;v<g;v++)for(let b=0;b<g;b++){const T=this.get(v,b);T>this.max&&(this.max=T),T<this.min&&(this.min=T)}}get(r,u){const f=new Uint8Array(this.data.buffer),g=4*this._idx(r,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[g],f[g+1],f[g+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(r,u){if(r<-1||r>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(r+1)}_unpackMapbox(r,u,f){return(256*r*256+256*u+f)/10-1e4}_unpackTerrarium(r,u,f){return 256*r+u+f/256-32768}getPixels(){return new Vr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,u,f){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let g=u*this.dim,v=u*this.dim+this.dim,b=f*this.dim,T=f*this.dim+this.dim;switch(u){case-1:g=v-1;break;case 1:v=g+1}switch(f){case-1:b=T-1;break;case 1:T=b+1}const A=-u*this.dim,M=-f*this.dim;for(let z=b;z<T;z++)for(let O=g;O<v;O++)this.data[this._idx(O,z)]=r.data[this._idx(O+A,z+M)]}}ot("DEMData",ab);class lb{constructor(r){this._stringToNumber={},this._numberToString=[];for(let u=0;u<r.length;u++){const f=r[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class cb{constructor(r,u,f,g,v){this.type="Feature",this._vectorTileFeature=r,r._z=u,r._x=f,r._y=g,this.properties=r.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(r[u]=this[u]);return r}}class ub{constructor(r,u){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new gl(ti,16,0),this.grid3D=new gl(ti,16,0),this.featureIndexArray=new Dt,this.promoteId=u}insert(r,u,f,g,v,b){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,v);const A=b?this.grid3D:this.grid;for(let M=0;M<u.length;M++){const z=u[M],O=[1/0,1/0,-1/0,-1/0];for(let V=0;V<z.length;V++){const H=z[V];O[0]=Math.min(O[0],H.x),O[1]=Math.min(O[1],H.y),O[2]=Math.max(O[2],H.x),O[3]=Math.max(O[3],H.y)}O[0]<ti&&O[1]<ti&&O[2]>=0&&O[3]>=0&&A.insert(T,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new va.VectorTile(new c_(this.rawTileData)).layers,this.sourceLayerCoder=new lb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,u,f,g){this.loadVTLayers();const v=r.params||{},b=ti/r.tileSize/r.scale,T=dc(v.filter),A=r.queryGeometry,M=r.queryPadding*b,z=db(A),O=this.grid.query(z.minX-M,z.minY-M,z.maxX+M,z.maxY+M),V=db(r.cameraQueryGeometry),H=this.grid3D.query(V.minX-M,V.minY-M,V.maxX+M,V.maxY+M,(oe,ve,Se,ye)=>function(Ee,De,ze,rt,ct){for(const Xe of Ee)if(De<=Xe.x&&ze<=Xe.y&&rt>=Xe.x&&ct>=Xe.y)return!0;const Qe=[new xt(De,ze),new xt(De,ct),new xt(rt,ct),new xt(rt,ze)];if(Ee.length>2){for(const Xe of Qe)if(xc(Ee,Xe))return!0}for(let Xe=0;Xe<Ee.length-1;Xe++)if(qC(Ee[Xe],Ee[Xe+1],Qe))return!0;return!1}(r.cameraQueryGeometry,oe-M,ve-M,Se+M,ye+M));for(const oe of H)O.push(oe);O.sort(xL);const X={};let ae;for(let oe=0;oe<O.length;oe++){const ve=O[oe];if(ve===ae)continue;ae=ve;const Se=this.featureIndexArray.get(ve);let ye=null;this.loadMatchingFeature(X,Se.bucketIndex,Se.sourceLayerIndex,Se.featureIndex,T,v.layers,v.availableImages,u,f,g,(Ee,De,ze)=>(ye||(ye=bl(Ee)),De.queryIntersectsFeature(A,Ee,ze,ye,this.z,r.transform,b,r.pixelPosMatrix)))}return X}loadMatchingFeature(r,u,f,g,v,b,T,A,M,z,O){const V=this.bucketLayerIDs[u];if(b&&!function(oe,ve){for(let Se=0;Se<oe.length;Se++)if(ve.indexOf(oe[Se])>=0)return!0;return!1}(b,V))return;const H=this.sourceLayerCoder.decode(f),X=this.vtLayers[H].feature(g);if(v.needGeometry){const oe=wl(X,!0);if(!v.filter(new xn(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!v.filter(new xn(this.tileID.overscaledZ),X))return;const ae=this.getId(X,H);for(let oe=0;oe<V.length;oe++){const ve=V[oe];if(b&&b.indexOf(ve)<0)continue;const Se=A[ve];if(!Se)continue;let ye={};ae&&z&&(ye=z.getState(Se.sourceLayer||"_geojsonTileLayer",ae));const Ee=G({},M[ve]);Ee.paint=hb(Ee.paint,Se.paint,X,ye,T),Ee.layout=hb(Ee.layout,Se.layout,X,ye,T);const De=!O||O(X,Se,ye);if(!De)continue;const ze=new cb(X,this.z,this.x,this.y,ae);ze.layer=Ee;let rt=r[ve];rt===void 0&&(rt=r[ve]=[]),rt.push({featureIndex:g,feature:ze,intersectionZ:De})}}lookupSymbolFeatures(r,u,f,g,v,b,T,A){const M={};this.loadVTLayers();const z=dc(v);for(const O of r)this.loadMatchingFeature(M,f,g,O,z,b,T,A,u);return M}hasLayer(r){for(const u of this.bucketLayerIDs)for(const f of u)if(r===f)return!0;return!1}getId(r,u){let f=r.id;return this.promoteId&&(f=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof f=="boolean"&&(f=Number(f))),f}}function hb(a,r,u,f,g){return q(a,(v,b)=>{const T=r instanceof vl?r.get(b):null;return T&&T.evaluate?T.evaluate(u,f,g):T})}function db(a){let r=1/0,u=1/0,f=-1/0,g=-1/0;for(const v of a)r=Math.min(r,v.x),u=Math.min(u,v.y),f=Math.max(f,v.x),g=Math.max(g,v.y);return{minX:r,minY:u,maxX:f,maxY:g}}function xL(a,r){return r-a}var E_;ot("FeatureIndex",ub,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(E_=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",E_.load="load",E_.fullLoad="fullLoad";let Jf=null,xh=[];const T_=1e3/30,bL={mark(a){performance.mark(a)},frame(a){const r=a;Jf!=null&&xh.push(r-Jf),Jf=r},clearMetrics(){Jf=null,xh=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const a in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[a])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const a=performance.getEntriesByName("loadTime")[0].duration,r=performance.getEntriesByName("fullLoadTime")[0].duration,u=xh.length,f=1/(xh.reduce((v,b)=>v+b,0)/u/1e3),g=xh.filter(v=>v>T_).reduce((v,b)=>v+(b-T_)/T_,0);return{loadTime:a,fullLoadTime:r,fps:f,percentDroppedFrames:g/(u+g)*100}}};l.AJAXError=Kn,l.ARRAY_TYPE=Xi,l.Actor=class{constructor(a,r,u){this.target=a,this.parent=r,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ue(["receive","process"],this),this.invoker=new vL(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Fe()?a:window}send(a,r,u,f,g=!1){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[v]=u);const b=St(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!u,targetMapId:f,mustQueue:g,sourceMapId:this.mapId,data:Ao(r,b)},b),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(a){const r=a.data,u=r.id;if(u&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){delete this.tasks[u];const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f()}else Fe()||r.mustQueue?(this.tasks[u]=r,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,r)}process(){if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),r=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),r&&this.processTask(a,r)}processTask(a,r){if(r.type==="<response>"){const u=this.callbacks[a];delete this.callbacks[a],u&&(r.error?u(Js(r.error)):u(null,Js(r.data)))}else{let u=!1;const f=St(this.globalScope)?void 0:[],g=r.hasCallback?(T,A)=>{u=!0,delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:T?Ao(T):null,data:Ao(A,f)},f)}:T=>{u=!0};let v=null;const b=Js(r.data);if(this.parent[r.type])v=this.parent[r.type](r.sourceMapId,b,g);else if(this.parent.getWorkerSource){const T=r.type.split(".");v=this.parent.getWorkerSource(r.sourceMapId,T[0],b.source)[T[1]](b,g)}else g(new Error(`Could not find function ${r.type}`));!u&&v&&v.cancel&&(this.cancelCallbacks[a]=v.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=uh,l.CanonicalTileID=w_,l.CollisionBoxArray=Me,l.CollisionCircleLayoutArray=class extends D{},l.Color=J,l.DEMData=ab,l.DataConstantProperty=ht,l.DictionaryCoder=lb,l.EXTENT=ti,l.ErrorEvent=Hs,l.EvaluationParameters=xn,l.Event=Dr,l.Evented=xr,l.FeatureIndex=ub,l.FillBucket=s_,l.FillExtrusionBucket=a_,l.GeoJSONFeature=cb,l.ImageAtlas=z1,l.ImagePosition=h_,l.LineBucket=l_,l.LineStripIndexArray=class extends se{},l.LngLat=Rn,l.LngLatBounds=Tl,l.MercatorCoordinate=Kf,l.ONE_EM=gi,l.OverscaledTileID=jr,l.PerformanceUtils=bL,l.PosArray=_t,l.Properties=mi,l.QuadTriangleArray=class extends W{},l.RGBAImage=Vr,l.RasterBoundsArray=class extends m{},l.RequestPerformance=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},l.ResourceType=ki,l.SegmentVector=Nt,l.SymbolBucket=Pc,l.Transitionable=Pf,l.TriangleIndexArray=qi,l.Uniform1f=Lo,l.Uniform1i=class extends Io{constructor(a,r){super(a,r),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},l.Uniform2f=class extends Io{constructor(a,r){super(a,r),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},l.Uniform3f=class extends Io{constructor(a,r){super(a,r),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},l.Uniform4f=yc,l.UniformColor=Yx,l.UniformMatrix4f=class extends Io{constructor(a,r){super(a,r),this.current=jC}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let r=1;r<16;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},l.UnwrappedTileID=ob,l.ValidationError=qe,l.ZoomHistory=Xu,l.add=function(a,r,u){return a[0]=r[0]+u[0],a[1]=r[1]+u[1],a[2]=r[2]+u[2],a},l.addDynamicAttributes=g_,l.asyncAll=function(a,r,u){if(!a.length)return u(null,[]);let f=a.length;const g=new Array(a.length);let v=null;a.forEach((b,T)=>{r(b,(A,M)=>{A&&(v=A),g[T]=M,--f==0&&u(v,g)})})},l.bezier=S,l.bindAll=ue,l.cacheEntryPossiblyAdded=function(a){wi++,wi>rr&&(a.getActor().send("enforceCacheSizeLimit",rn),wi=0)},l.clamp=P,l.clearTileCache=function(a){const r=caches.delete(Et);a&&r.catch(a).then(()=>a())},l.clipLine=H1,l.clone=function(a){var r=new Xi(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},l.clone$1=Z,l.clone$2=function(a){var r=new Xi(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r},l.collisionCircleLayout=NI,l.config=nt,l.copy=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.create=function(){var a=new Xi(16);return Xi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},l.create$1=r1,l.createExpression=sl,l.createFilter=dc,l.createLayout=Hn,l.createStyleLayer=function(a){return a.type==="custom"?new _L(a):new yL[a.type](a)},l.cross=function(a,r,u){var f=r[0],g=r[1],v=r[2],b=u[0],T=u[1],A=u[2];return a[0]=g*A-v*T,a[1]=v*b-f*A,a[2]=f*T-g*b,a},l.dot=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]},l.dot$1=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]+a[3]*r[3]},l.ease=I,l.emitValidationErrors=pc,l.enforceCacheSizeLimit=function(a){ri(),Pt&&Pt.then(r=>{r.keys().then(u=>{for(let f=0;f<u.length-a;f++)r.delete(u[f])})})},l.equals=function(a,r){var u=a[0],f=a[1],g=a[2],v=a[3],b=a[4],T=a[5],A=a[6],M=a[7],z=a[8],O=a[9],V=a[10],H=a[11],X=a[12],ae=a[13],oe=a[14],ve=a[15],Se=r[0],ye=r[1],Ee=r[2],De=r[3],ze=r[4],rt=r[5],ct=r[6],Qe=r[7],Xe=r[8],$e=r[9],et=r[10],Ye=r[11],Ve=r[12],yt=r[13],ft=r[14],Ot=r[15];return Math.abs(u-Se)<=Zi*Math.max(1,Math.abs(u),Math.abs(Se))&&Math.abs(f-ye)<=Zi*Math.max(1,Math.abs(f),Math.abs(ye))&&Math.abs(g-Ee)<=Zi*Math.max(1,Math.abs(g),Math.abs(Ee))&&Math.abs(v-De)<=Zi*Math.max(1,Math.abs(v),Math.abs(De))&&Math.abs(b-ze)<=Zi*Math.max(1,Math.abs(b),Math.abs(ze))&&Math.abs(T-rt)<=Zi*Math.max(1,Math.abs(T),Math.abs(rt))&&Math.abs(A-ct)<=Zi*Math.max(1,Math.abs(A),Math.abs(ct))&&Math.abs(M-Qe)<=Zi*Math.max(1,Math.abs(M),Math.abs(Qe))&&Math.abs(z-Xe)<=Zi*Math.max(1,Math.abs(z),Math.abs(Xe))&&Math.abs(O-$e)<=Zi*Math.max(1,Math.abs(O),Math.abs($e))&&Math.abs(V-et)<=Zi*Math.max(1,Math.abs(V),Math.abs(et))&&Math.abs(H-Ye)<=Zi*Math.max(1,Math.abs(H),Math.abs(Ye))&&Math.abs(X-Ve)<=Zi*Math.max(1,Math.abs(X),Math.abs(Ve))&&Math.abs(ae-yt)<=Zi*Math.max(1,Math.abs(ae),Math.abs(yt))&&Math.abs(oe-ft)<=Zi*Math.max(1,Math.abs(oe),Math.abs(ft))&&Math.abs(ve-Ot)<=Zi*Math.max(1,Math.abs(ve),Math.abs(Ot))},l.evaluateSizeForFeature=function(a,{uSize:r,uSizeT:u},{lowerSize:f,upperSize:g}){return a.kind==="source"?f/Ro:a.kind==="composite"?zt(f/Ro,g/Ro,u):r},l.evaluateSizeForZoom=function(a,r){let u=0,f=0;if(a.kind==="constant")f=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:b}=a,T=g?P(ar.interpolationFactor(g,r,v,b),0,1):0;a.kind==="camera"?f=zt(a.minSize,a.maxSize,T):u=T}return{uSizeT:u,uSize:f}},l.evaluateVariableOffset=X1,l.evented=nh,l.exported=Wn,l.exported$1=si,l.extend=G,l.filterObject=j,l.fromRotation=function(a,r){var u=Math.sin(r),f=Math.cos(r);return a[0]=f,a[1]=u,a[2]=0,a[3]=-u,a[4]=f,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},l.fromScaling=function(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.getAnchorAlignment=f_,l.getAnchorJustification=m_,l.getArrayBuffer=Wi,l.getImage=os,l.getJSON=function(a,r){return fi(G(a,{type:"json"}),r)},l.getOverlapMode=x_,l.getRTLTextPluginStatus=_l,l.getReferrer=Rr,l.getVideo=function(a,r){const u=window.document.createElement("video");u.muted=!0,u.onloadstart=function(){r(null,u)};for(let f=0;f<a.length;f++){const g=window.document.createElement("source");$s(a[f])||(u.crossOrigin="Anonymous"),g.src=a[f],u.appendChild(g)}return{cancel:()=>{}}},l.identity=Yg,l.invert=function(a,r){var u=r[0],f=r[1],g=r[2],v=r[3],b=r[4],T=r[5],A=r[6],M=r[7],z=r[8],O=r[9],V=r[10],H=r[11],X=r[12],ae=r[13],oe=r[14],ve=r[15],Se=u*T-f*b,ye=u*A-g*b,Ee=u*M-v*b,De=f*A-g*T,ze=f*M-v*T,rt=g*M-v*A,ct=z*ae-O*X,Qe=z*oe-V*X,Xe=z*ve-H*X,$e=O*oe-V*ae,et=O*ve-H*ae,Ye=V*ve-H*oe,Ve=Se*Ye-ye*et+Ee*$e+De*Xe-ze*Qe+rt*ct;return Ve?(a[0]=(T*Ye-A*et+M*$e)*(Ve=1/Ve),a[1]=(g*et-f*Ye-v*$e)*Ve,a[2]=(ae*rt-oe*ze+ve*De)*Ve,a[3]=(V*ze-O*rt-H*De)*Ve,a[4]=(A*Xe-b*Ye-M*Qe)*Ve,a[5]=(u*Ye-g*Xe+v*Qe)*Ve,a[6]=(oe*Ee-X*rt-ve*ye)*Ve,a[7]=(z*rt-V*Ee+H*ye)*Ve,a[8]=(b*et-T*Xe+M*ct)*Ve,a[9]=(f*Xe-u*et-v*ct)*Ve,a[10]=(X*ze-ae*Ee+ve*Se)*Ve,a[11]=(O*Ee-z*ze-H*Se)*Ve,a[12]=(T*Qe-b*$e-A*ct)*Ve,a[13]=(u*$e-f*Qe+g*ct)*Ve,a[14]=(ae*ye-X*De-oe*Se)*Ve,a[15]=(z*De-O*ye+V*Se)*Ve,a):null},l.isImageBitmap=kt,l.isSafari=St,l.isWorker=Fe,l.keysDifference=function(a,r){const u=[];for(const f in a)f in r||u.push(f);return u},l.lazyLoadRTLTextPlugin=function(){Er.isLoading()||Er.isLoaded()||_l()!=="deferred"||Af()},l.makeRequest=fi,l.mapObject=q,l.mercatorXfromLng=nb,l.mercatorYfromLat=ib,l.mercatorZfromAltitude=rb,l.mul=YC,l.mul$1=function(a,r,u){return a[0]=r[0]*u[0],a[1]=r[1]*u[1],a[2]=r[2]*u[2],a[3]=r[3]*u[3],a},l.multiply=s1,l.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},l.normalize=function(a,r){var u=r[0],f=r[1],g=r[2],v=u*u+f*f+g*g;return v>0&&(v=1/Math.sqrt(v)),a[0]=r[0]*v,a[1]=r[1]*v,a[2]=r[2]*v,a},l.number=zt,l.ortho=function(a,r,u,f,g,v,b){var T=1/(r-u),A=1/(f-g),M=1/(v-b);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*A,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*M,a[11]=0,a[12]=(r+u)*T,a[13]=(g+f)*A,a[14]=(b+v)*M,a[15]=1,a},l.parseCacheControl=je,l.parseGlyphPbf=function(a){return new c_(a).readFields(YI,[])},l.pbf=c_,l.performSymbolLayout=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=ti/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const r=a.bucket.layers[0].layout,u=a.bucket.layers[0]._unevaluatedLayout._values,f={layoutIconSize:u["icon-size"].possiblyEvaluate(new xn(a.bucket.zoom+1),a.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new xn(a.bucket.zoom+1),a.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new xn(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:M}=a.bucket.textSizeData;f.compositeTextSizes=[u["text-size"].possiblyEvaluate(new xn(A),a.canonical),u["text-size"].possiblyEvaluate(new xn(M),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:M}=a.bucket.iconSizeData;f.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new xn(A),a.canonical),u["icon-size"].possiblyEvaluate(new xn(M),a.canonical)]}const g=r.get("text-line-height")*gi,v=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",b=r.get("text-keep-upright"),T=r.get("text-size");for(const A of a.bucket.features){const M=r.get("text-font").evaluate(A,{},a.canonical).join(","),z=T.evaluate(A,{},a.canonical),O=f.layoutTextSize.evaluate(A,{},a.canonical),V=f.layoutIconSize.evaluate(A,{},a.canonical),H={horizontal:{},vertical:void 0},X=A.text;let ae,oe=[0,0];if(X){const ye=X.toString(),Ee=r.get("text-letter-spacing").evaluate(A,{},a.canonical)*gi,De=jg(ye)?Ee:0,ze=r.get("text-anchor").evaluate(A,{},a.canonical),rt=r.get("text-variable-anchor");if(!rt){const et=r.get("text-radial-offset").evaluate(A,{},a.canonical);oe=et?X1(ze,[et*gi,p_]):r.get("text-offset").evaluate(A,{},a.canonical).map(Ye=>Ye*gi)}let ct=v?"center":r.get("text-justify").evaluate(A,{},a.canonical);const Qe=r.get("symbol-placement"),Xe=Qe==="point"?r.get("text-max-width").evaluate(A,{},a.canonical)*gi:0,$e=()=>{a.bucket.allowVerticalPlacement&&mc(ye)&&(H.vertical=Gf(X,a.glyphMap,a.glyphPositions,a.imagePositions,M,Xe,g,ze,"left",De,oe,l.WritingMode.vertical,!0,Qe,O,z))};if(!v&&rt){const et=ct==="auto"?rt.map(Ve=>m_(Ve)):[ct];let Ye=!1;for(let Ve=0;Ve<et.length;Ve++){const yt=et[Ve];if(!H.horizontal[yt])if(Ye)H.horizontal[yt]=H.horizontal[0];else{const ft=Gf(X,a.glyphMap,a.glyphPositions,a.imagePositions,M,Xe,g,"center",yt,De,oe,l.WritingMode.horizontal,!1,Qe,O,z);ft&&(H.horizontal[yt]=ft,Ye=ft.positionedLines.length===1)}}$e()}else{ct==="auto"&&(ct=m_(ze));const et=Gf(X,a.glyphMap,a.glyphPositions,a.imagePositions,M,Xe,g,ze,ct,De,oe,l.WritingMode.horizontal,!1,Qe,O,z);et&&(H.horizontal[ct]=et),$e(),mc(ye)&&v&&b&&(H.vertical=Gf(X,a.glyphMap,a.glyphPositions,a.imagePositions,M,Xe,g,ze,ct,De,oe,l.WritingMode.vertical,!1,Qe,O,z))}}let ve=!1;if(A.icon&&A.icon.name){const ye=a.imageMap[A.icon.name];ye&&(ae=nL(a.imagePositions[A.icon.name],r.get("icon-offset").evaluate(A,{},a.canonical),r.get("icon-anchor").evaluate(A,{},a.canonical)),ve=!!ye.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ve:a.bucket.sdfIcons!==ve&&pe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ye.pixelRatio!==a.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const Se=K1(H.horizontal)||H.vertical;a.bucket.iconsInText=!!Se&&Se.iconsInText,(Se||ae)&&cL(a.bucket,A,H,ae,a.imageMap,f,O,V,oe,ve,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},l.perspective=function(a,r,u,f,g){var v,b=1/Math.tan(r/2);return a[0]=b/u,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,g!=null&&g!==1/0?(a[10]=(g+f)*(v=1/(f-g)),a[14]=2*g*f*v):(a[10]=-1,a[14]=-2*f),a},l.pick=function(a,r){const u={};for(let f=0;f<r.length;f++){const g=r[f];g in a&&(u[g]=a[g])}return u},l.plugin=Er,l.pointGeometry=xt,l.polygonIntersectsPolygon=e1,l.potpack=R1,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=ot,l.registerForPluginStateChange=function(a){return a({pluginStatus:Hi,pluginURL:Qs}),nh.on("pluginStateChange",a),a},l.renderColorRamp=d1,l.rotateX=function(a,r,u){var f=Math.sin(u),g=Math.cos(u),v=r[4],b=r[5],T=r[6],A=r[7],M=r[8],z=r[9],O=r[10],V=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=v*g+M*f,a[5]=b*g+z*f,a[6]=T*g+O*f,a[7]=A*g+V*f,a[8]=M*g-v*f,a[9]=z*g-b*f,a[10]=O*g-T*f,a[11]=V*g-A*f,a},l.rotateZ=function(a,r,u){var f=Math.sin(u),g=Math.cos(u),v=r[0],b=r[1],T=r[2],A=r[3],M=r[4],z=r[5],O=r[6],V=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=v*g+M*f,a[1]=b*g+z*f,a[2]=T*g+O*f,a[3]=A*g+V*f,a[4]=M*g-v*f,a[5]=z*g-b*f,a[6]=O*g-T*f,a[7]=V*g-A*f,a},l.scale=function(a,r,u){var f=u[0],g=u[1],v=u[2];return a[0]=r[0]*f,a[1]=r[1]*f,a[2]=r[2]*f,a[3]=r[3]*f,a[4]=r[4]*g,a[5]=r[5]*g,a[6]=r[6]*g,a[7]=r[7]*g,a[8]=r[8]*v,a[9]=r[9]*v,a[10]=r[10]*v,a[11]=r[11]*v,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.scale$1=function(a,r,u){return a[0]=r[0]*u,a[1]=r[1]*u,a[2]=r[2]*u,a},l.setCacheLimits=function(a,r){rn=a,rr=r},l.setRTLTextPlugin=function(a,r,u=!1){if(Hi===Ju||Hi===Qu||Hi===eh)throw new Error("setRTLTextPlugin cannot be called multiple times.");Qs=Wn.resolveURL(a),Hi=Ju,th=r,ma(),u||Af()},l.spec=Le,l.sphericalToCartesian=function([a,r,u]){return r+=90,r*=Math.PI/180,u*=Math.PI/180,{x:a*Math.cos(r)*Math.sin(u),y:a*Math.sin(r)*Math.sin(u),z:a*Math.cos(u)}},l.sqrLen=function(a){var r=a[0],u=a[1];return r*r+u*u},l.sub=function(a,r,u){return a[0]=r[0]-u[0],a[1]=r[1]-u[1],a[2]=r[2]-u[2],a},l.toEvaluationFeature=wl,l.transformMat3=function(a,r,u){var f=r[0],g=r[1],v=r[2];return a[0]=f*u[0]+g*u[3]+v*u[6],a[1]=f*u[1]+g*u[4]+v*u[7],a[2]=f*u[2]+g*u[5]+v*u[8],a},l.transformMat4=Df,l.transformMat4$1=function(a,r,u){var f=r[0],g=r[1];return a[0]=u[0]*f+u[4]*g+u[12],a[1]=u[1]*f+u[5]*g+u[13],a},l.translate=function(a,r,u){var f,g,v,b,T,A,M,z,O,V,H,X,ae=u[0],oe=u[1],ve=u[2];return r===a?(a[12]=r[0]*ae+r[4]*oe+r[8]*ve+r[12],a[13]=r[1]*ae+r[5]*oe+r[9]*ve+r[13],a[14]=r[2]*ae+r[6]*oe+r[10]*ve+r[14],a[15]=r[3]*ae+r[7]*oe+r[11]*ve+r[15]):(g=r[1],v=r[2],b=r[3],T=r[4],A=r[5],M=r[6],z=r[7],O=r[8],V=r[9],H=r[10],X=r[11],a[0]=f=r[0],a[1]=g,a[2]=v,a[3]=b,a[4]=T,a[5]=A,a[6]=M,a[7]=z,a[8]=O,a[9]=V,a[10]=H,a[11]=X,a[12]=f*ae+T*oe+O*ve+r[12],a[13]=g*ae+A*oe+V*ve+r[13],a[14]=v*ae+M*oe+H*ve+r[14],a[15]=b*ae+z*oe+X*ve+r[15]),a},l.triggerPluginCompletionEvent=Sf,l.unicodeBlockLookup=Je,l.uniqueId=function(){return K++},l.validateCustomStyleLayer=function(a){const r=[],u=a.id;return u===void 0&&r.push({message:`layers.${u}: missing required property "id"`}),a.render===void 0&&r.push({message:`layers.${u}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&r.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),r},l.validateLight=Zu,l.validateStyle=ml,l.vectorTile=va,l.warnOnce=pe,l.wrap=B}),c(["./shared"],function(l){function y(ee){const R=typeof ee;if(R==="number"||R==="boolean"||R==="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){let J="[";for(const ce of ee)J+=`${y(ce)},`;return`${J}]`}const F=Object.keys(ee).sort();let Y="{";for(let J=0;J<F.length;J++)Y+=`${JSON.stringify(F[J])}:${y(ee[F[J]])},`;return`${Y}}`}function w(ee){let R="";for(const F of l.refProperties)R+=`/${y(ee[F])}`;return R}class S{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,F){for(const J of R){this._layerConfigs[J.id]=J;const ce=this._layers[J.id]=l.createStyleLayer(J);ce._featureFilter=l.createFilter(ce.filter),this.keyCache[J.id]&&delete this.keyCache[J.id]}for(const J of F)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const Y=function(J,ce){const me={};for(let le=0;le<J.length;le++){const ge=ce&&ce[J[le].id]||w(J[le]);ce&&(ce[J[le].id]=ge);let Ce=me[ge];Ce||(Ce=me[ge]=[]),Ce.push(J[le])}const de=[];for(const le in me)de.push(me[le]);return de}(Object.values(this._layerConfigs),this.keyCache);for(const J of Y){const ce=J.map(Oe=>this._layers[Oe.id]),me=ce[0];if(me.visibility==="none")continue;const de=me.source||"";let le=this.familiesBySource[de];le||(le=this.familiesBySource[de]={});const ge=me.sourceLayer||"_geojsonTileLayer";let Ce=le[ge];Ce||(Ce=le[ge]=[]),Ce.push(ce)}}}class I{constructor(R){const F={},Y=[];for(const de in R){const le=R[de],ge=F[de]={};for(const Ce in le){const Oe=le[+Ce];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const Pe={x:0,y:0,w:Oe.bitmap.width+2,h:Oe.bitmap.height+2};Y.push(Pe),ge[Ce]={rect:Pe,metrics:Oe.metrics}}}const{w:J,h:ce}=l.potpack(Y),me=new l.AlphaImage({width:J||1,height:ce||1});for(const de in R){const le=R[de];for(const ge in le){const Ce=le[+ge];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const Oe=F[de][ge].rect;l.AlphaImage.copy(Ce.bitmap,me,{x:0,y:0},{x:Oe.x+1,y:Oe.y+1},Ce.bitmap)}}this.image=me,this.positions=F}}l.register("GlyphAtlas",I);class P{constructor(R){this.tileID=new l.OverscaledTileID(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId}parse(R,F,Y,J,ce){this.status="parsing",this.data=R,this.collisionBoxArray=new l.CollisionBoxArray;const me=new l.DictionaryCoder(Object.keys(R.layers).sort()),de=new l.FeatureIndex(this.tileID,this.promoteId);de.bucketLayerIDs=[];const le={},ge={featureIndex:de,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y},Ce=F.familiesBySource[this.source];for(const vt in Ce){const At=R.layers[vt];if(!At)continue;At.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ft=me.encode(vt),Vt=[];for(let dn=0;dn<At.length;dn++){const fn=At.feature(dn),Qn=de.getId(fn,vt);Vt.push({feature:fn,id:Qn,index:dn,sourceLayerIndex:Ft})}for(const dn of Ce[vt]){const fn=dn[0];fn.source!==this.source&&l.warnOnce(`layer.source = ${fn.source} does not equal this.source = ${this.source}`),fn.minzoom&&this.zoom<Math.floor(fn.minzoom)||fn.maxzoom&&this.zoom>=fn.maxzoom||fn.visibility!=="none"&&(B(dn,this.zoom,Y),(le[fn.id]=fn.createBucket({index:de.bucketLayerIDs.length,layers:dn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ft,sourceID:this.source})).populate(Vt,ge,this.tileID.canonical),de.bucketLayerIDs.push(dn.map(Qn=>Qn.id)))}}let Oe,Pe,st,lt;const Ke=l.mapObject(ge.glyphDependencies,vt=>Object.keys(vt).map(Number));Object.keys(Ke).length?J.send("getGlyphs",{uid:this.uid,stacks:Ke},(vt,At)=>{Oe||(Oe=vt,Pe=At,Rt.call(this))}):Pe={};const gt=Object.keys(ge.iconDependencies);gt.length?J.send("getImages",{icons:gt,source:this.source,tileID:this.tileID,type:"icons"},(vt,At)=>{Oe||(Oe=vt,st=At,Rt.call(this))}):st={};const dt=Object.keys(ge.patternDependencies);function Rt(){if(Oe)return ce(Oe);if(Pe&&st&&lt){const vt=new I(Pe),At=new l.ImageAtlas(st,lt);for(const Ft in le){const Vt=le[Ft];Vt instanceof l.SymbolBucket?(B(Vt.layers,this.zoom,Y),l.performSymbolLayout({bucket:Vt,glyphMap:Pe,glyphPositions:vt.positions,imageMap:st,imagePositions:At.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Vt.hasPattern&&(Vt instanceof l.LineBucket||Vt instanceof l.FillBucket||Vt instanceof l.FillExtrusionBucket)&&(B(Vt.layers,this.zoom,Y),Vt.addFeatures(ge,this.tileID.canonical,At.patternPositions))}this.status="done",ce(null,{buckets:Object.values(le).filter(Ft=>!Ft.isEmpty()),featureIndex:de,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vt.image,imageAtlas:At,glyphMap:this.returnDependencies?Pe:null,iconMap:this.returnDependencies?st:null,glyphPositions:this.returnDependencies?vt.positions:null})}}dt.length?J.send("getImages",{icons:dt,source:this.source,tileID:this.tileID,type:"patterns"},(vt,At)=>{Oe||(Oe=vt,lt=At,Rt.call(this))}):lt={},Rt.call(this)}}function B(ee,R,F){const Y=new l.EvaluationParameters(R);for(const J of ee)J.recalculate(Y,F)}function G(ee,R){const F=l.getArrayBuffer(ee.request,(Y,J,ce,me)=>{Y?R(Y):J&&R(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(J)),rawData:J,cacheControl:ce,expires:me})});return()=>{F.cancel(),R()}}class K{constructor(R,F,Y,J){this.actor=R,this.layerIndex=F,this.availableImages=Y,this.loadVectorData=J||G,this.loading={},this.loaded={}}loadTile(R,F){const Y=R.uid;this.loading||(this.loading={});const J=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request),ce=this.loading[Y]=new P(R);ce.abort=this.loadVectorData(R,(me,de)=>{if(delete this.loading[Y],me||!de)return ce.status="done",this.loaded[Y]=ce,F(me);const le=de.rawData,ge={};de.expires&&(ge.expires=de.expires),de.cacheControl&&(ge.cacheControl=de.cacheControl);const Ce={};if(J){const Oe=J.finish();Oe&&(Ce.resourceTiming=JSON.parse(JSON.stringify(Oe)))}ce.vectorTile=de.vectorTile,ce.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,(Oe,Pe)=>{if(Oe||!Pe)return F(Oe);F(null,l.extend({rawTileData:le.slice(0)},Pe,ge,Ce))}),this.loaded=this.loaded||{},this.loaded[Y]=ce})}reloadTile(R,F){const Y=this.loaded,J=R.uid,ce=this;if(Y&&Y[J]){const me=Y[J];me.showCollisionBoxes=R.showCollisionBoxes;const de=(le,ge)=>{const Ce=me.reloadCallback;Ce&&(delete me.reloadCallback,me.parse(me.vectorTile,ce.layerIndex,this.availableImages,ce.actor,Ce)),F(le,ge)};me.status==="parsing"?me.reloadCallback=de:me.status==="done"&&(me.vectorTile?me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,de):de())}}abortTile(R,F){const Y=this.loading,J=R.uid;Y&&Y[J]&&Y[J].abort&&(Y[J].abort(),delete Y[J]),F()}removeTile(R,F){const Y=this.loaded,J=R.uid;Y&&Y[J]&&delete Y[J],F()}}class ue{constructor(){this.loaded={}}loadTile(R,F){const{uid:Y,encoding:J,rawImageData:ce}=R,me=l.isImageBitmap(ce)?this.getImageData(ce):ce,de=new l.DEMData(Y,me,J);this.loaded=this.loaded||{},this.loaded[Y]=de,F(null,de)}getImageData(R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const F=this.offscreenCanvasContext.getImageData(-1,-1,R.width+2,R.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:F.width,height:F.height},F.data)}removeTile(R){const F=this.loaded,Y=R.uid;F&&F[Y]&&delete F[Y]}}var q=function ee(R,F){var Y,J=R&&R.type;if(J==="FeatureCollection")for(Y=0;Y<R.features.length;Y++)ee(R.features[Y],F);else if(J==="GeometryCollection")for(Y=0;Y<R.geometries.length;Y++)ee(R.geometries[Y],F);else if(J==="Feature")ee(R.geometry,F);else if(J==="Polygon")j(R.coordinates,F);else if(J==="MultiPolygon")for(Y=0;Y<R.coordinates.length;Y++)j(R.coordinates[Y],F);return R};function j(ee,R){if(ee.length!==0){Z(ee[0],R);for(var F=1;F<ee.length;F++)Z(ee[F],!R)}}function Z(ee,R){for(var F=0,Y=0,J=0,ce=ee.length,me=ce-1;J<ce;me=J++){var de=(ee[J][0]-ee[me][0])*(ee[me][1]+ee[J][1]),le=F+de;Y+=Math.abs(F)>=Math.abs(de)?F-le+de:de-le+F,F=le}F+Y>=0!=!!R&&ee.reverse()}const re=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class pe{constructor(R){this._feature=R,this.extent=l.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(this._feature.type===1){const R=[];for(const F of this._feature.geometry)R.push([new l.pointGeometry(F[0],F[1])]);return R}{const R=[];for(const F of this._feature.geometry){const Y=[];for(const J of F)Y.push(new l.pointGeometry(J[0],J[1]));R.push(Y)}return R}}toGeoJSON(R,F,Y){return re.call(this,R,F,Y)}}class be{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=R.length,this._features=R}feature(R){return new pe(this._features[R])}}var Re={exports:{}},Fe=l.pointGeometry,je=l.vectorTile.VectorTileFeature,Ge=pt;function pt(ee,R){this.options=R||{},this.features=ee,this.length=ee.length}function bt(ee,R){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=R||4096}pt.prototype.feature=function(ee){return new bt(this.features[ee],this.options.extent)},bt.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var R=0;R<ee.length;R++){for(var F=ee[R],Y=[],J=0;J<F.length;J++)Y.push(new Fe(F[J][0],F[J][1]));this.geometry.push(Y)}return this.geometry},bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,R=1/0,F=-1/0,Y=1/0,J=-1/0,ce=0;ce<ee.length;ce++)for(var me=ee[ce],de=0;de<me.length;de++){var le=me[de];R=Math.min(R,le.x),F=Math.max(F,le.x),Y=Math.min(Y,le.y),J=Math.max(J,le.y)}return[R,Y,F,J]},bt.prototype.toGeoJSON=je.prototype.toGeoJSON;var St=l.pbf,kt=Ge;function Wn(ee){var R=new St;return function(F,Y){for(var J in F.layers)Y.writeMessage(3,xt,F.layers[J])}(ee,R),R.finish()}function xt(ee,R){var F;R.writeVarintField(15,ee.version||1),R.writeStringField(1,ee.name||""),R.writeVarintField(5,ee.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<ee.length;F++)Y.feature=ee.feature(F),R.writeMessage(2,bi,Y);var J=Y.keys;for(F=0;F<J.length;F++)R.writeStringField(3,J[F]);var ce=Y.values;for(F=0;F<ce.length;F++)R.writeMessage(4,rn,ce[F])}function bi(ee,R){var F=ee.feature;F.id!==void 0&&R.writeVarintField(1,F.id),R.writeMessage(2,nt,ee),R.writeVarintField(3,F.type),R.writeMessage(4,nn,F)}function nt(ee,R){var F=ee.feature,Y=ee.keys,J=ee.values,ce=ee.keycache,me=ee.valuecache;for(var de in F.properties){var le=F.properties[de],ge=ce[de];if(le!==null){ge===void 0&&(Y.push(de),ce[de]=ge=Y.length-1),R.writeVarint(ge);var Ce=typeof le;Ce!=="string"&&Ce!=="boolean"&&Ce!=="number"&&(le=JSON.stringify(le));var Oe=Ce+":"+le,Pe=me[Oe];Pe===void 0&&(J.push(le),me[Oe]=Pe=J.length-1),R.writeVarint(Pe)}}}function Et(ee,R){return(R<<3)+(7&ee)}function Pt(ee){return ee<<1^ee>>31}function nn(ee,R){for(var F=ee.loadGeometry(),Y=ee.type,J=0,ce=0,me=F.length,de=0;de<me;de++){var le=F[de],ge=1;Y===1&&(ge=le.length),R.writeVarint(Et(1,ge));for(var Ce=Y===3?le.length-1:le.length,Oe=0;Oe<Ce;Oe++){Oe===1&&Y!==1&&R.writeVarint(Et(2,Ce-1));var Pe=le[Oe].x-J,st=le[Oe].y-ce;R.writeVarint(Pt(Pe)),R.writeVarint(Pt(st)),J+=Pe,ce+=st}Y===3&&R.writeVarint(Et(7,1))}}function rn(ee,R){var F=typeof ee;F==="string"?R.writeStringField(1,ee):F==="boolean"?R.writeBooleanField(7,ee):F==="number"&&(ee%1!=0?R.writeDoubleField(3,ee):ee<0?R.writeSVarintField(6,ee):R.writeVarintField(5,ee))}function rr(ee,R,F,Y,J,ce){if(J-Y<=F)return;const me=Y+J>>1;ri(ee,R,me,Y,J,ce%2),rr(ee,R,F,Y,me-1,ce+1),rr(ee,R,F,me+1,J,ce+1)}function ri(ee,R,F,Y,J,ce){for(;J>Y;){if(J-Y>600){const ge=J-Y+1,Ce=F-Y+1,Oe=Math.log(ge),Pe=.5*Math.exp(2*Oe/3),st=.5*Math.sqrt(Oe*Pe*(ge-Pe)/ge)*(Ce-ge/2<0?-1:1);ri(ee,R,F,Math.max(Y,Math.floor(F-Ce*Pe/ge+st)),Math.min(J,Math.floor(F+(ge-Ce)*Pe/ge+st)),ce)}const me=R[2*F+ce];let de=Y,le=J;for(wi(ee,R,Y,F),R[2*J+ce]>me&&wi(ee,R,Y,J);de<le;){for(wi(ee,R,de,le),de++,le--;R[2*de+ce]<me;)de++;for(;R[2*le+ce]>me;)le--}R[2*Y+ce]===me?wi(ee,R,Y,le):(le++,wi(ee,R,le,J)),le<=F&&(Y=le+1),F<=le&&(J=le-1)}}function wi(ee,R,F,Y){si(ee,F,Y),si(R,2*F,2*Y),si(R,2*F+1,2*Y+1)}function si(ee,R,F){const Y=ee[R];ee[R]=ee[F],ee[F]=Y}function un(ee,R,F,Y){const J=ee-F,ce=R-Y;return J*J+ce*ce}Re.exports=Wn,Re.exports.fromVectorTileJs=Wn,Re.exports.fromGeojsonVt=function(ee,R){R=R||{};var F={};for(var Y in ee)F[Y]=new kt(ee[Y].features,R),F[Y].name=Y,F[Y].version=R.version,F[Y].extent=R.extent;return Wn({layers:F})},Re.exports.GeoJSONWrapper=kt;const Ei=ee=>ee[0],qt=ee=>ee[1];class On{constructor(R,F=Ei,Y=qt,J=64,ce=Float64Array){this.nodeSize=J,this.points=R;const me=R.length<65536?Uint16Array:Uint32Array,de=this.ids=new me(R.length),le=this.coords=new ce(2*R.length);for(let ge=0;ge<R.length;ge++)de[ge]=ge,le[2*ge]=F(R[ge]),le[2*ge+1]=Y(R[ge]);rr(de,le,J,0,de.length-1,0)}range(R,F,Y,J){return function(ce,me,de,le,ge,Ce,Oe){const Pe=[0,ce.length-1,0],st=[];let lt,Ke;for(;Pe.length;){const gt=Pe.pop(),dt=Pe.pop(),Rt=Pe.pop();if(dt-Rt<=Oe){for(let Ft=Rt;Ft<=dt;Ft++)lt=me[2*Ft],Ke=me[2*Ft+1],lt>=de&&lt<=ge&&Ke>=le&&Ke<=Ce&&st.push(ce[Ft]);continue}const vt=Math.floor((Rt+dt)/2);lt=me[2*vt],Ke=me[2*vt+1],lt>=de&&lt<=ge&&Ke>=le&&Ke<=Ce&&st.push(ce[vt]);const At=(gt+1)%2;(gt===0?de<=lt:le<=Ke)&&(Pe.push(Rt),Pe.push(vt-1),Pe.push(At)),(gt===0?ge>=lt:Ce>=Ke)&&(Pe.push(vt+1),Pe.push(dt),Pe.push(At))}return st}(this.ids,this.coords,R,F,Y,J,this.nodeSize)}within(R,F,Y){return function(J,ce,me,de,le,ge){const Ce=[0,J.length-1,0],Oe=[],Pe=le*le;for(;Ce.length;){const st=Ce.pop(),lt=Ce.pop(),Ke=Ce.pop();if(lt-Ke<=ge){for(let At=Ke;At<=lt;At++)un(ce[2*At],ce[2*At+1],me,de)<=Pe&&Oe.push(J[At]);continue}const gt=Math.floor((Ke+lt)/2),dt=ce[2*gt],Rt=ce[2*gt+1];un(dt,Rt,me,de)<=Pe&&Oe.push(J[gt]);const vt=(st+1)%2;(st===0?me-le<=dt:de-le<=Rt)&&(Ce.push(Ke),Ce.push(gt-1),Ce.push(vt)),(st===0?me+le>=dt:de+le>=Rt)&&(Ce.push(gt+1),Ce.push(lt),Ce.push(vt))}return Oe}(this.ids,this.coords,R,F,Y,this.nodeSize)}}const ss={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},ki=Math.fround||(Kn=new Float32Array(1),ee=>(Kn[0]=+ee,Kn[0]));var Kn;class Rr{constructor(R){this.options=os(Object.create(ss),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:F,minZoom:Y,maxZoom:J,nodeSize:ce}=this.options;F&&console.time("total time");const me=`prepare ${R.length} points`;F&&console.time(me),this.points=R;let de=[];for(let le=0;le<R.length;le++)R[le].geometry&&de.push(fi(R[le],le));this.trees[J+1]=new On(de,bo,zr,ce,Float32Array),F&&console.timeEnd(me);for(let le=J;le>=Y;le--){const ge=+Date.now();de=this._cluster(de,le),this.trees[le]=new On(de,bo,zr,ce,Float32Array),F&&console.log("z%d: %d clusters in %dms",le,de.length,+Date.now()-ge)}return F&&console.timeEnd("total time"),this}getClusters(R,F){let Y=((R[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,R[1]));let ce=R[2]===180?180:((R[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)Y=-180,ce=180;else if(Y>ce){const Ce=this.getClusters([Y,J,180,me],F),Oe=this.getClusters([-180,J,ce,me],F);return Ce.concat(Oe)}const de=this.trees[this._limitZoom(F)],le=de.range(Gt(Y),Ri(me),Gt(ce),Ri(J)),ge=[];for(const Ce of le){const Oe=de.points[Ce];ge.push(Oe.numPoints?Wi(Oe):this.points[Oe.index])}return ge}getChildren(R){const F=this._getOriginId(R),Y=this._getOriginZoom(R),J="No cluster with the specified id.",ce=this.trees[Y];if(!ce)throw new Error(J);const me=ce.points[F];if(!me)throw new Error(J);const de=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),le=ce.within(me.x,me.y,de),ge=[];for(const Ce of le){const Oe=ce.points[Ce];Oe.parentId===R&&ge.push(Oe.numPoints?Wi(Oe):this.points[Oe.index])}if(ge.length===0)throw new Error(J);return ge}getLeaves(R,F,Y){const J=[];return this._appendLeaves(J,R,F=F||10,Y=Y||0,0),J}getTile(R,F,Y){const J=this.trees[this._limitZoom(R)],ce=Math.pow(2,R),{extent:me,radius:de}=this.options,le=de/me,ge=(Y-le)/ce,Ce=(Y+1+le)/ce,Oe={features:[]};return this._addTileFeatures(J.range((F-le)/ce,ge,(F+1+le)/ce,Ce),J.points,F,Y,ce,Oe),F===0&&this._addTileFeatures(J.range(1-le/ce,ge,1,Ce),J.points,ce,Y,ce,Oe),F===ce-1&&this._addTileFeatures(J.range(0,ge,le/ce,Ce),J.points,-1,Y,ce,Oe),Oe.features.length?Oe:null}getClusterExpansionZoom(R){let F=this._getOriginZoom(R)-1;for(;F<=this.options.maxZoom;){const Y=this.getChildren(R);if(F++,Y.length!==1)break;R=Y[0].properties.cluster_id}return F}_appendLeaves(R,F,Y,J,ce){const me=this.getChildren(F);for(const de of me){const le=de.properties;if(le&&le.cluster?ce+le.point_count<=J?ce+=le.point_count:ce=this._appendLeaves(R,le.cluster_id,Y,J,ce):ce<J?ce++:R.push(de),R.length===Y)break}return ce}_addTileFeatures(R,F,Y,J,ce,me){for(const de of R){const le=F[de],ge=le.numPoints;let Ce,Oe,Pe;if(ge)Ce=$s(le),Oe=le.x,Pe=le.y;else{const Ke=this.points[le.index];Ce=Ke.properties,Oe=Gt(Ke.geometry.coordinates[0]),Pe=Ri(Ke.geometry.coordinates[1])}const st={type:1,geometry:[[Math.round(this.options.extent*(Oe*ce-Y)),Math.round(this.options.extent*(Pe*ce-J))]],tags:Ce};let lt;ge?lt=le.id:this.options.generateId?lt=le.index:this.points[le.index].id&&(lt=this.points[le.index].id),lt!==void 0&&(st.id=lt),me.features.push(st)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,F){const Y=[],{radius:J,extent:ce,reduce:me,minPoints:de}=this.options,le=J/(ce*Math.pow(2,F));for(let ge=0;ge<R.length;ge++){const Ce=R[ge];if(Ce.zoom<=F)continue;Ce.zoom=F;const Oe=this.trees[F+1],Pe=Oe.within(Ce.x,Ce.y,le),st=Ce.numPoints||1;let lt=st;for(const Ke of Pe){const gt=Oe.points[Ke];gt.zoom>F&&(lt+=gt.numPoints||1)}if(lt>st&&lt>=de){let Ke=Ce.x*st,gt=Ce.y*st,dt=me&&st>1?this._map(Ce,!0):null;const Rt=(ge<<5)+(F+1)+this.points.length;for(const vt of Pe){const At=Oe.points[vt];if(At.zoom<=F)continue;At.zoom=F;const Ft=At.numPoints||1;Ke+=At.x*Ft,gt+=At.y*Ft,At.parentId=Rt,me&&(dt||(dt=this._map(Ce,!0)),me(dt,this._map(At)))}Ce.parentId=Rt,Y.push(Gi(Ke/lt,gt/lt,Rt,lt,dt))}else if(Y.push(Ce),lt>1)for(const Ke of Pe){const gt=Oe.points[Ke];gt.zoom<=F||(gt.zoom=F,Y.push(gt))}}return Y}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,F){if(R.numPoints)return F?os({},R.properties):R.properties;const Y=this.points[R.index].properties,J=this.options.map(Y);return F&&J===Y?os({},J):J}}function Gi(ee,R,F,Y,J){return{x:ki(ee),y:ki(R),zoom:1/0,id:F,parentId:-1,numPoints:Y,properties:J}}function fi(ee,R){const[F,Y]=ee.geometry.coordinates;return{x:ki(Gt(F)),y:ki(Ri(Y)),zoom:1/0,index:R,parentId:-1}}function Wi(ee){return{type:"Feature",id:ee.id,properties:$s(ee),geometry:{type:"Point",coordinates:[(R=ee.x,360*(R-.5)),Fn(ee.y)]}};var R}function $s(ee){const R=ee.numPoints,F=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return os(os({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:R,point_count_abbreviated:F})}function Gt(ee){return ee/360+.5}function Ri(ee){const R=Math.sin(ee*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function Fn(ee){const R=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function os(ee,R){for(const F in R)ee[F]=R[F];return ee}function bo(ee){return ee.x}function zr(ee){return ee.y}function Dr(ee,R,F,Y){for(var J,ce=Y,me=F-R>>1,de=F-R,le=ee[R],ge=ee[R+1],Ce=ee[F],Oe=ee[F+1],Pe=R+3;Pe<F;Pe+=3){var st=Hs(ee[Pe],ee[Pe+1],le,ge,Ce,Oe);if(st>ce)J=Pe,ce=st;else if(st===ce){var lt=Math.abs(Pe-me);lt<de&&(J=Pe,de=lt)}}ce>Y&&(J-R>3&&Dr(ee,R,J,Y),ee[J+2]=ce,F-J>3&&Dr(ee,J,F,Y))}function Hs(ee,R,F,Y,J,ce){var me=J-F,de=ce-Y;if(me!==0||de!==0){var le=((ee-F)*me+(R-Y)*de)/(me*me+de*de);le>1?(F=J,Y=ce):le>0&&(F+=me*le,Y+=de*le)}return(me=ee-F)*me+(de=R-Y)*de}function xr(ee,R,F,Y){var J={id:ee===void 0?null:ee,type:R,geometry:F,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ce){var me=ce.geometry,de=ce.type;if(de==="Point"||de==="MultiPoint"||de==="LineString")Le(ce,me);else if(de==="Polygon"||de==="MultiLineString")for(var le=0;le<me.length;le++)Le(ce,me[le]);else if(de==="MultiPolygon")for(le=0;le<me.length;le++)for(var ge=0;ge<me[le].length;ge++)Le(ce,me[le][ge])}(J),J}function Le(ee,R){for(var F=0;F<R.length;F+=3)ee.minX=Math.min(ee.minX,R[F]),ee.minY=Math.min(ee.minY,R[F+1]),ee.maxX=Math.max(ee.maxX,R[F]),ee.maxY=Math.max(ee.maxY,R[F+1])}function qe(ee,R,F,Y){if(R.geometry){var J=R.geometry.coordinates,ce=R.geometry.type,me=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),de=[],le=R.id;if(F.promoteId?le=R.properties[F.promoteId]:F.generateId&&(le=Y||0),ce==="Point")as(J,de);else if(ce==="MultiPoint")for(var ge=0;ge<J.length;ge++)as(J[ge],de);else if(ce==="LineString")Ti(J,de,me,!1);else if(ce==="MultiLineString"){if(F.lineMetrics){for(ge=0;ge<J.length;ge++)Ti(J[ge],de=[],me,!1),ee.push(xr(le,"LineString",de,R.properties));return}Ut(J,de,me,!1)}else if(ce==="Polygon")Ut(J,de,me,!0);else{if(ce!=="MultiPolygon"){if(ce==="GeometryCollection"){for(ge=0;ge<R.geometry.geometries.length;ge++)qe(ee,{id:le,geometry:R.geometry.geometries[ge],properties:R.properties},F,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ge=0;ge<J.length;ge++){var Ce=[];Ut(J[ge],Ce,me,!0),de.push(Ce)}}ee.push(xr(le,ce,de,R.properties))}}function as(ee,R){R.push($i(ee[0])),R.push(zi(ee[1])),R.push(0)}function Ti(ee,R,F,Y){for(var J,ce,me=0,de=0;de<ee.length;de++){var le=$i(ee[de][0]),ge=zi(ee[de][1]);R.push(le),R.push(ge),R.push(0),de>0&&(me+=Y?(J*ge-le*ce)/2:Math.sqrt(Math.pow(le-J,2)+Math.pow(ge-ce,2))),J=le,ce=ge}var Ce=R.length-3;R[2]=1,Dr(R,0,Ce,F),R[Ce+2]=1,R.size=Math.abs(me),R.start=0,R.end=R.size}function Ut(ee,R,F,Y){for(var J=0;J<ee.length;J++){var ce=[];Ti(ee[J],ce,F,Y),R.push(ce)}}function $i(ee){return ee/360+.5}function zi(ee){var R=Math.sin(ee*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function Di(ee,R,F,Y,J,ce,me,de){if(Y/=R,ce>=(F/=R)&&me<Y)return ee;if(me<F||ce>=Y)return null;for(var le=[],ge=0;ge<ee.length;ge++){var Ce=ee[ge],Oe=Ce.geometry,Pe=Ce.type,st=J===0?Ce.minX:Ce.minY,lt=J===0?Ce.maxX:Ce.maxY;if(st>=F&&lt<Y)le.push(Ce);else if(!(lt<F||st>=Y)){var Ke=[];if(Pe==="Point"||Pe==="MultiPoint")ls(Oe,Ke,F,Y,J);else if(Pe==="LineString")He(Oe,Ke,F,Y,J,!1,de.lineMetrics);else if(Pe==="MultiLineString")It(Oe,Ke,F,Y,J,!1);else if(Pe==="Polygon")It(Oe,Ke,F,Y,J,!0);else if(Pe==="MultiPolygon")for(var gt=0;gt<Oe.length;gt++){var dt=[];It(Oe[gt],dt,F,Y,J,!0),dt.length&&Ke.push(dt)}if(Ke.length){if(de.lineMetrics&&Pe==="LineString"){for(gt=0;gt<Ke.length;gt++)le.push(xr(Ce.id,Pe,Ke[gt],Ce.tags));continue}Pe!=="LineString"&&Pe!=="MultiLineString"||(Ke.length===1?(Pe="LineString",Ke=Ke[0]):Pe="MultiLineString"),Pe!=="Point"&&Pe!=="MultiPoint"||(Pe=Ke.length===3?"Point":"MultiPoint"),le.push(xr(Ce.id,Pe,Ke,Ce.tags))}}}return le.length?le:null}function ls(ee,R,F,Y,J){for(var ce=0;ce<ee.length;ce+=3){var me=ee[ce+J];me>=F&&me<=Y&&(R.push(ee[ce]),R.push(ee[ce+1]),R.push(ee[ce+2]))}}function He(ee,R,F,Y,J,ce,me){for(var de,le,ge=Lt(ee),Ce=J===0?Or:Ct,Oe=ee.start,Pe=0;Pe<ee.length-3;Pe+=3){var st=ee[Pe],lt=ee[Pe+1],Ke=ee[Pe+2],gt=ee[Pe+3],dt=ee[Pe+4],Rt=J===0?st:lt,vt=J===0?gt:dt,At=!1;me&&(de=Math.sqrt(Math.pow(st-gt,2)+Math.pow(lt-dt,2))),Rt<F?vt>F&&(le=Ce(ge,st,lt,gt,dt,F),me&&(ge.start=Oe+de*le)):Rt>Y?vt<Y&&(le=Ce(ge,st,lt,gt,dt,Y),me&&(ge.start=Oe+de*le)):Jn(ge,st,lt,Ke),vt<F&&Rt>=F&&(le=Ce(ge,st,lt,gt,dt,F),At=!0),vt>Y&&Rt<=Y&&(le=Ce(ge,st,lt,gt,dt,Y),At=!0),!ce&&At&&(me&&(ge.end=Oe+de*le),R.push(ge),ge=Lt(ee)),me&&(Oe+=de)}var Ft=ee.length-3;st=ee[Ft],lt=ee[Ft+1],Ke=ee[Ft+2],(Rt=J===0?st:lt)>=F&&Rt<=Y&&Jn(ge,st,lt,Ke),Ft=ge.length-3,ce&&Ft>=3&&(ge[Ft]!==ge[0]||ge[Ft+1]!==ge[1])&&Jn(ge,ge[0],ge[1],ge[2]),ge.length&&R.push(ge)}function Lt(ee){var R=[];return R.size=ee.size,R.start=ee.start,R.end=ee.end,R}function It(ee,R,F,Y,J,ce){for(var me=0;me<ee.length;me++)He(ee[me],R,F,Y,J,ce,!1)}function Jn(ee,R,F,Y){ee.push(R),ee.push(F),ee.push(Y)}function Or(ee,R,F,Y,J,ce){var me=(ce-R)/(Y-R);return ee.push(ce),ee.push(F+(J-F)*me),ee.push(1),me}function Ct(ee,R,F,Y,J,ce){var me=(ce-F)/(J-F);return ee.push(R+(Y-R)*me),ee.push(ce),ee.push(1),me}function sr(ee,R){for(var F=[],Y=0;Y<ee.length;Y++){var J,ce=ee[Y],me=ce.type;if(me==="Point"||me==="MultiPoint"||me==="LineString")J=$n(ce.geometry,R);else if(me==="MultiLineString"||me==="Polygon"){J=[];for(var de=0;de<ce.geometry.length;de++)J.push($n(ce.geometry[de],R))}else if(me==="MultiPolygon")for(J=[],de=0;de<ce.geometry.length;de++){for(var le=[],ge=0;ge<ce.geometry[de].length;ge++)le.push($n(ce.geometry[de][ge],R));J.push(le)}F.push(xr(ce.id,me,J,ce.tags))}return F}function $n(ee,R){var F=[];F.size=ee.size,ee.start!==void 0&&(F.start=ee.start,F.end=ee.end);for(var Y=0;Y<ee.length;Y+=3)F.push(ee[Y]+R,ee[Y+1],ee[Y+2]);return F}function qs(ee,R){if(ee.transformed)return ee;var F,Y,J,ce=1<<ee.z,me=ee.x,de=ee.y;for(F=0;F<ee.features.length;F++){var le=ee.features[F],ge=le.geometry,Ce=le.type;if(le.geometry=[],Ce===1)for(Y=0;Y<ge.length;Y+=2)le.geometry.push(Mn(ge[Y],ge[Y+1],R,ce,me,de));else for(Y=0;Y<ge.length;Y++){var Oe=[];for(J=0;J<ge[Y].length;J+=2)Oe.push(Mn(ge[Y][J],ge[Y][J+1],R,ce,me,de));le.geometry.push(Oe)}}return ee.transformed=!0,ee}function Mn(ee,R,F,Y,J,ce){return[Math.round(F*(ee*Y-J)),Math.round(F*(R*Y-ce))]}function oi(ee,R,F,Y,J){for(var ce=R===J.maxZoom?0:J.tolerance/((1<<R)*J.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:Y,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},de=0;de<ee.length;de++){me.numFeatures++,en(me,ee[de],ce,J);var le=ee[de].minX,ge=ee[de].minY,Ce=ee[de].maxX,Oe=ee[de].maxY;le<me.minX&&(me.minX=le),ge<me.minY&&(me.minY=ge),Ce>me.maxX&&(me.maxX=Ce),Oe>me.maxY&&(me.maxY=Oe)}return me}function en(ee,R,F,Y){var J=R.geometry,ce=R.type,me=[];if(ce==="Point"||ce==="MultiPoint")for(var de=0;de<J.length;de+=3)me.push(J[de]),me.push(J[de+1]),ee.numPoints++,ee.numSimplified++;else if(ce==="LineString")Zs(me,J,ee,F,!1,!1);else if(ce==="MultiLineString"||ce==="Polygon")for(de=0;de<J.length;de++)Zs(me,J[de],ee,F,ce==="Polygon",de===0);else if(ce==="MultiPolygon")for(var le=0;le<J.length;le++){var ge=J[le];for(de=0;de<ge.length;de++)Zs(me,ge[de],ee,F,!0,de===0)}if(me.length){var Ce=R.tags||null;if(ce==="LineString"&&Y.lineMetrics){for(var Oe in Ce={},R.tags)Ce[Oe]=R.tags[Oe];Ce.mapbox_clip_start=J.start/J.size,Ce.mapbox_clip_end=J.end/J.size}var Pe={geometry:me,type:ce==="Polygon"||ce==="MultiPolygon"?3:ce==="LineString"||ce==="MultiLineString"?2:1,tags:Ce};R.id!==null&&(Pe.id=R.id),ee.features.push(Pe)}}function Zs(ee,R,F,Y,J,ce){var me=Y*Y;if(Y>0&&R.size<(J?me:Y))F.numPoints+=R.length/3;else{for(var de=[],le=0;le<R.length;le+=3)(Y===0||R[le+2]>me)&&(F.numSimplified++,de.push(R[le]),de.push(R[le+1])),F.numPoints++;J&&function(ge,Ce){for(var Oe=0,Pe=0,st=ge.length,lt=st-2;Pe<st;lt=Pe,Pe+=2)Oe+=(ge[Pe]-ge[lt])*(ge[Pe+1]+ge[lt+1]);if(Oe>0===Ce)for(Pe=0,st=ge.length;Pe<st/2;Pe+=2){var Ke=ge[Pe],gt=ge[Pe+1];ge[Pe]=ge[st-2-Pe],ge[Pe+1]=ge[st-1-Pe],ge[st-2-Pe]=Ke,ge[st-1-Pe]=gt}}(de,ce),ee.push(de)}}function br(ee,R){var F=(R=this.options=function(J,ce){for(var me in ce)J[me]=ce[me];return J}(Object.create(this.options),R)).debug;if(F&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(J,ce){var me=[];if(J.type==="FeatureCollection")for(var de=0;de<J.features.length;de++)qe(me,J.features[de],ce,de);else qe(me,J.type==="Feature"?J:{geometry:J},ce);return me}(ee,R);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(J,ce){var me=ce.buffer/ce.extent,de=J,le=Di(J,1,-1-me,me,0,-1,2,ce),ge=Di(J,1,1-me,2+me,0,-1,2,ce);return(le||ge)&&(de=Di(J,1,-me,1+me,0,-1,2,ce)||[],le&&(de=sr(le,1).concat(de)),ge&&(de=de.concat(sr(ge,-1)))),de}(Y,R),Y.length&&this.splitTile(Y,0,0,0),F&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function wr(ee,R,F){return 32*((1<<ee)*F+R)+ee}function As(ee,R){const F=ee.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const Y=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!Y)return R(null,null);const J=new be(Y.features);let ce=Re.exports(J);ce.byteOffset===0&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),R(null,{vectorTile:J,rawData:ce.buffer})}br.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},br.prototype.splitTile=function(ee,R,F,Y,J,ce,me){for(var de=[ee,R,F,Y],le=this.options,ge=le.debug;de.length;){Y=de.pop(),F=de.pop(),R=de.pop(),ee=de.pop();var Ce=1<<R,Oe=wr(R,F,Y),Pe=this.tiles[Oe];if(!Pe&&(ge>1&&console.time("creation"),Pe=this.tiles[Oe]=oi(ee,R,F,Y,le),this.tileCoords.push({z:R,x:F,y:Y}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,F,Y,Pe.numFeatures,Pe.numPoints,Pe.numSimplified),console.timeEnd("creation"));var st="z"+R;this.stats[st]=(this.stats[st]||0)+1,this.total++}if(Pe.source=ee,J){if(R===le.maxZoom||R===J)continue;var lt=1<<J-R;if(F!==Math.floor(ce/lt)||Y!==Math.floor(me/lt))continue}else if(R===le.indexMaxZoom||Pe.numPoints<=le.indexMaxPoints)continue;if(Pe.source=null,ee.length!==0){ge>1&&console.time("clipping");var Ke,gt,dt,Rt,vt,At,Ft=.5*le.buffer/le.extent,Vt=.5-Ft,dn=.5+Ft,fn=1+Ft;Ke=gt=dt=Rt=null,vt=Di(ee,Ce,F-Ft,F+dn,0,Pe.minX,Pe.maxX,le),At=Di(ee,Ce,F+Vt,F+fn,0,Pe.minX,Pe.maxX,le),ee=null,vt&&(Ke=Di(vt,Ce,Y-Ft,Y+dn,1,Pe.minY,Pe.maxY,le),gt=Di(vt,Ce,Y+Vt,Y+fn,1,Pe.minY,Pe.maxY,le),vt=null),At&&(dt=Di(At,Ce,Y-Ft,Y+dn,1,Pe.minY,Pe.maxY,le),Rt=Di(At,Ce,Y+Vt,Y+fn,1,Pe.minY,Pe.maxY,le),At=null),ge>1&&console.timeEnd("clipping"),de.push(Ke||[],R+1,2*F,2*Y),de.push(gt||[],R+1,2*F,2*Y+1),de.push(dt||[],R+1,2*F+1,2*Y),de.push(Rt||[],R+1,2*F+1,2*Y+1)}}},br.prototype.getTile=function(ee,R,F){var Y=this.options,J=Y.extent,ce=Y.debug;if(ee<0||ee>24)return null;var me=1<<ee,de=wr(ee,R=(R%me+me)%me,F);if(this.tiles[de])return qs(this.tiles[de],J);ce>1&&console.log("drilling down to z%d-%d-%d",ee,R,F);for(var le,ge=ee,Ce=R,Oe=F;!le&&ge>0;)ge--,Ce=Math.floor(Ce/2),Oe=Math.floor(Oe/2),le=this.tiles[wr(ge,Ce,Oe)];return le&&le.source?(ce>1&&console.log("found parent tile z%d-%d-%d",ge,Ce,Oe),ce>1&&console.time("drilling down"),this.splitTile(le.source,ge,Ce,Oe,ee,R,F),ce>1&&console.timeEnd("drilling down"),this.tiles[de]?qs(this.tiles[de],J):null):null};class Xs extends K{constructor(R,F,Y,J){super(R,F,Y,As),J&&(this.loadGeoJSON=J)}loadData(R,F){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const J=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request);this._pendingCallback=F,this._pendingRequest=this.loadGeoJSON(R,(ce,me)=>{if(delete this._pendingCallback,delete this._pendingRequest,ce||!me)return F(ce);if(typeof me!="object")return F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{q(me,!0);try{if(R.filter){const le=l.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(Ce=>`${Ce.key}: ${Ce.message}`).join(", "));me={type:"FeatureCollection",features:me.features.filter(Ce=>le.value.evaluate({zoom:0},Ce))}}this._geoJSONIndex=R.cluster?new Rr(function({superclusterOptions:le,clusterProperties:ge}){if(!ge||!le)return le;const Ce={},Oe={},Pe={accumulated:null,zoom:0},st={properties:null},lt=Object.keys(ge);for(const Ke of lt){const[gt,dt]=ge[Ke],Rt=l.createExpression(dt),vt=l.createExpression(typeof gt=="string"?[gt,["accumulated"],["get",Ke]]:gt);Ce[Ke]=Rt.value,Oe[Ke]=vt.value}return le.map=Ke=>{st.properties=Ke;const gt={};for(const dt of lt)gt[dt]=Ce[dt].evaluate(Pe,st);return gt},le.reduce=(Ke,gt)=>{st.properties=gt;for(const dt of lt)Pe.accumulated=Ke[dt],Ke[dt]=Oe[dt].evaluate(Pe,st)},le}(R)).load(me.features):function(le,ge){return new br(le,ge)}(me,R.geojsonVtOptions)}catch(le){return F(le)}this.loaded={};const de={};if(J){const le=J.finish();le&&(de.resourceTiming={},de.resourceTiming[R.source]=JSON.parse(JSON.stringify(le)))}F(null,de)}})}reloadTile(R,F){const Y=this.loaded;return Y&&Y[R.uid]?super.reloadTile(R,F):this.loadTile(R,F)}loadGeoJSON(R,F){if(R.request)return l.getJSON(R.request,F);if(typeof R.data=="string")try{F(null,JSON.parse(R.data))}catch{F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}else F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(R,F){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),F()}getClusterExpansionZoom(R,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(Y){F(Y)}}getClusterChildren(R,F){try{F(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(Y){F(Y)}}getClusterLeaves(R,F){try{F(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(Y){F(Y)}}}class cs{constructor(R){this.self=R,this.actor=new l.Actor(R,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:K,geojson:Xs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,Y)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=Y},this.self.registerRTLTextPlugin=F=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=F.applyArabicShaping,l.plugin.processBidirectionalText=F.processBidirectionalText,l.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}setReferrer(R,F){this.referrer=F}setImages(R,F,Y){this.availableImages[R]=F;for(const J in this.workerSources[R]){const ce=this.workerSources[R][J];for(const me in ce)ce[me].availableImages=F}Y()}setLayers(R,F,Y){this.getLayerIndex(R).replace(F),Y()}updateLayers(R,F,Y){this.getLayerIndex(R).update(F.layers,F.removedIds),Y()}loadTile(R,F,Y){this.getWorkerSource(R,F.type,F.source).loadTile(F,Y)}loadDEMTile(R,F,Y){this.getDEMWorkerSource(R,F.source).loadTile(F,Y)}reloadTile(R,F,Y){this.getWorkerSource(R,F.type,F.source).reloadTile(F,Y)}abortTile(R,F,Y){this.getWorkerSource(R,F.type,F.source).abortTile(F,Y)}removeTile(R,F,Y){this.getWorkerSource(R,F.type,F.source).removeTile(F,Y)}removeDEMTile(R,F){this.getDEMWorkerSource(R,F.source).removeTile(F)}removeSource(R,F,Y){if(!this.workerSources[R]||!this.workerSources[R][F.type]||!this.workerSources[R][F.type][F.source])return;const J=this.workerSources[R][F.type][F.source];delete this.workerSources[R][F.type][F.source],J.removeSource!==void 0?J.removeSource(F,Y):Y()}loadWorkerSource(R,F,Y){try{this.self.importScripts(F.url),Y()}catch(J){Y(J.toString())}}syncRTLPluginState(R,F,Y){try{l.plugin.setState(F);const J=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&J!=null){this.self.importScripts(J);const ce=l.plugin.isParsed();Y(ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${J}`),ce)}}catch(J){Y(J.toString())}}getAvailableImages(R){let F=this.availableImages[R];return F||(F=[]),F}getLayerIndex(R){let F=this.layerIndexes[R];return F||(F=this.layerIndexes[R]=new S),F}getWorkerSource(R,F,Y){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][F]||(this.workerSources[R][F]={}),!this.workerSources[R][F][Y]){const J={send:(ce,me,de)=>{this.actor.send(ce,me,de,R)}};this.workerSources[R][F][Y]=new this.workerSourceTypes[F](J,this.getLayerIndex(R),this.getAvailableImages(R))}return this.workerSources[R][F][Y]}getDEMWorkerSource(R,F){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][F]||(this.demWorkerSources[R][F]=new ue),this.demWorkerSources[R][F]}enforceCacheSizeLimit(R,F){l.enforceCacheSizeLimit(F)}}return l.isWorker()&&(self.worker=new cs(self)),cs}),c(["./shared"],function(l){var y=w;function w(m){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{_=new Worker(E),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(E),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===p.width}()?(S[h=o&&o.failIfMajorPerformanceCaveat]===void 0&&(S[h]=function(p){var _,x=function(E){var C=document.createElement("canvas"),L=Object.create(w.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=E,C.getContext("webgl",L)||C.getContext("experimental-webgl",L)}(p);if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),x.getShaderParameter(_,x.COMPILE_STATUS)===!0)}(h)),S[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(m)}var S={};function I(m,o){if(Array.isArray(m)){if(!Array.isArray(o)||m.length!==o.length)return!1;for(let h=0;h<m.length;h++)if(!I(m[h],o[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&o!==null){if(typeof o!="object"||Object.keys(m).length!==Object.keys(o).length)return!1;for(const h in m)if(!I(m[h],o[h]))return!1;return!0}return m===o}w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class P{static testProp(o){if(!P.docStyle)return o[0];for(let h=0;h<o.length;h++)if(o[h]in P.docStyle)return o[h];return o[0]}static create(o,h,p){const _=window.document.createElement(o);return h!==void 0&&(_.className=h),p&&p.appendChild(_),_}static createNS(o,h){return window.document.createElementNS(o,h)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(o,h){o.style[P.transformProp]=h}static addEventListener(o,h,p,_={}){o.addEventListener(h,p,"passive"in _?_:_.capture)}static removeEventListener(o,h,p,_={}){o.removeEventListener(h,p,"passive"in _?_:_.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static mousePos(o,h){const p=o.getBoundingClientRect();return new l.pointGeometry(h.clientX-p.left-o.clientLeft,h.clientY-p.top-o.clientTop)}static touchPos(o,h){const p=o.getBoundingClientRect(),_=[];for(let x=0;x<h.length;x++)_.push(new l.pointGeometry(h[x].clientX-p.left-o.clientLeft,h[x].clientY-p.top-o.clientTop));return _}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);class B{constructor(o){this._transformRequestFn=o}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeSpriteURL(o,h,p){const _=function(x){const E=x.match(G);if(!E)throw new Error(`Unable to parse URL "${x}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(o);return _.path+=`${h}${p}`,function(x){const E=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${E}`}(_)}setTransformRequest(o){this._transformRequestFn=o}}const G=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class K{constructor(o,h,p,_){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(h,_)}update(o,h,p){const{width:_,height:x}=o,E=!(this.size&&this.size[0]===_&&this.size[1]===x||p),{context:C}=this,{gl:L}=C;if(this.useMipmap=!!(h&&h.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[_,x],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,o):L.texImage2D(L.TEXTURE_2D,0,this.format,_,x,0,this.format,L.UNSIGNED_BYTE,o.data);else{const{x:k,y:D}=p||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?L.texSubImage2D(L.TEXTURE_2D,0,k,D,L.RGBA,L.UNSIGNED_BYTE,o):L.texSubImage2D(L.TEXTURE_2D,0,k,D,_,x,L.RGBA,L.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)}bind(o,h,p){const{context:_}=this,{gl:x}=_;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),o!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,o),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||o),this.filter=o),h!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,h),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function ue(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class q extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,callback:p}of this.requestors)this._notify(h,p);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,h){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let p=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,h){if(!o)return!0;let p=0;for(const _ of o){if(_[0]<p||_[1]<_[0]||h<_[1])return!1;p=_[1]}return!0}_validateContent(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,h){const p=this.images[o];if(p.data.width!==h.data.width||p.data.height!==h.data.height)throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=p.version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,h){let p=!0;if(!this.isLoaded())for(const _ of o)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(o,h):this.requestors.push({ids:o,callback:h})}_notify(o,h){const p={};for(const _ of o){this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));const x=this.images[_];x?p[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:l.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,p)}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],p=this.getImage(o);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new l.ImagePosition(_,p);this.patterns[o]={bin:_,position:x}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new K(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const x in this.patterns)o.push(this.patterns[x].bin);const{w:h,h:p}=l.potpack(o),_=this.atlasImage;_.resize({width:h||1,height:p||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],C=E.x+1,L=E.y+1,k=this.images[x].data,D=k.width,N=k.height;l.RGBAImage.copy(k,_,{x:0,y:0},{x:C,y:L},{width:D,height:N}),l.RGBAImage.copy(k,_,{x:0,y:N-1},{x:C,y:L-1},{width:D,height:1}),l.RGBAImage.copy(k,_,{x:0,y:0},{x:C,y:L+N},{width:D,height:1}),l.RGBAImage.copy(k,_,{x:D-1,y:0},{x:C-1,y:L},{width:1,height:N}),l.RGBAImage.copy(k,_,{x:0,y:0},{x:C+D,y:L},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.images[h];p||l.warnOnce(`Image with ID: "${h}" was not found`),ue(p)&&this.updateImage(h,p)}}}const j=1e20;function Z(m,o,h,p,_,x,E,C,L){for(let k=o;k<o+p;k++)re(m,h*x+k,x,_,E,C,L);for(let k=h;k<h+_;k++)re(m,k*x+o,1,p,E,C,L)}function re(m,o,h,p,_,x,E){x[0]=0,E[0]=-j,E[1]=j,_[0]=m[o];for(let C=1,L=0,k=0;C<p;C++){_[C]=m[o+C*h];const D=C*C;do{const N=x[L];k=(_[C]-_[N]+D-N*N)/(C-N)/2}while(k<=E[L]&&--L>-1);L++,x[L]=C,E[L]=k,E[L+1]=j}for(let C=0,L=0;C<p;C++){for(;E[L+1]<C;)L++;const k=x[L],D=C-k;m[o+C*h]=_[k]+D*D}}class pe{constructor(o,h){this.requestManager=o,this.localIdeographFontFamily=h,this.entries={}}setURL(o){this.url=o}getGlyphs(o,h){const p=[];for(const _ in o)for(const x of o[_])p.push({stack:_,id:x});l.asyncAll(p,({stack:_,id:x},E)=>{let C=this.entries[_];C||(C=this.entries[_]={glyphs:{},requests:{},ranges:{}});let L=C.glyphs[x];if(L!==void 0)return void E(null,{stack:_,id:x,glyph:L});if(L=this._tinySDF(C,_,x),L)return C.glyphs[x]=L,void E(null,{stack:_,id:x,glyph:L});const k=Math.floor(x/256);if(256*k>65535)return void E(new Error("glyphs > 65535 not supported"));if(C.ranges[k])return void E(null,{stack:_,id:x,glyph:L});let D=C.requests[k];D||(D=C.requests[k]=[],pe.loadGlyphRange(_,k,this.url,this.requestManager,(N,W)=>{if(W){for(const ie in W)this._doesCharSupportLocalGlyph(+ie)||(C.glyphs[+ie]=W[+ie]);C.ranges[k]=!0}for(const ie of D)ie(N,W);delete C.requests[k]})),D.push((N,W)=>{N?E(N):W&&E(null,{stack:_,id:x,glyph:W[x]||null})})},(_,x)=>{if(_)h(_);else if(x){const E={};for(const{stack:C,id:L,glyph:k}of x)(E[C]||(E[C]={}))[L]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};h(null,E)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](o)||l.unicodeBlockLookup["Hangul Syllables"](o)||l.unicodeBlockLookup.Hiragana(o)||l.unicodeBlockLookup.Katakana(o))}_tinySDF(o,h,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let x=o.tinySDF;if(!x){let C="400";/bold/i.test(h)?C="900":/medium/i.test(h)?C="500":/light/i.test(h)&&(C="200"),x=o.tinySDF=new pe.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:C})}const E=x.draw(String.fromCharCode(p));return{id:p,bitmap:new l.AlphaImage({width:E.width||30,height:E.height||30},E.data),metrics:{width:E.glyphWidth||24,height:E.glyphHeight||24,left:E.glyphLeft||0,top:E.glyphTop-27||-8,advance:E.glyphAdvance||24}}}}pe.loadGlyphRange=function(m,o,h,p,_){const x=256*o,E=x+255,C=p.transformRequest(h.replace("{fontstack}",m).replace("{range}",`${x}-${E}`),l.ResourceType.Glyphs);l.getArrayBuffer(C,(L,k)=>{if(L)_(L);else if(k){const D={};for(const N of l.parseGlyphPbf(k))D[N.id]=N;_(null,D)}})},pe.TinySDF=class{constructor({fontSize:m=24,buffer:o=3,radius:h=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:x="normal",fontStyle:E="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=h;const C=this.size=m+4*o,L=this._createCanvas(C),k=this.ctx=L.getContext("2d",{willReadFrequently:!0});k.font=`${E} ${x} ${m}px ${_}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(m){const o=document.createElement("canvas");return o.width=o.height=m,o}draw(m){const{width:o,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:x}=this.ctx.measureText(m),E=Math.ceil(h),C=Math.min(this.size-this.buffer,Math.ceil(x-_)),L=Math.min(this.size-this.buffer,E+Math.ceil(p)),k=C+2*this.buffer,D=L+2*this.buffer,N=Math.max(k*D,0),W=new Uint8ClampedArray(N),ie={data:W,width:k,height:D,glyphWidth:C,glyphHeight:L,glyphTop:E,glyphLeft:0,glyphAdvance:o};if(C===0||L===0)return ie;const{ctx:te,buffer:ne,gridInner:fe,gridOuter:_e}=this;te.clearRect(ne,ne,C,L),te.fillText(m,ne,ne+E);const xe=te.getImageData(ne,ne,C,L);_e.fill(j,0,N),fe.fill(0,0,N);for(let se=0;se<L;se++)for(let Te=0;Te<C;Te++){const we=xe.data[4*(se*C+Te)+3]/255;if(we===0)continue;const Me=(se+ne)*k+Te+ne;if(we===1)_e[Me]=0,fe[Me]=j;else{const ke=.5-we;_e[Me]=ke>0?ke*ke:0,fe[Me]=ke<0?ke*ke:0}}Z(_e,0,0,k,D,k,this.f,this.v,this.z),Z(fe,ne,ne,C,L,k,this.f,this.v,this.z);for(let se=0;se<N;se++){const Te=Math.sqrt(_e[se])-Math.sqrt(fe[se]);W[se]=Math.round(255-255*(Te/this.radius+this.cutoff))}return ie}};const be=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(m,o){return l.sphericalToCartesian(m.expression.evaluate(o))}interpolate(m,o,h){return{x:l.number(m.x,o.x,h),y:l.number(m.y,o.y,h),z:l.number(m.z,o.z,h)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Re="-transition";class Fe extends l.Evented{constructor(o){super(),this._transitionable=new l.Transitionable(be),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(l.validateLight,o,h))for(const p in o){const _=o[p];p.endsWith(Re)?this._transitionable.setTransition(p.slice(0,-Re.length),_):this._transitionable.setValue(p,_)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,o.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class je{constructor(o,h){this.width=o,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,h){const p=o.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,h)),this.dashEntry[p]}getDashRanges(o,h,p){const _=[];let x=o.length%2==1?-o[o.length-1]*p:0,E=o[0]*p,C=!0;_.push({left:x,right:E,isDash:C,zeroLength:o[0]===0});let L=o[0];for(let k=1;k<o.length;k++){C=!C;const D=o[k];x=L*p,L+=D,E=L*p,_.push({left:x,right:E,isDash:C,zeroLength:D===0})}return _}addRoundDash(o,h,p){const _=h/2;for(let x=-p;x<=p;x++){const E=this.width*(this.nextRow+p+x);let C=0,L=o[C];for(let k=0;k<this.width;k++){k/L.right>1&&(L=o[++C]);const D=Math.abs(k-L.left),N=Math.abs(k-L.right),W=Math.min(D,N);let ie;const te=x/p*(_+1);if(L.isDash){const ne=_-Math.abs(te);ie=Math.sqrt(W*W+ne*ne)}else ie=_-Math.sqrt(W*W+te*te);this.data[E+k]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(o){for(let C=o.length-1;C>=0;--C){const L=o[C],k=o[C+1];L.zeroLength?o.splice(C,1):k&&k.isDash===L.isDash&&(k.left=L.left,o.splice(C,1))}const h=o[0],p=o[o.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const _=this.width*this.nextRow;let x=0,E=o[x];for(let C=0;C<this.width;C++){C/E.right>1&&(E=o[++x]);const L=Math.abs(C-E.left),k=Math.abs(C-E.right),D=Math.min(L,k);this.data[_+C]=Math.max(0,Math.min(255,(E.isDash?D:-D)+128))}}addDash(o,h){const p=h?7:0,_=2*p+1;if(this.nextRow+_>this.height)return l.warnOnce("LineAtlas out of space"),null;let x=0;for(let C=0;C<o.length;C++)x+=o[C];if(x!==0){const C=this.width/x,L=this.getDashRanges(o,this.width,C);h?this.addRoundDash(L,C,p):this.addRegularDash(L)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:x};return this.nextRow+=_,this.dirty=!0,E}bind(o){const h=o.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class Ge{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const x=new Ge.Actor(p[_],h,this.id);x.name=`Worker ${_}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,h,p){l.asyncAll(this.actors,(_,x)=>{_.send(o,h,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function pt(m,o,h){const p=function(_,x){if(_)return h(_);if(x){const E=l.pick(l.extend(x,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(C=>C.id)),h(null,E)}};return m.url?l.getJSON(o.transformRequest(m.url,l.ResourceType.Source),p):l.exported.frame(()=>p(null,m))}Ge.Actor=l.Actor;class bt{constructor(o,h,p){this.bounds=l.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*h),_=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*h),x=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*h),E=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*h);return o.x>=p&&o.x<x&&o.y>=_&&o.y<E}}class St extends l.Evented{constructor(o,h,p,_){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(h,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=pt(this._options,this.map._requestManager,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o?this.fire(new l.ErrorEvent(o)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new bt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(o,h){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function x(E,C){return delete o.request,o.aborted?h(null):E&&E.status!==404?h(E):(C&&C.resourceTiming&&(o.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&o.setExpiryData(C),o.loadVectorData(C,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",_,x.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",_,x.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class kt extends l.Evented{constructor(o,h,p,_){super(),this.id=o,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},h),l.extend(this,l.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=pt(this._options,this.map._requestManager,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new l.ErrorEvent(o)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new bt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(_,x,E)=>{if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(_)o.state="errored",h(_);else if(x){this.map._refreshExpiredTiles&&o.setExpiryData(E);const C=this.map.painter.context,L=C.gl;o.texture=this.map.painter.getTileTexture(x.width),o.texture?o.texture.update(x,{useMipmap:!0}):(o.texture=new K(C,x,L.RGBA,{useMipmap:!0}),o.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),C.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax)),o.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h()}unloadTile(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()}hasTransition(){return!1}}let Wn;class xt extends kt{constructor(o,h,p,_){super(o,h,p,_),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(o,h){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(x,E){x&&(o.state="errored",h(x)),E&&(o.dem=E,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded",h(null))}o.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(function(x,E){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(x)o.state="errored",h(x);else if(E){this.map._refreshExpiredTiles&&o.setExpiryData(E),delete E.cacheControl,delete E.expires;const C=l.isImageBitmap(E)&&(Wn==null&&(Wn=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Wn)?E:l.exported.getImageData(E,1),L={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:C,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",L,_.bind(this)))}}).bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)}_getNeighboringTiles(o){const h=o.canonical,p=Math.pow(2,h.z),_=(h.x-1+p)%p,x=h.x===0?o.wrap-1:o.wrap,E=(h.x+1+p)%p,C=h.x+1===p?o.wrap+1:o.wrap,L={};return L[new l.OverscaledTileID(o.overscaledZ,x,h.z,_,h.y).key]={backfilled:!1},L[new l.OverscaledTileID(o.overscaledZ,C,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(L[new l.OverscaledTileID(o.overscaledZ,x,h.z,_,h.y-1).key]={backfilled:!1},L[new l.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},L[new l.OverscaledTileID(o.overscaledZ,C,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<p&&(L[new l.OverscaledTileID(o.overscaledZ,x,h.z,_,h.y+1).key]={backfilled:!1},L[new l.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},L[new l.OverscaledTileID(o.overscaledZ,C,h.z,E,h.y+1).key]={backfilled:!1}),L}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class bi extends l.Evented{constructor(o,h,p,_){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(_),this._data=h.data,this._options=l.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const x=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*x,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*x,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:l.EXTENT,radius:(h.clusterRadius||50)*x,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData("content"),this}getClusterExpansionZoom(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this}getClusterChildren(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this}getClusterLeaves(o,h,p,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:p},_),this}_updateWorkerData(o){const h=l.extend({},this.workerOptions),p=this._data;typeof p=="string"?(h.request=this.map._requestManager.transformRequest(l.exported.resolveURL(p),l.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(p),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(_,x)=>{if(this._pendingLoads--,this._removed||x&&x.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:o}));let E=null;if(x&&x.resourceTiming&&x.resourceTiming[this.id]&&(E=x.resourceTiming[this.id].slice(0)),_)return void this.fire(new l.ErrorEvent(_));const C={dataType:"source",sourceDataType:o};this._collectResourceTiming&&E&&E.length>0&&l.extend(C,{resourceTiming:E}),this.fire(new l.Event("data",C))})}loaded(){return this._pendingLoads===0}loadTile(o,h){const p=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const _={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(p,_,(x,E)=>(delete o.request,o.unloadVectorData(),o.aborted?h(null):x?h(x):(o.loadVectorData(E,this.map.painter,p==="reloadTile"),h(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var nt=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Et extends l.Evented{constructor(o,h,p,_){super(),this.id=o,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=h}load(o,h){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):_&&(this.image=_,o&&(this.coordinates=o),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o;const h=o.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(_){let x=1/0,E=1/0,C=-1/0,L=-1/0;for(const W of _)x=Math.min(x,W.x),E=Math.min(E,W.y),C=Math.max(C,W.x),L=Math.max(L,W.y);const k=Math.max(C-x,L-E),D=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),N=Math.pow(2,D);return new l.CanonicalTileID(D,Math.floor((x+C)/2*N),Math.floor((E+L)/2*N))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new K(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Pt extends Et{constructor(o,h,p,_){super(o,h,p,_),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const o=this.options;this.urls=[];for(const h of o.urls)this.urls.push(this.map._requestManager.transformRequest(h,l.ResourceType.Source).url);l.getVideo(this.urls,(h,p)=>{this._loaded=!0,h?this.fire(new l.ErrorEvent(h)):p&&(this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new K(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class nn extends Et{constructor(o,h,p,_){super(o,h,p,_),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(E=>typeof E!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new K(h,this.canvas,p.RGBA,{premultiply:!0});for(const _ in this.tiles){const x=this.tiles[_];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const rn={vector:St,raster:kt,"raster-dem":xt,geojson:bi,video:Pt,image:Et,canvas:nn};function rr(m,o){const h=l.create();return l.translate(h,h,[1,1,0]),l.scale(h,h,[.5*m.width,.5*m.height,1]),l.multiply(h,h,m.calculatePosMatrix(o.toUnwrapped()))}function ri(m,o,h,p,_,x){const E=function(N,W,ie){if(N)for(const te of N){const ne=W[te];if(ne&&ne.source===ie&&ne.type==="fill-extrusion")return!0}else for(const te in W){const ne=W[te];if(ne.source===ie&&ne.type==="fill-extrusion")return!0}return!1}(_&&_.layers,o,m.id),C=x.maxPitchScaleFactor(),L=m.tilesIn(p,C,E);L.sort(wi);const k=[];for(const N of L)k.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(o,h,m._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,_,x,C,rr(m.transform,N.tileID))});const D=function(N){const W={},ie={};for(const te of N){const ne=te.queryResults,fe=te.wrappedTileID,_e=ie[fe]=ie[fe]||{};for(const xe in ne){const se=ne[xe],Te=_e[xe]=_e[xe]||{},we=W[xe]=W[xe]||[];for(const Me of se)Te[Me.featureIndex]||(Te[Me.featureIndex]=!0,we.push(Me))}}return W}(k);for(const N in D)D[N].forEach(W=>{const ie=W.feature,te=m.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=te});return D}function wi(m,o){const h=m.tileID,p=o.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}class si{constructor(o,h){this.tileID=o,this.uid=l.uniqueId(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const h=o+this.timeAdded;h<l.exported.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.textures.forEach(h=>o.saveTileTexture(h)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(o,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(_,x){const E={};if(!x)return E;for(const C of _){const L=C.layerIds.map(k=>x.getLayer(k)).filter(Boolean);if(L.length!==0){C.layers=L,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(k=>L.filter(D=>D.id===k)[0]));for(const k of L)E[k.id]=C}}return E}(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof l.SymbolBucket&&x.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const x=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(_).queryRadius(x))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(o)}const h=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new K(o,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new K(o,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,h,p,_,x,E,C,L,k,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:D,transform:L,params:C,queryPadding:this.queryPadding*k},o,h,p):{}}querySourceFeatures(o,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),x=h?h.sourceLayer:"",E=_._geojsonTileLayer||_[x];if(!E)return;const C=l.createFilter(h&&h.filter),{z:L,x:k,y:D}=this.tileID.canonical,N={z:L,x:k,y:D};for(let W=0;W<E.length;W++){const ie=E.feature(W);if(C.needGeometry){const fe=l.toEvaluationFeature(ie,!0);if(!C.filter(new l.EvaluationParameters(this.tileID.overscaledZ),fe,this.tileID.canonical))continue}else if(!C.filter(new l.EvaluationParameters(this.tileID.overscaledZ),ie))continue;const te=p.getId(ie,x),ne=new l.GeoJSONFeature(ie,L,k,D,te);ne.tile=N,o.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const p=l.parseCacheControl(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(h)if(this.expirationTime<h)_=!0;else{const x=this.expirationTime-h;x?this.expirationTime=p+Math.max(x,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!h.style.hasLayer(_))continue;const x=this.buckets[_],E=x.layers[0].sourceLayer||"_geojsonTileLayer",C=p[E],L=o[E];if(!C||!L||Object.keys(L).length===0)continue;x.update(L,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=h&&h.style&&h.style.getLayer(_);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=l.exported.now()+o}setDependencies(o,h){const p={};for(const _ of h)p[_]=!0;this.dependencies[o]=p}hasDependency(o,h){for(const p of o){const _=this.dependencies[p];if(_){for(const x of h)if(_[x])return!0}}return!1}}class un{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,p){const _=o.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const x={value:h,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(o,x)},p)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const p=o.wrapped().key,_=h===void 0?0:this.data[p].indexOf(h),x=this.data[p][_];return this.data[p].splice(_,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const p in this.data)for(const _ of this.data[p])o(_.value)||h.push(_);for(const p of h)this.remove(p.value.tileID,p)}}class Ei{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,p){const _=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][_]=this.stateChanges[o][_]||{},l.extend(this.stateChanges[o][_],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const x in this.state[o])x!==_&&(this.deletedStates[o][x]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][_]===null){this.deletedStates[o][_]={};for(const x in this.state[o][_])p[x]||(this.deletedStates[o][_][x]=null)}else for(const x in p)this.deletedStates[o]&&this.deletedStates[o][_]&&this.deletedStates[o][_][x]===null&&delete this.deletedStates[o][_][x]}removeFeatureState(o,h,p){if(this.deletedStates[o]===null)return;const _=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&h!==void 0)this.deletedStates[o][_]!==null&&(this.deletedStates[o][_]=this.deletedStates[o][_]||{},this.deletedStates[o][_][p]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][_])for(p in this.deletedStates[o][_]={},this.stateChanges[o][_])this.deletedStates[o][_][p]=null;else this.deletedStates[o][_]=null;else this.deletedStates[o]=null}getState(o,h){const p=String(h),_=l.extend({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const x=this.deletedStates[o][h];if(x===null)return{};for(const E in x)delete _[E]}return _}initializeTileState(o,h){o.setFeatureState(this.state,h)}coalesceChanges(o,h){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const x={};for(const E in this.stateChanges[_])this.state[_][E]||(this.state[_][E]={}),l.extend(this.state[_][E],this.stateChanges[_][E]),x[E]=this.state[_][E];p[_]=x}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const x={};if(this.deletedStates[_]===null)for(const E in this.state[_])x[E]={},this.state[_][E]={};else for(const E in this.deletedStates[_]){if(this.deletedStates[_][E]===null)this.state[_][E]={};else for(const C of Object.keys(this.deletedStates[_][E]))delete this.state[_][E][C];x[E]=this.state[_][E]}p[_]=p[_]||{},l.extend(p[_],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in o)o[_].setFeatureState(p,h)}}class qt extends l.Evented{constructor(o,h,p){super(),this.id=o,this.dispatcher=p,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,x,E,C){const L=new rn[x.type](_,x,E,C);if(L.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${L.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],L),L}(o,h,p,this),this._tiles={},this._cache=new un(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ei}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,h){return this._source.loadTile(o,h)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new l.Event("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(On).map(o=>o.key)}getRenderableIds(o){const h=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&h.push(this._tiles[p]);return o?h.sort((p,_)=>{const x=p.tileID,E=_.tileID,C=new l.pointGeometry(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),L=new l.pointGeometry(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-E.overscaledZ||L.y-C.y||L.x-C.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(On).map(p=>p.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,h){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=h),this._loadTile(p,this._tileLoaded.bind(this,p,o,h)))}_tileLoaded(o,h,p,_){if(_)return o.state="errored",void(_.status!==404?this._source.fire(new l.ErrorEvent(_,{tile:o})):this.update(this.transform,this.terrain));o.timeAdded=l.exported.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const h=this.getRenderableIds();for(let _=0;_<h.length;_++){const x=h[_];if(o.neighboringTiles&&o.neighboringTiles[x]){const E=this.getTileByID(x);p(o,E),p(E,o)}}function p(_,x){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let E=x.tileID.canonical.x-_.tileID.canonical.x;const C=x.tileID.canonical.y-_.tileID.canonical.y,L=Math.pow(2,_.tileID.canonical.z),k=x.tileID.key;E===0&&C===0||Math.abs(C)>1||(Math.abs(E)>1&&(Math.abs(E+L)===1?E+=L:Math.abs(E-L)===1&&(E-=L)),x.dem&&_.dem&&(_.dem.backfillBorder(x.dem,E,C),_.neighboringTiles&&_.neighboringTiles[k]&&(_.neighboringTiles[k].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,p,_){for(const x in this._tiles){let E=this._tiles[x];if(_[x]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>p)continue;let C=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const k=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[k.key],E&&E.hasData()&&(C=k)}let L=C;for(;L.overscaledZ>h;)if(L=L.scaledTo(L.overscaledZ-1),o[L.key]){_[C.key]=C;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=o.overscaledZ-1;p>=h;p--){const _=o.scaledTo(p),x=this._getLoadedTile(_);if(x)return x}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const h=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,_=Math.floor(h*p*5),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const p={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+h),p[x.tileID.key]=x}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(o,h){if(this.transform=o,this.terrain=h,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new l.OverscaledTileID(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(p=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(k=>this._source.hasTile(k)))):p=[];const _=o.coveringZoomLevel(this._source),x=Math.max(_-qt.maxOverzooming,this._source.minzoom),E=Math.max(_+qt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const D of p)if(D.canonical.z>this._source.minzoom){const N=D.scaledTo(D.canonical.z-1);k[N.key]=N;const W=D.scaledTo(Math.max(this._source.minzoom,Math.min(D.canonical.z,5)));k[W.key]=W}p=p.concat(Object.values(k))}const C=this._updateRetainedTiles(p,_);if(ss(this._source.type)){const k={},D={},N=Object.keys(C);for(const W of N){const ie=C[W],te=this._tiles[W];if(!te||te.fadeEndTime&&te.fadeEndTime<=l.exported.now())continue;const ne=this.findLoadedParent(ie,x);ne&&(this._addTile(ne.tileID),k[ne.tileID.key]=ne.tileID),D[W]=ie}this._retainLoadedChildren(D,_,E,C);for(const W in k)C[W]||(this._coveredTiles[W]=!0,C[W]=k[W]);if(h){const W={},ie={};for(const te of p)this._tiles[te.key].hasData()?W[te.key]=te:ie[te.key]=te;for(const te in ie){const ne=ie[te].children(this._source.maxzoom);this._tiles[ne[0].key]&&this._tiles[ne[1].key]&&this._tiles[ne[2].key]&&this._tiles[ne[3].key]&&(W[ne[0].key]=C[ne[0].key]=ne[0],W[ne[1].key]=C[ne[1].key]=ne[1],W[ne[2].key]=C[ne[2].key]=ne[2],W[ne[3].key]=C[ne[3].key]=ne[3],delete ie[te])}for(const te in ie){const ne=this.findLoadedParent(ie[te],this._source.minzoom);if(ne){W[ne.tileID.key]=C[ne.tileID.key]=ne.tileID;for(const fe in W)W[fe].isChildOf(ne.tileID)&&delete W[fe]}}for(const te in this._tiles)W[te]||(this._coveredTiles[te]=!0)}}for(const k in C)this._tiles[k].clearFadeHold();const L=l.keysDifference(this._tiles,C);for(const k of L){const D=this._tiles[k];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,h){const p={},_={},x=Math.max(h-qt.maxOverzooming,this._source.minzoom),E=Math.max(h+qt.maxUnderzooming,this._source.minzoom),C={};for(const L of o){const k=this._addTile(L);p[L.key]=L,k.hasData()||h<this._source.maxzoom&&(C[L.key]=L)}this._retainLoadedChildren(C,h,E,p);for(const L of o){let k=this._tiles[L.key];if(k.hasData())continue;if(h+1>this._source.maxzoom){const N=L.children(this._source.maxzoom)[0],W=this.getTile(N);if(W&&W.hasData()){p[N.key]=N;continue}}else{const N=L.children(this._source.maxzoom);if(p[N[0].key]&&p[N[1].key]&&p[N[2].key]&&p[N[3].key])continue}let D=k.wasRequested();for(let N=L.overscaledZ-1;N>=x;--N){const W=L.scaledTo(N);if(_[W.key]||(_[W.key]=!0,k=this.getTile(W),!k&&D&&(k=this._addTile(W)),k&&(p[W.key]=W,D=k.wasRequested(),k.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let p,_=this._tiles[o].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}h.push(_.key);const x=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;_=x}for(const x of h)this._loadedParentTiles[x]=p}}_addTile(o){let h=this._tiles[o.key];if(h)return h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const p=h;return h||(h=new si(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h.uses++,this._tiles[o.key]=h,p||this._source.fire(new l.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=h.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,h,p){const _=[],x=this.transform;if(!x)return _;const E=p?x.getCameraQueryGeometry(o):o,C=o.map(te=>x.pointCoordinate(te,this.terrain)),L=E.map(te=>x.pointCoordinate(te,this.terrain)),k=this.getIds();let D=1/0,N=1/0,W=-1/0,ie=-1/0;for(const te of L)D=Math.min(D,te.x),N=Math.min(N,te.y),W=Math.max(W,te.x),ie=Math.max(ie,te.y);for(let te=0;te<k.length;te++){const ne=this._tiles[k[te]];if(ne.holdingForFade())continue;const fe=ne.tileID,_e=Math.pow(2,x.zoom-ne.tileID.overscaledZ),xe=h*ne.queryPadding*l.EXTENT/ne.tileSize/_e,se=[fe.getTilePoint(new l.MercatorCoordinate(D,N)),fe.getTilePoint(new l.MercatorCoordinate(W,ie))];if(se[0].x-xe<l.EXTENT&&se[0].y-xe<l.EXTENT&&se[1].x+xe>=0&&se[1].y+xe>=0){const Te=C.map(Me=>fe.getTilePoint(Me)),we=L.map(Me=>fe.getTilePoint(Me));_.push({tile:ne,tileID:fe,queryGeometry:Te,cameraQueryGeometry:we,scale:_e})}}return _}getVisibleCoordinates(o){const h=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(ss(this._source.type))for(const o in this._tiles){const h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(o,h,p){this._state.updateState(o=o||"_geojsonTileLayer",h,p)}removeFeatureState(o,h,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,p)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,p){const _=this._tiles[o];_&&_.setDependencies(h,p)}reloadTilesForDependencies(o,h){for(const p in this._tiles)this._tiles[p].hasDependency(o,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,h))}}function On(m,o){const h=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return m.overscaledZ-o.overscaledZ||p-h||o.canonical.y-m.canonical.y||o.canonical.x-m.canonical.x}function ss(m){return m==="raster"||m==="image"||m==="video"}qt.maxOverzooming=10,qt.maxUnderzooming=3;const ki="mapboxgl_preloaded_worker_pool";class Kn{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Kn.workerCount;)this.workers.push(new Worker(Po.workerUrl));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ki]}numActive(){return Object.keys(this.active).length}}const Rr=Math.floor(l.exported.hardwareConcurrency/2);let Gi;function fi(){return Gi||(Gi=new Kn),Gi}function Wi(m,o){const h={};for(const p in m)p!=="ref"&&(h[p]=m[p]);return l.refProperties.forEach(p=>{p in o&&(h[p]=o[p])}),h}function $s(m){m=m.slice();const o=Object.create(null);for(let h=0;h<m.length;h++)o[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=Wi(m[h],o[m[h].ref]));return m}Kn.workerCount=Math.max(Math.min(Rr,6),1);const Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ri(m,o,h){h.push({command:Gt.addSource,args:[m,o[m]]})}function Fn(m,o,h){o.push({command:Gt.removeSource,args:[m]}),h[m]=!0}function os(m,o,h,p){Fn(m,h,p),Ri(m,o,h)}function bo(m,o,h){let p;for(p in m[h])if(Object.prototype.hasOwnProperty.call(m[h],p)&&p!=="data"&&!I(m[h][p],o[h][p]))return!1;for(p in o[h])if(Object.prototype.hasOwnProperty.call(o[h],p)&&p!=="data"&&!I(m[h][p],o[h][p]))return!1;return!0}function zr(m,o,h,p,_,x){let E;for(E in o=o||{},m=m||{})Object.prototype.hasOwnProperty.call(m,E)&&(I(m[E],o[E])||h.push({command:x,args:[p,E,o[E],_]}));for(E in o)Object.prototype.hasOwnProperty.call(o,E)&&!Object.prototype.hasOwnProperty.call(m,E)&&(I(m[E],o[E])||h.push({command:x,args:[p,E,o[E],_]}))}function Dr(m){return m.id}function Hs(m,o){return m[o.id]=o,m}class xr{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=l.clamp(o,0,1);let h=1,p=this._distances[h];const _=o*this.paddedLength+this.padding;for(;p<_&&h<this._distances.length;)p=this._distances[++h];const x=h-1,E=this._distances[x],C=p-E,L=C>0?(_-E)/C:0;return this.points[x].mult(1-L).add(this.points[h].mult(L))}}function Le(m,o){let h=!0;return m==="always"||m!=="never"&&o!=="never"||(h=!1),h}class qe{constructor(o,h,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(h/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,p,_,x){this._forEachCell(h,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(o,h,p,_){this._forEachCell(h-_,p-_,h+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(p),this.circles.push(_)}_insertBoxCell(o,h,p,_,x,E){this.boxCells[x].push(E)}_insertCircleCell(o,h,p,_,x,E){this.circleCells[x].push(E)}_query(o,h,p,_,x,E,C){if(p<0||o>this.width||_<0||h>this.height)return[];const L=[];if(o<=0&&h<=0&&this.width<=p&&this.height<=_){if(x)return[{key:null,x1:o,y1:h,x2:p,y2:_}];for(let k=0;k<this.boxKeys.length;k++)L.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const D=this.circles[3*k],N=this.circles[3*k+1],W=this.circles[3*k+2];L.push({key:this.circleKeys[k],x1:D-W,y1:N-W,x2:D+W,y2:N+W})}}else this._forEachCell(o,h,p,_,this._queryCell,L,{hitTest:x,overlapMode:E,seenUids:{box:{},circle:{}}},C);return L}query(o,h,p,_){return this._query(o,h,p,_,!1,null)}hitTest(o,h,p,_,x,E){return this._query(o,h,p,_,!0,x,E).length>0}hitTestCircle(o,h,p,_,x){const E=o-p,C=o+p,L=h-p,k=h+p;if(C<0||E>this.width||k<0||L>this.height)return!1;const D=[];return this._forEachCell(E,L,C,k,this._queryCellCircle,D,{hitTest:!0,overlapMode:_,circle:{x:o,y:h,radius:p},seenUids:{box:{},circle:{}}},x),D.length>0}_queryCell(o,h,p,_,x,E,C,L){const{seenUids:k,hitTest:D,overlapMode:N}=C,W=this.boxCells[x];if(W!==null){const te=this.bboxes;for(const ne of W)if(!k.box[ne]){k.box[ne]=!0;const fe=4*ne,_e=this.boxKeys[ne];if(o<=te[fe+2]&&h<=te[fe+3]&&p>=te[fe+0]&&_>=te[fe+1]&&(!L||L(_e))&&(!D||!Le(N,_e.overlapMode))&&(E.push({key:_e,x1:te[fe],y1:te[fe+1],x2:te[fe+2],y2:te[fe+3]}),D))return!0}}const ie=this.circleCells[x];if(ie!==null){const te=this.circles;for(const ne of ie)if(!k.circle[ne]){k.circle[ne]=!0;const fe=3*ne,_e=this.circleKeys[ne];if(this._circleAndRectCollide(te[fe],te[fe+1],te[fe+2],o,h,p,_)&&(!L||L(_e))&&(!D||!Le(N,_e.overlapMode))){const xe=te[fe],se=te[fe+1],Te=te[fe+2];if(E.push({key:_e,x1:xe-Te,y1:se-Te,x2:xe+Te,y2:se+Te}),D)return!0}}}return!1}_queryCellCircle(o,h,p,_,x,E,C,L){const{circle:k,seenUids:D,overlapMode:N}=C,W=this.boxCells[x];if(W!==null){const te=this.bboxes;for(const ne of W)if(!D.box[ne]){D.box[ne]=!0;const fe=4*ne,_e=this.boxKeys[ne];if(this._circleAndRectCollide(k.x,k.y,k.radius,te[fe+0],te[fe+1],te[fe+2],te[fe+3])&&(!L||L(_e))&&!Le(N,_e.overlapMode))return E.push(!0),!0}}const ie=this.circleCells[x];if(ie!==null){const te=this.circles;for(const ne of ie)if(!D.circle[ne]){D.circle[ne]=!0;const fe=3*ne,_e=this.circleKeys[ne];if(this._circlesCollide(te[fe],te[fe+1],te[fe+2],k.x,k.y,k.radius)&&(!L||L(_e))&&!Le(N,_e.overlapMode))return E.push(!0),!0}}}_forEachCell(o,h,p,_,x,E,C,L){const k=this._convertToXCellCoord(o),D=this._convertToYCellCoord(h),N=this._convertToXCellCoord(p),W=this._convertToYCellCoord(_);for(let ie=k;ie<=N;ie++)for(let te=D;te<=W;te++)if(x.call(this,o,h,p,_,this.xCellCount*te+ie,E,C,L))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,p,_,x,E){const C=_-o,L=x-h,k=p+E;return k*k>C*C+L*L}_circleAndRectCollide(o,h,p,_,x,E,C){const L=(E-_)/2,k=Math.abs(o-(_+L));if(k>L+p)return!1;const D=(C-x)/2,N=Math.abs(h-(x+D));if(N>D+p)return!1;if(k<=L||N<=D)return!0;const W=k-L,ie=N-D;return W*W+ie*ie<=p*p}}function as(m,o,h,p,_){const x=l.create();return o?(l.scale(x,x,[1/_,1/_,1]),h||l.rotateZ(x,x,p.angle)):l.multiply(x,p.labelPlaneMatrix,m),x}function Ti(m,o,h,p,_){if(o){const x=l.clone(m);return l.scale(x,x,[_,_,1]),h||l.rotateZ(x,x,-p.angle),x}return p.glCoordMatrix}function Ut(m,o,h){let p;h?(p=[m.x,m.y,h(m.x,m.y),1],l.transformMat4(p,p,o)):(p=[m.x,m.y,0,1],sr(p,p,o));const _=p[3];return{point:new l.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function $i(m,o){return .5+m/o*.5}function zi(m,o){const h=m[0]/m[3],p=m[1]/m[3];return h>=-o[0]&&h<=o[0]&&p>=-o[1]&&p<=o[1]}function Di(m,o,h,p,_,x,E,C,L,k){const D=p?m.textSizeData:m.iconSizeData,N=l.evaluateSizeForZoom(D,h.transform.zoom),W=[256/h.width*2+1,256/h.height*2+1],ie=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ie.clear();const te=m.lineVertexArray,ne=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,fe=h.transform.width/h.transform.height;let _e=!1;for(let xe=0;xe<ne.length;xe++){const se=ne.get(xe);if(se.hidden||se.writingMode===l.WritingMode.vertical&&!_e){Ct(se.numGlyphs,ie);continue}let Te;if(_e=!1,k?(Te=[se.anchorX,se.anchorY,k(se.anchorX,se.anchorY),1],l.transformMat4(Te,Te,o)):(Te=[se.anchorX,se.anchorY,0,1],sr(Te,Te,o)),!zi(Te,W)){Ct(se.numGlyphs,ie);continue}const we=$i(h.transform.cameraToCenterDistance,Te[3]),Me=l.evaluateSizeForFeature(D,N,se),ke=E?Me/we:Me*we,Ne=new l.pointGeometry(se.anchorX,se.anchorY),Ie=Ut(Ne,_,k).point,tt={},Ze=Lt(se,ke,!1,C,o,_,x,m.glyphOffsetArray,te,ie,Ie,Ne,tt,fe,L,k);_e=Ze.useVertical,(Ze.notEnoughRoom||_e||Ze.needsFlipping&&Lt(se,ke,!0,C,o,_,x,m.glyphOffsetArray,te,ie,Ie,Ne,tt,fe,L,k).notEnoughRoom)&&Ct(se.numGlyphs,ie)}p?m.text.dynamicLayoutVertexBuffer.updateData(ie):m.icon.dynamicLayoutVertexBuffer.updateData(ie)}function ls(m,o,h,p,_,x,E,C,L,k,D,N,W){const ie=C.glyphStartIndex+C.numGlyphs,te=C.lineStartIndex,ne=C.lineStartIndex+C.lineLength,fe=o.getoffsetX(C.glyphStartIndex),_e=o.getoffsetX(ie-1),xe=Jn(m*fe,h,p,_,x,E,C.segment,te,ne,L,k,D,N,W);if(!xe)return null;const se=Jn(m*_e,h,p,_,x,E,C.segment,te,ne,L,k,D,N,W);return se?{first:xe,last:se}:null}function He(m,o,h,p){return m===l.WritingMode.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*p?{useVertical:!0}:(m===l.WritingMode.vertical?o.y<h.y:o.x>h.x)?{needsFlipping:!0}:null}function Lt(m,o,h,p,_,x,E,C,L,k,D,N,W,ie,te,ne){const fe=o/24,_e=m.lineOffsetX*fe,xe=m.lineOffsetY*fe;let se;if(m.numGlyphs>1){const Te=m.glyphStartIndex+m.numGlyphs,we=m.lineStartIndex,Me=m.lineStartIndex+m.lineLength,ke=ls(fe,C,_e,xe,h,D,N,m,L,x,W,te,ne);if(!ke)return{notEnoughRoom:!0};const Ne=Ut(ke.first.point,E,ne).point,Ie=Ut(ke.last.point,E,ne).point;if(p&&!h){const tt=He(m.writingMode,Ne,Ie,ie);if(tt)return tt}se=[ke.first];for(let tt=m.glyphStartIndex+1;tt<Te-1;tt++)se.push(Jn(fe*C.getoffsetX(tt),_e,xe,h,D,N,m.segment,we,Me,L,x,W,te,ne));se.push(ke.last)}else{if(p&&!h){const we=Ut(N,_,ne).point,Me=m.lineStartIndex+m.segment+1,ke=new l.pointGeometry(L.getx(Me),L.gety(Me)),Ne=Ut(ke,_,ne),Ie=Ne.signedDistanceFromCamera>0?Ne.point:It(N,ke,we,1,_,ne),tt=He(m.writingMode,we,Ie,ie);if(tt)return tt}const Te=Jn(fe*C.getoffsetX(m.glyphStartIndex),_e,xe,h,D,N,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,L,x,W,te,ne);if(!Te)return{notEnoughRoom:!0};se=[Te]}for(const Te of se)l.addDynamicAttributes(k,Te.point,Te.angle);return{}}function It(m,o,h,p,_,x){const E=Ut(m.add(m.sub(o)._unit()),_,x).point,C=h.sub(E);return h.add(C._mult(p/C.mag()))}function Jn(m,o,h,p,_,x,E,C,L,k,D,N,W,ie){const te=p?m-o:m+o;let ne=te>0?1:-1,fe=0;p&&(ne*=-1,fe=Math.PI),ne<0&&(fe+=Math.PI);let _e=ne>0?C+E:C+E+1,xe=_,se=_,Te=0,we=0;const Me=Math.abs(te),ke=[];for(;Te+we<=Me;){if(_e+=ne,_e<C||_e>=L)return null;if(se=xe,ke.push(xe),xe=N[_e],xe===void 0){const it=new l.pointGeometry(k.getx(_e),k.gety(_e)),Mt=Ut(it,D,ie);if(Mt.signedDistanceFromCamera>0)xe=N[_e]=Mt.point;else{const Dt=_e-ne;xe=It(Te===0?x:new l.pointGeometry(k.getx(Dt),k.gety(Dt)),it,se,Me-Te+1,D,ie)}}Te+=we,we=se.dist(xe)}const Ne=(Me-Te)/we,Ie=xe.sub(se),tt=Ie.mult(Ne)._add(se);tt._add(Ie._unit()._perp()._mult(h*ne));const Ze=fe+Math.atan2(xe.y-se.y,xe.x-se.x);return ke.push(tt),{point:tt,angle:W?Ze:0,path:ke}}const Or=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ct(m,o){for(let h=0;h<m;h++){const p=o.length;o.resize(p+4),o.float32.set(Or,3*p)}}function sr(m,o,h){const p=o[0],_=o[1];return m[0]=h[0]*p+h[4]*_+h[12],m[1]=h[1]*p+h[5]*_+h[13],m[3]=h[3]*p+h[7]*_+h[15],m}const $n=100;class qs{constructor(o,h=new qe(o.width+200,o.height+200,25),p=new qe(o.width+200,o.height+200,25)){this.transform=o,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+$n,this.screenBottomBoundary=o.height+$n,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,h,p,_,x,E){const C=this.projectAndGetPerspectiveRatio(_,o.anchorPointX,o.anchorPointY,E),L=p*C.perspectiveRatio,k=o.x1*L+C.point.x,D=o.y1*L+C.point.y,N=o.x2*L+C.point.x,W=o.y2*L+C.point.y;return!this.isInsideGrid(k,D,N,W)||h!=="always"&&this.grid.hitTest(k,D,N,W,h,x)||C.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[k,D,N,W],offscreen:this.isOffscreen(k,D,N,W)}}placeCollisionCircles(o,h,p,_,x,E,C,L,k,D,N,W,ie,te){const ne=[],fe=new l.pointGeometry(h.anchorX,h.anchorY),_e=Ut(fe,E,te),xe=$i(this.transform.cameraToCenterDistance,_e.signedDistanceFromCamera),se=(D?x/xe:x*xe)/l.ONE_EM,Te=Ut(fe,C,te).point,we=ls(se,_,h.lineOffsetX*se,h.lineOffsetY*se,!1,Te,fe,h,p,C,{},!1,te);let Me=!1,ke=!1,Ne=!0;if(we){const Ie=.5*W*xe+ie,tt=new l.pointGeometry(-100,-100),Ze=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),it=new xr,Mt=we.first,Dt=we.last;let _t=[];for(let $t=Mt.path.length-1;$t>=1;$t--)_t.push(Mt.path[$t]);for(let $t=1;$t<Dt.path.length;$t++)_t.push(Dt.path[$t]);const sn=2.5*Ie;if(L){const $t=_t.map(Ht=>Ut(Ht,L,te));_t=$t.some(Ht=>Ht.signedDistanceFromCamera<=0)?[]:$t.map(Ht=>Ht.point)}let on=[];if(_t.length>0){const $t=_t[0].clone(),Ht=_t[0].clone();for(let ln=1;ln<_t.length;ln++)$t.x=Math.min($t.x,_t[ln].x),$t.y=Math.min($t.y,_t[ln].y),Ht.x=Math.max(Ht.x,_t[ln].x),Ht.y=Math.max(Ht.y,_t[ln].y);on=$t.x>=tt.x&&Ht.x<=Ze.x&&$t.y>=tt.y&&Ht.y<=Ze.y?[_t]:Ht.x<tt.x||$t.x>Ze.x||Ht.y<tt.y||$t.y>Ze.y?[]:l.clipLine([_t],tt.x,tt.y,Ze.x,Ze.y)}for(const $t of on){it.reset($t,.25*Ie);let Ht=0;Ht=it.length<=.5*Ie?1:Math.ceil(it.paddedLength/sn)+1;for(let ln=0;ln<Ht;ln++){const ai=ln/Math.max(Ht-1,1),ds=it.lerp(ai),Ur=ds.x+$n,fs=ds.y+$n;ne.push(Ur,fs,Ie,0);const io=Ur-Ie,Tr=fs-Ie,qi=Ur+Ie,Ls=fs+Ie;if(Ne=Ne&&this.isOffscreen(io,Tr,qi,Ls),ke=ke||this.isInsideGrid(io,Tr,qi,Ls),o!=="always"&&this.grid.hitTestCircle(Ur,fs,Ie,o,N)&&(Me=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Me}}}}return{circles:!k&&Me||!ke||xe<this.perspectiveRatioCutoff?[]:ne,offscreen:Ne,collisionDetected:Me}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,_=1/0,x=-1/0,E=-1/0;for(const D of o){const N=new l.pointGeometry(D.x+$n,D.y+$n);p=Math.min(p,N.x),_=Math.min(_,N.y),x=Math.max(x,N.x),E=Math.max(E,N.y),h.push(N)}const C=this.grid.query(p,_,x,E).concat(this.ignoredGrid.query(p,_,x,E)),L={},k={};for(const D of C){const N=D.key;if(L[N.bucketInstanceId]===void 0&&(L[N.bucketInstanceId]={}),L[N.bucketInstanceId][N.featureIndex])continue;const W=[new l.pointGeometry(D.x1,D.y1),new l.pointGeometry(D.x2,D.y1),new l.pointGeometry(D.x2,D.y2),new l.pointGeometry(D.x1,D.y2)];l.polygonIntersectsPolygon(h,W)&&(L[N.bucketInstanceId][N.featureIndex]=!0,k[N.bucketInstanceId]===void 0&&(k[N.bucketInstanceId]=[]),k[N.bucketInstanceId].push(N.featureIndex))}return k}insertCollisionBox(o,h,p,_,x,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:E,overlapMode:h},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,p,_,x,E){const C=p?this.ignoredGrid:this.grid,L={bucketInstanceId:_,featureIndex:x,collisionGroupID:E,overlapMode:h};for(let k=0;k<o.length;k+=4)C.insertCircle(L,o[k],o[k+1],o[k+2])}projectAndGetPerspectiveRatio(o,h,p,_){let x;return _?(x=[h,p,_(h,p),1],l.transformMat4(x,x,o)):(x=[h,p,0,1],sr(x,x,o)),{point:new l.pointGeometry((x[0]/x[3]+1)/2*this.transform.width+$n,(-x[1]/x[3]+1)/2*this.transform.height+$n),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(o,h,p,_){return p<$n||o>=this.screenRightBoundary||_<$n||h>this.screenBottomBoundary}isInsideGrid(o,h,p,_){return p>=0&&o<this.gridRightBoundary&&_>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=l.identity([]);return l.translate(o,o,[-100,-100,0]),o}}function Mn(m,o,h){return o*(l.EXTENT/(m.tileSize*Math.pow(2,h-m.tileID.overscaledZ)))}class oi{constructor(o,h,p,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class en{constructor(o,h,p,_,x){this.text=new oi(o?o.text:null,h,p,x),this.icon=new oi(o?o.icon:null,h,_,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Zs{constructor(o,h,p){this.text=o,this.icon=h,this.skipFade=p}}class br{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class wr{constructor(o,h,p,_,x){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class As{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[o]}}function Xs(m,o,h,p,_){const{horizontalAlign:x,verticalAlign:E}=l.getAnchorAlignment(m),C=-(x-.5)*o,L=-(E-.5)*h,k=l.evaluateVariableOffset(m,p);return new l.pointGeometry(C+k[0]*_,L+k[1]*_)}function cs(m,o,h,p,_,x){const{x1:E,x2:C,y1:L,y2:k,anchorPointX:D,anchorPointY:N}=m,W=new l.pointGeometry(o,h);return p&&W._rotate(_?x:-x),{x1:E+W.x,y1:L+W.y,x2:C+W.x,y2:k+W.y,anchorPointX:D,anchorPointY:N}}class ee{constructor(o,h,p,_,x){this.transform=o.clone(),this.terrain=h,this.collisionIndex=new qs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new As(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,p,_){const x=p.getBucket(h),E=p.latestFeatureIndex;if(!x||!E||h.id!==x.layerIds[0])return;const C=p.collisionBoxArray,L=x.layers[0].layout,k=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),D=p.tileSize/l.EXTENT,N=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),W=L.get("text-pitch-alignment")==="map",ie=L.get("text-rotation-alignment")==="map",te=Mn(p,1,this.transform.zoom),ne=as(N,W,ie,this.transform,te);let fe=null;if(W){const xe=Ti(N,W,ie,this.transform,te);fe=l.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[x.bucketInstanceId]=new wr(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,p.tileID);const _e={bucket:x,layout:L,posMatrix:N,textLabelPlaneMatrix:ne,labelToScreenMatrix:fe,scale:k,textPixelRatio:D,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(_)for(const xe of x.sortKeyRanges){const{sortKey:se,symbolInstanceStart:Te,symbolInstanceEnd:we}=xe;o.push({sortKey:se,symbolInstanceStart:Te,symbolInstanceEnd:we,parameters:_e})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:_e})}attemptAnchorPlacement(o,h,p,_,x,E,C,L,k,D,N,W,ie,te,ne,fe){const _e=[W.textOffset0,W.textOffset1],xe=Xs(o,p,_,_e,x),se=this.collisionIndex.placeCollisionBox(cs(h,xe.x,xe.y,E,C,this.transform.angle),N,L,k,D.predicate,fe);if((!ne||this.collisionIndex.placeCollisionBox(cs(ne,xe.x,xe.y,E,C,this.transform.angle),N,L,k,D.predicate,fe).box.length!==0)&&se.box.length>0){let Te;if(this.prevPlacement&&this.prevPlacement.variableOffsets[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[W.crossTileID].anchor),W.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[W.crossTileID]={textOffset:_e,width:p,height:_,anchor:o,textBoxScale:x,prevAnchor:Te},this.markUsedJustification(ie,o,W,te),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,te,W),this.placedOrientations[W.crossTileID]=te),{shift:xe,placedGlyphBoxes:se}}}placeLayerBucketPart(o,h,p){const{bucket:_,layout:x,posMatrix:E,textLabelPlaneMatrix:C,labelToScreenMatrix:L,textPixelRatio:k,holdingForFade:D,collisionBoxArray:N,partiallyEvaluatedTextSize:W,collisionGroup:ie}=o.parameters,te=x.get("text-optional"),ne=x.get("icon-optional"),fe=l.getOverlapMode(x,"text-overlap","text-allow-overlap"),_e=fe==="always",xe=l.getOverlapMode(x,"icon-overlap","icon-allow-overlap"),se=xe==="always",Te=x.get("text-rotation-alignment")==="map",we=x.get("text-pitch-alignment")==="map",Me=x.get("icon-text-fit")!=="none",ke=x.get("symbol-z-order")==="viewport-y",Ne=_e&&(se||!_.hasIconData()||ne),Ie=se&&(_e||!_.hasTextData()||te);!_.collisionArrays&&N&&_.deserializeCollisionBoxes(N);const tt=(Ze,it)=>{if(h[Ze.crossTileID])return;if(D)return void(this.placements[Ze.crossTileID]=new Zs(!1,!1,!1));let Mt=!1,Dt=!1,_t=!0,sn=null,on={box:null,offscreen:null},$t={box:null,offscreen:null},Ht=null,ln=null,ai=null,ds=0,Ur=0,fs=0;it.textFeatureIndex?ds=it.textFeatureIndex:Ze.useRuntimeCollisionCircles&&(ds=Ze.featureIndex),it.verticalTextFeatureIndex&&(Ur=it.verticalTextFeatureIndex);const io=this.retainedQueryData[_.bucketInstanceId].tileID,Tr=this.terrain?(ei,Nt)=>this.terrain.getElevation(io,ei,Nt):null;for(const ei of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Nt=it[ei];Nt&&(Nt.elevation=Tr?Tr(Nt.anchorPointX,Nt.anchorPointY):0)}const qi=it.textBox;if(qi){const ei=tn=>{let li=l.WritingMode.horizontal;if(_.allowVerticalPlacement&&!tn&&this.prevPlacement){const ci=this.prevPlacement.placedOrientations[Ze.crossTileID];ci&&(this.placedOrientations[Ze.crossTileID]=ci,li=ci,this.markUsedOrientation(_,li,Ze))}return li},Nt=(tn,li)=>{if(_.allowVerticalPlacement&&Ze.numVerticalGlyphVertices>0&&it.verticalTextBox){for(const ci of _.writingModes)if(ci===l.WritingMode.vertical?(on=li(),$t=on):on=tn(),on&&on.box&&on.box.length)break}else on=tn()};if(x.get("text-variable-anchor")){let tn=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ze.crossTileID]){const bn=this.prevPlacement.variableOffsets[Ze.crossTileID];tn.indexOf(bn.anchor)>0&&(tn=tn.filter(Sr=>Sr!==bn.anchor),tn.unshift(bn.anchor))}const li=(bn,Sr,Co)=>{const sh=bn.x2-bn.x1,_a=bn.y2-bn.y1,Mf=Ze.textBoxScale,oh=Me&&xe==="never"?Sr:null;let ro={box:[],offscreen:!1};const Io=fe!=="never"?2*tn.length:tn.length;for(let Lo=0;Lo<Io;++Lo){const yc=this.attemptAnchorPlacement(tn[Lo%tn.length],bn,sh,_a,Mf,Te,we,k,E,ie,Lo>=tn.length?fe:"never",Ze,_,Co,oh,Tr);if(yc&&(ro=yc.placedGlyphBoxes,ro&&ro.box&&ro.box.length)){Mt=!0,sn=yc.shift;break}}return ro};Nt(()=>li(qi,it.iconBox,l.WritingMode.horizontal),()=>{const bn=it.verticalTextBox;return _.allowVerticalPlacement&&!(on&&on.box&&on.box.length)&&Ze.numVerticalGlyphVertices>0&&bn?li(bn,it.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),on&&(Mt=on.box,_t=on.offscreen);const ci=ei(on&&on.box);if(!Mt&&this.prevPlacement){const bn=this.prevPlacement.variableOffsets[Ze.crossTileID];bn&&(this.variableOffsets[Ze.crossTileID]=bn,this.markUsedJustification(_,bn.anchor,Ze,ci))}}else{const tn=(li,ci)=>{const bn=this.collisionIndex.placeCollisionBox(li,fe,k,E,ie.predicate,Tr);return bn&&bn.box&&bn.box.length&&(this.markUsedOrientation(_,ci,Ze),this.placedOrientations[Ze.crossTileID]=ci),bn};Nt(()=>tn(qi,l.WritingMode.horizontal),()=>{const li=it.verticalTextBox;return _.allowVerticalPlacement&&Ze.numVerticalGlyphVertices>0&&li?tn(li,l.WritingMode.vertical):{box:null,offscreen:null}}),ei(on&&on.box&&on.box.length)}}if(Ht=on,Mt=Ht&&Ht.box&&Ht.box.length>0,_t=Ht&&Ht.offscreen,Ze.useRuntimeCollisionCircles){const ei=_.text.placedSymbolArray.get(Ze.centerJustifiedTextSymbolIndex),Nt=l.evaluateSizeForFeature(_.textSizeData,W,ei),tn=x.get("text-padding");ln=this.collisionIndex.placeCollisionCircles(fe,ei,_.lineVertexArray,_.glyphOffsetArray,Nt,E,C,L,p,we,ie.predicate,Ze.collisionCircleDiameter,tn,Tr),ln.circles.length&&ln.collisionDetected&&!p&&l.warnOnce("Collisions detected, but collision boxes are not shown"),Mt=_e||ln.circles.length>0&&!ln.collisionDetected,_t=_t&&ln.offscreen}if(it.iconFeatureIndex&&(fs=it.iconFeatureIndex),it.iconBox){const ei=Nt=>{const tn=Me&&sn?cs(Nt,sn.x,sn.y,Te,we,this.transform.angle):Nt;return this.collisionIndex.placeCollisionBox(tn,xe,k,E,ie.predicate,Tr)};$t&&$t.box&&$t.box.length&&it.verticalIconBox?(ai=ei(it.verticalIconBox),Dt=ai.box.length>0):(ai=ei(it.iconBox),Dt=ai.box.length>0),_t=_t&&ai.offscreen}const Ls=te||Ze.numHorizontalGlyphVertices===0&&Ze.numVerticalGlyphVertices===0,_c=ne||Ze.numIconVertices===0;if(Ls||_c?_c?Ls||(Dt=Dt&&Mt):Mt=Dt&&Mt:Dt=Mt=Dt&&Mt,Mt&&Ht&&Ht.box&&this.collisionIndex.insertCollisionBox(Ht.box,fe,x.get("text-ignore-placement"),_.bucketInstanceId,$t&&$t.box&&Ur?Ur:ds,ie.ID),Dt&&ai&&this.collisionIndex.insertCollisionBox(ai.box,xe,x.get("icon-ignore-placement"),_.bucketInstanceId,fs,ie.ID),ln&&(Mt&&this.collisionIndex.insertCollisionCircles(ln.circles,fe,x.get("text-ignore-placement"),_.bucketInstanceId,ds,ie.ID),p)){const ei=_.bucketInstanceId;let Nt=this.collisionCircleArrays[ei];Nt===void 0&&(Nt=this.collisionCircleArrays[ei]=new br);for(let tn=0;tn<ln.circles.length;tn+=4)Nt.circles.push(ln.circles[tn+0]),Nt.circles.push(ln.circles[tn+1]),Nt.circles.push(ln.circles[tn+2]),Nt.circles.push(ln.collisionDetected?1:0)}if(Ze.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ze.crossTileID]=new Zs(Mt||Ne,Dt||Ie,_t||_.justReloaded),h[Ze.crossTileID]=!0};if(ke){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ze=_.getSortedSymbolIndexes(this.transform.angle);for(let it=Ze.length-1;it>=0;--it){const Mt=Ze[it];tt(_.symbolInstances.get(Mt),_.collisionArrays[Mt])}}else for(let Ze=o.symbolInstanceStart;Ze<o.symbolInstanceEnd;Ze++)tt(_.symbolInstances.get(Ze),_.collisionArrays[Ze]);if(p&&_.bucketInstanceId in this.collisionCircleArrays){const Ze=this.collisionCircleArrays[_.bucketInstanceId];l.invert(Ze.invProjMatrix,E),Ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(o,h,p,_){let x;x=_===l.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(h)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const C of E)C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=x>=0&&C!==x?0:p.crossTileID)}markUsedOrientation(o,h,p){const _=h===l.WritingMode.horizontal||h===l.WritingMode.horizontalOnly?h:0,x=h===l.WritingMode.vertical?h:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const C of E)o.text.placedSymbolArray.get(C).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const _=h?h.symbolFadeChange(o):1,x=h?h.opacities:{},E=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(const L in this.placements){const k=this.placements[L],D=x[L];D?(this.opacities[L]=new en(D,_,k.text,k.icon),p=p||k.text!==D.text.placed||k.icon!==D.icon.placed):(this.opacities[L]=new en(null,_,k.text,k.icon,k.skipFade),p=p||k.text||k.icon)}for(const L in x){const k=x[L];if(!this.opacities[L]){const D=new en(k,_,!1,!1);D.isHidden()||(this.opacities[L]=D,p=p||k.text.placed||k.icon.placed)}}for(const L in E)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=E[L]);for(const L in C)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=C[L]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const p={};for(const _ of h){const x=_.getBucket(o);x&&_.latestFeatureIndex&&o.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,_.collisionBoxArray)}}updateBucketOpacities(o,h,p){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const _=o.layers[0].layout,x=new en(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),L=_.get("text-variable-anchor"),k=_.get("text-rotation-alignment")==="map",D=_.get("text-pitch-alignment")==="map",N=_.get("icon-text-fit")!=="none",W=new en(null,0,E&&(C||!o.hasIconData()||_.get("icon-optional")),C&&(E||!o.hasTextData()||_.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const ie=(te,ne,fe)=>{for(let _e=0;_e<ne/4;_e++)te.opacityVertexArray.emplaceBack(fe)};for(let te=0;te<o.symbolInstances.length;te++){const ne=o.symbolInstances.get(te),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:_e,crossTileID:xe}=ne;let se=this.opacities[xe];h[xe]?se=x:se||(se=W,this.opacities[xe]=se),h[xe]=!0;const Te=ne.numIconVertices>0,we=this.placedOrientations[ne.crossTileID],Me=we===l.WritingMode.vertical,ke=we===l.WritingMode.horizontal||we===l.WritingMode.horizontalOnly;if(fe>0||_e>0){const Ne=ge(se.text);ie(o.text,fe,Me?Ce:Ne),ie(o.text,_e,ke?Ce:Ne);const Ie=se.text.isHidden();[ne.rightJustifiedTextSymbolIndex,ne.centerJustifiedTextSymbolIndex,ne.leftJustifiedTextSymbolIndex].forEach(it=>{it>=0&&(o.text.placedSymbolArray.get(it).hidden=Ie||Me?1:0)}),ne.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ne.verticalPlacedTextSymbolIndex).hidden=Ie||ke?1:0);const tt=this.variableOffsets[ne.crossTileID];tt&&this.markUsedJustification(o,tt.anchor,ne,we);const Ze=this.placedOrientations[ne.crossTileID];Ze&&(this.markUsedJustification(o,"left",ne,Ze),this.markUsedOrientation(o,Ze,ne))}if(Te){const Ne=ge(se.icon),Ie=!(N&&ne.verticalPlacedIconSymbolIndex&&Me);ne.placedIconSymbolIndex>=0&&(ie(o.icon,ne.numIconVertices,Ie?Ne:Ce),o.icon.placedSymbolArray.get(ne.placedIconSymbolIndex).hidden=se.icon.isHidden()),ne.verticalPlacedIconSymbolIndex>=0&&(ie(o.icon,ne.numVerticalIconVertices,Ie?Ce:Ne),o.icon.placedSymbolArray.get(ne.verticalPlacedIconSymbolIndex).hidden=se.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ne=o.collisionArrays[te];if(Ne){let Ie=new l.pointGeometry(0,0);if(Ne.textBox||Ne.verticalTextBox){let Ze=!0;if(L){const it=this.variableOffsets[xe];it?(Ie=Xs(it.anchor,it.width,it.height,it.textOffset,it.textBoxScale),k&&Ie._rotate(D?this.transform.angle:-this.transform.angle)):Ze=!1}Ne.textBox&&R(o.textCollisionBox.collisionVertexArray,se.text.placed,!Ze||Me,Ie.x,Ie.y),Ne.verticalTextBox&&R(o.textCollisionBox.collisionVertexArray,se.text.placed,!Ze||ke,Ie.x,Ie.y)}const tt=!!(!ke&&Ne.verticalIconBox);Ne.iconBox&&R(o.iconCollisionBox.collisionVertexArray,se.icon.placed,tt,N?Ie.x:0,N?Ie.y:0),Ne.verticalIconBox&&R(o.iconCollisionBox.collisionVertexArray,se.icon.placed,!tt,N?Ie.x:0,N?Ie.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=te.invProjMatrix,o.placementViewportMatrix=te.viewportMatrix,o.collisionCircleArray=te.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function R(m,o,h,p,_){m.emplaceBack(o?1:0,h?1:0,p||0,_||0),m.emplaceBack(o?1:0,h?1:0,p||0,_||0),m.emplaceBack(o?1:0,h?1:0,p||0,_||0),m.emplaceBack(o?1:0,h?1:0,p||0,_||0)}const F=Math.pow(2,25),Y=Math.pow(2,24),J=Math.pow(2,17),ce=Math.pow(2,16),me=Math.pow(2,9),de=Math.pow(2,8),le=Math.pow(2,1);function ge(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const o=m.placed?1:0,h=Math.floor(127*m.opacity);return h*F+o*Y+h*J+o*ce+h*me+o*de+h*le+o}const Ce=0;class Oe{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,p,_,x){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(E,_,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,L)=>C.sortKey-L.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,x())return!0;return!1}}class Pe{constructor(o,h,p,_,x,E,C,L){this.placement=new ee(o,h,E,C,L),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(o,h,p){const _=l.exported.now(),x=()=>{const E=l.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=h[o[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Oe(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const st=512/l.EXTENT/2;class lt{constructor(o,h,p){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<h.length;_++){const x=h.get(_),E=x.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,o)})}}getScaledCoordinates(o,h){const p=st/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*l.EXTENT+o.anchorX)*p),y:Math.floor((h.canonical.y*l.EXTENT+o.anchorY)*p)}}findMatches(o,h,p){const _=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let x=0;x<o.length;x++){const E=o.get(x);if(E.crossTileID)continue;const C=this.indexedSymbolInstances[E.key];if(!C)continue;const L=this.getScaledCoordinates(E,h);for(const k of C)if(Math.abs(k.coord.x-L.x)<=_&&Math.abs(k.coord.y-L.y)<=_&&!p[k.crossTileID]){p[k.crossTileID]=!0,E.crossTileID=k.crossTileID;break}}}}class Ke{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const p in this.indexes){const _=this.indexes[p],x={};for(const E in _){const C=_[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),x[C.tileID.key]=C}this.indexes[p]=x}this.lng=o}addBucket(o,h,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const _=this.usedCrossTileIDs[o.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>o.overscaledZ)for(const C in E){const L=E[C];L.tileID.isChildOf(o)&&L.findMatches(h.symbolInstances,o,_)}else{const C=E[o.scaledTo(Number(x)).key];C&&C.findMatches(h.symbolInstances,o,_)}}for(let x=0;x<h.symbolInstances.length;x++){const E=h.symbolInstances.get(x);E.crossTileID||(E.crossTileID=p.generate(),_[E.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new lt(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const p in h.indexedSymbolInstances)for(const _ of h.indexedSymbolInstances[p])delete this.usedCrossTileIDs[o][_.crossTileID]}removeStaleBuckets(o){let h=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)o[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],h=!0)}return h}}class dt{constructor(){this.layerIndexes={},this.crossTileIDs=new Ke,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,p){let _=this.layerIndexes[o.id];_===void 0&&(_=this.layerIndexes[o.id]=new gt);let x=!1;const E={};_.handleWrapJump(p);for(const C of h){const L=C.getBucket(o);L&&o.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(C.tileID,L,this.crossTileIDs)&&(x=!0),E[L.bucketInstanceId]=!0)}return _.removeStaleBuckets(E)&&(x=!0),x}pruneUnusedLayers(o){const h={};o.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}var Rt=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class vt extends l.Evented{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=o._cache.max,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const o in this._tiles){const h=this._tiles[o];h.textures.forEach(p=>p.destroy()),h.textures=[]}}update(o,h){this.sourceCache.update(o,h),this._renderableTilesKeys=[];for(const p of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.ortho(p.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[p.key]=new si(p,this.tileSize))}removeOutdated(o){const h={};this.renderHistory=this.renderHistory.filter((p,_)=>this.renderHistory.indexOf(p)===_).slice(0,this.renderHistorySize);for(const p of this._renderableTilesKeys)h[p]=!0;for(const p of this.renderHistory)h[p]=!0;for(const p in this._tiles)h[p]||(this._tiles[p].clearTextures(o),delete this._tiles[p])}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const h={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID;if(_.canonical.equals(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16),l.ortho(x.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),h[p]=x}else if(_.canonical.isChildOf(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const E=_.canonical.z-o.canonical.z,C=_.canonical.x-(_.canonical.x>>E<<E),L=_.canonical.y-(_.canonical.y>>E<<E),k=l.EXTENT>>E;l.ortho(x.posMatrix,0,k,0,k,0,1),l.translate(x.posMatrix,x.posMatrix,[-C*k,-L*k,0]),h[p]=x}else if(o.canonical.isChildOf(_.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const E=o.canonical.z-_.canonical.z,C=o.canonical.x-(o.canonical.x>>E<<E),L=o.canonical.y-(o.canonical.y>>E<<E),k=l.EXTENT>>E;l.ortho(x.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(x.posMatrix,x.posMatrix,[C*k,L*k,0]),l.scale(x.posMatrix,x.posMatrix,[1/2**E,1/2**E,0]),h[p]=x}}return h}getSourceTile(o,h){const p=this.sourceCache._source;let _=o.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(_).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!x||!x.dem)&&h)for(;_>=p.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(o.scaledTo(_--).key);return x}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(h=>h.timeLoaded>=o)}}class At{constructor(o,h,p){this.style=o,this.sourceCache=new vt(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.elevationOffset=typeof p.elevationOffset=="number"?p.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(o,h,p,_=l.EXTENT){if(!(h>=0&&h<_&&p>=0&&p<_))return this.elevationOffset;let x=0;const E=this.getTerrainData(o);if(E.tile&&E.tile.dem){const C=l.transformMat4$1([],[h/_*l.EXTENT,p/_*l.EXTENT],E.u_terrain_matrix),L=[C[0]*E.tile.dem.dim,C[1]*E.tile.dem.dim],k=[Math.floor(L[0]),Math.floor(L[1])],D=E.tile.dem.get(k[0],k[1]),N=E.tile.dem.get(k[0],k[1]+1),W=E.tile.dem.get(k[0]+1,k[1]),ie=E.tile.dem.get(k[0]+1,k[1]+1);x=l.number(l.number(D,N,L[0]-k[0]),l.number(W,ie,L[0]-k[0]),L[1]-k[1])}return x}rememberForRerender(o,h){for(const p in this.sourceCache._tiles){const _=this.sourceCache._tiles[p];(_.tileID.equals(h)||_.tileID.isChildOf(h))&&(o===this.sourceCache.sourceCache.id&&(_.timeLoaded=Date.now()),this._rerender[o]=this._rerender[o]||{},this._rerender[o][_.tileID.key]=!0)}}needsRerender(o,h){return this._rerender[o]&&this._rerender[o][h.key]}clearRerenderCache(){this._rerender={}}getElevation(o,h,p,_=l.EXTENT){return(this.getDEMElevation(o,h,p,_)+this.elevationOffset)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const _=this.style.map.painter.context,x=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new K(_,x,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new K(_,new l.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const h=this.sourceCache.getSourceTile(o,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const _=this.style.map.painter.context;h.demTexture=this.style.map.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new K(_,h.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),h.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let x=o.canonical.z-h.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=_?x=o.canonical.z-_:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=o.canonical.x-(o.canonical.x>>x<<x),C=o.canonical.y-(o.canonical.y>>x<<x),L=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<x),1/(l.EXTENT<<x),0]);l.translate(L,L,[E*l.EXTENT,C*l.EXTENT,0]),this._demMatrixCache[o.key]={matrix:L,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getRTTFramebuffer(){const o=this.style.map.painter;if(!this._rttFramebuffer){const h=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=o.context.createFramebuffer(h,h,!0),this._rttFramebuffer.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,h,h))}return this._rttFramebuffer}getFramebuffer(o){const h=this.style.map.painter,p=h.width/devicePixelRatio,_=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new K(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new K(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,_,!0),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,E=0;x<this._coordsTextureSize;x++)for(let C=0;C<this._coordsTextureSize;C++,E+=4)h[E+0]=255&C,h[E+1]=255&x,h[E+2]=C>>8<<4|x>>8,h[E+3]=0;const p=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),_=new K(o,p,o.gl.RGBA,{premultiply:!1});return _.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(o){const h=new Uint8Array(4),p=this.style.map.painter,_=p.context,x=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(o.x,p.height/devicePixelRatio-o.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const E=h[0]+(h[2]>>4<<8),C=h[1]+((15&h[2])<<8),L=this.coordsIndex[255-h[3]],k=L&&this.sourceCache.getTileByID(L);if(!k)return null;const D=this._coordsTextureSize,N=(1<<k.tileID.canonical.z)*D;return new l.MercatorCoordinate((k.tileID.canonical.x*D+E)/N,(k.tileID.canonical.y*D+C)/N,this.getElevation(k.tileID,E,C,D))}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.style.map.painter.context,h=new l.PosArray,p=new l.TriangleIndexArray,_=this.meshSize,x=l.EXTENT/_,E=_*_;for(let C=0;C<=_;C++)for(let L=0;L<=_;L++)h.emplaceBack(L*x,C*x);for(let C=0;C<E;C+=_+1)for(let L=0;L<_;L++)p.emplaceBack(L+C,_+L+C+1,_+L+C+2),p.emplaceBack(L+C,_+L+C+2,L+C+1);return this._mesh={indexBuffer:o.createIndexBuffer(p),vertexBuffer:o.createVertexBuffer(h,Rt.members),segments:l.SegmentVector.simpleSegment(0,0,h.length,p.length)},this._mesh}getMinMaxElevation(o){const h=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=(h.dem.min+this.elevationOffset)*this.exaggeration,p.maxElevation=(h.dem.max+this.elevationOffset)*this.exaggeration),p}}const Ft=(m,o)=>l.emitValidationErrors(m,o&&o.filter(h=>h.identifier!=="source.canvas")),Vt=l.pick(Gt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),dn=l.pick(Gt,["setCenter","setZoom","setBearing","setPitch"]),fn=function(){const m={},o=l.spec.$version;for(const h in l.spec.$root){const p=l.spec.$root[h];if(p.required){let _=null;_=h==="version"?o:p.type==="array"?[]:{},_!=null&&(m[h]=_)}}return m}();class Qn extends l.Evented{constructor(o,h={}){super(),this.map=o,this.dispatcher=new Ge(fi(),this),this.imageManager=new q,this.imageManager.setEventedParent(this),this.glyphManager=new pe(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new je(256,512),this.crossTileSymbolIndex=new dt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=Qn.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,E)=>{if(l.triggerPluginCompletionEvent(x),E&&E.every(C=>C))for(const C in p.sourceCaches)p.sourceCaches[C].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.sourceCaches[_.sourceId];if(!x)return;const E=x.getSource();if(E&&E.vectorLayerIds)for(const C in this._layers){const L=this._layers[C];L.source===E.id&&this._validateLayer(L)}})}loadURL(o,h={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const p=typeof h.validate!="boolean"||h.validate,_=this.map._requestManager.transformRequest(o,l.ResourceType.Style);this._request=l.getJSON(_,(x,E)=>{this._request=null,x?this.fire(new l.ErrorEvent(x)):E&&this._load(E,p)})}loadJSON(o,h={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(o,h.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(fn,!1)}_load(o,h){if(h&&Ft(this,l.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o;for(const _ in o.sources)this.addSource(_,o.sources[_],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);const p=$s(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=l.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Fe(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(o){this._spriteRequest=function(h,p,_,x){let E,C,L;const k=_>1?"@2x":"";let D=l.getJSON(p.transformRequest(p.normalizeSpriteURL(h,k,".json"),l.ResourceType.SpriteJSON),(ie,te)=>{D=null,L||(L=ie,E=te,W())}),N=l.getImage(p.transformRequest(p.normalizeSpriteURL(h,k,".png"),l.ResourceType.SpriteImage),(ie,te)=>{N=null,L||(L=ie,C=te,W())});function W(){if(L)x(L);else if(E&&C){const ie=l.exported.getImageData(C),te={};for(const ne in E){const{width:fe,height:_e,x:xe,y:se,sdf:Te,pixelRatio:we,stretchX:Me,stretchY:ke,content:Ne}=E[ne],Ie=new l.RGBAImage({width:fe,height:_e});l.RGBAImage.copy(ie,Ie,{x:xe,y:se},{x:0,y:0},{width:fe,height:_e}),te[ne]={data:Ie,pixelRatio:we,sdf:Te,stretchX:Me,stretchY:ke,content:Ne}}x(null,te)}}return{cancel(){D&&(D.cancel(),D=null),N&&(N.cancel(),N=null)}}}(o,this.map._requestManager,this.map.getPixelRatio(),(h,p)=>{if(this._spriteRequest=null,h)this.fire(new l.ErrorEvent(h));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(o){const h=this.sourceCaches[o.source];if(!h)return;const p=o.sourceLayer;if(!p)return;const _=h.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const h=[];for(const p of o){const _=this._layers[p];_.type!=="custom"&&h.push(_.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const h=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(_.length||x.length)&&this._updateWorkerLayers(_,x);for(const E in this._updatedSources){const C=this._updatedSources[E];if(C==="reload")this._reloadSource(E);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(E)}}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const x=this.sourceCaches[_];p[_]=x.used,x.used=!1}for(const _ of this._order){const x=this._layers[_];x.recalculate(o,this._availableImages),!x.isHidden(o.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const _ in p){const x=this.sourceCaches[_];p[_]!==x.used&&x.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(o){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),o){const h=this.sourceCaches[o.source];if(!h)throw new Error(`cannot load terrain, because there exists no source with ID: ${o.source}`);this.terrain=new At(this,h,o),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=p=>{p.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=p=>{p.tile&&(p.sourceId===o.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(p.sourceId,p.tile.tileID)):p.source.type==="geojson"&&this.terrain.rememberForRerender(p.sourceId,p.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:o}))}setState(o){if(this._checkLoaded(),Ft(this,l.validateStyle(o)))return!1;(o=l.clone$1(o)).layers=$s(o.layers);const h=function(_,x){if(!_)return[{command:Gt.setStyle,args:[x]}];let E=[];try{if(!I(_.version,x.version))return[{command:Gt.setStyle,args:[x]}];I(_.center,x.center)||E.push({command:Gt.setCenter,args:[x.center]}),I(_.zoom,x.zoom)||E.push({command:Gt.setZoom,args:[x.zoom]}),I(_.bearing,x.bearing)||E.push({command:Gt.setBearing,args:[x.bearing]}),I(_.pitch,x.pitch)||E.push({command:Gt.setPitch,args:[x.pitch]}),I(_.sprite,x.sprite)||E.push({command:Gt.setSprite,args:[x.sprite]}),I(_.glyphs,x.glyphs)||E.push({command:Gt.setGlyphs,args:[x.glyphs]}),I(_.transition,x.transition)||E.push({command:Gt.setTransition,args:[x.transition]}),I(_.light,x.light)||E.push({command:Gt.setLight,args:[x.light]});const C={},L=[];(function(D,N,W,ie){let te;for(te in N=N||{},D=D||{})Object.prototype.hasOwnProperty.call(D,te)&&(Object.prototype.hasOwnProperty.call(N,te)||Fn(te,W,ie));for(te in N)Object.prototype.hasOwnProperty.call(N,te)&&(Object.prototype.hasOwnProperty.call(D,te)?I(D[te],N[te])||(D[te].type==="geojson"&&N[te].type==="geojson"&&bo(D,N,te)?W.push({command:Gt.setGeoJSONSourceData,args:[te,N[te].data]}):os(te,N,W,ie)):Ri(te,N,W))})(_.sources,x.sources,L,C);const k=[];_.layers&&_.layers.forEach(D=>{C[D.source]?E.push({command:Gt.removeLayer,args:[D.id]}):k.push(D)}),E=E.concat(L),function(D,N,W){N=N||[];const ie=(D=D||[]).map(Dr),te=N.map(Dr),ne=D.reduce(Hs,{}),fe=N.reduce(Hs,{}),_e=ie.slice(),xe=Object.create(null);let se,Te,we,Me,ke,Ne,Ie;for(se=0,Te=0;se<ie.length;se++)we=ie[se],Object.prototype.hasOwnProperty.call(fe,we)?Te++:(W.push({command:Gt.removeLayer,args:[we]}),_e.splice(_e.indexOf(we,Te),1));for(se=0,Te=0;se<te.length;se++)we=te[te.length-1-se],_e[_e.length-1-se]!==we&&(Object.prototype.hasOwnProperty.call(ne,we)?(W.push({command:Gt.removeLayer,args:[we]}),_e.splice(_e.lastIndexOf(we,_e.length-Te),1)):Te++,Ne=_e[_e.length-se],W.push({command:Gt.addLayer,args:[fe[we],Ne]}),_e.splice(_e.length-se,0,we),xe[we]=!0);for(se=0;se<te.length;se++)if(we=te[se],Me=ne[we],ke=fe[we],!xe[we]&&!I(Me,ke))if(I(Me.source,ke.source)&&I(Me["source-layer"],ke["source-layer"])&&I(Me.type,ke.type)){for(Ie in zr(Me.layout,ke.layout,W,we,null,Gt.setLayoutProperty),zr(Me.paint,ke.paint,W,we,null,Gt.setPaintProperty),I(Me.filter,ke.filter)||W.push({command:Gt.setFilter,args:[we,ke.filter]}),I(Me.minzoom,ke.minzoom)&&I(Me.maxzoom,ke.maxzoom)||W.push({command:Gt.setLayerZoomRange,args:[we,ke.minzoom,ke.maxzoom]}),Me)Object.prototype.hasOwnProperty.call(Me,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?zr(Me[Ie],ke[Ie],W,we,Ie.slice(6),Gt.setPaintProperty):I(Me[Ie],ke[Ie])||W.push({command:Gt.setLayerProperty,args:[we,Ie,ke[Ie]]}));for(Ie in ke)Object.prototype.hasOwnProperty.call(ke,Ie)&&!Object.prototype.hasOwnProperty.call(Me,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?zr(Me[Ie],ke[Ie],W,we,Ie.slice(6),Gt.setPaintProperty):I(Me[Ie],ke[Ie])||W.push({command:Gt.setLayerProperty,args:[we,Ie,ke[Ie]]}))}else W.push({command:Gt.removeLayer,args:[we]}),Ne=_e[_e.lastIndexOf(we)+1],W.push({command:Gt.addLayer,args:[ke,Ne]})}(k,x.layers,E)}catch(C){console.warn("Unable to compute style diff:",C),E=[{command:Gt.setStyle,args:[x]}]}return E}(this.serialize(),o).filter(_=>!(_.command in dn));if(h.length===0)return!1;const p=h.filter(_=>!(_.command in Vt));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return h.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=o,!0}addImage(o,h){if(this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,p={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.validateStyle.source,`sources.${o}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const _=this.sourceCaches[o]=new qt(o,h,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:o})),_.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new l.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],h.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,h,p={}){this._checkLoaded();const _=o.id;if(this.getLayer(_))return void this.fire(new l.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let x;if(o.type==="custom"){if(Ft(this,l.validateCustomStyleLayer(o)))return;x=l.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=l.clone$1(o),o=l.extend(o,{source:_})),this._validate(l.validateStyle.layer,`layers.${_}`,o,{arrayIndex:-1},p))return;x=l.createStyleLayer(o),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize()}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=x,this._removedLayers[_]&&x.source&&x.type!=="custom"){const C=this._removedLayers[_];delete this._removedLayers[_],C.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new l.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const p=this._order.indexOf(o);this._order.splice(p,1);const _=h?this._order.indexOf(h):this._order.length;h&&_===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${o}" before non-existing layer "${h}".`))):(this._order.splice(_,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${o}".`)));h.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,h,p){this._checkLoaded();const _=this.getLayer(o);_?_.minzoom===h&&_.maxzoom===p||(h!=null&&(_.minzoom=h),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,h,p={}){this._checkLoaded();const _=this.getLayer(o);if(_){if(!I(_.filter,h))return h==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(l.validateStyle.filter,`layers.${_.id}.filter`,h,null,p)||(_.filter=l.clone$1(h),this._updateLayer(_)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return l.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,h,p,_={}){this._checkLoaded();const x=this.getLayer(o);x?I(x.getLayoutProperty(h),p)||(x.setLayoutProperty(h,p,_),this._updateLayer(x)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,h){const p=this.getLayer(o);if(p)return p.getLayoutProperty(h);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,h,p,_={}){this._checkLoaded();const x=this.getLayer(o);x?I(x.getPaintProperty(h),p)||(x.setPaintProperty(h,p,_)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const p=o.source,_=o.sourceLayer,x=this.sourceCaches[p];if(x===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const E=x.getSource().type;E==="geojson"&&_?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||_?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),x.setFeatureState(_,o.id,h)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,h){this._checkLoaded();const p=o.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const x=_.getSource().type,E=x==="vector"?o.sourceLayer:void 0;x!=="vector"||E?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(E,o.id,h):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const h=o.source,p=o.sourceLayer,_=this.sourceCaches[h];if(_!==void 0)return _.getSource().type!=="vector"||p?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,o.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,o=>o.serialize()),layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=E=>this._layers[E].type==="fill-extrusion",p={},_=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(h(C)){p[C]=E;for(const L of o){const k=L[C];if(k)for(const D of k)_.push(D)}}}_.sort((E,C)=>C.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(h(C))for(let L=_.length-1;L>=0;L--){const k=_[L].feature;if(p[k.layer.id]<E)break;x.push(k),_.pop()}else for(const L of o){const k=L[C];if(k)for(const D of k)x.push(D.feature)}}return x}queryRenderedFeatures(o,h,p){h&&h.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const _={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of h.layers){const C=this._layers[E];if(!C)return this.fire(new l.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];_[C.source]=!0}}const x=[];h.availableImages=this._availableImages;for(const E in this.sourceCaches)h.layers&&!_[E]||x.push(ri(this.sourceCaches[E],this._layers,this._serializedLayers,o,h,p));return this.placement&&x.push(function(E,C,L,k,D,N,W){const ie={},te=N.queryRenderedSymbols(k),ne=[];for(const fe of Object.keys(te).map(Number))ne.push(W[fe]);ne.sort(wi);for(const fe of ne){const _e=fe.featureIndex.lookupSymbolFeatures(te[fe.bucketInstanceId],C,fe.bucketIndex,fe.sourceLayerIndex,D.filter,D.layers,D.availableImages,E);for(const xe in _e){const se=ie[xe]=ie[xe]||[],Te=_e[xe];Te.sort((we,Me)=>{const ke=fe.featureSortOrder;if(ke){const Ne=ke.indexOf(we.featureIndex);return ke.indexOf(Me.featureIndex)-Ne}return Me.featureIndex-we.featureIndex});for(const we of Te)se.push(we)}}for(const fe in ie)ie[fe].forEach(_e=>{const xe=_e.feature,se=L[E[fe].source].getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=se});return ie}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,h){h&&h.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[o];return p?function(_,x){const E=_.getRenderableIds().map(k=>_.getTileByID(k)),C=[],L={};for(let k=0;k<E.length;k++){const D=E[k],N=D.tileID.canonical.key;L[N]||(L[N]=!0,D.querySourceFeatures(C,x))}return C}(p,h):[]}addSourceType(o,h,p){return Qn.getSourceType(o)?p(new Error(`A source type called "${o}" already exists.`)):(Qn.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const E in o)if(!I(o[E],p[E])){_=!0;break}if(!_)return;const x={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(x)}_validate(o,h,p,_,x={}){return(!x||x.validate!==!1)&&Ft(this,o.call(l.validateStyle,l.extend({key:h,style:this.serialize(),value:p,styleSpec:l.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const h=this.sourceCaches[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const h in this.sourceCaches)this.sourceCaches[h].update(o,this.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,h,p,_,x=!1){let E=!1,C=!1;const L={};for(const k of this._order){const D=this._layers[k];if(D.type!=="symbol")continue;if(!L[D.source]){const W=this.sourceCaches[D.source];L[D.source]=W.getRenderableIds(!0).map(ie=>W.getTileByID(ie)).sort((ie,te)=>te.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(te.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(D,L[D.source],o.center.lng);E=E||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),o.zoom))&&(this.pauseablePlacement=new Pe(o,this.terrain,this._order,x,h,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),C=!0),E&&this.pauseablePlacement.placement.setStale()),C||E)for(const k of this._order){const D=this._layers[k];D.type==="symbol"&&this.placement.updateLayerOpacities(D,L[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h,p){this.imageManager.getImages(h.icons,p),this._updateTilesForChangedImages();const _=this.sourceCaches[h.source];_&&_.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(o,h,p){this.glyphManager.getGlyphs(h.stacks,p)}getResource(o,h,p){return l.makeRequest(h,p)}}Qn.getSourceType=function(m){return rn[m]},Qn.setSourceType=function(m,o){rn[m]=o},Qn.registerForPluginStateChange=l.registerForPluginStateChange;var Fr="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const pi={prelude:Xt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Xt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Xt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Xt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Xt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Xt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Xt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Xt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Xt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Xt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Xt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Xt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Xt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Xt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Xt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Xt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Xt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Xt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Xt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Xt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Xt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Fr),terrainDepth:Xt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Fr),terrainCoords:Xt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Fr)};function Xt(m,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute ([\w]+) ([\w]+)/g),_=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=x?x.concat(_):_,C={};return{fragmentSource:m=m.replace(h,(L,k,D,N,W)=>(C[W]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${W}
varying ${D} ${N} ${W};
#else
uniform ${D} ${N} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${D} ${N} ${W} = u_${W};
#endif
`)),vertexSource:o=o.replace(h,(L,k,D,N,W)=>{const ie=N==="float"?"vec2":"vec4",te=W.match(/color/)?"color":ie;return C[W]?k==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${D} ${ie} a_${W};
varying ${D} ${N} ${W};
#else
uniform ${D} ${N} u_${W};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${D} ${N} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${te}(a_${W}, u_${W}_t);
#else
    ${D} ${N} ${W} = u_${W};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${D} ${ie} a_${W};
#else
uniform ${D} ${N} u_${W};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${D} ${N} ${W} = a_${W};
#else
    ${D} ${N} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${D} ${N} ${W} = unpack_mix_${te}(a_${W}, u_${W}_t);
#else
    ${D} ${N} ${W} = u_${W};
#endif
`}),staticAttributes:p,staticUniforms:E}}class wo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,p,_,x,E,C,L,k){this.context=o;let D=this.boundPaintVertexBuffers.length!==_.length;for(let N=0;!D&&N<_.length;N++)this.boundPaintVertexBuffers[N]!==_[N]&&(D=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===p&&!D&&this.boundIndexBuffer===x&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===C&&this.boundDynamicVertexBuffer2===L&&this.boundDynamicVertexBuffer3===k?(o.bindVertexArrayOES.set(this.vao),C&&C.bind(),x&&x.dynamicDraw&&x.bind(),L&&L.bind(),k&&k.bind()):this.freshBind(h,p,_,x,E,C,L,k)}freshBind(o,h,p,_,x,E,C,L){let k;const D=o.numAttributes,N=this.context,W=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=L;else{k=N.currentNumAttributes||0;for(let ie=D;ie<k;ie++)W.disableVertexAttribArray(ie)}h.enableAttributes(W,o);for(const ie of p)ie.enableAttributes(W,o);E&&E.enableAttributes(W,o),C&&C.enableAttributes(W,o),L&&L.enableAttributes(W,o),h.bind(),h.setVertexAttribPointers(W,o,x);for(const ie of p)ie.bind(),ie.setVertexAttribPointers(W,o,x);E&&(E.bind(),E.setVertexAttribPointers(W,o,x)),_&&_.bind(),C&&(C.bind(),C.setVertexAttribPointers(W,o,x)),L&&(L.bind(),L.setVertexAttribPointers(W,o,x)),N.currentNumAttributes=D}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Eo(m){const o=[];for(let h=0;h<m.length;h++){if(m[h]===null)continue;const p=m[h].split(" ");o.push(p.pop())}return o}class ia{constructor(o,h,p,_,x,E,C){const L=o.gl;this.program=L.createProgram();const k=Eo(p.staticAttributes),D=_?_.getBinderAttributes():[],N=k.concat(D),W=pi.prelude.staticUniforms?Eo(pi.prelude.staticUniforms):[],ie=p.staticUniforms?Eo(p.staticUniforms):[],te=_?_.getBinderUniforms():[],ne=W.concat(ie).concat(te),fe=[];for(const ke of ne)fe.indexOf(ke)<0&&fe.push(ke);const _e=_?_.defines():[];E&&_e.push("#define OVERDRAW_INSPECTOR;"),C&&_e.push("#define TERRAIN3D;");const xe=_e.concat(pi.prelude.fragmentSource,p.fragmentSource).join(`
`),se=_e.concat(pi.prelude.vertexSource,p.vertexSource).join(`
`),Te=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(Te,xe),L.compileShader(Te),L.attachShader(this.program,Te);const we=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(we,se),L.compileShader(we),L.attachShader(this.program,we),this.attributes={};const Me={};this.numAttributes=N.length;for(let ke=0;ke<this.numAttributes;ke++)N[ke]&&(L.bindAttribLocation(this.program,ke,N[ke]),this.attributes[N[ke]]=ke);L.linkProgram(this.program),L.deleteShader(we),L.deleteShader(Te);for(let ke=0;ke<fe.length;ke++){const Ne=fe[ke];if(Ne&&!Me[Ne]){const Ie=L.getUniformLocation(this.program,Ne);Ie&&(Me[Ne]=Ie)}}this.fixedUniforms=x(o,Me),this.terrainUniforms=((ke,Ne)=>({u_depth:new l.Uniform1i(ke,Ne.u_depth),u_terrain:new l.Uniform1i(ke,Ne.u_terrain),u_terrain_dim:new l.Uniform1f(ke,Ne.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(ke,Ne.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(ke,Ne.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(ke,Ne.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(ke,Ne.u_terrain_exaggeration)}))(o,Me),this.binderUniforms=_?_.getUniforms(o,Me):[]}draw(o,h,p,_,x,E,C,L,k,D,N,W,ie,te,ne,fe,_e,xe){const se=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(_),o.setColorMode(x),o.setCullFace(E),L){o.activeTexture.set(se.TEXTURE2),se.bindTexture(se.TEXTURE_2D,L.depthTexture),o.activeTexture.set(se.TEXTURE3),se.bindTexture(se.TEXTURE_2D,L.texture);for(const we in this.terrainUniforms)this.terrainUniforms[we].set(L[we])}for(const we in this.fixedUniforms)this.fixedUniforms[we].set(C[we]);ne&&ne.setUniforms(o,this.binderUniforms,ie,{zoom:te});let Te=0;switch(h){case se.LINES:Te=2;break;case se.TRIANGLES:Te=3;break;case se.LINE_STRIP:Te=1}for(const we of W.get()){const Me=we.vaos||(we.vaos={});(Me[k]||(Me[k]=new wo)).bind(o,this,D,ne?ne.getPaintVertexBuffers():[],N,we.vertexOffset,fe,_e,xe),se.drawElements(h,we.primitiveLength*Te,se.UNSIGNED_SHORT,we.primitiveOffset*Te*2)}}}function ra(m,o,h){const p=1/Mn(h,1,o.transform.tileZoom),_=Math.pow(2,h.tileID.overscaledZ),x=h.tileSize*Math.pow(2,o.transform.tileZoom)/_,E=x*(h.tileID.canonical.x+h.tileID.wrap*_),C=x*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[E>>16,C>>16],u_pixel_coord_lower:[65535&E,65535&C]}}const Ys=(m,o,h,p)=>{const _=o.style.light,x=_.properties.get("position"),E=[x.x,x.y,x.z],C=l.create$1();_.properties.get("anchor")==="viewport"&&l.fromRotation(C,-o.transform.angle),l.transformMat3(E,E,C);const L=_.properties.get("color");return{u_matrix:m,u_lightpos:E,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+h,u_opacity:p}},Br=(m,o,h,p,_,x,E)=>l.extend(Ys(m,o,h,p),ra(x,o,E),{u_height_factor:-Math.pow(2,_.overscaledZ)/E.tileSize/8}),sa=m=>({u_matrix:m}),oa=(m,o,h,p)=>l.extend(sa(m),ra(h,o,p)),aa=(m,o)=>({u_matrix:m,u_world:o}),el=(m,o,h,p,_)=>l.extend(oa(m,o,h,p),{u_world:_}),tc=(m,o,h,p)=>{const _=m.transform;let x,E;if(p.paint.get("circle-pitch-alignment")==="map"){const C=Mn(h,1,_.zoom);x=!0,E=[C,C]}else x=!1,E=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(o.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:E}},Ps=(m,o,h)=>{const p=Mn(h,1,o.zoom),_=Math.pow(2,o.zoom-h.tileID.overscaledZ),x=h.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[o.pixelsToGLUnits[0]/(p*_),o.pixelsToGLUnits[1]/(p*_)],u_overscale_factor:x}},$=(m,o,h=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:h}),Q=m=>({u_matrix:m}),he=(m,o,h,p)=>({u_matrix:m,u_extrude_scale:Mn(o,1,h),u_intensity:p});function Ae(m,o){const h=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new l.MercatorCoordinate(0,p/h).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/h).toLngLat().lat]}const Ue=(m,o,h,p)=>{const _=m.transform;return{u_matrix:Bn(m,o,h,p),u_ratio:1/Mn(o,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},at=(m,o,h,p,_)=>l.extend(Ue(m,o,h,_),{u_image:0,u_image_height:p}),Bt=(m,o,h,p,_)=>{const x=m.transform,E=zt(o,x);return{u_matrix:Bn(m,o,h,_),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Mn(o,1,x.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},En=(m,o,h,p,_,x)=>{const E=m.lineAtlas,C=zt(o,m.transform),L=h.layout.get("line-cap")==="round",k=E.getDash(p.from,L),D=E.getDash(p.to,L),N=k.width*_.fromScale,W=D.width*_.toScale;return l.extend(Ue(m,o,h,x),{u_patternscale_a:[C/N,-k.height/2],u_patternscale_b:[C/W,-D.height/2],u_sdfgamma:E.width/(256*Math.min(N,W)*m.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:D.y,u_mix:_.t})};function zt(m,o){return 1/Mn(m,1,o.tileZoom)}function Bn(m,o,h,p){return m.translatePosMatrix(p?p.posMatrix:o.tileID.posMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const or=(m,o,h,p,_)=>{return{u_matrix:m,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(E=_.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(x=_.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Jd(_.paint.get("raster-hue-rotate"))};var x,E};function Jd(m){m*=Math.PI/180;const o=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const ku=(m,o,h,p,_,x,E,C,L,k)=>{const D=_.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:D.cameraToCenterDistance,u_pitch:D.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:D.width/D.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+L,u_pitch_with_map:+p,u_texsize:k,u_texture:0}},nc=(m,o,h,p,_,x,E,C,L,k,D)=>{const N=_.transform;return l.extend(ku(m,o,h,p,_,x,E,C,L,k),{u_gamma_scale:p?Math.cos(N._pitch)*N.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+D})},Qd=(m,o,h,p,_,x,E,C,L,k)=>l.extend(nc(m,o,h,p,_,x,E,C,!0,L,!0),{u_texsize_icon:k,u_texture_icon:1}),Ag=(m,o,h)=>({u_matrix:m,u_opacity:o,u_color:h}),Pg=(m,o,h,p,_,x)=>l.extend(function(E,C,L,k){const D=L.imageManager.getPattern(E.from.toString()),N=L.imageManager.getPattern(E.to.toString()),{width:W,height:ie}=L.imageManager.getPixelSize(),te=Math.pow(2,k.tileID.overscaledZ),ne=k.tileSize*Math.pow(2,L.transform.tileZoom)/te,fe=ne*(k.tileID.canonical.x+k.tileID.wrap*te),_e=ne*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[W,ie],u_mix:C.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/Mn(k,1,L.transform.tileZoom),u_pixel_coord_upper:[fe>>16,_e>>16],u_pixel_coord_lower:[65535&fe,65535&_e]}}(p,x,h,_),{u_matrix:m,u_opacity:o}),Ru={fillExtrusion:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_lightpos:new l.Uniform3f(m,o.u_lightpos),u_lightintensity:new l.Uniform1f(m,o.u_lightintensity),u_lightcolor:new l.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,o.u_vertical_gradient),u_opacity:new l.Uniform1f(m,o.u_opacity)}),fillExtrusionPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_lightpos:new l.Uniform3f(m,o.u_lightpos),u_lightintensity:new l.Uniform1f(m,o.u_lightintensity),u_lightcolor:new l.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,o.u_vertical_gradient),u_height_factor:new l.Uniform1f(m,o.u_height_factor),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade),u_opacity:new l.Uniform1f(m,o.u_opacity)}),fill:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),fillPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),fillOutline:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world)}),fillOutlinePattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),circle:(m,o)=>({u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(m,o.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(m,o.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),collisionBox:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(m,o.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(m,o.u_extrude_scale),u_overscale_factor:new l.Uniform1f(m,o.u_overscale_factor)}),collisionCircle:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_inv_matrix:new l.UniformMatrix4f(m,o.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(m,o.u_viewport_size)}),debug:(m,o)=>({u_color:new l.UniformColor(m,o.u_color),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_overlay:new l.Uniform1i(m,o.u_overlay),u_overlay_scale:new l.Uniform1f(m,o.u_overlay_scale)}),clippingMask:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),heatmap:(m,o)=>({u_extrude_scale:new l.Uniform1f(m,o.u_extrude_scale),u_intensity:new l.Uniform1f(m,o.u_intensity),u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),heatmapTexture:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world),u_image:new l.Uniform1i(m,o.u_image),u_color_ramp:new l.Uniform1i(m,o.u_color_ramp),u_opacity:new l.Uniform1f(m,o.u_opacity)}),hillshade:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_latrange:new l.Uniform2f(m,o.u_latrange),u_light:new l.Uniform2f(m,o.u_light),u_shadow:new l.UniformColor(m,o.u_shadow),u_highlight:new l.UniformColor(m,o.u_highlight),u_accent:new l.UniformColor(m,o.u_accent)}),hillshadePrepare:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_dimension:new l.Uniform2f(m,o.u_dimension),u_zoom:new l.Uniform1f(m,o.u_zoom),u_unpack:new l.Uniform4f(m,o.u_unpack)}),line:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels)}),lineGradient:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_image:new l.Uniform1i(m,o.u_image),u_image_height:new l.Uniform1f(m,o.u_image_height)}),linePattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texsize:new l.Uniform2f(m,o.u_texsize),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_image:new l.Uniform1i(m,o.u_image),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),lineSDF:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(m,o.u_patternscale_a),u_patternscale_b:new l.Uniform2f(m,o.u_patternscale_b),u_sdfgamma:new l.Uniform1f(m,o.u_sdfgamma),u_image:new l.Uniform1i(m,o.u_image),u_tex_y_a:new l.Uniform1f(m,o.u_tex_y_a),u_tex_y_b:new l.Uniform1f(m,o.u_tex_y_b),u_mix:new l.Uniform1f(m,o.u_mix)}),raster:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_tl_parent:new l.Uniform2f(m,o.u_tl_parent),u_scale_parent:new l.Uniform1f(m,o.u_scale_parent),u_buffer_scale:new l.Uniform1f(m,o.u_buffer_scale),u_fade_t:new l.Uniform1f(m,o.u_fade_t),u_opacity:new l.Uniform1f(m,o.u_opacity),u_image0:new l.Uniform1i(m,o.u_image0),u_image1:new l.Uniform1i(m,o.u_image1),u_brightness_low:new l.Uniform1f(m,o.u_brightness_low),u_brightness_high:new l.Uniform1f(m,o.u_brightness_high),u_saturation_factor:new l.Uniform1f(m,o.u_saturation_factor),u_contrast_factor:new l.Uniform1f(m,o.u_contrast_factor),u_spin_weights:new l.Uniform3f(m,o.u_spin_weights)}),symbolIcon:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texture:new l.Uniform1i(m,o.u_texture)}),symbolSDF:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texture:new l.Uniform1i(m,o.u_texture),u_gamma_scale:new l.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,o.u_is_halo)}),symbolTextAndIcon:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texsize_icon:new l.Uniform2f(m,o.u_texsize_icon),u_texture:new l.Uniform1i(m,o.u_texture),u_texture_icon:new l.Uniform1i(m,o.u_texture_icon),u_gamma_scale:new l.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,o.u_is_halo)}),background:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_opacity:new l.Uniform1f(m,o.u_opacity),u_color:new l.UniformColor(m,o.u_color)}),backgroundPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_opacity:new l.Uniform1f(m,o.u_opacity),u_image:new l.Uniform1i(m,o.u_image),u_pattern_tl_a:new l.Uniform2f(m,o.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(m,o.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(m,o.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(m,o.u_pattern_br_b),u_texsize:new l.Uniform2f(m,o.u_texsize),u_mix:new l.Uniform1f(m,o.u_mix),u_pattern_size_a:new l.Uniform2f(m,o.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(m,o.u_pattern_size_b),u_scale_a:new l.Uniform1f(m,o.u_scale_a),u_scale_b:new l.Uniform1f(m,o.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(m,o.u_tile_units_to_pixels)}),terrain:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texture:new l.Uniform1i(m,o.u_texture)}),terrainDepth:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),terrainCoords:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texture:new l.Uniform1i(m,o.u_texture),u_terrain_coords_id:new l.Uniform1f(m,o.u_terrain_coords_id)})};class zu{constructor(o,h,p){this.context=o;const _=o.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Du={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ou{constructor(o,h,p,_){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=_,this.context=o;const x=o.gl;this.buffer=x.createBuffer(),o.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let p=0;p<this.attributes.length;p++){const _=h.attributes[this.attributes[p].name];_!==void 0&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,h,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],E=h.attributes[x.name];E!==void 0&&o.vertexAttribPointer(E,x.components,o[Du[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ef extends Jt{getDefault(){return l.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Cg extends Jt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class tl extends Jt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class nl extends Jt{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class tf extends Jt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class ar extends Jt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Fu extends Jt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class ic extends Jt{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class rc extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Bu extends Jt{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Nu extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class sc extends Jt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Uu extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class Vu extends Jt{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class oc extends Jt{getDefault(){return l.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class nf extends Jt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class rf extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class la extends Jt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Ig extends Jt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Lg extends Jt{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Mg extends Jt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class kg extends Jt{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Rg extends Jt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class zg extends Jt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class ju extends Jt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class ac extends Jt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Gu extends Jt{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Wu extends Jt{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class ca extends Jt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class sf extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class of extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class lc extends Jt{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class To extends lc{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class af extends lc{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class ua{constructor(o,h,p,_){this.context=o,this.width=h,this.height=p;const x=o.gl,E=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new To(o,E),_&&(this.depthAttachment=new af(o,E)),x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class gn{constructor(o,h,p){this.blendFunction=o,this.blendColor=h,this.mask=p}}gn.Replace=[1,0],gn.disabled=new gn(gn.Replace,l.Color.transparent,[!1,!1,!1,!1]),gn.unblended=new gn(gn.Replace,l.Color.transparent,[!0,!0,!0,!0]),gn.alphaBlended=new gn([1,771],l.Color.transparent,[!0,!0,!0,!0]);class lf{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ef(this),this.clearDepth=new Cg(this),this.clearStencil=new tl(this),this.colorMask=new nl(this),this.depthMask=new tf(this),this.stencilMask=new ar(this),this.stencilFunc=new Fu(this),this.stencilOp=new ic(this),this.stencilTest=new rc(this),this.depthRange=new Bu(this),this.depthTest=new Nu(this),this.depthFunc=new sc(this),this.blend=new Uu(this),this.blendFunc=new Vu(this),this.blendColor=new oc(this),this.blendEquation=new nf(this),this.cullFace=new rf(this),this.cullFaceSide=new la(this),this.frontFace=new Ig(this),this.program=new Lg(this),this.activeTexture=new Mg(this),this.viewport=new kg(this),this.bindFramebuffer=new Rg(this),this.bindRenderbuffer=new zg(this),this.bindTexture=new ju(this),this.bindVertexBuffer=new ac(this),this.bindElementBuffer=new Gu(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Wu(this),this.pixelStoreUnpack=new ca(this),this.pixelStoreUnpackPremultiplyAlpha=new sf(this),this.pixelStoreUnpackFlipY=new of(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new zu(this,o,h)}createVertexBuffer(o,h,p){return new Ou(this,o,h,p)}createRenderbuffer(o,h,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,o,h,p),this.bindRenderbuffer.set(null),x}createFramebuffer(o,h,p){return new ua(this,o,h,p)}clear({color:o,depth:h}){const p=this.gl;let _=0;o&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p.clear(_)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){I(o.blendFunction,gn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Wt{constructor(o,h,p){this.func=o,this.mask=h,this.range=p}}Wt.ReadOnly=!1,Wt.ReadWrite=!0,Wt.disabled=new Wt(519,Wt.ReadOnly,[0,1]);const Qt=7680;class pn{constructor(o,h,p,_,x,E){this.test=o,this.ref=h,this.mask=p,this.fail=_,this.depthFail=x,this.pass=E}}pn.disabled=new pn({func:519,mask:0},0,0,Qt,Qt,Qt);class vn{constructor(o,h,p){this.enable=o,this.mode=h,this.frontFace=p}}let il;function ha(m,o,h,p,_,x,E){const C=m.context,L=C.gl,k=m.useProgram("collisionBox"),D=[];let N=0,W=0;for(let se=0;se<p.length;se++){const Te=p[se],we=o.getTile(Te),Me=we.getBucket(h);if(!Me)continue;let ke=Te.posMatrix;_[0]===0&&_[1]===0||(ke=m.translatePosMatrix(Te.posMatrix,we,_,x));const Ne=E?Me.textCollisionBox:Me.iconCollisionBox,Ie=Me.collisionCircleArray;if(Ie.length>0){const tt=l.create(),Ze=ke;l.mul(tt,Me.placementInvProjMatrix,m.transform.glCoordMatrix),l.mul(tt,tt,Me.placementViewportMatrix),D.push({circleArray:Ie,circleOffset:W,transform:Ze,invTransform:tt,coord:Te}),N+=Ie.length/4,W=N}Ne&&k.draw(C,L.LINES,Wt.disabled,pn.disabled,m.colorModeForRenderPass(),vn.disabled,Ps(ke,m.transform,we),m.style.terrain&&m.style.terrain.getTerrainData(Te),h.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,null,m.transform.zoom,null,null,Ne.collisionVertexBuffer)}if(!E||!D.length)return;const ie=m.useProgram("collisionCircle"),te=new l.CollisionCircleLayoutArray;te.resize(4*N),te._trim();let ne=0;for(const se of D)for(let Te=0;Te<se.circleArray.length/4;Te++){const we=4*Te,Me=se.circleArray[we+0],ke=se.circleArray[we+1],Ne=se.circleArray[we+2],Ie=se.circleArray[we+3];te.emplace(ne++,Me,ke,Ne,Ie,0),te.emplace(ne++,Me,ke,Ne,Ie,1),te.emplace(ne++,Me,ke,Ne,Ie,2),te.emplace(ne++,Me,ke,Ne,Ie,3)}(!il||il.length<2*N)&&(il=function(se){const Te=2*se,we=new l.QuadTriangleArray;we.resize(Te),we._trim();for(let Me=0;Me<Te;Me++){const ke=6*Me;we.uint16[ke+0]=4*Me+0,we.uint16[ke+1]=4*Me+1,we.uint16[ke+2]=4*Me+2,we.uint16[ke+3]=4*Me+2,we.uint16[ke+4]=4*Me+3,we.uint16[ke+5]=4*Me+0}return we}(N));const fe=C.createIndexBuffer(il,!0),_e=C.createVertexBuffer(te,l.collisionCircleLayout.members,!0);for(const se of D){const Te={u_matrix:se.transform,u_inv_matrix:se.invTransform,u_camera_to_center_distance:(xe=m.transform).cameraToCenterDistance,u_viewport_size:[xe.width,xe.height]};ie.draw(C,L.TRIANGLES,Wt.disabled,pn.disabled,m.colorModeForRenderPass(),vn.disabled,Te,m.style.terrain&&m.style.terrain.getTerrainData(se.coord),h.id,_e,fe,l.SegmentVector.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,m.transform.zoom,null,null,null)}var xe;_e.destroy(),fe.destroy()}vn.disabled=new vn(!1,1029,2305),vn.backCCW=new vn(!0,1029,2305);const Dg=l.identity(new Float32Array(16));function Og(m,o,h,p,_,x){const{horizontalAlign:E,verticalAlign:C}=l.getAnchorAlignment(m),L=-(E-.5)*o,k=-(C-.5)*h,D=l.evaluateVariableOffset(m,p);return new l.pointGeometry((L/_+D[0])*x,(k/_+D[1])*x)}function cf(m,o,h,p,_,x,E,C,L,k,D){const N=m.text.placedSymbolArray,W=m.text.dynamicLayoutVertexArray,ie=m.icon.dynamicLayoutVertexArray,te={};W.clear();for(let ne=0;ne<N.length;ne++){const fe=N.get(ne),_e=m.allowVerticalPlacement&&!fe.placedOrientation,xe=fe.hidden||!fe.crossTileID||_e?null:p[fe.crossTileID];if(xe){const se=new l.pointGeometry(fe.anchorX,fe.anchorY),Te=Ut(se,h?E:x,D),we=$i(_.cameraToCenterDistance,Te.signedDistanceFromCamera);let Me=l.evaluateSizeForFeature(m.textSizeData,L,fe)*we/l.ONE_EM;h&&(Me*=m.tilePixelRatio/C);const{width:ke,height:Ne,anchor:Ie,textOffset:tt,textBoxScale:Ze}=xe,it=Og(Ie,ke,Ne,tt,Ze,Me),Mt=h?Ut(se.add(it),x,D).point:Te.point.add(o?it.rotate(-_.angle):it),Dt=m.allowVerticalPlacement&&fe.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<fe.numGlyphs;_t++)l.addDynamicAttributes(W,Mt,Dt);k&&fe.associatedIconIndex>=0&&(te[fe.associatedIconIndex]={shiftedAnchor:Mt,angle:Dt})}else Ct(fe.numGlyphs,W)}if(k){ie.clear();const ne=m.icon.placedSymbolArray;for(let fe=0;fe<ne.length;fe++){const _e=ne.get(fe);if(_e.hidden)Ct(_e.numGlyphs,ie);else{const xe=te[fe];if(xe)for(let se=0;se<_e.numGlyphs;se++)l.addDynamicAttributes(ie,xe.shiftedAnchor,xe.angle);else Ct(_e.numGlyphs,ie)}}m.icon.dynamicLayoutVertexBuffer.updateData(ie)}m.text.dynamicLayoutVertexBuffer.updateData(W)}function Fg(m,o,h){return h.iconsInText&&o?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function cc(m,o,h,p,_,x,E,C,L,k,D,N){const W=m.context,ie=W.gl,te=m.transform,ne=C==="map",fe=L==="map",_e=C!=="viewport"&&h.layout.get("symbol-placement")!=="point",xe=ne&&!fe&&!_e,se=!h.layout.get("symbol-sort-key").isConstant();let Te=!1;const we=m.depthModeForSublayer(0,Wt.ReadOnly),Me=h.layout.get("text-variable-anchor"),ke=[];for(const Ne of p){const Ie=o.getTile(Ne),tt=Ie.getBucket(h);if(!tt)continue;const Ze=_?tt.text:tt.icon;if(!Ze||!Ze.segments.get().length)continue;const it=Ze.programConfigurations.get(h.id),Mt=_||tt.sdfIcons,Dt=_?tt.textSizeData:tt.iconSizeData,_t=fe||te.pitch!==0,sn=m.useProgram(Fg(Mt,_,tt),it),on=l.evaluateSizeForZoom(Dt,te.zoom),$t=m.style.terrain&&m.style.terrain.getTerrainData(Ne);let Ht,ln,ai,ds,Ur=[0,0],fs=null;if(_){if(ln=Ie.glyphAtlasTexture,ai=ie.LINEAR,Ht=Ie.glyphAtlasTexture.size,tt.iconsInText){Ur=Ie.imageAtlasTexture.size,fs=Ie.imageAtlasTexture;const Sr=Dt.kind==="composite"||Dt.kind==="camera";ds=_t||m.options.rotating||m.options.zooming||Sr?ie.LINEAR:ie.NEAREST}}else{const Sr=h.layout.get("icon-size").constantOr(0)!==1||tt.iconsNeedLinear;ln=Ie.imageAtlasTexture,ai=Mt||m.options.rotating||m.options.zooming||Sr||_t?ie.LINEAR:ie.NEAREST,Ht=Ie.imageAtlasTexture.size}const io=Mn(Ie,1,m.transform.zoom),Tr=as(Ne.posMatrix,fe,ne,m.transform,io),qi=Ti(Ne.posMatrix,fe,ne,m.transform,io),Ls=Me&&tt.hasTextData(),_c=h.layout.get("icon-text-fit")!=="none"&&Ls&&tt.hasIconData();if(_e){const Sr=m.style.terrain?(sh,_a)=>m.style.terrain.getElevation(Ne,sh,_a):null,Co=h.layout.get("text-rotation-alignment")==="map";Di(tt,Ne.posMatrix,m,_,Tr,qi,fe,k,Co,Sr)}const ei=m.translatePosMatrix(Ne.posMatrix,Ie,x,E),Nt=_e||_&&Me||_c?Dg:Tr,tn=m.translatePosMatrix(qi,Ie,x,E,!0),li=Mt&&h.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ci;ci=Mt?tt.iconsInText?Qd(Dt.kind,on,xe,fe,m,ei,Nt,tn,Ht,Ur):nc(Dt.kind,on,xe,fe,m,ei,Nt,tn,_,Ht,!0):ku(Dt.kind,on,xe,fe,m,ei,Nt,tn,_,Ht);const bn={program:sn,buffers:Ze,uniformValues:ci,atlasTexture:ln,atlasTextureIcon:fs,atlasInterpolation:ai,atlasInterpolationIcon:ds,isSDF:Mt,hasHalo:li};if(se&&tt.canOverlap){Te=!0;const Sr=Ze.segments.get();for(const Co of Sr)ke.push({segments:new l.SegmentVector([Co]),sortKey:Co.sortKey,state:bn,terrainData:$t})}else ke.push({segments:Ze.segments,sortKey:0,state:bn,terrainData:$t})}Te&&ke.sort((Ne,Ie)=>Ne.sortKey-Ie.sortKey);for(const Ne of ke){const Ie=Ne.state;if(W.activeTexture.set(ie.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,ie.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&(W.activeTexture.set(ie.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),Ie.isSDF){const tt=Ie.uniformValues;Ie.hasHalo&&(tt.u_is_halo=1,rl(Ie.buffers,Ne.segments,h,m,Ie.program,we,D,N,tt,Ne.terrainData)),tt.u_is_halo=0}rl(Ie.buffers,Ne.segments,h,m,Ie.program,we,D,N,Ie.uniformValues,Ne.terrainData)}}function rl(m,o,h,p,_,x,E,C,L,k){const D=p.context;_.draw(D,D.gl.TRIANGLES,x,E,C,vn.disabled,L,k,h.id,m.layoutVertexBuffer,m.indexBuffer,o,h.paint,p.transform.zoom,m.programConfigurations.get(h.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function sl(m,o,h,p,_,x,E){const C=m.context.gl,L=h.paint.get("fill-pattern"),k=L&&L.constantOr(1),D=h.getCrossfadeParameters();let N,W,ie,te,ne;E?(W=k&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=C.LINES):(W=k?"fillPattern":"fill",N=C.TRIANGLES);for(const fe of p){const _e=o.getTile(fe);if(k&&!_e.patternsLoaded())continue;const xe=_e.getBucket(h);if(!xe)continue;const se=xe.programConfigurations.get(h.id),Te=m.useProgram(W,se),we=m.style.terrain&&m.style.terrain.getTerrainData(fe);k&&(m.context.activeTexture.set(C.TEXTURE0),_e.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),se.updatePaintBuffers(D));const Me=L.constantOr(null);if(Me&&_e.imageAtlas){const Ie=_e.imageAtlas,tt=Ie.patternPositions[Me.to.toString()],Ze=Ie.patternPositions[Me.from.toString()];tt&&Ze&&se.setConstantPatternPositions(tt,Ze)}const ke=we?fe:null,Ne=m.translatePosMatrix(ke?ke.posMatrix:fe.posMatrix,_e,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){te=xe.indexBuffer2,ne=xe.segments2;const Ie=[C.drawingBufferWidth,C.drawingBufferHeight];ie=W==="fillOutlinePattern"&&k?el(Ne,m,D,_e,Ie):aa(Ne,Ie)}else te=xe.indexBuffer,ne=xe.segments,ie=k?oa(Ne,m,D,_e):sa(Ne);Te.draw(m.context,N,_,m.stencilModeForClipping(fe),x,vn.disabled,ie,we,h.id,xe.layoutVertexBuffer,te,ne,h.paint,m.transform.zoom,se)}}function ol(m,o,h,p,_,x,E){const C=m.context,L=C.gl,k=h.paint.get("fill-extrusion-pattern"),D=k.constantOr(1),N=h.getCrossfadeParameters(),W=h.paint.get("fill-extrusion-opacity");for(const ie of p){const te=o.getTile(ie),ne=te.getBucket(h);if(!ne)continue;const fe=m.style.terrain&&m.style.terrain.getTerrainData(ie),_e=ne.programConfigurations.get(h.id),xe=m.useProgram(D?"fillExtrusionPattern":"fillExtrusion",_e);D&&(m.context.activeTexture.set(L.TEXTURE0),te.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),_e.updatePaintBuffers(N));const se=k.constantOr(null);if(se&&te.imageAtlas){const ke=te.imageAtlas,Ne=ke.patternPositions[se.to.toString()],Ie=ke.patternPositions[se.from.toString()];Ne&&Ie&&_e.setConstantPatternPositions(Ne,Ie)}const Te=m.translatePosMatrix(ie.posMatrix,te,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),we=h.paint.get("fill-extrusion-vertical-gradient"),Me=D?Br(Te,m,we,W,ie,N,te):Ys(Te,m,we,W);xe.draw(C,C.gl.TRIANGLES,_,x,E,vn.backCCW,Me,fe,h.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,h.paint,m.transform.zoom,_e,m.style.terrain&&ne.centroidVertexBuffer)}}function $u(m,o,h,p,_,x,E){const C=m.context,L=C.gl,k=h.fbo;if(!k)return;const D=m.useProgram("hillshade"),N=m.style.terrain&&m.style.terrain.getTerrainData(o);C.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,k.colorAttachment.get()),D.draw(C,L.TRIANGLES,_,x,E,vn.disabled,((W,ie,te,ne)=>{const fe=te.paint.get("hillshade-shadow-color"),_e=te.paint.get("hillshade-highlight-color"),xe=te.paint.get("hillshade-accent-color");let se=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(se-=W.transform.angle);const Te=!W.options.moving;return{u_matrix:ne?ne.posMatrix:W.transform.calculatePosMatrix(ie.tileID.toUnwrapped(),Te),u_image:0,u_latrange:Ae(0,ie.tileID),u_light:[te.paint.get("hillshade-exaggeration"),se],u_shadow:fe,u_highlight:_e,u_accent:xe}})(m,h,p,N?o:null),N,p.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function uf(m,o,h,p,_,x){const E=m.context,C=E.gl,L=o.dem;if(L&&L.data){const k=L.dim,D=L.stride,N=L.getPixels();if(E.activeTexture.set(C.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(D),o.demTexture){const ie=o.demTexture;ie.update(N,{premultiply:!1}),ie.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else o.demTexture=new K(E,N,C.RGBA,{premultiply:!1}),o.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);E.activeTexture.set(C.TEXTURE0);let W=o.fbo;if(!W){const ie=new K(E,{width:k,height:k,data:null},C.RGBA);ie.bind(C.LINEAR,C.CLAMP_TO_EDGE),W=o.fbo=E.createFramebuffer(k,k,!0),W.colorAttachment.set(ie.texture)}E.bindFramebuffer.set(W.framebuffer),E.viewport.set([0,0,k,k]),m.useProgram("hillshadePrepare").draw(E,C.TRIANGLES,p,_,x,vn.disabled,((ie,te)=>{const ne=te.stride,fe=l.create();return l.ortho(fe,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(fe,fe,[0,-l.EXTENT,0]),{u_matrix:fe,u_image:1,u_dimension:[ne,ne],u_zoom:ie.overscaledZ,u_unpack:te.getUnpackVector()}})(o.tileID,L),null,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function uc(m,o,h,p,_,x){const E=p.paint.get("raster-fade-duration");if(!x&&E>0){const C=l.exported.now(),L=(C-m.timeAdded)/E,k=o?(C-o.timeAdded)/E:-1,D=h.getSource(),N=_.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),W=!o||Math.abs(o.tileID.overscaledZ-N)>Math.abs(m.tileID.overscaledZ-N),ie=W&&m.refreshedUponExpiration?1:l.clamp(W?L:1-k,0,1);return m.refreshedUponExpiration&&L>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}const hc=new l.Color(1,0,0,1),Nr=new l.Color(0,1,0,1),hf=new l.Color(0,0,1,1),Hu=new l.Color(1,0,1,1),df=new l.Color(0,1,1,1);function So(m,o,h,p){da(m,0,o+h/2,m.transform.width,h,p)}function al(m,o,h,p){da(m,o-h/2,0,h,m.transform.height,p)}function da(m,o,h,p,_,x){const E=m.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(o*m.pixelRatio,h*m.pixelRatio,p*m.pixelRatio,_*m.pixelRatio),E.clear({color:x}),C.disable(C.SCISSOR_TEST)}function Bg(m,o,h){const p=m.context,_=p.gl,x=h.posMatrix,E=m.useProgram("debug"),C=Wt.disabled,L=pn.disabled,k=m.colorModeForRenderPass(),D="$debug",N=m.style.terrain&&m.style.terrain.getTerrainData(h);p.activeTexture.set(_.TEXTURE0),m.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const W=o.getTileByID(h.key).latestRawTileData,ie=Math.floor((W&&W.byteLength||0)/1024),te=o.getTile(h).tileSize,ne=512/Math.min(te,512)*(h.overscaledZ/m.transform.zoom)*.5;let fe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(fe+=` => ${h.overscaledZ}`),function(_e,xe){_e.initDebugOverlayCanvas();const se=_e.debugOverlayCanvas,Te=_e.context.gl,we=_e.debugOverlayCanvas.getContext("2d");we.clearRect(0,0,se.width,se.height),we.shadowColor="white",we.shadowBlur=2,we.lineWidth=1.5,we.strokeStyle="white",we.textBaseline="top",we.font="bold 36px Open Sans, sans-serif",we.fillText(xe,5,5),we.strokeText(xe,5,5),_e.debugOverlayTexture.update(se),_e.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}(m,`${fe} ${ie}kB`),E.draw(p,_.TRIANGLES,C,L,gn.alphaBlended,vn.disabled,$(x,l.Color.transparent,ne),null,D,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),E.draw(p,_.LINE_STRIP,C,L,k,vn.disabled,$(x,l.Color.red),N,D,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function dc(m,o,h){const p=m.context,_=p.gl,x=m.colorModeForRenderPass(),E=new Wt(_.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D),C=m.useProgram("terrain"),L=o.getTerrainMesh(),k=o.getTerrainData(h.tileID);p.bindFramebuffer.set(null),p.viewport.set([0,0,m.width,m.height]),p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,o.getRTTFramebuffer().colorAttachment.get());const D=m.transform.calculatePosMatrix(h.tileID.toUnwrapped());C.draw(p,_.TRIANGLES,E,pn.disabled,x,vn.backCCW,{u_matrix:D,u_texture:0},k,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}function ff(m,o,h,p){const _=m.context,x=h.tileSize*o.qualityFactor;h.textures[p]||(h.textures[p]=m.getTileTexture(x)||new K(_,{width:x,height:x,data:null},_.gl.RGBA),h.textures[p].bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),p===0&&o.sourceCache.renderHistory.unshift(h.tileID.key));const E=o.getRTTFramebuffer();E.colorAttachment.set(h.textures[p].texture),_.bindFramebuffer.set(E.framebuffer),_.viewport.set([0,0,x,x])}class pf{constructor(o){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=o,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=o.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const o=this.painter.style,h=o.terrain;for(const p in o.sourceCaches){this._coordsDescendingInv[p]={};const _=o.sourceCaches[p].getVisibleCoordinates();for(const x of _){const E=h.sourceCache.getTerrainCoords(x);for(const C in E)this._coordsDescendingInv[p][C]||(this._coordsDescendingInv[p][C]=[]),this._coordsDescendingInv[p][C].push(E[C])}}for(const p of o._order){const _=o._layers[p],x=_.source;if(this._renderToTexture[_.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const E in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][E]=this._coordsDescendingInv[x][E].map(C=>C.key).sort().join()}}return this._renderableTiles.forEach(p=>{for(const _ in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[_][p.tileID.key];x&&x!==p.textureCoords[_]&&p.clearTextures(this.painter),h.needsRerender(_,p.tileID)&&p.clearTextures(this.painter)}this._rerender[p.tileID.key]=!p.textures.length}),h.clearRerenderCache(),h.sourceCache.removeOutdated(this.painter),this}renderLayer(o){const h=o.type,p=this.painter,_=p.style._order,x=p.currentLayer,E=x+1===_.length;if(this._renderToTexture[h]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(_[x]),!E))return!0;if(this._renderToTexture[this._prevType]||h==="hillshade"||this._renderToTexture[h]&&E){this._prevType=h;const C=this._stacks.length-1,L=this._stacks[C]||[];for(const k of this._renderableTiles){if(ff(p,p.style.terrain,k,C),this._rerender[k.tileID.key]){p.context.clear({color:l.Color.transparent});for(let D=0;D<L.length;D++){const N=p.style._layers[L[D]],W=N.source?this._coordsDescendingInv[N.source][k.tileID.key]:[k.tileID];p._renderTileClippingMasks(N,W),p.renderLayer(p,p.style.sourceCaches[N.source],N,W),N.source&&(k.textureCoords[N.source]=this._coordsDescendingInvStr[N.source][k.tileID.key])}}dc(p,p.style.terrain,k)}if(h==="hillshade"){this._stacks.push([_[x]]);for(const k of this._renderableTiles){const D=this._coordsDescendingInv[o.source][k.tileID.key];ff(p,p.style.terrain,k,this._stacks.length-1),p.context.clear({color:l.Color.transparent}),p._renderTileClippingMasks(o,D),p.renderLayer(p,p.style.sourceCaches[o.source],o,D),dc(p,p.style.terrain,k)}return!0}return this._renderToTexture[h]}return!1}}const ll={symbol:function(m,o,h,p,_){if(m.renderPass!=="translucent")return;const x=pn.disabled,E=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(C,L,k,D,N,W,ie){const te=L.transform,ne=N==="map",fe=W==="map";for(const _e of C){const xe=D.getTile(_e),se=xe.getBucket(k);if(!se||!se.text||!se.text.segments.get().length)continue;const Te=l.evaluateSizeForZoom(se.textSizeData,te.zoom),we=Mn(xe,1,L.transform.zoom),Me=as(_e.posMatrix,fe,ne,L.transform,we),ke=k.layout.get("icon-text-fit")!=="none"&&se.hasIconData();if(Te){const Ne=Math.pow(2,te.zoom-xe.tileID.overscaledZ);cf(se,ne,fe,ie,te,Me,_e.posMatrix,Ne,Te,ke,L.style.terrain?(Ie,tt)=>L.style.terrain.getElevation(_e,Ie,tt):null)}}}(p,m,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),_),h.paint.get("icon-opacity").constantOr(1)!==0&&cc(m,o,h,p,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),x,E),h.paint.get("text-opacity").constantOr(1)!==0&&cc(m,o,h,p,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),x,E),o.map.showCollisionBoxes&&(ha(m,o,h,p,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),ha(m,o,h,p,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),C=!h.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(x.constantOr(1)===0||E.constantOr(1)===0))return;const L=m.context,k=L.gl,D=m.depthModeForSublayer(0,Wt.ReadOnly),N=pn.disabled,W=m.colorModeForRenderPass(),ie=[];for(let te=0;te<p.length;te++){const ne=p[te],fe=o.getTile(ne),_e=fe.getBucket(h);if(!_e)continue;const xe=_e.programConfigurations.get(h.id),se=m.useProgram("circle",xe),Te=_e.layoutVertexBuffer,we=_e.indexBuffer,Me=m.style.terrain&&m.style.terrain.getTerrainData(ne),ke={programConfiguration:xe,program:se,layoutVertexBuffer:Te,indexBuffer:we,uniformValues:tc(m,ne,fe,h),terrainData:Me};if(C){const Ne=_e.segments.get();for(const Ie of Ne)ie.push({segments:new l.SegmentVector([Ie]),sortKey:Ie.sortKey,state:ke})}else ie.push({segments:_e.segments,sortKey:0,state:ke})}C&&ie.sort((te,ne)=>te.sortKey-ne.sortKey);for(const te of ie){const{programConfiguration:ne,program:fe,layoutVertexBuffer:_e,indexBuffer:xe,uniformValues:se,terrainData:Te}=te.state;fe.draw(L,k.TRIANGLES,D,N,W,vn.disabled,se,Te,h.id,_e,xe,te.segments,h.paint,m.transform.zoom,ne)}},heatmap:function(m,o,h,p){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const _=m.context,x=_.gl,E=pn.disabled,C=new gn([x.ONE,x.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(L,k,D){const N=L.gl;L.activeTexture.set(N.TEXTURE1),L.viewport.set([0,0,k.width/4,k.height/4]);let W=D.heatmapFbo;if(W)N.bindTexture(N.TEXTURE_2D,W.colorAttachment.get()),L.bindFramebuffer.set(W.framebuffer);else{const ie=N.createTexture();N.bindTexture(N.TEXTURE_2D,ie),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),W=D.heatmapFbo=L.createFramebuffer(k.width/4,k.height/4,!1),function(te,ne,fe,_e){const xe=te.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,ne.width/4,ne.height/4,0,xe.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),_e.colorAttachment.set(fe)}(L,k,ie,W)}})(_,m,h),_.clear({color:l.Color.transparent});for(let L=0;L<p.length;L++){const k=p[L];if(o.hasRenderableParent(k))continue;const D=o.getTile(k),N=D.getBucket(h);if(!N)continue;const W=N.programConfigurations.get(h.id),ie=m.useProgram("heatmap",W),{zoom:te}=m.transform;ie.draw(_,x.TRIANGLES,Wt.disabled,E,C,vn.disabled,he(k.posMatrix,D,te,h.paint.get("heatmap-intensity")),null,h.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,h.paint,m.transform.zoom,W)}_.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(_,x){const E=_.context,C=E.gl,L=x.heatmapFbo;if(!L)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,L.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1);let k=x.colorRampTexture;k||(k=x.colorRampTexture=new K(E,x.colorRamp,C.RGBA)),k.bind(C.LINEAR,C.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,C.TRIANGLES,Wt.disabled,pn.disabled,_.colorModeForRenderPass(),vn.disabled,((D,N,W,ie)=>{const te=l.create();l.ortho(te,0,D.width,D.height,0,0,1);const ne=D.context.gl;return{u_matrix:te,u_world:[ne.drawingBufferWidth,ne.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(_,x),null,x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(m,h))},line:function(m,o,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const E=m.depthModeForSublayer(0,Wt.ReadOnly),C=m.colorModeForRenderPass(),L=h.paint.get("line-dasharray"),k=h.paint.get("line-pattern"),D=k.constantOr(1),N=h.paint.get("line-gradient"),W=h.getCrossfadeParameters(),ie=D?"linePattern":L?"lineSDF":N?"lineGradient":"line",te=m.context,ne=te.gl;let fe=!0;for(const _e of p){const xe=o.getTile(_e);if(D&&!xe.patternsLoaded())continue;const se=xe.getBucket(h);if(!se)continue;const Te=se.programConfigurations.get(h.id),we=m.context.program.get(),Me=m.useProgram(ie,Te),ke=fe||Me.program!==we,Ne=m.style.terrain&&m.style.terrain.getTerrainData(_e),Ie=k.constantOr(null);if(Ie&&xe.imageAtlas){const it=xe.imageAtlas,Mt=it.patternPositions[Ie.to.toString()],Dt=it.patternPositions[Ie.from.toString()];Mt&&Dt&&Te.setConstantPatternPositions(Mt,Dt)}const tt=Ne?_e:null,Ze=D?Bt(m,xe,h,W,tt):L?En(m,xe,h,L,W,tt):N?at(m,xe,h,se.lineClipsArray.length,tt):Ue(m,xe,h,tt);if(D)te.activeTexture.set(ne.TEXTURE0),xe.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Te.updatePaintBuffers(W);else if(L&&(ke||m.lineAtlas.dirty))te.activeTexture.set(ne.TEXTURE0),m.lineAtlas.bind(te);else if(N){const it=se.gradients[h.id];let Mt=it.texture;if(h.gradientVersion!==it.version){let Dt=256;if(h.stepInterpolant){const _t=o.getSource().maxzoom,sn=_e.canonical.z===_t?Math.ceil(1<<m.transform.maxZoom-_e.canonical.z):1;Dt=l.clamp(l.nextPowerOfTwo(se.maxLineLength/l.EXTENT*1024*sn),256,te.maxTextureSize)}it.gradient=l.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Dt,image:it.gradient||void 0,clips:se.lineClipsArray}),it.texture?it.texture.update(it.gradient):it.texture=new K(te,it.gradient,ne.RGBA),it.version=h.gradientVersion,Mt=it.texture}te.activeTexture.set(ne.TEXTURE0),Mt.bind(h.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}Me.draw(te,ne.TRIANGLES,E,m.stencilModeForClipping(_e),C,vn.disabled,Ze,Ne,h.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,h.paint,m.transform.zoom,Te,se.layoutVertexBuffer2),fe=!1}},fill:function(m,o,h,p){const _=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const E=m.colorModeForRenderPass(),C=h.paint.get("fill-pattern"),L=m.opaquePassEnabledForLayer()&&!C.constantOr(1)&&_.constantOr(l.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===L){const k=m.depthModeForSublayer(1,m.renderPass==="opaque"?Wt.ReadWrite:Wt.ReadOnly);sl(m,o,h,p,k,E,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){const k=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,Wt.ReadOnly);sl(m,o,h,p,k,E,!0)}},"fill-extrusion":function(m,o,h,p){const _=h.paint.get("fill-extrusion-opacity");if(_!==0&&m.renderPass==="translucent"){const x=new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D);if(_!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))ol(m,o,h,p,x,pn.disabled,gn.disabled),ol(m,o,h,p,x,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const E=m.colorModeForRenderPass();ol(m,o,h,p,x,pn.disabled,E)}}},hillshade:function(m,o,h,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const _=m.context,x=m.depthModeForSublayer(0,Wt.ReadOnly),E=m.colorModeForRenderPass(),[C,L]=m.renderPass==="translucent"?m.stencilConfigForOverlap(p):[{},p];for(const k of L){const D=o.getTile(k);D.needsHillshadePrepare!==void 0&&D.needsHillshadePrepare&&m.renderPass==="offscreen"?uf(m,D,h,x,pn.disabled,E):m.renderPass==="translucent"&&$u(m,k,D,h,x,C[k.overscaledZ],E)}_.viewport.set([0,0,m.width,m.height])},raster:function(m,o,h,p){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!p.length)return;const _=m.context,x=_.gl,E=o.getSource(),C=m.useProgram("raster"),L=m.colorModeForRenderPass(),[k,D]=E instanceof Et?[{},p]:m.stencilConfigForOverlap(p),N=D[D.length-1].overscaledZ,W=!m.options.moving;for(const ie of D){const te=m.depthModeForSublayer(ie.overscaledZ-N,h.paint.get("raster-opacity")===1?Wt.ReadWrite:Wt.ReadOnly,x.LESS),ne=o.getTile(ie);ne.registerFadeDuration(h.paint.get("raster-fade-duration"));const fe=o.findLoadedParent(ie,0),_e=uc(ne,fe,o,h,m.transform,m.style.terrain);let xe,se;const Te=h.paint.get("raster-resampling")==="nearest"?x.NEAREST:x.LINEAR;_.activeTexture.set(x.TEXTURE0),ne.texture.bind(Te,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(x.TEXTURE1),fe?(fe.texture.bind(Te,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),xe=Math.pow(2,fe.tileID.overscaledZ-ne.tileID.overscaledZ),se=[ne.tileID.canonical.x*xe%1,ne.tileID.canonical.y*xe%1]):ne.texture.bind(Te,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST);const we=m.style.terrain&&m.style.terrain.getTerrainData(ie),Me=we?ie:null,ke=Me?Me.posMatrix:m.transform.calculatePosMatrix(ie.toUnwrapped(),W),Ne=or(ke,se||[0,0],xe||1,_e,h);E instanceof Et?C.draw(_,x.TRIANGLES,te,pn.disabled,L,vn.disabled,Ne,we,h.id,E.boundsBuffer,m.quadTriangleIndexBuffer,E.boundsSegments):C.draw(_,x.TRIANGLES,te,k[ie.overscaledZ],L,vn.disabled,Ne,we,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,o,h,p){const _=h.paint.get("background-color"),x=h.paint.get("background-opacity");if(x===0)return;const E=m.context,C=E.gl,L=m.transform,k=L.tileSize,D=h.paint.get("background-pattern");if(m.isPatternMissing(D))return;const N=!D&&_.a===1&&x===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==N)return;const W=pn.disabled,ie=m.depthModeForSublayer(0,N==="opaque"?Wt.ReadWrite:Wt.ReadOnly),te=m.colorModeForRenderPass(),ne=m.useProgram(D?"backgroundPattern":"background"),fe=p||L.coveringTiles({tileSize:k,terrain:m.style.terrain});D&&(E.activeTexture.set(C.TEXTURE0),m.imageManager.bind(m.context));const _e=h.getCrossfadeParameters();for(const xe of fe){const se=p?xe.posMatrix:m.transform.calculatePosMatrix(xe.toUnwrapped()),Te=D?Pg(se,x,m,D,{tileID:xe,tileSize:k},_e):Ag(se,x,_),we=m.style.terrain&&m.style.terrain.getTerrainData(xe);ne.draw(E,C.TRIANGLES,ie,W,te,vn.disabled,Te,we,h.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,o,h){for(let p=0;p<h.length;p++)Bg(m,o,h[p])},custom:function(m,o,h){const p=m.context,_=h.implementation;if(m.renderPass==="offscreen"){const x=_.prerender;x&&(m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),x.call(_,p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),p.setStencilMode(pn.disabled);const x=_.renderingMode==="3d"?new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Wt.ReadOnly);p.setDepthMode(x),_.render(p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState(),p.bindFramebuffer.set(null)}}};class qu{constructor(o,h){this.context=new lf(o),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=qt.maxUnderzooming+qt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new dt,this.gpuTimers={}}resize(o,h,p){if(this.width=o*p,this.height=h*p,this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const o=this.context,h=new l.PosArray;h.emplaceBack(0,0),h.emplaceBack(l.EXTENT,0),h.emplaceBack(0,l.EXTENT),h.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(h,Rt.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.PosArray;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=o.createVertexBuffer(p,Rt.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const _=new l.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(l.EXTENT,0,l.EXTENT,0),_.emplaceBack(0,l.EXTENT,0,l.EXTENT),_.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(_,nt.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const x=new l.PosArray;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(x,Rt.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const E=new l.LineStripIndexArray;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(E);const C=new l.TriangleIndexArray;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(C),this.emptyTexture=new K(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA);const L=this.context.gl;this.stencilClearMode=new pn({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.create();l.ortho(p,0,this.width,this.height,0,0,1),l.scale(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,h.TRIANGLES,Wt.disabled,this.stencilClearMode,gn.disabled,vn.disabled,Q(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h){if(this.currentStencilSource===o.source||!o.isTileClipped()||!h||!h.length)return;this.currentStencilSource=o.source;const p=this.context,_=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(gn.disabled),p.setDepthMode(Wt.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const C=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,L=this.style.terrain&&this.style.terrain.getTerrainData(E);x.draw(p,_.TRIANGLES,Wt.disabled,new pn({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),gn.disabled,vn.disabled,Q(E.posMatrix),L,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new pn({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){const h=this.context.gl;return new pn({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,p=o.sort((E,C)=>C.overscaledZ-E.overscaledZ),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let C=0;C<x;C++)E[C+_]=new pn({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[E,p]}return[{[_]:pn.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new gn([o.CONSTANT_COLOR,o.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gn.unblended:gn.alphaBlended}depthModeForSublayer(o,h,p){if(!this.opaquePassEnabledForLayer())return Wt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Wt(p||this.context.gl.LEQUAL,h,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const p=this.style._order,_=this.style.sourceCaches,x=this.style.terrain&&new pf(this);for(const k in _){const D=_[k];D.used&&D.prepare(this.context)}const E={},C={},L={};for(const k in _){const D=_[k];E[k]=D.getVisibleCoordinates(),C[k]=E[k].slice().reverse(),L[k]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<p.length;k++)if(this.style._layers[p[k]].is3D()){this.opaquePassCutoff=k;break}if(x){this.opaquePassCutoff=0;const k=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(D,N){const W=D.context,ie=W.gl,te=gn.unblended,ne=new Wt(ie.LEQUAL,Wt.ReadWrite,[0,1]),fe=N.getTerrainMesh(),_e=N.sourceCache.getRenderableTiles(),xe=D.useProgram("terrainDepth");W.bindFramebuffer.set(N.getFramebuffer("depth").framebuffer),W.viewport.set([0,0,D.width/devicePixelRatio,D.height/devicePixelRatio]),W.clear({color:l.Color.transparent,depth:1});for(const se of _e){const Te=N.getTerrainData(se.tileID),we=D.transform.calculatePosMatrix(se.tileID.toUnwrapped());xe.draw(W,ie.TRIANGLES,ne,pn.disabled,te,vn.backCCW,{u_matrix:we},Te,"terrain",fe.vertexBuffer,fe.indexBuffer,fe.segments)}W.bindFramebuffer.set(null),W.viewport.set([0,0,D.width,D.height])}(this,this.style.terrain),function(D,N){const W=D.context,ie=W.gl,te=gn.unblended,ne=new Wt(ie.LEQUAL,Wt.ReadWrite,[0,1]),fe=N.getTerrainMesh(),_e=N.getCoordsTexture(),xe=N.sourceCache.getRenderableTiles(),se=D.useProgram("terrainCoords");W.bindFramebuffer.set(N.getFramebuffer("coords").framebuffer),W.viewport.set([0,0,D.width/devicePixelRatio,D.height/devicePixelRatio]),W.clear({color:l.Color.transparent,depth:1}),N.coordsIndex=[];for(const Te of xe){const we=N.getTerrainData(Te.tileID);W.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,_e.texture);const Me=D.transform.calculatePosMatrix(Te.tileID.toUnwrapped());se.draw(W,ie.TRIANGLES,ne,pn.disabled,te,vn.backCCW,{u_matrix:Me,u_terrain_coords_id:(255-N.coordsIndex.length)/255,u_texture:0},we,"terrain",fe.vertexBuffer,fe.indexBuffer,fe.segments),N.coordsIndex.push(Te.tileID.key)}W.bindFramebuffer.set(null),W.viewport.set([0,0,D.width,D.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const k of p){const D=this.style._layers[k];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const N=C[D.source];(D.type==="custom"||N.length)&&this.renderLayer(this,_[D.source],D,N)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!x)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[p[this.currentLayer]],D=_[k.source],N=E[k.source];this._renderTileClippingMasks(k,N),this.renderLayer(this,D,k,N)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const k=this.style._layers[p[this.currentLayer]],D=_[k.source];if(x&&x.renderLayer(k))continue;const N=(k.type==="symbol"?L:C)[k.source];this._renderTileClippingMasks(k,E[k.source]),this.renderLayer(this,D,k,N)}if(this.options.showTileBoundaries){let k,D;Object.values(this.style._layers).forEach(N=>{N.source&&!N.isHidden(this.transform.zoom)&&(N.source!==(D&&D.id)&&(D=this.style.sourceCaches[N.source]),(!k||k.getSource().maxzoom<D.getSource().maxzoom)&&(k=D))}),k&&ll.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const D=k.transform.padding;So(k,k.transform.height-(D.top||0),3,hc),So(k,D.bottom||0,3,Nr),al(k,D.left||0,3,hf),al(k,k.transform.width-(D.right||0),3,Hu);const N=k.transform.centerPoint;(function(W,ie,te,ne){da(W,ie-1,te-10,2,20,ne),da(W,ie-10,te-1,20,2,ne)})(k,N.x,k.transform.height-N.y,df)}(this),this.context.setDefault()}renderLayer(o,h,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(_||[]).length)&&(this.id=p.id,this.gpuTimingStart(p),ll[p.type](o,h,p,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let p=this.gpuTimers[o.id];p||(p=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),p.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const h={};for(const p in o){const _=o[p],x=this.context.extTimerQuery,E=x.getQueryObjectEXT(_.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(_.query),h[p]=E}return h}translatePosMatrix(o,h,p,_,x){if(!p[0]&&!p[1])return o;const E=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(E){const k=Math.sin(E),D=Math.cos(E);p=[p[0]*D-p[1]*k,p[0]*k+p[1]*D]}const C=[x?p[0]:Mn(h,p[0],this.transform.zoom),x?p[1]:Mn(h,p[1],this.transform.zoom),0],L=new Float32Array(16);return l.translate(L,o,C),L}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!h||!p}useProgram(o,h){this.cache=this.cache||{};const p=o+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new ia(this.context,o,pi[o],h,Ru[o],this._showOverdrawInspector,this.style.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new K(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class fc{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,p){const _=Math.pow(2,p),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const L=1/(C=l.transformMat4([],C,o))[3]/h*_;return l.mul$1(C,C,[L,L,1/C[3],L])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const L=l.sub([],x[C[0]],x[C[1]]),k=l.sub([],x[C[2]],x[C[1]]),D=l.normalize([],l.cross([],L,k)),N=-l.dot(D,x[C[1]]);return D.concat(N)});return new fc(x,E)}}class cl{constructor(o,h){this.min=o,this.max=h,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(o){const h=[o%2==0,o<2],p=l.clone$2(this.min),_=l.clone$2(this.max);for(let x=0;x<h.length;x++)p[x]=h[x]?this.min[x]:this.center[x],_[x]=h[x]?this.center[x]:this.max[x];return _[2]=this.max[2],new cl(p,_)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<o.planes.length;_++){const x=o.planes[_];let E=0;for(let C=0;C<h.length;C++)l.dot$1(x,h[C])>=0&&E++;if(E===0)return 0;E!==h.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let x=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let C=0;C<o.points.length;C++){const L=o.points[C][_]-this.min[_];x=Math.min(x,L),E=Math.max(E,L)}if(E<0||x>this.max[_]-this.min[_])return 0}return 1}}class fa{constructor(o=0,h=0,p=0,_=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=p,this.right=_}interpolate(o,h,p){return h.top!=null&&o.top!=null&&(this.top=l.number(o.top,h.top,p)),h.bottom!=null&&o.bottom!=null&&(this.bottom=l.number(o.bottom,h.bottom,p)),h.left!=null&&o.left!=null&&(this.left=l.number(o.left,h.left,p)),h.right!=null&&o.right!=null&&(this.right=l.number(o.right,h.right,p)),this}getCenter(o,h){const p=l.clamp((this.left+o-this.right)/2,0,o),_=l.clamp((this.top+h-this.bottom)/2,0,h);return new l.pointGeometry(p,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new fa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ul{constructor(o,h,p,_,x){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=x===void 0||!!x,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new fa,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const o=new ul(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.tileSize=this.tileSize,o.latRange=this.latRange,o.width=this.width,o.height=this.height,o._center=this._center,o._elevation=this._elevation,o.zoom=this.zoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-l.wrap(o,-180,180)*Math.PI/180;var p;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(p=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,x,E){var C=x[0],L=x[1],k=x[2],D=x[3],N=Math.sin(E),W=Math.cos(E);_[0]=C*W+k*N,_[1]=L*W+D*N,_[2]=C*-N+k*W,_[3]=L*-N+D*W}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=l.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,p){this._unmodified=!1,this._edgeInsets.interpolate(o,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new l.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.pointGeometry(0,0)),_=this.pointCoordinate(new l.pointGeometry(this.width,0)),x=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new l.pointGeometry(0,this.height)),C=Math.floor(Math.min(p.x,_.x,x.x,E.x)),L=Math.floor(Math.max(p.x,_.x,x.x,E.x)),k=1;for(let D=C-k;D<=L+k;D++)D!==0&&h.push(new l.UnwrappedTileID(D,o))}return h}coveringTiles(o){var h,p;let _=this.coveringZoomLevel(o);const x=_;if(o.minzoom!==void 0&&_<o.minzoom)return[];o.maxzoom!==void 0&&_>o.maxzoom&&(_=o.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),C=l.MercatorCoordinate.fromLngLat(this.center),L=Math.pow(2,_),k=[L*E.x,L*E.y,0],D=[L*C.x,L*C.y,0],N=fc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let W=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(W=_);const ie=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,te=se=>({aabb:new cl([se*L,0,0],[(se+1)*L,L,0]),zoom:0,x:0,y:0,wrap:se,fullyVisible:!1}),ne=[],fe=[],_e=_,xe=o.reparseOverscaled?x:_;if(this._renderWorldCopies)for(let se=1;se<=3;se++)ne.push(te(-se)),ne.push(te(se));for(ne.push(te(0));ne.length>0;){const se=ne.pop(),Te=se.x,we=se.y;let Me=se.fullyVisible;if(!Me){const it=se.aabb.intersects(N);if(it===0)continue;Me=it===2}const ke=o.terrain?k:D,Ne=se.aabb.distanceX(ke),Ie=se.aabb.distanceY(ke),tt=Math.max(Math.abs(Ne),Math.abs(Ie)),Ze=ie+(1<<_e-se.zoom)-2;if(se.zoom===_e||tt>Ze&&se.zoom>=W){const it=_e-se.zoom,Mt=k[0]-.5-(Te<<it),Dt=k[1]-.5-(we<<it);fe.push({tileID:new l.OverscaledTileID(se.zoom===_e?xe:se.zoom,se.wrap,se.zoom,Te,we),distanceSq:l.sqrLen([D[0]-.5-Te,D[1]-.5-we]),tileDistanceToCamera:Math.sqrt(Mt*Mt+Dt*Dt)})}else for(let it=0;it<4;it++){const Mt=(Te<<1)+it%2,Dt=(we<<1)+(it>>1),_t=se.zoom+1;let sn=se.aabb.quadrant(it);if(o.terrain){const on=new l.OverscaledTileID(_t,se.wrap,_t,Mt,Dt),$t=o.terrain.getMinMaxElevation(on),Ht=(h=$t.minElevation)!==null&&h!==void 0?h:this.elevation,ln=(p=$t.maxElevation)!==null&&p!==void 0?p:this.elevation;sn=new cl([sn.min[0],sn.min[1],Ht],[sn.max[0],sn.max[1],ln])}ne.push({aabb:sn,zoom:_t,x:Mt,y:Dt,wrap:se.wrap,fullyVisible:Me})}}return fe.sort((se,Te)=>se.distanceSq-Te.distanceSq).map(se=>se.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=l.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(o.lng)*this.worldSize,l.mercatorYfromLat(h)*this.worldSize)}unproject(o){return new l.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(o){this.freezeElevation||(this.elevation=o?this.getElevation(this._center,o):0)}getElevation(o,h){const p=l.MercatorCoordinate.fromLngLat(o),_=(1<<this.tileZoom)*l.EXTENT,x=p.x*_,E=p.y*_,C=Math.floor(x/l.EXTENT),L=Math.floor(E/l.EXTENT),k=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,C,L);return h.getElevation(k,x%l.EXTENT,E%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const h=this.pointLocation(this.centerPoint,o),p=this.getElevation(h,o);if(!(this.elevation-p))return;const _=this.getCameraPosition(),x=l.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),E=l.MercatorCoordinate.fromLngLat(h,p),C=x.x-E.x,L=x.y-E.y,k=x.z-E.z,D=Math.sqrt(C*C+L*L+k*k),N=this.scaleZoom(this.cameraToCenterDistance/D/this.tileSize);this._elevation=p,this._center=h,this.zoom=N}setLocationAtPoint(o,h){const p=this.pointCoordinate(h),_=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(o),E=new l.MercatorCoordinate(x.x-(p.x-_.x),x.y-(p.y-_.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,h){return h?this.coordinatePoint(this.locationCoordinate(o),this.getElevation(o,h),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,h){return this.coordinateLocation(this.pointCoordinate(o,h))}locationCoordinate(o){return l.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,h){if(h){const W=h.pointCoordinate(o);if(W!=null)return W}const p=[o.x,o.y,0,1],_=[o.x,o.y,1,1];l.transformMat4(p,p,this.pixelMatrixInverse),l.transformMat4(_,_,this.pixelMatrixInverse);const x=p[3],E=_[3],C=p[1]/x,L=_[1]/E,k=p[2]/x,D=_[2]/E,N=k===D?0:(0-k)/(D-k);return new l.MercatorCoordinate(l.number(p[0]/x,_[0]/E,N)/this.worldSize,l.number(C,L,N)/this.worldSize)}coordinatePoint(o,h=0,p=this.pixelMatrix){const _=[o.x*this.worldSize,o.y*this.worldSize,h,1];return l.transformMat4(_,_,p),new l.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,o))).extend(this.pointLocation(new l.pointGeometry(this.width,o))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,h=!1){const p=o.key,_=h?this._alignedPosMatrixCache:this._posMatrixCache;if(_[p])return _[p];const x=o.canonical,E=this.worldSize/this.zoomScale(x.z),C=x.x+Math.pow(2,x.z)*o.wrap,L=l.identity(new Float64Array(16));return l.translate(L,L,[C*E,x.y*E,0]),l.scale(L,L,[E/l.EXTENT,E/l.EXTENT,1]),l.multiply(L,h?this.alignedProjMatrix:this.projMatrix,L),_[p]=new Float32Array(L),_[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,h,p,_,x=-90,E=90,C=-180,L=180;const k=this.size,D=this._unmodified;if(this.latRange){const ie=this.latRange;x=l.mercatorYfromLat(ie[1])*this.worldSize,E=l.mercatorYfromLat(ie[0])*this.worldSize,o=E-x<k.y?k.y/(E-x):0}if(this.lngRange){const ie=this.lngRange;C=l.wrap(l.mercatorXfromLng(ie[0])*this.worldSize,0,this.worldSize),L=l.wrap(l.mercatorXfromLng(ie[1])*this.worldSize,0,this.worldSize),L<C&&(L+=this.worldSize),h=L-C<k.x?k.x/(L-C):0}const N=this.point,W=Math.max(h||0,o||0);if(W)return this.center=this.unproject(new l.pointGeometry(h?(L+C)/2:N.x,o?(E+x)/2:N.y)),this.zoom+=this.scaleZoom(W),this._unmodified=D,void(this._constraining=!1);if(this.latRange){const ie=N.y,te=k.y/2;ie-te<x&&(_=x+te),ie+te>E&&(_=E-te)}if(this.lngRange){const ie=(C+L)/2,te=l.wrap(N.x,ie-this.worldSize/2,ie+this.worldSize/2),ne=k.x/2;te-ne<C&&(p=C+ne),te+ne>L&&(p=L-ne)}p===void 0&&_===void 0||(this.center=this.unproject(new l.pointGeometry(p!==void 0?p:N.x,_!==void 0?_:N.y)).wrap()),this._unmodified=D,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=l.identity(new Float64Array(16));l.scale(_,_,[this.width/2,-this.height/2,1]),l.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=l.identity(new Float64Array(16)),l.scale(_,_,[1,-1,1]),l.translate(_,_,[-1,-1,0]),l.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const x=Math.PI/2+this._pitch,E=this._fov*(.5+o.y/this.height),C=Math.sin(E)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-x-E,.01,Math.PI-.01)),L=this.getHorizon(),k=2*Math.atan(L/this.cameraToCenterDistance)*(.5+o.y/(2*L)),D=Math.sin(k)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-x-k,.01,Math.PI-.01)),N=Math.cos(Math.PI/2-this._pitch)*C+this.cameraToSeaLevelDistance,W=Math.cos(Math.PI/2-this._pitch)*D+this.cameraToSeaLevelDistance,ie=1.01*Math.min(N,W),te=this.height/50;_=new Float64Array(16),l.perspective(_,this._fov,this.width/this.height,te,ie),_[8]=2*-o.x/this.width,_[9]=2*o.y/this.height,l.scale(_,_,[1,-1,1]),l.translate(_,_,[0,0,-this.cameraToCenterDistance]),l.rotateX(_,_,this._pitch),l.rotateZ(_,_,this.angle),l.translate(_,_,[-h,-p,0]),this.mercatorMatrix=l.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),l.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_),l.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=l.invert([],_),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const ne=this.width%2/2,fe=this.height%2/2,_e=Math.cos(this.angle),xe=Math.sin(this.angle),se=h-Math.round(h)+_e*ne+xe*fe,Te=p-Math.round(p)+_e*fe+xe*ne,we=new Float64Array(_);if(l.translate(we,we,[se>.5?se-1:se,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=we,_=l.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new l.pointGeometry(0,0)),h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return l.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,o))}getCameraQueryGeometry(o){const h=this.getCameraPoint();if(o.length===1)return[o[0],h];{let p=h.x,_=h.y,x=h.x,E=h.y;for(const C of o)p=Math.min(p,C.x),_=Math.min(_,C.y),x=Math.max(x,C.x),E=Math.max(E,C.y);return[new l.pointGeometry(p,_),new l.pointGeometry(x,_),new l.pointGeometry(x,E),new l.pointGeometry(p,E),new l.pointGeometry(p,_)]}}}class mf{constructor(o){this._hashName=o&&encodeURIComponent(o),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(h,p){let _=!1,x=null;const E=()=>{x=null,_&&(h(),x=setTimeout(E,300),_=!1)};return()=>(_=!0,x||E(),x)}(this._updateHashUnthrottled.bind(this))}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),E=Math.round(h.lng*x)/x,C=Math.round(h.lat*x)/x,L=this._map.getBearing(),k=this._map.getPitch();let D="";if(D+=o?`/${E}/${C}/${p}`:`${p}/${C}/${E}`,(L||k)&&(D+="/"+Math.round(10*L)/10),k&&(D+=`/${Math.round(k)}`),this._hashName){const N=this._hashName;let W=!1;const ie=window.location.hash.slice(1).split("&").map(te=>{const ne=te.split("=")[0];return ne===N?(W=!0,`${ne}=${D}`):te}).filter(te=>te);return W||ie.push(`${N}=${D}`),`#${ie.join("&")}`}return`#${D}`}_getCurrentHash(){const o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(h=p)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}}}const hl={linearity:.3,easing:l.bezier(0,0,.3,1)},gf=l.extend({deceleration:2500,maxSpeed:1400},hl),_f=l.extend({deceleration:20,maxSpeed:1400},hl),yf=l.extend({deceleration:1e3,maxSpeed:360},hl),pa=l.extend({deceleration:1e3,maxSpeed:90},hl);class vf{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=l.exported.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(h.pan.mag()){const x=fl(h.pan.mag(),p,l.extend({},gf,o||{}));_.offset=h.pan.mult(x.amount/h.pan.mag()),_.center=this._map.transform.center,dl(_,x)}if(h.zoom){const x=fl(h.zoom,p,_f);_.zoom=this._map.transform.zoom+x.amount,dl(_,x)}if(h.bearing){const x=fl(h.bearing,p,yf);_.bearing=this._map.transform.bearing+l.clamp(x.amount,-179,179),dl(_,x)}if(h.pitch){const x=fl(h.pitch,p,pa);_.pitch=this._map.transform.pitch+x.amount,dl(_,x)}if(_.zoom||_.bearing){const x=h.pinchAround===void 0?h.around:h.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),l.extend(_,{noMoveStart:!0})}}function dl(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function fl(m,o,h){const{maxSpeed:p,linearity:_,deceleration:x}=h,E=l.clamp(m*_/(o/1e3),-p,p),C=Math.abs(E)/(x*_);return{easing:h.easing,duration:1e3*C,amount:E*(C/2)}}class lr extends l.Event{constructor(o,h,p,_={}){const x=P.mousePos(h.getCanvasContainer(),p),E=h.unproject(x);super(o,l.extend({point:x,lngLat:E,originalEvent:p},_)),this._defaultPrevented=!1,this.target=h}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class pl extends l.Event{constructor(o,h,p){const _=o==="touchend"?p.changedTouches:p.touches,x=P.touchPos(h.getCanvasContainer(),_),E=x.map(L=>h.unproject(L)),C=x.reduce((L,k,D,N)=>L.add(k.div(N.length)),new l.pointGeometry(0,0));super(o,{points:x,point:C,lngLats:E,lngLat:h.unproject(C),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class cr extends l.Event{constructor(o,h,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ng{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new cr(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new lr(o.type,this._map,o))}mouseup(o){this._map.fire(new lr(o.type,this._map,o))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new lr(o.type,this._map,o))}dblclick(o){return this._firePreventable(new lr(o.type,this._map,o))}mouseover(o){this._map.fire(new lr(o.type,this._map,o))}mouseout(o){this._map.fire(new lr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new pl(o.type,this._map,o))}touchmove(o){this._map.fire(new pl(o.type,this._map,o))}touchend(o){this._map.fire(new pl(o.type,this._map,o))}touchcancel(o){this._map.fire(new pl(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ks{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new lr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new lr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xf{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(P.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=P.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const x=Math.min(_.x,p.x),E=Math.max(_.x,p.x),C=Math.min(_.y,p.y),L=Math.max(_.y,p.y);P.setTransform(this._box,`translate(${x}px,${C}px)`),this._box.style.width=E-x+"px",this._box.style.height=L-C+"px"}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const p=this._startPos,_=h;if(this.reset(),P.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new l.Event(o,{originalEvent:h}))}}function Cs(m,o){if(m.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${o.length}`);const h={};for(let p=0;p<m.length;p++)h[m[p].identifier]=o[p];return h}class ml{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const x=new l.pointGeometry(0,0);for(const E of _)x._add(E);return x.div(_.length)}(h),this.touches=Cs(p,h)))}touchmove(o,h,p){if(this.aborted||!this.centroid)return;const _=Cs(p,h);for(const x in this.touches){const E=this.touches[x],C=_[x];(!C||C.dist(E)>30)&&(this.aborted=!0)}}touchend(o,h,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Zu{constructor(o){this.singleTap=new ml(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,p){this.singleTap.touchstart(o,h,p)}touchmove(o,h,p){this.singleTap.touchmove(o,h,p)}touchend(o,h,p){const _=this.singleTap.touchend(o,h,p);if(_){const x=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(x&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Ug{constructor(){this._zoomIn=new Zu({numTouches:1,numTaps:2}),this._zoomOut=new Zu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,p){this._zoomIn.touchstart(o,h,p),this._zoomOut.touchstart(o,h,p)}touchmove(o,h,p){this._zoomIn.touchmove(o,h,p),this._zoomOut.touchmove(o,h,p)}touchend(o,h,p){const _=this._zoomIn.touchend(o,h,p),x=this._zoomOut.touchend(o,h,p);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vg={0:1,2:2};class pc{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;const p=P.mouseButton(o);this._correctButton(o,p)&&(this._lastPoint=h,this._eventButton=p)}mousemoveWindow(o,h){const p=this._lastPoint;if(p){if(o.preventDefault(),function(_,x){const E=Vg[x];return _.buttons===void 0||(_.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(p,h)}}mouseupWindow(o){this._lastPoint&&P.mouseButton(o)===this._eventButton&&(this._moved&&P.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gl extends pc{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return h===0&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class Is extends pc{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){const p=.8*(h.x-o.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(o){o.preventDefault()}}class ot extends pc{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){const p=-.5*(h.y-o.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(o){o.preventDefault()}}class bf{constructor(o,h){this._minTouches=o.cooperativeGestures?2:1,this._clickTolerance=o.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(o,h,p){return this._calculateTransform(o,h,p)}touchmove(o,h,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(o,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,h,p)}touchend(o,h,p){this._calculateTransform(o,h,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,p){p.length>0&&(this._active=!0);const _=Cs(p,h),x=new l.pointGeometry(0,0),E=new l.pointGeometry(0,0);let C=0;for(const k in _){const D=_[k],N=this._touches[k];N&&(x._add(D),E._add(D.sub(N)),C++,_[k]=D)}if(this._touches=_,C<this._minTouches||!E.mag())return;const L=E.div(C);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:L}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ao{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,h,p){return{}}touchstart(o,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,p){if(!this._firstTwoTouches)return;o.preventDefault();const[_,x]=this._firstTwoTouches,E=Js(p,h,_),C=Js(p,h,x);if(!E||!C)return;const L=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],L,o)}touchend(o,h,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,E=Js(p,h,_),C=Js(p,h,x);E&&C||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Js(m,o,h){for(let p=0;p<m.length;p++)if(m[p].identifier===h)return o[p]}function Xu(m,o){return Math.log(m/o)/Math.LN2}class Je extends Ao{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Xu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xu(this._distance,p),pinchAround:h}}}function mc(m,o){return 180*m.angleWith(o)/Math.PI}class jg extends Ao{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){const p=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:mc(this._vector,p),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,p=mc(o,this._startVector);return Math.abs(p)<h}}function Yu(m){return Math.abs(m.y)>Math.abs(m.x)}class Ku extends Ao{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,h,p){super.touchstart(o,h,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,Yu(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=o[0].sub(this._lastPoints[0]),x=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,x,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(o,h,p){if(this._valid!==void 0)return this._valid;const _=o.mag()>=2,x=h.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=o.y>0==h.y>0;return Yu(o)&&Yu(h)&&E}}const wf={panStep:100,bearingStep:15,pitchStep:10};class Ef{constructor(){const o=wf;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,p=0,_=0,x=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:C=>{const L=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Gg,zoom:h?Math.round(L)+h*(o.shiftKey?2:1):L,bearing:C.getBearing()+p*this._bearingStep,pitch:C.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:C.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gg(m){return m*(2-m)}const Tf=4.000244140625;class Ju{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;o.preventDefault()}let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=l.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%Tf==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=P.mousePos(this._el,o);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Tf?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&L!==0&&(L=1/L);const k=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(k*L))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,p=this._startZoom,_=this._easing;let x,E=!1;if(this._type==="wheel"&&p&&_){const C=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),L=_(C);x=l.number(p,h,L),C<1?this._frameId||(this._frameId=!0):E=!0}else x=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:x-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=l.ease;if(this._prevEase){const p=this._prevEase,_=(l.exported.now()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),E=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-E*E);h=l.bezier(E,C,.25,1)}return this._prevEase={start:l.exported.now(),duration:o,easing:h},h}reset(){this._active=!1}}class Qu{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class eh{constructor(){this.reset()}reset(){this._active=!1}dblclick(o,h){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(o.shiftKey?-1:1),around:p.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class th{constructor(){this._tap=new Zu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,h,p){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=h[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(o,h,p))}touchmove(o,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=h[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,h,p)}touchend(o,h,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(o,h,p)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hi{constructor(o,h,p){this._el=o,this._mousePan=h,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qs{constructor(o,h,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Sf{constructor(o,h,p,_){this._el=o,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ma=m=>m.zoom||m.drag||m.pitch||m.rotate;class nh extends l.Event{}function _l(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Af{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vf(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),l.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,x,E]of this._listeners)P.addEventListener(_,x,_===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,h,p]of this._listeners)P.removeEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new Ng(h,o));const _=h.boxZoom=new xf(h,o);this._add("boxZoom",_);const x=new Ug,E=new eh;h.doubleClickZoom=new Qu(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const C=new th;this._add("tapDragZoom",C);const L=h.touchPitch=new Ku(h);this._add("touchPitch",L);const k=new Is(o),D=new ot(o);h.dragRotate=new Qs(o,k,D),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const N=new gl(o),W=new bf(o,h);h.dragPan=new Hi(p,N,W),this._add("mousePan",N),this._add("touchPan",W,["touchZoom","touchRotate"]);const ie=new jg,te=new Je;h.touchZoomRotate=new Sf(p,te,ie,C),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]);const ne=h.scrollZoom=new Ju(h,this);this._add("scrollZoom",ne,["mousePan"]);const fe=h.keyboard=new Ef;this._add("keyboard",fe),this._add("blockableMapEvent",new Ks(h));for(const _e of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[_e]&&h[_e].enable(o[_e])}_add(o,h,p){this._handlers.push({handlerName:o,handler:h,allowed:p}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ma(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,p){for(const _ in o)if(_!==p&&(!h||h.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const h=[];for(const p of o)this._el.contains(p.target)&&h.push(p);return h}handleEvent(o,h){if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const p=o.type==="renderFrame"?void 0:o,_={needsRenderFrame:!1},x={},E={},C=o.touches,L=C?this._getMapTouches(C):void 0,k=L?P.touchPos(this._el,L):P.mousePos(this._el,o);for(const{handlerName:W,handler:ie,allowed:te}of this._handlers){if(!ie.isEnabled())continue;let ne;this._blockedByActive(E,te,W)?ie.reset():ie[h||o.type]&&(ne=ie[h||o.type](o,k,L),this.mergeHandlerResult(_,x,ne,W,p),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||ie.isActive())&&(E[W]=ie)}const D={};for(const W in this._previousActiveHandlers)E[W]||(D[W]=p);this._previousActiveHandlers=E,(Object.keys(D).length||_l(_))&&(this._changes.push([_,x,D]),this._triggerRenderFrame()),(Object.keys(E).length||_l(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=_;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(o,h,p,_,x){if(!p)return;l.extend(o,p);const E={handlerName:_,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(h.zoom=E),p.panDelta!==void 0&&(h.drag=E),p.pitchDelta!==void 0&&(h.pitch=E),p.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const o={},h={},p={};for(const[_,x,E]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new l.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),l.extend(h,x),l.extend(p,E);this._updateMapTransform(o,h,p),this._changes=[]}_updateMapTransform(o,h,p){const _=this._map,x=_.transform,E=_.style&&_.style.terrain;if(!(_l(o)||E&&this._drag))return this._fireEvents(h,p,!0);let{panDelta:C,zoomDelta:L,bearingDelta:k,pitchDelta:D,around:N,pinchAround:W}=o;W!==void 0&&(N=W),_._stop(!0),N=N||_.transform.centerPoint;const ie=x.pointLocation(C?N.sub(C):N);k&&(x.bearing+=k),D&&(x.pitch+=D),L&&(x.zoom+=L),E?h.drag&&!this._drag?(this._drag={center:x.centerPoint,lngLat:x.pointLocation(N),point:N,handlerName:h.drag.handlerName},_.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&p[this._drag.handlerName]?(_.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):h.drag&&this._drag&&(x.center=x.pointLocation(x.centerPoint.sub(C))):x.setLocationAtPoint(ie,N),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,p,!0)}_fireEvents(o,h,p){const _=ma(this._eventsInProgress),x=ma(o),E={};for(const D in o){const{originalEvent:N}=o[D];this._eventsInProgress[D]||(E[`${D}start`]=N),this._eventsInProgress[D]=o[D]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const D in E)this._fireEvent(D,E[D]);x&&this._fireEvent("move",x.originalEvent);for(const D in o){const{originalEvent:N}=o[D];this._fireEvent(D,N)}const C={};let L;for(const D in this._eventsInProgress){const{handlerName:N,originalEvent:W}=this._eventsInProgress[D];this._handlersById[N].isActive()||(delete this._eventsInProgress[D],L=h[N]||W,C[`${D}end`]=L)}for(const D in C)this._fireEvent(D,C[D]);const k=ma(this._eventsInProgress);if(p&&(_||x)&&!k){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;D?(N(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:L})):(this._map.fire(new l.Event("moveend",{originalEvent:L})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new l.Event(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new nh("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Er={extend:(m,...o)=>l.extend(m,...o),run(m){m()},logToElement(m,o=!1,h="log"){const p=window.document.getElementById(h);p&&(o&&(p.innerHTML=""),p.innerHTML+=`<br>${m}`)}};class xn extends l.Evented{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,p){return o=l.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,l.extend({offset:o},h),p)}panTo(o,h,p){return this.easeTo(l.extend({center:o},h),p)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,p){return this.easeTo(l.extend({zoom:o},h),p)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,p){return this.easeTo(l.extend({bearing:o},h),p)}resetNorth(o,h){return this.rotateTo(0,l.extend({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=l.LngLatBounds.convert(o);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,h)}_cameraForBoxAndBearing(o,h,p,_){const x={top:0,bottom:0,right:0,left:0};if(typeof(_=l.extend({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const we=_.padding;_.padding={top:we,bottom:we,right:we,left:we}}_.padding=l.extend(x,_.padding);const E=this.transform,C=E.padding,L=E.project(l.LngLat.convert(o)),k=E.project(l.LngLat.convert(h)),D=L.rotate(-p*Math.PI/180),N=k.rotate(-p*Math.PI/180),W=new l.pointGeometry(Math.max(D.x,N.x),Math.max(D.y,N.y)),ie=new l.pointGeometry(Math.min(D.x,N.x),Math.min(D.y,N.y)),te=W.sub(ie),ne=(E.width-(C.left+C.right+_.padding.left+_.padding.right))/te.x,fe=(E.height-(C.top+C.bottom+_.padding.top+_.padding.bottom))/te.y;if(fe<0||ne<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const _e=Math.min(E.scaleZoom(E.scale*Math.min(ne,fe)),_.maxZoom),xe=l.pointGeometry.convert(_.offset),se=new l.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(p*Math.PI/180),Te=xe.add(se).mult(E.scale/E.zoomScale(_e));return{center:E.unproject(L.add(k).div(2).sub(Te)),zoom:_e,bearing:p}}fitBounds(o,h,p){return this._fitInternal(this.cameraForBounds(o,h),h,p)}fitScreenCoordinates(o,h,p,_,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(o)),this.transform.pointLocation(l.pointGeometry.convert(h)),p,_),_,x)}_fitInternal(o,h,p){return o?(delete(h=l.extend(o,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(o,h){this.stop();const p=this.transform;let _=!1,x=!1,E=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(_=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=l.LngLat.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(x=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(E=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),_&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),x&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),E&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h))}calculateCameraOptionsFromTo(o,h,p,_=0){const x=l.MercatorCoordinate.fromLngLat(o,h),E=l.MercatorCoordinate.fromLngLat(p,_),C=E.x-x.x,L=E.y-x.y,k=E.z-x.z,D=Math.hypot(C,L,k);if(D===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(C,L),W=this.transform.scaleZoom(this.transform.cameraToCenterDistance/D/this.transform.tileSize),ie=180*Math.atan2(C,-L)/Math.PI;let te=180*Math.acos(N/D)/Math.PI;return te=k<0?90-te:90+te,{center:E.toLngLat(),zoom:W,pitch:te,bearing:ie}}easeTo(o,h){this._stop(!1,o.easeId),((o=l.extend({offset:[0,0],duration:500,easing:l.ease},o)).animate===!1||!o.essential&&l.exported.prefersReducedMotion)&&(o.duration=0);const p=this.transform,_=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),L="zoom"in o?+o.zoom:_,k="bearing"in o?this._normalizeBearing(o.bearing,x):x,D="pitch"in o?+o.pitch:E,N="padding"in o?o.padding:p.padding,W=l.pointGeometry.convert(o.offset);let ie=p.centerPoint.add(W);const te=p.pointLocation(ie),ne=l.LngLat.convert(o.center||te);this._normalizeCenter(ne);const fe=p.project(te),_e=p.project(ne).sub(fe),xe=p.zoomScale(L-_);let se,Te;o.around&&(se=l.LngLat.convert(o.around),Te=p.locationPoint(se));const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||L!==_,this._rotating=this._rotating||x!==k,this._pitching=this._pitching||D!==E,this._padding=!p.isPaddingEqual(N),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,we),this._ease(Me=>{if(this._zooming&&(p.zoom=l.number(_,L,Me)),this._rotating&&(p.bearing=l.number(x,k,Me)),this._pitching&&(p.pitch=l.number(E,D,Me)),this._padding&&(p.interpolatePadding(C,N,Me),ie=p.centerPoint.add(W)),se)p.setLocationAtPoint(se,Te);else{const ke=p.zoomScale(p.zoom-_),Ne=L>_?Math.min(2,xe):Math.max(.5,xe),Ie=Math.pow(Ne,1-Me),tt=p.unproject(fe.add(_e.mult(Me*Ie)).mult(ke));p.setLocationAtPoint(p.renderWorldCopies?tt.wrap():tt,ie)}this._fireMoveEvents(h)},Me=>{this._afterEase(h,Me)},o),this}_prepareEase(o,h,p={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),h||p.moving||this.fire(new l.Event("movestart",o)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new l.Event("move",o)),this._zooming&&this.fire(new l.Event("zoom",o)),this._rotating&&this.fire(new l.Event("rotate",o)),this._pitching&&this.fire(new l.Event("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const p=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",o)),_&&this.fire(new l.Event("rotateend",o)),x&&this.fire(new l.Event("pitchend",o)),this.fire(new l.Event("moveend",o))}flyTo(o,h){if(!o.essential&&l.exported.prefersReducedMotion){const _t=l.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(_t,h)}this.stop(),o=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},o);const p=this.transform,_=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),L="zoom"in o?l.clamp(+o.zoom,p.minZoom,p.maxZoom):_,k="bearing"in o?this._normalizeBearing(o.bearing,x):x,D="pitch"in o?+o.pitch:E,N="padding"in o?o.padding:p.padding,W=p.zoomScale(L-_),ie=l.pointGeometry.convert(o.offset);let te=p.centerPoint.add(ie);const ne=p.pointLocation(te),fe=l.LngLat.convert(o.center||ne);this._normalizeCenter(fe);const _e=p.project(ne),xe=p.project(fe).sub(_e);let se=o.curve;const Te=Math.max(p.width,p.height),we=Te/W,Me=xe.mag();if("minZoom"in o){const _t=l.clamp(Math.min(o.minZoom,_,L),p.minZoom,p.maxZoom),sn=Te/p.zoomScale(_t-_);se=Math.sqrt(sn/Me*2)}const ke=se*se;function Ne(_t){const sn=(we*we-Te*Te+(_t?-1:1)*ke*ke*Me*Me)/(2*(_t?we:Te)*ke*Me);return Math.log(Math.sqrt(sn*sn+1)-sn)}function Ie(_t){return(Math.exp(_t)-Math.exp(-_t))/2}function tt(_t){return(Math.exp(_t)+Math.exp(-_t))/2}const Ze=Ne(0);let it=function(_t){return tt(Ze)/tt(Ze+se*_t)},Mt=function(_t){return Te*((tt(Ze)*(Ie(sn=Ze+se*_t)/tt(sn))-Ie(Ze))/ke)/Me;var sn},Dt=(Ne(1)-Ze)/se;if(Math.abs(Me)<1e-6||!isFinite(Dt)){if(Math.abs(Te-we)<1e-6)return this.easeTo(o,h);const _t=we<Te?-1:1;Dt=Math.abs(Math.log(we/Te))/se,Mt=function(){return 0},it=function(sn){return Math.exp(_t*se*sn)}}return o.duration="duration"in o?+o.duration:1e3*Dt/("screenSpeed"in o?+o.screenSpeed/se:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=x!==k,this._pitching=D!==E,this._padding=!p.isPaddingEqual(N),this._prepareEase(h,!1),this._ease(_t=>{const sn=_t*Dt,on=1/it(sn);p.zoom=_t===1?L:_+p.scaleZoom(on),this._rotating&&(p.bearing=l.number(x,k,_t)),this._pitching&&(p.pitch=l.number(E,D,_t)),this._padding&&(p.interpolatePadding(C,N,_t),te=p.centerPoint.add(ie));const $t=_t===1?fe:p.unproject(_e.add(xe.mult(Mt(sn))).mult(on));p.setLocationAtPoint(p.renderWorldCopies?$t.wrap():$t,te),this._fireMoveEvents(h)},()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,h,p){p.animate===!1||p.duration===0?(o(1),h()):(this._easeStart=l.exported.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=l.wrap(o,-180,180);const p=Math.abs(o-h);return Math.abs(o-360-h)<p&&(o-=360),Math.abs(o+360-h)<p&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=o.lng-h.center.lng;o.lng+=p>180?-360:p<-180?360:0}}class yl{constructor(o={}){this.options=o,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const p=this._map._getUIString(`AttributionControl.${h}`);o.title=p,o.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const h=this._map.style.sourceCaches;for(const _ in h){const x=h[_];if(x.used||x.usedForTerrain){const E=x.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o=o.filter(_=>String(_).trim()),o.sort((_,x)=>_.length-x.length),o=o.filter((_,x)=>{for(let E=x+1;E<o.length;E++)if(o[E].indexOf(_)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class gc{constructor(o={}){this.options=o,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl mapboxgl-ctrl");const h=P.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact","mapboxgl-compact"):h.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Pf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const _ of p)if(_.id===o)return void(_.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Cf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},If={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Wg={showCompass:!0,showZoom:!0,visualizePitch:!1};class us{constructor(o,h,p=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Is({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,p&&(this.mousePitch=new ot({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),P.addEventListener(h,"mousedown",this.mousedown),P.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(h,"touchmove",this.touchmove),P.addEventListener(h,"touchend",this.touchend),P.addEventListener(h,"touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),P.disableDrag()}move(o,h){const p=this.map,_=this.mouseRotate.mousemoveWindow(o,h);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(o,h);x&&x.pitchDelta&&p.setPitch(p.getPitch()+x.pitchDelta)}}off(){const o=this.element;P.removeEventListener(o,"mousedown",this.mousedown),P.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(o,"touchmove",this.touchmove),P.removeEventListener(o,"touchend",this.touchend),P.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup)}mousedown(o){this.down(l.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),P.mousePos(this.element,o)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)}mousemove(o){this.move(o,P.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function vl(m,o,h){if(m=new l.LngLat(m.lng,m.lat),o){const p=new l.LngLat(m.lng-360,m.lat),_=new l.LngLat(m.lng+360,m.lat),x=h.locationPoint(m).distSqr(o);h.locationPoint(p).distSqr(o)<x?m=p:h.locationPoint(_).distSqr(o)<x&&(m=_)}for(;Math.abs(m.lng-h.center.lng)>180;){const p=h.locationPoint(m);if(p.x>=0&&p.y>=0&&p.x<=h.width&&p.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const ht={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function wt(m,o,h){const p=m.classList;for(const _ in ht)p.remove(`maplibregl-${h}-anchor-${_}`,`mapboxgl-${h}-anchor-${_}`);p.add(`maplibregl-${h}-anchor-${o}`,`mapboxgl-${h}-anchor-${o}`)}class ga extends l.Evented{constructor(o,h){if(super(),(o instanceof HTMLElement||h)&&(o=l.extend({element:o},h)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=l.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div"),this._element.setAttribute("aria-label","Map marker");const p=P.createNS("http://www.w3.org/2000/svg","svg"),_=41,x=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${_}px`),p.setAttributeNS(null,"width",`${x}px`),p.setAttributeNS(null,"viewBox",`0 0 ${x} ${_}`);const E=P.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const C=P.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const L=P.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xe of k){const se=P.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",xe.rx),se.setAttributeNS(null,"ry",xe.ry),L.appendChild(se)}const D=P.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const N=P.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(N);const W=P.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");const ie=P.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild(ie);const te=P.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const ne=P.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(8.0, 8.0)");const fe=P.createNS("http://www.w3.org/2000/svg","circle");fe.setAttributeNS(null,"fill","#000000"),fe.setAttributeNS(null,"opacity","0.25"),fe.setAttributeNS(null,"cx","5.5"),fe.setAttributeNS(null,"cy","5.5"),fe.setAttributeNS(null,"r","5.4999962");const _e=P.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#FFFFFF"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962"),ne.appendChild(fe),ne.appendChild(_e),C.appendChild(L),C.appendChild(D),C.appendChild(W),C.appendChild(te),C.appendChild(ne),p.appendChild(C),p.setAttributeNS(null,"height",_*this._scale+"px"),p.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(p),this._offset=l.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),wt(this._element,this._anchor,"marker"),this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=l.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(o){const h=o.code,p=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(o){const h=o.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}_update(o){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=vl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${ht[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${h}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),x=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*x?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(o){return this._offset=l.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const ih={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let eo,mi=0,to=!1;const hs={maxWidth:100,unit:"metric"};function Lf(m,o,h){const p=h&&h.maxWidth||100,_=m._container.clientHeight/2,x=m.unproject([0,_]),E=m.unproject([p,_]),C=x.distanceTo(E);if(h&&h.unit==="imperial"){const L=3.2808*C;L>5280?no(o,p,L/5280,m._getUIString("ScaleControl.Miles")):no(o,p,L,m._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?no(o,p,C/1852,m._getUIString("ScaleControl.NauticalMiles")):C>=1e3?no(o,p,C/1e3,m._getUIString("ScaleControl.Kilometers")):no(o,p,C,m._getUIString("ScaleControl.Meters"))}function no(m,o,h,p){const _=function(x){const E=Math.pow(10,`${Math.floor(x)}`.length-1);let C=x/E;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(L){const k=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*k)/k}(C),E*C}(h);m.style.width=o*(_/h)+"px",m.innerHTML=`${_}&nbsp;${p}`}const kn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Hn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function rh(m){if(m){if(typeof m=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,m),"top-left":new l.pointGeometry(o,o),"top-right":new l.pointGeometry(-o,o),bottom:new l.pointGeometry(0,-m),"bottom-left":new l.pointGeometry(o,-o),"bottom-right":new l.pointGeometry(-o,-o),left:new l.pointGeometry(m,0),right:new l.pointGeometry(-m,0)}}if(m instanceof l.pointGeometry||Array.isArray(m)){const o=l.pointGeometry.convert(m);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:l.pointGeometry.convert(m.center||[0,0]),top:l.pointGeometry.convert(m.top||[0,0]),"top-left":l.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(m["top-right"]||[0,0]),bottom:l.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(m["bottom-right"]||[0,0]),left:l.pointGeometry.convert(m.left||[0,0]),right:l.pointGeometry.convert(m.right||[0,0])}}return rh(new l.pointGeometry(0,0))}const Po={supported:y,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends xn{constructor(m){var o;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(m=l.extend({},If,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ul(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Pf,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Cf,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=(o=m.pixelRatio)!==null&&o!==void 0?o:devicePixelRatio,this._requestManager=new B(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Af(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new mf(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,l.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new yl({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new gc,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new l.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new l.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new l.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(m,o){if(o===void 0&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,o,h,p){return p==null&&this.style.terrain&&(p=this.transform.getElevation(h,this.style.terrain)),super.calculateCameraOptionsFromTo(m,o,h,p)}resize(m){const o=this._containerDimensions(),h=o[0],p=o[1];this._resizeCanvas(h,p,this.getPixelRatio()),this.transform.resize(h,p),this.painter.resize(h,p,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new l.Event("movestart",m)).fire(new l.Event("move",m))),this.fire(new l.Event("resize",m)),_&&this.fire(new l.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[o,h]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(o,h,m),this.painter.resize(o,h,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(l.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(l.LngLat.convert(m),this.style&&this.style.terrain)}unproject(m){return this.transform.pointLocation(l.pointGeometry.convert(m),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,o,h){if(m==="mouseenter"||m==="mouseover"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:x=>{const E=this.getLayer(o)?this.queryRenderedFeatures(x.point,{layers:[o]}):[];E.length?p||(p=!0,h.call(this,new lr(m,this,x.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(m==="mouseleave"||m==="mouseout"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:E=>{(this.getLayer(o)?this.queryRenderedFeatures(E.point,{layers:[o]}):[]).length?p=!0:p&&(p=!1,h.call(this,new lr(m,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,h.call(this,new lr(m,this,E.originalEvent)))}}}}{const p=_=>{const x=this.getLayer(o)?this.queryRenderedFeatures(_.point,{layers:[o]}):[];x.length&&(_.features=x,h.call(this,_),delete _.features)};return{layer:o,listener:h,delegates:{[m]:p}}}}on(m,o,h){if(h===void 0)return super.on(m,o);const p=this._createDelegatedListener(m,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(m,o,h){if(h===void 0)return super.once(m,o);const p=this._createDelegatedListener(m,o,h);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(m,o,h){return h===void 0?super.off(m,o):(this._delegatedListeners&&this._delegatedListeners[m]&&(p=>{const _=this._delegatedListeners[m];for(let x=0;x<_.length;x++){const E=_[x];if(E.layer===o&&E.listener===h){for(const C in E.delegates)this.off(C,E.delegates[C]);return _.splice(x,1),this}}})(),this)}queryRenderedFeatures(m,o){if(!this.style)return[];let h;if(o!==void 0||m===void 0||m instanceof l.pointGeometry||Array.isArray(m)||(o=m,m=void 0),o=o||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof m[0]=="number")h=[l.pointGeometry.convert(m)];else{const p=l.pointGeometry.convert(m[0]),_=l.pointGeometry.convert(m[1]);h=[p,new l.pointGeometry(_.x,p.y),_,new l.pointGeometry(p.x,_.y),p]}return this.style.queryRenderedFeatures(h,o,this.transform)}querySourceFeatures(m,o){return this.style.querySourceFeatures(m,o)}setStyle(m,o){return(o=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(m,o))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const o=this._locale[m];if(o==null)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Qn(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Qn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,o){if(typeof m=="string"){const h=this._requestManager.transformRequest(m,l.ResourceType.Style);l.getJSON(h,(p,_)=>{p?this.fire(new l.ErrorEvent(p)):_&&this._updateDiff(_,o)})}else typeof m=="object"&&this._updateDiff(m,o)}_updateDiff(m,o){try{this.style.setState(m)&&this._update(!0)}catch(h){l.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(m,o){return this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)}isSourceLoaded(m){const o=this.style&&this.style.sourceCaches[m];if(o!==void 0)return o.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){return this.style.setTerrain(m),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const o in m){const h=m[o]._tiles;for(const p in h){const _=h[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(m,o,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,h)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,o,{pixelRatio:h=1,sdf:p=!1,stretchX:_,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||l.isImageBitmap(o)){const{width:C,height:L,data:k}=l.exported.getImageData(o);this.style.addImage(m,{data:new l.RGBAImage({width:C,height:L},k),pixelRatio:h,stretchX:_,stretchY:x,content:E,sdf:p,version:0})}else{if(o.width===void 0||o.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:L,data:k}=o,D=o;this.style.addImage(m,{data:new l.RGBAImage({width:C,height:L},new Uint8Array(k)),pixelRatio:h,stretchX:_,stretchY:x,content:E,sdf:p,version:0,userImage:D}),D.onAdd&&D.onAdd(this,m)}}}updateImage(m,o){const h=this.style.getImage(m);if(!h)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||l.isImageBitmap(o)?l.exported.getImageData(o):o,{width:_,height:x,data:E}=p;if(_===void 0||x===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==h.data.width||x!==h.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(o instanceof HTMLImageElement||l.isImageBitmap(o));h.data.replace(E,C),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,o){l.getImage(this._requestManager.transformRequest(m,l.ResourceType.Image),o)}listImages(){return this.style.listImages()}addLayer(m,o){return this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)}moveLayer(m,o){return this.style.moveLayer(m,o),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,o,h){return this.style.setLayerZoomRange(m,o,h),this._update(!0)}setFilter(m,o,h={}){return this.style.setFilter(m,o,h),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,o,h,p={}){return this.style.setPaintProperty(m,o,h,p),this._update(!0)}getPaintProperty(m,o){return this.style.getPaintProperty(m,o)}setLayoutProperty(m,o,h,p={}){return this.style.setLayoutProperty(m,o,h,p),this._update(!0)}getLayoutProperty(m,o){return this.style.getLayoutProperty(m,o)}setLight(m,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,o){return this.style.setFeatureState(m,o),this._update()}removeFeatureState(m,o){return this.style.removeFeatureState(m,o),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,o=0;return this._container&&(m=this._container.clientWidth||400,o=this._container.clientHeight||300),[m,o]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const o=this._canvasContainer=P.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&o.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1],this.getPixelRatio());const p=this._controlContainer=P.create("div","maplibregl-control-container mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=P.create("div",`maplibregl-ctrl-${x} mapboxgl-ctrl-${x}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const m=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=P.create("div","maplibregl-cooperative-gesture-screen",m);let o="Control",h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",o="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${h}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",p=>{p.key===o&&(this._metaPress=!0)}),document.addEventListener("keyup",p=>{p.key===o&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",p=>{this._onCooperativeGesture(p,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(m,o,h){this._canvas.width=h*m,this._canvas.height=h*o,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const m=l.extend({},y.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);o?(this.painter=new qu(o,this.transform),l.exported$1.testSupport(o)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(m,o,h){return!o&&h<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let o,h=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(o=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,o),h=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,C=l.exported.now();this.style.zoomHistory.update(E,C);const L=new l.EvaluationParameters(E,{now:C,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=L.crossFadingFactor();k===1&&k===this._crossFadingFactor||(_=!0,this._crossFadingFactor=k),this.style.update(L)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const E=l.exported.now()-h;p.endQueryEXT(p.TIME_ELAPSED_EXT,o),setTimeout(()=>{const C=p.getQueryObjectEXT(o,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(o),this.fire(new l.Event("gpu-timing-frame",{cpuTime:E,gpuTime:C}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const C=this.painter.queryGpuTimers(E);this.fire(new l.Event("gpu-timing-layer",{layerTimes:C}))},50)}const x=this._sourcesDirty||this._styleDirty||this._placementDirty;return x||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._cooperativeGestures&&P.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(m=>{l.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,o){l.setCacheLimits(m,o)}get version(){return"2.4.0"}},NavigationControl:class{constructor(m){this.options=l.extend({},Wg,m),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),o=m===this._map.getMaxZoom(),h=m===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new us(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,o){const h=P.create("button",m,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(m,o){const h=this._map._getUIString(`NavigationControl.${o}`);m.title=h,m.setAttribute("aria-label",h)}},GeolocateControl:class extends l.Evented{constructor(m){super(),this.options=l.extend({},ih,m),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var o;return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,eo!==void 0?o(eo):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{eo=h.state!=="denied",o(eo)}):(eo=!!window.navigator.geolocation,o(eo)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,mi=0,to=!1}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),h=m.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",m)),this._finish()}}_updateCamera(m){const o=new l.LngLat(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,p=this._map.getBearing(),_=l.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),_,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new l.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,o=this._map.unproject([0,m]),h=this._map.unproject([1,m]),p=o.distanceTo(h),_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&to)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ga(this._dotElement),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ga({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":mi--,to=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),mi++,mi>1?(m={maximumAge:6e5,timeout:0},to=!0):(m=this.options.positionOptions,to=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:yl,LogoControl:gc,ScaleControl:class{constructor(m){this.options=l.extend({},hs,m),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Lf(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,Lf(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(m){this.options=m,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(m){return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(m){super(),this.options=l.extend(Object.create(kn),m),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=l.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const o=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=m;p=h.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=P.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(x=>this._container.classList.add(x)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=vl(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const o=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let h=this.options.anchor;const p=rh(this.options.offset);if(!h){const x=this._container.offsetWidth,E=this._container.offsetHeight;let C;C=o.y+p.bottom.y<E?["top"]:o.y>this._map.transform.height-E?["bottom"]:[],o.x<x/2?C.push("left"):o.x>this._map.transform.width-x/2&&C.push("right"),h=C.length===0?"bottom":C.join("-")}const _=o.add(p[h]).round();P.setTransform(this._container,`${ht[h]} translate(${_.x}px,${_.y}px)`),wt(this._container,h,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Hn);m&&m.focus()}_onClose(){this.remove()}},Marker:ga,Style:Qn,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:nn,GeoJSONSource:bi,ImageSource:Et,RasterDEMTileSource:xt,RasterTileSource:kt,VectorTileSource:St,VideoSource:Pt,prewarm:function(){fi().acquire(ki)},clearPrewarmedResources:function(){const m=Gi;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(ki),Gi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Kn.workerCount},set workerCount(m){Kn.workerCount=m},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){l.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){l.clearTileCache(m)},workerUrl:"",addProtocol(m,o){l.config.REGISTERED_PROTOCOLS[m]=o},removeProtocol(m){delete l.config.REGISTERED_PROTOCOLS[m]}};return Er.extend(Po,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),Po});var d=s;return d})})(dA);var E3=dA.exports;const T3=Pu(E3);function Im(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const lx=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Ow=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Ow&&parseFloat(Ow[1]);const S3="3.4.14";function Xo(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Zp=typeof process!="object"||String(process)!=="[object process]"||process.browser,A3=typeof window<"u"&&typeof window.orientation<"u",Fw=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Fw&&parseFloat(Fw[1]);function Ed(t){"@babel/helpers - typeof";return Ed=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ed(t)}function P3(t,e){if(Ed(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(Ed(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function C3(t){var e=P3(t,"string");return Ed(e)=="symbol"?e:String(e)}function U(t,e,n){return e=C3(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class I3{constructor(e,n){U(this,"name",void 0),U(this,"workerThread",void 0),U(this,"isRunning",!0),U(this,"result",void 0),U(this,"_resolve",()=>{}),U(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Xo(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Xo(this.isRunning),this.isRunning=!1,this._reject(e)}}let ny=class{terminate(){}};const iy=new Map;function L3(t){Xo(t.source&&!t.url||!t.source&&t.url);let e=iy.get(t.source||t.url);return e||(t.url&&(e=M3(t.url),iy.set(t.url,e)),t.source&&(e=pA(t.source),iy.set(t.source,e))),Xo(e),e}function M3(t){if(!t.startsWith("http"))return t;const e=k3(t);return pA(e)}function pA(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function k3(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function mA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(Bw(t))i.add(t);else if(Bw(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)mA(t[s],e,i)}}return n===void 0?Array.from(i):[]}function Bw(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const ry=()=>{};class k0{static isSupported(){return typeof Worker<"u"&&Zp||typeof ny<"u"&&!Zp}constructor(e){U(this,"name",void 0),U(this,"source",void 0),U(this,"url",void 0),U(this,"terminated",!1),U(this,"worker",void 0),U(this,"onMessage",void 0),U(this,"onError",void 0),U(this,"_loadableURL","");const{name:n,source:i,url:s}=e;Xo(i||s),this.name=n,this.source=i,this.url=s,this.onMessage=ry,this.onError=c=>console.log(c),this.worker=Zp?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=ry,this.onError=ry,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||mA(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=L3({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new ny(i,{eval:!1})}else if(this.source)e=new ny(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class R3{static isSupported(){return k0.isSupported()}constructor(e){U(this,"name","unnamed"),U(this,"source",void 0),U(this,"url",void 0),U(this,"maxConcurrency",1),U(this,"maxMobileConcurrency",1),U(this,"onDebug",()=>{}),U(this,"reuseWorkers",!0),U(this,"props",{}),U(this,"jobQueue",[]),U(this,"idleQueue",[]),U(this,"count",0),U(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(c,d,l)=>c.done(l),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(c,d)=>c.error(d);const s=new Promise(c=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:c}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new I3(n.name,e);e.onMessage=s=>n.onMessage(i,s.type,s.payload),e.onError=s=>n.onError(i,s),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new k0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return A3?this.maxMobileConcurrency:this.maxConcurrency}}const z3={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Vo{static isSupported(){return k0.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Vo._workerFarm=Vo._workerFarm||new Vo({}),Vo._workerFarm.setProps(e),Vo._workerFarm}constructor(e){U(this,"props",void 0),U(this,"workerPools",new Map),this.props={...z3},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:s}=e;let c=this.workerPools.get(n);return c||(c=new R3({name:n,source:i,url:s}),c.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,c)),c}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}U(Vo,"_workerFarm",void 0);const D3="latest";function O3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let s=n.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(s="modules/".concat(t.module,"/dist/").concat(i)),!s){let c=t.version;c==="latest"&&(c=D3);const d=c?"@".concat(c):"";s="https://unpkg.com/@loaders.gl/".concat(t.module).concat(d,"/dist/").concat(i)}return Xo(s),s}function F3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:S3;Xo(t,"no worker provided");const n=t.version;return!(!e||!n)}function B3(t,e){return!Vo.isSupported()||!Zp&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function N3(t,e,n,i,s){const c=t.id,d=O3(t,n),y=Vo.getWorkerFarm(n).getWorkerPool({name:c,url:d});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const w=await y.startJob("process-on-worker",U3.bind(null,s));return w.postMessage("process",{input:e,options:n,context:i}),await(await w.result).result}async function U3(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:c,options:d}=i;try{const l=await t(c,d);e.postMessage("done",{id:s,result:l})}catch(l){const y=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:s,error:y})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function V3(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),s=new Uint8Array(e);for(let c=0;c<i.length;++c)if(i[c]!==s[c])return!1;return!0}function j3(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),s=i.reduce((l,y)=>l+y.byteLength,0),c=new Uint8Array(s);let d=0;for(const l of i)c.set(l,d),d+=l.byteLength;return c.buffer}async function G3(t){const e=[];for await(const n of t)e.push(n);return j3(...e)}let W3="";const Nw={};function $3(t){for(const e in Nw)if(t.startsWith(e)){const n=Nw[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(W3).concat(t)),t}function H3(t){return t&&typeof t=="object"&&t.isBuffer}function gA(t){if(H3(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function _A(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function q3(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const Z3=t=>typeof t=="boolean",nd=t=>typeof t=="function",Nd=t=>t!==null&&typeof t=="object",Uw=t=>Nd(t)&&t.constructor==={}.constructor,X3=t=>t&&typeof t[Symbol.iterator]=="function",Y3=t=>t&&typeof t[Symbol.asyncIterator]=="function",Jl=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Ql=t=>typeof Blob<"u"&&t instanceof Blob,K3=t=>t&&typeof t=="object"&&t.isBuffer,J3=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Nd(t)&&nd(t.tee)&&nd(t.cancel)&&nd(t.getReader),Q3=t=>Nd(t)&&nd(t.read)&&nd(t.pipe)&&Z3(t.readable),yA=t=>J3(t)||Q3(t),eR=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,tR=/^([-\w.]+\/[-\w.+]+)/;function nR(t){const e=tR.exec(t);return e?e[1]:t}function Vw(t){const e=eR.exec(t);return e?e[1]:""}const vA=/\?.*/;function iR(t){const e=t.match(vA);return e&&e[0]}function cx(t){return t.replace(vA,"")}function fg(t){return Jl(t)?t.url:Ql(t)?t.name||"":typeof t=="string"?t:""}function ux(t){if(Jl(t)){const e=t,n=e.headers.get("content-type")||"",i=cx(e.url);return nR(n)||Vw(i)}return Ql(t)?t.type||"":typeof t=="string"?Vw(t):""}function rR(t){return Jl(t)?t.headers["content-length"]||-1:Ql(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function xA(t){if(Jl(t))return t;const e={},n=rR(t);n>=0&&(e["content-length"]=String(n));const i=fg(t),s=ux(t);s&&(e["content-type"]=s);const c=await aR(t);c&&(e["x-first-bytes"]=c),typeof t=="string"&&(t=new TextEncoder().encode(t));const d=new Response(t,{headers:e});return Object.defineProperty(d,"url",{value:i}),d}async function sR(t){if(!t.ok){const e=await oR(t);throw new Error(e)}}async function oR(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function aR(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=c=>{var d;return i(c==null||(d=c.target)===null||d===void 0?void 0:d.result)},s.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=lR(n);return"data:base64,".concat(i)}return null}function lR(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function jw(t,e){if(typeof t=="string"){t=$3(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await xA(t)}function cR(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Ud(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||cR()}const _p=globalThis.window||globalThis.self||globalThis.global,kh=globalThis.process||{},bA=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Ud();function uR(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let hR=class{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=uR(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function dR(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function fR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function sy(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const s=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const c=t.width*n,d=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(d/2),"px ").concat(Math.floor(c/2),"px;"),"line-height:".concat(d,"px;"),"background:url(".concat(s,");"),"background-size:".concat(c,"px ").concat(d,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Lm;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Lm||(Lm={}));const pR=10;function Gw(t){return typeof t!="string"?t:(t=t.toUpperCase(),Lm[t]||Lm.WHITE)}function mR(t,e,n){if(!Ud&&typeof t=="string"){if(e){const i=Gw(e);t="\x1B[".concat(i,"m").concat(t,"\x1B[39m")}if(n){const i=Gw(n);t="\x1B[".concat(i+pR,"m").concat(t,"\x1B[49m")}}return t}function gR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),s=t;for(const c of i){const d=s[c];typeof d=="function"&&(e.find(l=>c===l)||(s[c]=d.bind(t)))}}function Mm(t,e){if(!t)throw new Error(e||"Assertion failed")}function Ic(){let t;if(Ud()&&_p.performance){var e,n;t=_p==null||(e=_p.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in kh){var i;const s=kh==null||(i=kh.hrtime)===null||i===void 0?void 0:i.call(kh);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const Lc={debug:Ud()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},_R={enabled:!0,level:0};function gs(){}const Ww={},$w={once:!0};let hx=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=bA,this._startTs=Ic(),this._deltaTs=Ic(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new hR("__probe-".concat(this.id,"__"),_R),this.timeStamp("".concat(this.id," started")),gR(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ic()-this._startTs).toPrecision(10))}getDelta(){return Number((Ic()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Mm(e,n)}warn(e){return this._getLogFunction(0,e,Lc.warn,arguments,$w)}error(e){return this._getLogFunction(0,e,Lc.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Lc.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Lc.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Lc.debug||Lc.info,arguments,$w)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||gs,i&&[i],{tag:bR(n)}):gs}image(e){let{logLevel:n,priority:i,image:s,message:c="",scale:d=1}=e;return this._shouldLog(n||i)?Ud()?xR({image:s,message:c,scale:d}):vR():gs}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||gs)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const s=Hw({logLevel:e,message:n,opts:i}),{collapsed:c}=i;return s.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||gs)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=wA(e)}_getLogFunction(e,n,i,s,c){if(this._shouldLog(e)){c=Hw({logLevel:e,message:n,args:s,opts:c}),i=i||c.method,Mm(i),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=Ic();const d=c.tag||c.message;if(c.once&&d)if(!Ww[d])Ww[d]=Ic();else return gs;return n=yR(this.id,c.message,c),i.bind(console,n,...c.args)}return gs}};hx.VERSION=bA;function wA(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Mm(Number.isFinite(e)&&e>=0),e}function Hw(t){const{logLevel:e,message:n}=t;t.logLevel=wA(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return Mm(s==="string"||s==="object"),Object.assign(t,{args:i},t.opts)}function yR(t,e,n){if(typeof e=="string"){const i=n.time?fR(dR(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=mR(e,n.color,n.background)}return e}function vR(t){return console.warn("removed"),gs}function xR(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const c=new Image;return c.onload=()=>{const d=sy(c,n,i);console.log(...d)},c.src=e,gs}const s=e.nodeName||"";if(s.toLowerCase()==="img")return console.log(...sy(e,n,i)),gs;if(s.toLowerCase()==="canvas"){const c=new Image;return c.onload=()=>console.log(...sy(c,n,i)),c.src=e.toDataURL(),gs}return gs}function bR(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const qw=new hx({id:"loaders.gl"});class wR{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ER{constructor(){U(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.error.bind(this.console,...n)}}const EA={fetch:null,mimeType:void 0,nothrow:!1,log:new ER,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:lx,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},TR={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function TA(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const SA=()=>{const t=TA();return t.globalOptions=t.globalOptions||{...EA},t.globalOptions};function SR(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],AR(t,n),CR(e,t,i)}function AR(t,e){Zw(t,null,EA,TR,e);for(const n of e){const i=t&&t[n.id]||{},s=n.options&&n.options[n.id]||{},c=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Zw(i,n.id,s,c,e)}}function Zw(t,e,n,i,s){const c=e||"Top level",d=e?"".concat(e,"."):"";for(const l in t){const y=!e&&Nd(t[l]),w=l==="baseUri"&&!e,S=l==="workerUrl"&&e;if(!(l in n)&&!w&&!S){if(l in i)qw.warn("".concat(c," loader option '").concat(d).concat(l,"' no longer supported, use '").concat(i[l],"'"))();else if(!y){const I=PR(l,s);qw.warn("".concat(c," loader option '").concat(d).concat(l,"' not recognized. ").concat(I))()}}}}function PR(t,e){const n=t.toLowerCase();let i="";for(const s of e)for(const c in s.options){if(t===c)return"Did you mean '".concat(s.id,".").concat(c,"'?");const d=c.toLowerCase();(n.startsWith(d)||d.startsWith(n))&&(i=i||"Did you mean '".concat(s.id,".").concat(c,"'?"))}return i}function CR(t,e,n){const s={...t.options||{}};return IR(s,n),s.log===null&&(s.log=new wR),Xw(s,SA()),Xw(s,e),s}function Xw(t,e){for(const n in e)if(n in e){const i=e[n];Uw(i)&&Uw(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function IR(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function dx(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function fx(t){var e,n;Im(t,"null loader"),Im(dx(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const AA=()=>{const t=TA();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function LR(t){const e=AA();t=Array.isArray(t)?t:[t];for(const n of t){const i=fx(n);e.find(s=>i===s)||e.unshift(i)}}function MR(){return AA()}const kR=new hx({id:"loaders.gl"}),RR=/\.([^.]+)$/;async function zR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!PA(t))return null;let s=Yw(t,e,{...n,nothrow:!0},i);if(s)return s;if(Ql(t)&&(t=await t.slice(0,10).arrayBuffer(),s=Yw(t,e,n,i)),!s&&!(n!=null&&n.nothrow))throw new Error(CA(t));return s}function Yw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!PA(t))return null;if(e&&!Array.isArray(e))return fx(e);let s=[];e&&(s=s.concat(e)),n!=null&&n.ignoreRegisteredLoaders||s.push(...MR()),OR(s);const c=DR(t,s,n,i);if(!c&&!(n!=null&&n.nothrow))throw new Error(CA(t));return c}function DR(t,e,n,i){const s=fg(t),c=ux(t),d=cx(s)||(i==null?void 0:i.url);let l=null,y="";if(n!=null&&n.mimeType&&(l=oy(e,n==null?void 0:n.mimeType),y="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),l=l||FR(e,d),y=y||(l?"matched url ".concat(d):""),l=l||oy(e,c),y=y||(l?"matched MIME type ".concat(c):""),l=l||NR(e,t),y=y||(l?"matched initial data ".concat(IA(t)):""),l=l||oy(e,n==null?void 0:n.fallbackMimeType),y=y||(l?"matched fallback MIME type ".concat(c):""),y){var w;kR.log(1,"selectLoader selected ".concat((w=l)===null||w===void 0?void 0:w.name,": ").concat(y,"."))}return l}function PA(t){return!(t instanceof Response&&t.status===204)}function CA(t){const e=fg(t),n=ux(t);let i="No valid loader found (";i+=e?"".concat(_A(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const s=t?IA(t):"";return i+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",i+=")",i}function OR(t){for(const e of t)fx(e)}function FR(t,e){const n=e&&RR.exec(e),i=n&&n[1];return i?BR(t,i):null}function BR(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function oy(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function NR(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(UR(e,n))return n}else if(ArrayBuffer.isView(e)){if(Kw(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Kw(e,0,n))return n;return null}function UR(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function Kw(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(s=>VR(t,e,n,s))}function VR(t,e,n,i){if(i instanceof ArrayBuffer)return V3(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const s=R0(t,e,i.length);return i===s;default:return!1}}function IA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?R0(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?R0(t,0,e):""}function R0(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let s="";for(let c=0;c<n;c++)s+=String.fromCharCode(i.getUint8(e+c));return s}const jR=256*1024;function*GR(t,e){const n=(e==null?void 0:e.chunkSize)||jR;let i=0;const s=new TextEncoder;for(;i<t.length;){const c=Math.min(t.length-i,n),d=t.slice(i,i+c);i+=c,yield s.encode(d)}}const WR=256*1024;function $R(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=WR}=e;let i=0;for(;i<t.byteLength;){const s=Math.min(t.byteLength-i,n),c=new ArrayBuffer(s),d=new Uint8Array(t,i,s);new Uint8Array(c).set(d),i+=s,yield c}}()}const HR=1024*1024;async function*qR(t,e){const n=(e==null?void 0:e.chunkSize)||HR;let i=0;for(;i<t.size;){const s=i+n,c=await t.slice(i,s).arrayBuffer();i=s,yield c}}function Jw(t,e){return lx?ZR(t,e):XR(t)}async function*ZR(t,e){const n=t.getReader();let i;try{for(;;){const s=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:c,value:d}=await s;if(c)return;yield gA(d)}}catch{n.releaseLock()}}async function*XR(t,e){for await(const n of t)yield gA(n)}function YR(t,e){if(typeof t=="string")return GR(t,e);if(t instanceof ArrayBuffer)return $R(t,e);if(Ql(t))return qR(t,e);if(yA(t))return Jw(t,e);if(Jl(t))return Jw(t.body,e);throw new Error("makeIterator")}const LA="Cannot convert supplied data type";function KR(t,e,n){if(e.text&&typeof t=="string")return t;if(K3(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+s)),i}throw new Error(LA)}async function JR(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return KR(t,e);if(Ql(t)&&(t=await xA(t)),Jl(t)){const s=t;return await sR(s),e.binary?await s.arrayBuffer():await s.text()}if(yA(t)&&(t=YR(t,n)),X3(t)||Y3(t))return G3(t);throw new Error(LA)}function MA(t,e){const n=SA(),i=t||n;return typeof i.fetch=="function"?i.fetch:Nd(i.fetch)?s=>jw(s,i):e!=null&&e.fetch?e==null?void 0:e.fetch:jw}function QR(t,e,n){if(n)return n;const i={fetch:MA(e,t),...t};if(i.url){const s=cx(i.url);i.baseUrl=s,i.queryString=iR(i.url),i.filename=_A(s),i.baseUrl=q3(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function ez(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function px(t,e,n,i){Xo(!i||typeof i=="object"),e&&!Array.isArray(e)&&!dx(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const s=fg(t),d=ez(e,i),l=await zR(t,d,n);return l?(n=SR(n,l,d,s),i=QR({url:s,parse:px,loaders:d},n,i||null),await tz(l,t,n,i)):null}async function tz(t,e,n,i){if(F3(t),Jl(e)){const s=e,{ok:c,redirected:d,status:l,statusText:y,type:w,url:S}=s,I=Object.fromEntries(s.headers.entries());i.response={headers:I,ok:c,redirected:d,status:l,statusText:y,type:w,url:S}}if(e=await JR(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(B3(t,n))return await N3(t,e,n,i,px);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw Xo(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function km(t,e,n,i){!Array.isArray(e)&&!dx(e)&&(n=e,e=void 0);const s=MA(n);let c=t;return typeof t=="string"&&(c=await s(t)),Ql(t)&&(c=await s(t)),await px(c,e,n)}const nz="3.4.14",{_parseImageNode:iz}=globalThis,z0=typeof Image<"u",D0=typeof ImageBitmap<"u",rz=!!iz,O0=lx?!0:rz;function sz(t){switch(t){case"auto":return D0||z0||O0;case"imagebitmap":return D0;case"image":return z0;case"data":return O0;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function oz(){if(D0)return"imagebitmap";if(z0)return"image";if(O0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function az(t){const e=cz(t);if(!e)throw new Error("Not an image");return e}function lz(t){switch(az(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function cz(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const uz=/^data:image\/svg\+xml/,hz=/\.svg((\?|#).*)?$/;function mx(t){return t&&(uz.test(t)||hz.test(t))}function dz(t,e){if(mx(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(c){throw new Error(c.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return kA(t,e)}function kA(t,e){if(mx(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function RA(t,e,n){const i=dz(t,n),s=self.URL||self.webkitURL,c=typeof i!="string"&&s.createObjectURL(i);try{return await fz(c||i,e)}finally{c&&s.revokeObjectURL(c)}}async function fz(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,s)=>{try{n.onload=()=>i(n),n.onerror=c=>s(new Error("Could not load image ".concat(t,": ").concat(c)))}catch(c){s(c)}})}const pz={};let Qw=!0;async function mz(t,e,n){let i;mx(n)?i=await RA(t,e,n):i=kA(t,n);const s=e&&e.imagebitmap;return await gz(i,s)}async function gz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((_z(e)||!Qw)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Qw=!1}return await createImageBitmap(t)}function _z(t){for(const e in t||pz)return!1;return!0}function yz(t){return!wz(t,"ftyp",4)||!(t[8]&96)?null:vz(t)}function vz(t){switch(xz(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function xz(t,e,n){return String.fromCharCode(...t.slice(e,n))}function bz(t){return[...t].map(e=>e.charCodeAt(0))}function wz(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=bz(e);for(let s=0;s<i.length;++s)if(i[s]!==t[s+n])return!1;return!0}const po=!1,id=!0;function zA(t){const e=Vd(t);return Tz(e)||Pz(e)||Sz(e)||Az(e)||Ez(e)}function Ez(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=yz(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function Tz(t){const e=Vd(t);return e.byteLength>=24&&e.getUint32(0,po)===2303741511?{mimeType:"image/png",width:e.getUint32(16,po),height:e.getUint32(20,po)}:null}function Sz(t){const e=Vd(t);return e.byteLength>=10&&e.getUint32(0,po)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,id),height:e.getUint16(8,id)}:null}function Az(t){const e=Vd(t);return e.byteLength>=14&&e.getUint16(0,po)===16973&&e.getUint32(2,id)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,id),height:e.getUint32(22,id)}:null}function Pz(t){const e=Vd(t);if(!(e.byteLength>=3&&e.getUint16(0,po)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=Cz();let c=2;for(;c+9<e.byteLength;){const d=e.getUint16(c,po);if(s.has(d))return{mimeType:"image/jpeg",height:e.getUint16(c+5,po),width:e.getUint16(c+7,po)};if(!i.has(d))return null;c+=2,c+=e.getUint16(c,po)}return null}function Cz(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Vd(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function Iz(t,e){const{mimeType:n}=zA(t)||{},i=globalThis._parseImageNode;return Im(i),await i(t,n)}async function Lz(t,e,n){e=e||{};const s=(e.image||{}).type||"auto",{url:c}=n||{},d=Mz(s);let l;switch(d){case"imagebitmap":l=await mz(t,e,c);break;case"image":l=await RA(t,e,c);break;case"data":l=await Iz(t);break;default:Im(!1)}return s==="data"&&(l=lz(l)),l}function Mz(t){switch(t){case"auto":case"data":return oz();default:return sz(t),t}}const kz=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Rz=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],zz={image:{type:"auto",decode:!0}},Dz={id:"image",module:"images",name:"Images",version:nz,mimeTypes:Rz,extensions:kz,parse:Lz,tests:[t=>!!zA(new DataView(t))],options:zz};function DA(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function ea(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||DA()}const Xp={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},yp=Xp.window||Xp.self||Xp.global,Rh=Xp.process||{},OA=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";ea();const ay=globalThis;function FA(t){if(!t&&!ea())return"Node";if(DA(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,s=n.indexOf("Trident/")!==-1;return i||s?"IE":ay.chrome?"Chrome":ay.safari?"Safari":ay.mozInnerScreenX?"Firefox":"Unknown"}function Oz(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class Fz{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";U(this,"storage",void 0),U(this,"id",void 0),U(this,"config",void 0),this.storage=Oz(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function Bz(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function Nz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function ly(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const s=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const c=t.width*n,d=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(d/2),"px ").concat(Math.floor(c/2),"px;"),"line-height:".concat(d,"px;"),"background:url(".concat(s,");"),"background-size:".concat(c,"px ").concat(d,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Rm;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Rm||(Rm={}));function eE(t){return typeof t=="string"?Rm[t.toUpperCase()]||Rm.WHITE:t}function Uz(t,e,n){return!ea&&typeof t=="string"&&(e&&(e=eE(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=eE(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function Vz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const s of i)typeof t[s]=="function"&&(e.find(c=>s===c)||(t[s]=t[s].bind(t)))}function zm(t,e){if(!t)throw new Error(e||"Assertion failed")}function Mc(){let t;if(ea&&"performance"in yp){var e,n;t=yp==null||(e=yp.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Rh){var i;const s=Rh==null||(i=Rh.hrtime)===null||i===void 0?void 0:i.call(Rh);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const kc={debug:ea&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},jz={enabled:!0,level:0};function _s(){}const tE={},nE={once:!0};class gx{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};U(this,"id",void 0),U(this,"VERSION",OA),U(this,"_startTs",Mc()),U(this,"_deltaTs",Mc()),U(this,"_storage",void 0),U(this,"userData",{}),U(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new Fz("__probe-".concat(this.id,"__"),jz),this.timeStamp("".concat(this.id," started")),Vz(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Mc()-this._startTs).toPrecision(10))}getDelta(){return Number((Mc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){zm(e,n)}warn(e){return this._getLogFunction(0,e,kc.warn,arguments,nE)}error(e){return this._getLogFunction(0,e,kc.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,kc.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,kc.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return this._getLogFunction(e,n,kc.debug||kc.info,arguments,nE)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||_s,i&&[i],{tag:Hz(n)}):_s}image(e){let{logLevel:n,priority:i,image:s,message:c="",scale:d=1}=e;return this._shouldLog(n||i)?ea?$z({image:s,message:c,scale:d}):Wz():_s}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||_s)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const s=iE({logLevel:e,message:n,opts:i}),{collapsed:c}=i;return s.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||_s)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=BA(e)}_getLogFunction(e,n,i,s,c){if(this._shouldLog(e)){c=iE({logLevel:e,message:n,args:s,opts:c}),i=i||c.method,zm(i),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=Mc();const d=c.tag||c.message;if(c.once)if(!tE[d])tE[d]=Mc();else return _s;return n=Gz(this.id,c.message,c),i.bind(console,n,...c.args)}return _s}}U(gx,"VERSION",OA);function BA(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return zm(Number.isFinite(e)&&e>=0),e}function iE(t){const{logLevel:e,message:n}=t;t.logLevel=BA(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return zm(s==="string"||s==="object"),Object.assign(t,{args:i},t.opts)}function Gz(t,e,n){if(typeof e=="string"){const i=n.time?Nz(Bz(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=Uz(e,n.color,n.background)}return e}function Wz(t){return console.warn("removed"),_s}function $z(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const c=new Image;return c.onload=()=>{const d=ly(c,n,i);console.log(...d)},c.src=e,_s}const s=e.nodeName||"";if(s.toLowerCase()==="img")return console.log(...ly(e,n,i)),_s;if(s.toLowerCase()==="canvas"){const c=new Image;return c.onload=()=>console.log(...ly(c,n,i)),c.src=e.toDataURL(),_s}return _s}function Hz(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Zt=new gx({id:"deck"});let F0={};function qz(t){F0=t}function er(t,e,n,i){Zt.level>0&&F0[t]&&F0[t].call(null,e,n,i)}function Zz(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const Xz={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Zz,parseTextSync:JSON.parse};function Yz(){const t="8.9.34",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(Zt.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Zt,_registerLoggers:qz},LR([Xz,[Dz,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const Kz=Yz(),cn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(cn,"IDENTITY",{get:()=>(Zt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const mo={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Wl={common:0,meters:1,pixels:2},rE={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Tt=new gx({id:"luma.gl"});function gr(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const Jz="Invalid WebGLRenderingContext",Qz="Requires WebGL2";function pg(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Yt(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function eD(t){return Yt(t)?t:null}function mg(t){return gr(pg(t),Jz),t}function nr(t){return gr(Yt(t),Qz),t}const Wh={};function tD(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function nD(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function iD(t,e){Wh[t]=!0,e!==void 0&&tD(e)}function rD(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(Wh[i]=!0);while(i!==0);for(i in Wh)if(Wh[i])return delete Wh[i],parseInt(i,10);return 0}}const jd=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const s=new t.VertexAttrib(n);this.attribs[i]=s}this.maxAttrib=0};jd.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};jd.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const ec=function(e){const n=this;this.gl=e,rD(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(c){return c===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(c){const d=n.currentVertexArrayObject;d.maxAttrib=Math.max(d.maxAttrib,c);const l=d.attribs[c];return l.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(c){const d=n.currentVertexArrayObject;d.maxAttrib=Math.max(d.maxAttrib,c);const l=d.attribs[c];return l.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(c,d){switch(c){case 34962:n.currentArrayBuffer=d;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=d;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(c,d){const y=n.currentVertexArrayObject.attribs[c];switch(d){case 34975:return y.buffer;case 34338:return y.enabled;case 34339:return y.size;case 34340:return y.stride;case 34341:return y.type;case 34922:return y.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(c,d,l,y,w,S){const I=n.currentVertexArrayObject;I.maxAttrib=Math.max(I.maxAttrib,c);const P=I.attribs[c];return P.buffer=n.currentArrayBuffer,P.size=d,P.type=l,P.normalized=y,P.stride=w,P.offset=S,P.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{nD("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};ec.prototype.VERTEX_ARRAY_BINDING_OES=34229;ec.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new jd(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};ec.prototype.createVertexArrayOES=function(){const e=new jd(this);return this.vertexArrayObjects.push(e),e};ec.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};ec.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof jd&&e.hasBeenBound&&e.ext===this)};ec.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){iD(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,s=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const c=this.currentVertexArrayObject;if(s===c)return;(!s||c.elementArrayBuffer!==s.elementArrayBuffer)&&i.bindBuffer.call(n,34963,c.elementArrayBuffer);let d=this.currentArrayBuffer;const l=Math.max(s?s.maxAttrib:0,c.maxAttrib);for(let y=0;y<=l;y++){const w=c.attribs[y],S=s?s.attribs[y]:null;if((!s||w.enabled!==S.enabled)&&(w.enabled?i.enableVertexAttribArray.call(n,y):i.disableVertexAttribArray.call(n,y)),w.enabled){let I=!1;(!s||w.buffer!==S.buffer)&&(d!==w.buffer&&(i.bindBuffer.call(n,34962,w.buffer),d=w.buffer),I=!0),(I||w.cached!==S.cached)&&i.vertexAttribPointer.call(n,y,w.size,w.type,w.normalized,w.stride,w.offset)}}this.currentArrayBuffer!==d&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function sD(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const s=e.call(this)||[];return s.indexOf("OES_vertex_array_object")<0&&s.push("OES_vertex_array_object"),s};const n=t.getExtension;t.getExtension=function(s){const c=n.call(this,s);return c||(s!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new ec(this)),this.__OESVertexArrayObject))}}const sE="OES_element_index",oE="WEBGL_draw_buffers",oD="EXT_disjoint_timer_query",aD="EXT_disjoint_timer_query_webgl2",lD="EXT_texture_filter_anisotropic",aE="WEBGL_debug_renderer_info",cD=35723,uD=4352,hD=36795,dD=34047,fD=37445,pD=37446,Sn=t=>Yt(t)?void 0:0,mD={3074:t=>Yt(t)?void 0:36064,[cD]:t=>Yt(t)?void 0:uD,35977:Sn,32937:Sn,[hD]:(t,e)=>{const n=Yt(t)?t.getExtension(aD):t.getExtension(oD);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[fD]:(t,e)=>{const n=t.getExtension(aE);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[pD]:(t,e)=>{const n=t.getExtension(aE);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[dD]:(t,e)=>{const n=t.luma.extensions[lD];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:Sn,35071:Sn,37447:Sn,36063:(t,e)=>{if(!Yt(t)){const n=t.getExtension(oE);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:Sn,35374:Sn,35377:Sn,34852:t=>{if(!Yt(t)){const e=t.getExtension(oE);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(sE)?2147483647:65535,33001:t=>t.getExtension(sE)?16777216:65535,33e3:t=>16777216,37157:Sn,35373:Sn,35657:Sn,36183:Sn,37137:Sn,34045:Sn,35978:Sn,35979:Sn,35968:Sn,35376:Sn,35375:Sn,35659:Sn,37154:Sn,35371:Sn,35658:Sn,35076:Sn,35077:Sn,35380:Sn};function gD(t,e,n){const i=mD[n],s=typeof i=="function"?i(t,e,n):i;return s!==void 0?s:e(n)}const _D="OES_vertex_array_object",NA="ANGLE_instanced_arrays",yD="WEBGL_draw_buffers",vD="EXT_disjoint_timer_query",xD="EXT_texture_filter_anisotropic",bD="VertexArray requires WebGL2 or OES_vertex_array_object extension";function wD(t,e){return{webgl2:Yt(t),ext:t.getExtension(e)}}const UA={[_D]:{meta:{suffix:"OES"},createVertexArray:()=>{gr(!1,bD)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[NA]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){gr(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[yD]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{gr(!1)}},[vD]:{meta:{suffix:"EXT"},createQuery:()=>{gr(!1)},deleteQuery:()=>{gr(!1)},beginQuery:()=>{gr(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},cy={readBuffer:(t,e,n)=>{Yt(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:s,ext:c}=wD(t,NA);let d;switch(i){case 35069:d=s?void 0:!1;break;case 35070:d=!s&&!c?0:void 0;break}return d!==void 0?d:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Yt(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,s)=>{if(!Yt(t))switch(s){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,s)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:s}=t.luma,c=s[xD];i=c&&c.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:gD,hint(t,e,n,i){return e(n,i)}};function ED(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(sD(t),TD(t),AD(t,UA),SD(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=ED;function TD(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function SD(t,e){let{target:n,target2:i}=e;Object.keys(cy).forEach(s=>{if(typeof cy[s]=="function"){const c=t[s]?t[s].bind(t):()=>{},d=cy[s].bind(null,t,c);n[s]=d,i[s]=d}})}function AD(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&PD(t,{extension:n,target:t.luma,target2:t})}function PD(t,e){let{extension:n,target:i,target2:s}=e;const c=UA[n];gr(c);const{meta:d={}}=c,{suffix:l=""}=d,y=t.getExtension(n);for(const w of Object.keys(c)){const S="".concat(w).concat(l);let I=null;w==="meta"||typeof t[w]=="function"||(y&&typeof y[S]=="function"?I=function(){return y[S](...arguments)}:typeof c[w]=="function"&&(I=c[w].bind(i))),I&&(i[w]=I,s[w]=I)}}const _x={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ta=(t,e,n)=>e?t.enable(n):t.disable(n),lE=(t,e,n)=>t.hint(n,e),$r=(t,e,n)=>t.pixelStorei(n,e),CD=(t,e)=>{const n=Yt(t)?36009:36160;return t.bindFramebuffer(n,e)},ID=(t,e)=>t.bindFramebuffer(36008,e);function zh(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const LD={3042:Ta,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Ta,2885:(t,e)=>t.cullFace(e),2929:Ta,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Ta,35723:lE,36006:CD,2886:(t,e)=>t.frontFace(e),33170:lE,2849:(t,e)=>t.lineWidth(e),32823:Ta,32824:"polygonOffset",10752:"polygonOffset",35977:Ta,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ta,3088:(t,e)=>t.scissor(...e),2960:Ta,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:$r,3317:$r,37440:$r,37441:$r,37443:$r,3330:$r,3332:$r,3331:$r,36010:ID,3314:$r,32878:$r,3316:$r,3315:$r,32877:$r,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=zh(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=zh(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=zh(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=zh(e)&&e.length===3?[...e,...e]:e;const[n,i,s,c,d,l]=e;t.stencilFuncSeparate(1028,n,i,s),t.stencilFuncSeparate(1029,c,d,l)},stencilOp:(t,e)=>{e=zh(e)&&e.length===3?[...e,...e]:e;const[n,i,s,c,d,l]=e;t.stencilOpSeparate(1028,n,i,s),t.stencilOpSeparate(1029,c,d,l)},viewport:(t,e)=>t.viewport(...e)};function Xn(t,e,n){return e[t]!==void 0?e[t]:n[t]}const MD={blendEquation:(t,e,n)=>t.blendEquationSeparate(Xn(32777,e,n),Xn(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Xn(32969,e,n),Xn(32968,e,n),Xn(32971,e,n),Xn(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Xn(32824,e,n),Xn(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Xn(32938,e,n),Xn(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Xn(2962,e,n),Xn(2967,e,n),Xn(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Xn(34816,e,n),Xn(36003,e,n),Xn(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Xn(2964,e,n),Xn(2965,e,n),Xn(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Xn(34817,e,n),Xn(34818,e,n),Xn(34819,e,n))},cE={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,i,s)=>t({32773:new Float32Array([e,n,i,s])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,s)=>t({32969:e,32968:n,32971:i,32970:s}),clearColor:(t,e,n,i,s)=>t({3106:new Float32Array([e,n,i,s])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,s)=>t({3107:[e,n,i,s]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,s)=>t({3088:new Int32Array([e,n,i,s])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,s)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,s)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(t,e,n,i,s)=>t({2978:[e,n,i,s]})},ao=(t,e)=>t.isEnabled(e),uE={3042:ao,2884:ao,2929:ao,3024:ao,32823:ao,32926:ao,32928:ao,3089:ao,2960:ao,35977:ao};function VA(t){for(const e in t)return!1;return!0}function kD(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}function hE(t,e){const n=t[e].bind(t);t[e]=function(){const s=arguments.length<=0?void 0:arguments[0];return s in t.state.cache?t.state.enable?t.state.cache[s]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function RD(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var c=arguments.length,d=new Array(c),l=0;l<c;l++)d[l]=arguments[l];const{valueChanged:y,oldValue:w}=n(t.state._updateCache,...d);return y&&i(...d),w},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function zD(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class DD{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?FD(e):Object.assign({},_x),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){gr(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Yo(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const s=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const c in e){gr(c!==void 0);const d=e[c],l=this.cache[c];kD(d,l)||(n=!0,i=l,s&&!(c in s)&&(s[c]=l),this.cache[c]=d)}return{valueChanged:n,oldValue:i}}}function jA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(gr(i!==void 0),!t.state){const{polyfillContext:s}=globalThis;s&&s(t),t.state=new DD(t,{copyState:i}),zD(t);for(const c in cE){const d=cE[c];RD(t,c,d)}hE(t,"getParameter"),hE(t,"isEnabled")}return t.state.enable=n,t}function OD(t){t.state||jA(t,{copyState:!1}),t.state.push()}function dE(t){gr(t.state),t.state.pop()}function Yo(t,e){if(gr(pg(t),"setParameters requires a WebGL context"),VA(e))return;const n={};for(const s in e){const c=Number(s),d=LD[s];d&&(typeof d=="string"?n[d]=!0:d(t,e[s],c))}const i=t.state&&t.state.cache;if(i)for(const s in n){const c=MD[s];c(t,e,i)}}function FD(t,e){if(e=e||_x,typeof e=="number"){const s=e,c=uE[s];return c?c(t,s):t.getParameter(s)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const s of n){const c=uE[s];i[s]=c?c(t,Number(s)):t.getParameter(Number(s))}return i}function BD(t){Yo(t,_x)}function Gs(t,e,n){if(VA(e))return n(t);const{nocatch:i=!0}=e;OD(t),Yo(t,e);let s;if(i)s=n(t),dE(t);else try{s=n(t)}finally{dE(t)}return s}function _u(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,i="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return i?t.drawingBufferWidth/i:1}return 1}function uy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=_u(t),s=t.drawingBufferWidth,c=t.drawingBufferHeight;return UD(e,i,s,c,n)}function ND(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function UD(t,e,n,i,s){const c=fE(t[0],e,n);let d=pE(t[1],e,i,s),l=fE(t[0]+1,e,n);const y=l===n-1?l:l-1;l=pE(t[1]+1,e,i,s);let w;return s?(l=l===0?l:l+1,w=d,d=l):w=l===i-1?l:l-1,{x:c,y:d,width:Math.max(y-c+1,1),height:Math.max(w-d+1,1)}}function fE(t,e,n){return Math.min(Math.round(t*e),n-1)}function pE(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const yx=ea(),VD=yx&&typeof document<"u",GA={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function WA(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};gr(yx,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},GA,t);const{width:e,height:n}=t;function i(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=i;let s;const{canvas:c}=t,d=$D({canvas:c,width:e,height:n,onError:i});return s=WD(d,t),s?(s=vx(s,t),HD(s),s):null}function vx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||qD(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},GA,e);const{manageState:n,debug:i}=e;return n&&jA(t,{copyState:!1,log:function(){for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];return Tt.log(1,...c)()}}),yx&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Tt.level=Math.max(Tt.level,1)):Tt.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function jD(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),s=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),c=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:s||e,renderer:c||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function GD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=ND(e.useDevicePixels);ZD(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function WD(t,e){const{onError:n}=e;let i=null;const s=y=>i=y.statusMessage||i;t.addEventListener("webglcontextcreationerror",s,!1);const{webgl1:c=!0,webgl2:d=!0}=e;let l=null;return d&&(l=l||t.getContext("webgl2",e),l=l||t.getContext("experimental-webgl2",e)),c&&(l=l||t.getContext("webgl",e),l=l||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",s,!1),l?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):n("Failed to create ".concat(d&&!c?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function $D(t){let{canvas:e,width:n=800,height:i=600,onError:s}=t,c;return typeof e=="string"?(VD&&document.readyState==="complete"||s("createGLContext called on canvas '".concat(e,"' before page was loaded")),c=document.getElementById(e)):e?c=e:(c=document.createElement("canvas"),c.id="lumagl-canvas",c.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",c.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(c,document.body.firstChild)),c}function HD(t){const e=Yt(t)?"WebGL2":"WebGL1",n=jD(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",s=t.debug?" debug":"";Tt.info(1,"".concat(e).concat(s," context ").concat(i))()}function qD(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function ZD(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,s="height"in n?n.height:t.canvas.clientHeight;(!i||!s)&&(Tt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,s=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const c=t.luma.canvasSizeInfo;if(c.clientWidth!==i||c.clientHeight!==s||c.devicePixelRatio!==e){let d=e;const l=Math.floor(i*d),y=Math.floor(s*d);t.canvas.width=l,t.canvas.height=y,(t.drawingBufferWidth!==l||t.drawingBufferHeight!==y)&&(Tt.warn("Device pixel ratio clamped")(),d=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/s),t.canvas.width=Math.floor(i*d),t.canvas.height=Math.floor(s*d)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:s,devicePixelRatio:e})}}function mE(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class gE{constructor(e,n){U(this,"name",void 0),U(this,"type",void 0),U(this,"sampleSize",1),U(this,"time",void 0),U(this,"count",void 0),U(this,"samples",void 0),U(this,"lastTiming",void 0),U(this,"lastSampleTime",void 0),U(this,"lastSampleCount",void 0),U(this,"_count",0),U(this,"_time",0),U(this,"_samples",0),U(this,"_startTime",0),U(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=mE(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(mE()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class xx{constructor(e){U(this,"id",void 0),U(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof gE?this.stats[n]=e:this.stats[n]=new gE(n,i)),this.stats[n]}}const rd="8.5.21",XD="set luma.log.level=1 (or higher) to trace rendering";class YD{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new xx({id:e})),this.stats.get(e)}}const Dl=new YD;if(globalThis.luma&&globalThis.luma.VERSION!==rd)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(rd));globalThis.luma||(ea()&&Tt.log(1,"luma.gl ".concat(rd," - ").concat(XD))(),globalThis.luma=globalThis.luma||{VERSION:rd,version:rd,log:Tt,stats:Dl,globals:{modules:{},nodeIO:{}}});function KD(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function JD(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function ut(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function hy(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return ut(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function Ha(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const dy={};function Ya(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";dy[t]=dy[t]||1;const e=dy[t]++;return"".concat(t,"-").concat(e)}function _E(t){return ut(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function yu(t){let e=!0;for(const n in t){e=!1;break}return e}function $A(t,e,n,i){const s="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),c=Object.getPrototypeOf(t);i.forEach(d=>{c.methodName||(c[d]=()=>{throw Tt.removed("Calling removed method ".concat(e,".").concat(d,": "),s)(),new Error(d)})})}const Rc="Resource subclass must define virtual methods";let ta=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};mg(e);const{id:i,userData:s={}}=n;this.gl=e,this.gl2=e,this.id=i||Ya(this[Symbol.toStringTag]),this.userData=s,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=hy(this.gl,e),ut(e);const s=(this.constructor.PARAMETERS||{})[e];if(s){const c=Yt(this.gl);if(!((!("webgl2"in s)||c)&&(!("extension"in s)||this.gl.getExtension(s.extension)))){const l=s.webgl1,y="webgl2"in s?s.webgl2:s.webgl1;return c?y:l}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,s=this.constructor.PARAMETERS||{},c=Yt(this.gl),d={},l=n||Object.keys(s);for(const y of l){const w=s[y];if(w&&(!("webgl2"in w)||c)&&(!("extension"in w)||this.gl.getExtension(w.extension))){const I=i?Ha(this.gl,y):y;d[I]=this.getParameter(y,e),i&&w.type==="GLenum"&&(d[I]=Ha(this.gl,d[I]))}}return d}setParameter(e,n){e=hy(this.gl,e),ut(e);const s=(this.constructor.PARAMETERS||{})[e];if(s){const c=Yt(this.gl);if(!((!("webgl2"in s)||c)&&(!("extension"in s)||this.gl.getExtension(s.extension))))throw new Error("Parameter not available on this platform");s.type==="GLenum"&&(n=hy(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return $A(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Rc)}_deleteHandle(){throw new Error(Rc)}_bindHandle(e){throw new Error(Rc)}_getOptsFromHandle(){throw new Error(Rc)}_getParameter(e,n){throw new Error(Rc)}_setParameter(e,n){throw new Error(Rc)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Dl.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Dl.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const s=Dl.get("Memory Usage".concat(i));s.get("GPU Memory").addCount(e),s.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=Dl.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const QD="Failed to deduce GL constant from typed array";function B0(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(QD)}}function Td(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function eO(t){let{data:e,width:n,height:i,bytesPerPixel:s=4,temp:c}=t;const d=n*s;c=c||new Uint8Array(d);for(let l=0;l<i/2;++l){const y=l*d,w=(i-l-1)*d;c.set(e.subarray(y,y+d)),e.copyWithin(y,w,w+d),e.set(c,w)}}function tO(t){let{data:e,width:n,height:i}=t;const s=Math.round(n/2),c=Math.round(i/2),d=new Uint8Array(s*c*4);for(let l=0;l<c;l++)for(let y=0;y<s;y++)for(let w=0;w<4;w++)d[(l*s+y)*4+w]=e[(l*2*n+y*2)*4+w];return{data:d,width:s,height:c}}function N0(t,e,n){const{removedProps:i={},deprecatedProps:s={},replacedProps:c={}}=n;for(const l in i)if(l in e){const w=i[l]?"".concat(t,".").concat(i[l]):"N/A";Tt.removed("".concat(t,".").concat(l),w)()}for(const l in s)if(l in e){const y=s[l];Tt.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(y))()}let d=null;for(const l in c)if(l in e){const y=c[l];Tt.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(y))(),d=d||Object.assign({},e),d[y]=e[l],delete d[l]}return d||e}const nO={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},iO={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Yr{static getBytesPerElement(e){return Td(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return ut(e.size),Td(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new Yr(nO,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(s=>this._assign(s)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Yr.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Yr.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=N0("Accessor",e,iO),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const yE=10,HA={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},rO={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:HA},sO={removedProps:HA};class yn extends ta{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Yr.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Yr.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=N0("Buffer",e,rO),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=N0("Buffer",e,sO),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Yr(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:s=0}=e,c=e.byteLength||e.length;ut(n);const d=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(d,this.handle),s!==0||c!==void 0?(nr(this.gl),this.gl.bufferSubData(this.target,i,n,s,c)):this.gl.bufferSubData(d,i,n),this.gl.bindBuffer(d,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:s=0,size:c}=e;const{gl:d}=this;return nr(d),d.bindBuffer(36662,n.handle),d.bindBuffer(36663,this.handle),d.copyBufferSubData(36662,36663,i,s,c),d.bindBuffer(36662,null),d.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:s=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};nr(this.gl);const c=Td(this.accessor.type||5126,{clamped:!1}),d=this._getAvailableElementCount(n),l=i;let y,w;e?(w=e.length,y=w-l):(y=Math.min(d,s||d),w=l+y);const S=Math.min(d,y);return s=s||S,ut(s<=S),e=e||new c(w),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,s),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:s}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?s!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,s):(ut(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(yE,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;ut(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const s=this._getTarget();this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.usage),this.gl.bufferSubData(s,n,e),this.gl.bindBuffer(s,null),this.debugData=e.slice(0,yE),this.bytesUsed=i,this._trackAllocatedMemory(i);const c=B0(e);return ut(c),this.setAccessor(new Yr(this.accessor,{type:c})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;ut(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const s=this._getTarget();return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,n),this.gl.bindBuffer(s,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Td(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new Yr(this.accessor,{type:B0(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Tt.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Tt.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Tt.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Tt.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Yr(this.accessor,e),this}}const bx={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},qA={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},ZA={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function oO(t,e){const n=bx[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Yt(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function aO(t,e){const n=bx[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const lO=[9729,9728],vE=globalThis.WebGLBuffer||function(){};class $l extends ta{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:s}=n;let c=!0;return i&&(c=c&&oO(e,i),c=c&&(!s||aO(e,i))),c}constructor(e,n){const{id:i=Ya("texture"),handle:s,target:c}=n;super(e,{id:i,handle:s}),this.target=c,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(j=>this.initialize(Object.assign({},e,{pixels:j,data:j}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:s=null,format:c=6408,border:d=0,recreate:l=!1,parameters:y={},pixelStore:w={},textureUnit:S=void 0}=e;n||(n=s);let{width:I,height:P,dataFormat:B,type:G,compressed:K=!1,mipmaps:ue=!0}=e;const{depth:q=0}=e;return{width:I,height:P,compressed:K,dataFormat:B,type:G}=this._deduceParameters({format:c,type:G,dataFormat:B,compressed:K,data:n,width:I,height:P}),this.width=I,this.height=P,this.depth=q,this.format=c,this.type=G,this.dataFormat=B,this.border=d,this.textureUnit=S,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),ue&&this._isNPOT()&&(Tt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),ue=!1,this._updateForNPOT(y)),this.mipmaps=ue,this.setImageData({data:n,width:I,height:P,depth:q,format:c,type:G,dataFormat:B,border:d,mipmaps:ue,parameters:w,compressed:K}),ue&&this.generateMipmap(),this.setParameters(y),l&&(this.data=n),i&&(this._video={video:n,parameters:y,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:s=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:s}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Tt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Gs(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:s=0,format:c=this.format,border:d=this.border,offset:l=0,parameters:y={}}=e;let{data:w=null,type:S=this.type,width:I=this.width,height:P=this.height,dataFormat:B=this.dataFormat,compressed:G=!1}=e;w||(w=i),{type:S,dataFormat:B,compressed:G,width:I,height:P}=this._deduceParameters({format:c,type:S,dataFormat:B,compressed:G,data:w,width:I,height:P});const{gl:K}=this;K.bindTexture(this.target,this.handle);let ue=null;({data:w,dataType:ue}=this._getDataType({data:w,compressed:G}));let q,j=0;if(Gs(this.gl,y,()=>{switch(ue){case"null":K.texImage2D(n,s,c,I,P,d,B,S,w);break;case"typed-array":K.texImage2D(n,s,c,I,P,d,B,S,w,l);break;case"buffer":q=nr(K),q.bindBuffer(35052,w.handle||w),q.texImage2D(n,s,c,I,P,d,B,S,l),q.bindBuffer(35052,null);break;case"browser-object":Yt(K)?K.texImage2D(n,s,c,I,P,d,B,S,w):K.texImage2D(n,s,c,B,S,w);break;case"compressed":for(const[Z,re]of w.entries())K.compressedTexImage2D(n,Z,re.format,re.width,re.height,d,re.data),j+=re.levelSize;break;default:ut(!1,"Unknown image data type")}}),ue==="compressed")this._trackAllocatedMemory(j,"Texture");else if(w&&w.byteLength)this._trackAllocatedMemory(w.byteLength,"Texture");else{const Z=qA[this.dataFormat]||4,re=ZA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*Z*re,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:s=null,x:c=0,y:d=0,width:l=this.width,height:y=this.height,level:w=0,format:S=this.format,type:I=this.type,dataFormat:P=this.dataFormat,compressed:B=!1,offset:G=0,border:K=this.border,parameters:ue={}}=e;if({type:I,dataFormat:P,compressed:B,width:l,height:y}=this._deduceParameters({format:S,type:I,dataFormat:P,compressed:B,data:s,width:l,height:y}),ut(this.depth===0,"texSubImage not supported for 3D textures"),s||(s=i),s&&s.data){const q=s;s=q.data,l=q.shape[0],y=q.shape[1]}s instanceof yn&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),Gs(this.gl,ue,()=>{if(B)this.gl.compressedTexSubImage2D(n,w,c,d,l,y,S,s);else if(s===null)this.gl.texSubImage2D(n,w,c,d,l,y,P,I,null);else if(ArrayBuffer.isView(s))this.gl.texSubImage2D(n,w,c,d,l,y,P,I,s,G);else if(s instanceof vE){const q=nr(this.gl);q.bindBuffer(35052,s),q.texSubImage2D(n,w,c,d,l,y,P,I,G),q.bindBuffer(35052,null)}else Yt(this.gl)?nr(this.gl).texSubImage2D(n,w,c,d,l,y,P,I,s):this.gl.texSubImage2D(n,w,c,d,P,I,s)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Tt.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof yn?{data:n.handle,dataType:"buffer"}:n instanceof vE?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:s,height:c,dataFormat:d,type:l,compressed:y}=e;const w=bx[n];return d=d||w&&w.dataFormat,l=l||w&&w.types[0],y=y||w&&w.compressed,{width:s,height:c}=this._deduceImageSize(i,s,c),{dataFormat:d,type:l,compressed:y,width:s,height:c,format:n,data:i}}_deduceImageSize(e,n,i){let s;return typeof ImageData<"u"&&e instanceof ImageData?s={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?s={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?s={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?s={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?s={width:e.videoWidth,height:e.videoHeight}:e?s={width:n,height:i}:s={width:n>=0?n:1,height:i>=0?i:1},ut(s,"Could not deduced texture size"),ut(n===void 0||s.width===n,"Deduced texture width does not match supplied width"),ut(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:ut(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Yt(this.gl)||!this.width||!this.height?!1:!_E(this.width)||!_E(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:lO.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let cO="";function uO(t,e){return ut(typeof t=="string"),t=cO+t,new Promise((n,i)=>{try{const s=new Image;s.onload=()=>n(s),s.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),s.crossOrigin=e&&e.crossOrigin||"anonymous",s.src=t}catch(s){i(s)}})}class ns extends $l{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return $l.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};mg(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:uO(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const U0=[34069,34070,34071,34072,34073,34074];class XA extends $l{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};mg(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:s=0,y:c=0,mipmapLevel:d=0}=e;return this._subImage({target:n,data:i,x:s,y:c,mipmapLevel:d})}async setCubeMapImageData(e){let{width:n,height:i,pixels:s,data:c,border:d=0,format:l=6408,type:y=5121}=e;const{gl:w}=this,S=s||c,I=await Promise.all(U0.map(P=>{const B=S[P];return Promise.all(Array.isArray(B)?B:[B])}));this.bind(),U0.forEach((P,B)=>{I[B].length>1&&this.opts.mipmaps!==!1&&Tt.warn("".concat(this.id," has mipmap and multiple LODs."))(),I[B].forEach((G,K)=>{n&&i?w.texImage2D(P,K,l,n,i,d,l,y,G):w.texImage2D(P,K,l,l,y,G)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:s,pixels:c,data:d,border:l=0,format:y=6408,type:w=5121}=e,{gl:S}=this,I=c||d;return this.bind(),I instanceof Promise?I.then(P=>this.setImageDataForFace(Object.assign({},e,{face:n,data:P,pixels:P}))):this.width||this.height?S.texImage2D(n,0,y,i,s,l,y,w,I):S.texImage2D(n,0,y,y,w,I),this}}XA.FACES=U0;class hO extends $l{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};nr(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:s,height:c,depth:d=1,border:l=0,format:y,type:w=5121,offset:S=0,data:I,parameters:P={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Gs(this.gl,P,()=>{ArrayBuffer.isView(I)&&this.gl.texImage3D(this.target,n,i,s,c,d,l,y,w,I),I instanceof yn&&(this.gl.bindBuffer(35052,I.handle),this.gl.texImage3D(this.target,n,i,s,c,d,l,y,w,S))}),I&&I.byteLength)this._trackAllocatedMemory(I.byteLength,"Texture");else{const B=qA[this.dataFormat]||4,G=ZA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*B*G,"Texture")}return this.loaded=!0,this}}const Al="EXT_color_buffer_float",xE={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:Al,bpp:2},33327:{gl2:Al,bpp:4},34842:{gl2:Al,bpp:8},33326:{gl2:Al,bpp:4},33328:{gl2:Al,bpp:8},34836:{gl2:Al,bpp:16},35898:{gl2:Al,bpp:4}};function dO(t,e,n){const i=n[e];if(!i)return!1;const s=Yt(t)&&i.gl2||i.gl1;return typeof s=="string"?t.getExtension(s):s}class Yc extends ta{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||dO(e,n,xE)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:s=1,samples:c=0}=e;return ut(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),c!==0&&Yt(this.gl)?this.gl.renderbufferStorageMultisample(36161,c,n,i,s):this.gl.renderbufferStorage(36161,n,i,s),this.format=n,this.width=i,this.height=s,this.samples=c,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*xE[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const fO=256,pO=1024,mO=16384,bE=6144,wE=6145,EE=6146,TE=34041,YA="clear: bad arguments";function wx(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:s=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const c={};e&&(c.framebuffer=e);let d=0;n&&(d|=mO,n!==!0&&(c.clearColor=n)),i&&(d|=fO,i!==!0&&(c.clearDepth=i)),s&&(d|=pO,i!==!0&&(c.clearStencil=i)),ut(d!==0,YA),Gs(t,c,()=>{t.clear(d)})}function gO(t){let{framebuffer:e=null,buffer:n=bE,drawBuffer:i=0,value:s=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};nr(t),Gs(t,{framebuffer:e},()=>{switch(n){case bE:switch(s.constructor){case Int32Array:t.clearBufferiv(n,i,s);break;case Uint32Array:t.clearBufferuiv(n,i,s);break;case Float32Array:default:t.clearBufferfv(n,i,s)}break;case wE:t.clearBufferfv(wE,0,[s]);break;case EE:t.clearBufferiv(EE,0,[s]);break;case TE:const[c,d]=s;t.clearBufferfi(TE,0,c,d);break;default:ut(!1,YA)}})}function _O(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ut(!1),0}}function gg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:s=6408}=e;let{sourceAttachment:c=36064,target:d=null,sourceWidth:l,sourceHeight:y,sourceType:w}=e;const{framebuffer:S,deleteFramebuffer:I}=KA(t);ut(S);const{gl:P,handle:B,attachments:G}=S;l=l||S.width,y=y||S.height,c===36064&&B===null&&(c=1028),ut(G[c]),w=w||G[c].type,d=vO(d,w,s,l,y),w=w||B0(d);const K=P.bindFramebuffer(36160,B);return P.readPixels(n,i,l,y,s,w,d),P.bindFramebuffer(36160,K||null),I&&S.delete(),d}function SE(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=gg(t,{sourceAttachment:e}),{width:s,height:c}=t;for(;c>n;)({data:i,width:s,height:c}=tO({data:i,width:s,height:c}));eO({data:i,width:s,height:c});const d=document.createElement("canvas");d.width=s,d.height=c;const l=d.getContext("2d"),y=l.createImageData(s,c);return y.data.set(i),l.putImageData(y,0,0),d.toDataURL()}function yO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:i=0,sourceY:s=0,targetMipmaplevel:c=0,targetInternalFormat:d=6408}=n;let{targetX:l,targetY:y,targetZ:w,width:S,height:I}=n;const{framebuffer:P,deleteFramebuffer:B}=KA(t);ut(P);const{gl:G,handle:K}=P,ue=typeof l<"u"||typeof y<"u"||typeof w<"u";l=l||0,y=y||0,w=w||0;const q=G.bindFramebuffer(36160,K);ut(e);let j=null;if(e instanceof $l&&(j=e,S=Number.isFinite(S)?S:j.width,I=Number.isFinite(I)?I:j.height,j.bind(0),e=j.target),!ue)G.copyTexImage2D(e,c,d,i,s,S,I,0);else switch(e){case 3553:case 34067:G.copyTexSubImage2D(e,c,l,y,i,s,S,I);break;case 35866:case 32879:nr(G).copyTexSubImage3D(e,c,l,y,w,i,s,S,I);break}return j&&j.unbind(),G.bindFramebuffer(36160,q||null),B&&P.delete(),j}function KA(t){return t instanceof xi?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:IO(t),deleteFramebuffer:!0}}function vO(t,e,n,i,s){if(t)return t;e=e||5121;const c=Td(e,{clamped:!1}),d=_O(n);return new c(i*s*d)}const In={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function xO(t){const e=new ns(t,{format:6408,type:5126,dataFormat:6408}),n=new xi(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const JA={[In.WEBGL2]:[!1,!0],[In.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[In.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[In.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[In.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[In.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[In.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[In.FLOAT_BLEND]:["EXT_float_blend"],[In.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[In.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[In.TEXTURE_FLOAT]:["OES_texture_float",!0],[In.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[In.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[In.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[In.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[In.COLOR_ATTACHMENT_RGBA32F]:[xO,"EXT_color_buffer_float"],[In.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[In.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[In.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[In.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[In.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[In.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},bO=2;function wO(t,e){return Ex(t,e)}function Ex(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>QA(t,n))}function EO(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in JA)t.luma.caps[e]===void 0&&(t.luma.caps[e]=QA(t,e));return t.luma.caps}function QA(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=TO(t,e)),t.luma.caps[e]||Tt.log(bO,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function TO(t,e){const n=JA[e];ut(n,e);let i;const s=Yt(t)&&n[1]||n[0];if(typeof s=="function")i=s(t);else if(Array.isArray(s)){i=!0;for(const c of s)i=i&&!!t.getExtension(c)}else typeof s=="string"?i=!!t.getExtension(s):typeof s=="boolean"?i=s:ut(!1);return i}const AE="Multiple render targets not supported";class xi extends ta{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:s}=n;let c=!0;return i&&(c=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),s&&(c=c&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),c}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new xi(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=nr(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=nr(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:s=null,color:c=!0,depth:d=!0,stencil:l=!1,check:y=!0,readBuffer:w=void 0,drawBuffers:S=void 0}=e;if(ut(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,s)for(const I in s){const P=s[I];(Array.isArray(P)?P[0]:P).resize({width:n,height:i})}else s=this._createDefaultAttachments(c,d,l,n,i);this.update({clearAttachments:!0,attachments:s,readBuffer:w,drawBuffers:S}),s&&y&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:s,clearAttachments:c=!1,resizeAttachments:d=!0}=e;this.attach(n,{clearAttachments:c,resizeAttachments:d});const{gl:l}=this,y=l.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),s&&this._setDrawBuffers(s),l.bindFramebuffer(36160,y||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return ut(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&Tt.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const s in this.attachments)this.attachments[s].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};n&&Object.keys(this.attachments).forEach(d=>{s[d]=null}),Object.assign(s,e);const c=this.gl.bindFramebuffer(36160,this.handle);for(const d in s){ut(d!==void 0,"Misspelled framebuffer binding point?");const l=Number(d),y=s[l];let w=y;if(!w)this._unattach(l);else if(w instanceof Yc)this._attachRenderbuffer({attachment:l,renderbuffer:w});else if(Array.isArray(y)){const[S,I=0,P=0]=y;w=S,this._attachTexture({attachment:l,texture:S,layer:I,level:P})}else this._attachTexture({attachment:l,texture:w,layer:0,level:0});i&&w&&w.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,c||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(d=>!this.attachments[d]).forEach(d=>{delete this.attachments[d]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(AO(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:s,drawBuffers:c=[]}=e,d=this.gl.bindFramebuffer(36160,this.handle);return(n||i||s)&&wx(this.gl,{color:n,depth:i,stencil:s}),c.forEach((l,y)=>{gO(this.gl,{drawBuffer:y,value:l})}),this.gl.bindFramebuffer(36160,d||null),this}readPixels(){return Tt.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Tt.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Tt.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Tt.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Tt.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Tt.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:s=0,width:c,height:d}=e;const l=nr(this.gl),y=l.bindFramebuffer(36008,this.handle);return i===0&&s===0&&c===void 0&&d===void 0?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,i,s,c,d),l.bindFramebuffer(36008,y),this}getAttachmentParameter(e,n,i){let s=this._getAttachmentParameterFallback(n);return s===null&&(this.gl.bindFramebuffer(36160,this.handle),s=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&s>1e3&&(s=Ha(this.gl,s)),s}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const s={};for(const c of i){const d=n?Ha(this.gl,c):c;s[d]=this.getAttachmentParameter(e,c,n)}return s}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const s of n){const c=Number(s),d=e?Ha(this.gl,c):c;i[d]=this.getAttachmentParameters(c,e)}return i}show(){return typeof window<"u"&&window.open(SE(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Tt.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=SE(this,{targetMaxHeight:100});return Tt.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,s,c){let d=null;return e&&(d=d||{},d[36064]=new ns(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:s,height:c,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(d[36064])),n&&i?(d=d||{},d[33306]=new Yc(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:s,height:111}),this.ownResources.push(d[33306])):n?(d=d||{},d[36096]=new Yc(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:s,height:c}),this.ownResources.push(d[36096])):i&&ut(!1),d}_unattach(e){const n=this.attachments[e];n&&(n instanceof Yc?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:s}=this;s.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:s,level:c}=e;const{gl:d}=this;switch(d.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:nr(d).framebufferTextureLayer(36160,n,i.target,c,s);break;case 34067:const y=SO(s);d.framebufferTexture2D(36160,n,y,i.handle,c);break;case 3553:d.framebufferTexture2D(36160,n,3553,i.handle,c);break;default:ut(!1,"Illegal texture type")}d.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=eD(this.gl);n?n.readBuffer(e):ut(e===36064||e===1029,AE),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=nr(n);if(i)i.drawBuffers(e);else{const s=n.getExtension("WEBGL_draw_buffers");s?s.drawBuffersWEBGL(e):ut(e.length===1&&(e[0]===36064||e[0]===1029),AE)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=EO(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function SO(t){return t<34069?t+34069:t}function AO(t){return(xi.STATUS||{})[t]||"Framebuffer error ".concat(t)}const PO=[36049,36048,33296,33298,33299,33300,33301,33302,33303];xi.ATTACHMENT_PARAMETERS=PO;function CO(t,e){ut(t instanceof ns||t instanceof XA||t instanceof hO);const n=t.constructor,{gl:i,width:s,height:c,format:d,type:l,dataFormat:y,border:w,mipmaps:S}=t,I=Object.assign({width:s,height:c,format:d,type:l,dataFormat:y,border:w,mipmaps:S},e);return new n(i,I)}function IO(t,e){const{gl:n,width:i,height:s,id:c}=t;return new xi(n,Object.assign({},e,{id:"framebuffer-for-".concat(c),width:i,height:s,attachments:{36064:t}}))}function Yp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const LO=35632,MO=35633;function kO(t){switch(t){case LO:return"fragment";case MO:return"vertex";default:return"unknown type"}}function RO(t,e,n,i){const s=t.split(/\r?\n/),c={},d={},l=i||Yp(e)||"(unnamed)",y="".concat(kO(n)," shader ").concat(l);for(let S=0;S<s.length;S++){const I=s[S];if(I.length<=1)continue;const P=I.split(":"),B=P[0],G=parseInt(P[2],10);if(isNaN(G))throw new Error("GLSL compilation error in ".concat(y,": ").concat(t));B!=="WARNING"?c[G]=I:d[G]=I}const w=zO(e);return{shaderName:y,errors:PE(c,w),warnings:PE(d,w)}}function PE(t,e){let n="";for(let i=0;i<e.length;i++){const s=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(s,`
`),t[i+1])){const c=t[i+1],d=c.split(":",3),l=d[0],y=parseInt(d[1],10)||0,w=c.substring(d.join(":").length+1).trim();n+=eP("^^^ ".concat(l,": ").concat(w,`

`),y)}}return n}function zO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),s=String(i.length+e-1).length;return i.map((c,d)=>{const l=String(d+e),y=l.length;return eP(l,s-y)+n+c})}function eP(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function tP(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const DO="Shader: GLSL source code must be a JavaScript string";class Sd extends ta{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return ut(!1),"unknown"}}constructor(e,n){mg(e),ut(typeof n.source=="string",DO);const i=Yp(n.source,null)||n.id||Ya("unnamed ".concat(Sd.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=Yp(n,null);i&&(this.id=Ya(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Sd.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Yp(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:s,errors:c,warnings:d}=RO(i,this.source,this.shaderType,this.id);throw Tt.error("GLSL compilation errors in ".concat(s,`
`).concat(c))(),Tt.warn("GLSL compilation warnings in ".concat(s,`
`).concat(d))(),new Error("GLSL compilation errors in ".concat(s))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class fy extends Sd{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class py extends Sd{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const OO={5126:Pn.bind(null,"uniform1fv",Hr,1,Qi),35664:Pn.bind(null,"uniform2fv",Hr,2,Qi),35665:Pn.bind(null,"uniform3fv",Hr,3,Qi),35666:Pn.bind(null,"uniform4fv",Hr,4,Qi),5124:Pn.bind(null,"uniform1iv",Sa,1,Qi),35667:Pn.bind(null,"uniform2iv",Sa,2,Qi),35668:Pn.bind(null,"uniform3iv",Sa,3,Qi),35669:Pn.bind(null,"uniform4iv",Sa,4,Qi),35670:Pn.bind(null,"uniform1iv",Sa,1,Qi),35671:Pn.bind(null,"uniform2iv",Sa,2,Qi),35672:Pn.bind(null,"uniform3iv",Sa,3,Qi),35673:Pn.bind(null,"uniform4iv",Sa,4,Qi),35674:Pn.bind(null,"uniformMatrix2fv",Hr,4,Fo),35675:Pn.bind(null,"uniformMatrix3fv",Hr,9,Fo),35676:Pn.bind(null,"uniformMatrix4fv",Hr,16,Fo),35678:Ni,35680:Ni,5125:Pn.bind(null,"uniform1uiv",vp,1,Qi),36294:Pn.bind(null,"uniform2uiv",vp,2,Qi),36295:Pn.bind(null,"uniform3uiv",vp,3,Qi),36296:Pn.bind(null,"uniform4uiv",vp,4,Qi),35685:Pn.bind(null,"uniformMatrix2x3fv",Hr,6,Fo),35686:Pn.bind(null,"uniformMatrix2x4fv",Hr,8,Fo),35687:Pn.bind(null,"uniformMatrix3x2fv",Hr,6,Fo),35688:Pn.bind(null,"uniformMatrix3x4fv",Hr,12,Fo),35689:Pn.bind(null,"uniformMatrix4x2fv",Hr,8,Fo),35690:Pn.bind(null,"uniformMatrix4x3fv",Hr,12,Fo),35678:Ni,35680:Ni,35679:Ni,35682:Ni,36289:Ni,36292:Ni,36293:Ni,36298:Ni,36299:Ni,36300:Ni,36303:Ni,36306:Ni,36307:Ni,36308:Ni,36311:Ni},FO={},BO={},NO={},CE=[0];function Tx(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(CE[0]=t,t=CE);const s=t.length;if(s%e&&Tt.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let c=i[s];c||(c=new n(s),i[s]=c);for(let d=0;d<s;d++)c[d]=t[d];return c}function Hr(t,e){return Tx(t,e,Float32Array,FO)}function Sa(t,e){return Tx(t,e,Int32Array,BO)}function vp(t,e){return Tx(t,e,Uint32Array,NO)}function IE(t,e,n){const i=OO[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function UO(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function VO(t,e,n){for(const i in t){const s=t[i];if((!n||!!n[i])&&!jO(s))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),s),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function jO(t){return Array.isArray(t)||ArrayBuffer.isView(t)?WO(t):isFinite(t)||t===!0||t===!1||t instanceof $l||t instanceof Yc?!0:t instanceof xi?!!t.texture:!1}function GO(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let s=0,c=n.length;s<c;++s)i[s]=n[s]}else t[e]=n.slice();else t[e]=n}function WO(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ni(){let t=null;return(e,n,i)=>{const s=t!==i;return s&&(e.uniform1i(n,i),t=i),s}}function Pn(t,e,n,i){let s=null,c=null;return(d,l,y)=>{const w=e(y,n),S=w.length;let I=!1;if(s===null)s=new Float32Array(S),c=S,I=!0;else{ut(c===S,"Uniform length cannot change.");for(let P=0;P<S;++P)if(w[P]!==s[P]){I=!0;break}}return I&&(i(d,t,l,w),s.set(w)),I}}function Qi(t,e,n,i){t[e](n,i)}function Fo(t,e,n,i){t[e](n,!1,i)}const $O=5120,HO=5121,qO=5122,ZO=5123,LE=0,xp=1,XO=2,YO=3,bp=4,KO=5,JO=6,_i=5126,QO=35664,eF=35665,tF=35666,Dh=5124,nF=35667,iF=35668,rF=35669,Oh=5125,sF=36294,oF=36295,aF=36296,lF=35670,cF=35671,uF=35672,hF=35673,dF=35674,fF=35675,pF=35676,mF=35685,gF=35686,_F=35687,yF=35688,vF=35689,xF=35690,V0={[_i]:[_i,1,"float"],[QO]:[_i,2,"vec2"],[eF]:[_i,3,"vec3"],[tF]:[_i,4,"vec4"],[Dh]:[Dh,1,"int"],[nF]:[Dh,2,"ivec2"],[iF]:[Dh,3,"ivec3"],[rF]:[Dh,4,"ivec4"],[Oh]:[Oh,1,"uint"],[sF]:[Oh,2,"uvec2"],[oF]:[Oh,3,"uvec3"],[aF]:[Oh,4,"uvec4"],[lF]:[_i,1,"bool"],[cF]:[_i,2,"bvec2"],[uF]:[_i,3,"bvec3"],[hF]:[_i,4,"bvec4"],[dF]:[_i,8,"mat2"],[mF]:[_i,8,"mat2x3"],[gF]:[_i,8,"mat2x4"],[fF]:[_i,12,"mat3"],[_F]:[_i,12,"mat3x2"],[yF]:[_i,12,"mat3x4"],[pF]:[_i,16,"mat4"],[vF]:[_i,16,"mat4x2"],[xF]:[_i,16,"mat4x3"]};function bF(t){switch(t){case LE:return LE;case xp:return xp;case YO:return xp;case XO:return xp;case bp:return bp;case KO:return bp;case JO:return bp;default:return ut(!1),0}}function ME(t){const e=V0[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function nP(t,e){switch(t){case $O:case HO:case qO:case ZO:t=_i;break}for(const n in V0){const[i,s,c]=V0[n];if(i===t&&s===e)return{glType:n,name:c}}return null}class wF{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let s=0;s<i;s++){const{name:c,type:d,size:l}=n.getActiveAttrib(e.handle,s),y=n.getAttribLocation(e.handle,c);y>=0&&this._addAttribute(y,c,d,l)}this.attributeInfos.sort((s,c)=>s.location-c.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Yt(n))return;const i=n.getProgramParameter(e.handle,35971);for(let s=0;s<i;s++){const{name:c,type:d,size:l}=n.getTransformFeedbackVarying(e.handle,s);this._addVarying(s,c,d,l)}this.varyingInfos.sort((s,c)=>s.location-c.location)}_addAttribute(e,n,i,s){const{type:c,components:d}=ME(i),l={type:c,size:s*d};this._inferProperties(e,n,l);const y={location:e,name:n,accessor:new Yr(l)};this.attributeInfos.push(y),this.attributeInfosByLocation[e]=y,this.attributeInfosByName[y.name]=y}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,s){const{type:c,components:d}=ME(i),l=new Yr({type:c,size:s*d}),y={location:e,name:n,accessor:l};this.varyingInfos.push(y),this.varyingInfosByName[y.name]=y}}const kE=4,EF=35981,TF=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class iP extends ta{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",TF),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:s,varyings:c,bufferMode:d=EF}=e;return this.hash=n||"",this.vs=typeof i=="string"?new fy(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof s=="string"?new py(this.gl,{id:"".concat(e.id,"-fs"),source:s}):s,ut(this.vs instanceof fy),ut(this.fs instanceof py),this.uniforms={},this._textureUniforms={},c&&c.length>0&&(nr(this.gl),this.varyings=c,this.gl2.transformFeedbackVaryings(this.handle,c,d)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new wF(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:s,offset:c=0,start:d,end:l,isIndexed:y=!1,indexType:w=5123,instanceCount:S=0,isInstanced:I=S>0,vertexArray:P=null,transformFeedback:B,framebuffer:G,parameters:K={},uniforms:ue,samplers:q}=e;if((ue||q)&&(Tt.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(ue||{})),Tt.priority>=n){const j=G?G.id:"default",Z="mode=".concat(Ha(this.gl,i)," verts=").concat(s," ")+"instances=".concat(S," indexType=").concat(Ha(this.gl,w)," ")+"isInstanced=".concat(I," isIndexed=").concat(y," ")+"Framebuffer=".concat(j);Tt.log(n,Z)()}return ut(P),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||s===0||I&&S===0?!1:(P.bindForDraw(s,S,()=>{if(G!==void 0&&(K=Object.assign({},K,{framebuffer:G})),B){const j=bF(i);B.begin(j)}this._bindTextures(),Gs(this.gl,K,()=>{y&&I?this.gl2.drawElementsInstanced(i,s,w,c,S):y&&Yt(this.gl)&&!isNaN(d)&&!isNaN(l)?this.gl2.drawRangeElements(i,d,l,s,w,c):y?this.gl.drawElements(i,s,w,c):I?this.gl2.drawArraysInstanced(i,c,s,S):this.gl.drawArrays(i,c,s)}),B&&B.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Tt.priority>=2&&VO(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],s=this._uniformSetters[n];if(s){let c=i,d=!1;if(c instanceof xi&&(c=c.texture),c instanceof $l)if(d=this.uniforms[n]!==i,d){s.textureIndex===void 0&&(s.textureIndex=this._textureIndexCounter++);const l=c,{textureIndex:y}=s;l.bind(y),c=y,this._textureUniforms[n]=l}else c=s.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(s(c)||d)&&GO(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const s of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new fy({handle:s});break;case 35632:i.fs=new py({handle:s});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Ya(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Tt.time(kE,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Tt.timeEnd(kE,"linkProgram for ".concat(this._getName()))(),e.debug||Tt.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:s}=UO(i.name);let c=e.getUniformLocation(this.handle,s);if(this._uniformSetters[s]=IE(e,c,i),i.size>1)for(let d=0;d<i.size;d++)c=e.getUniformLocation(this.handle,"".concat(s,"[").concat(d,"]")),this._uniformSetters["".concat(s,"[").concat(d,"]")]=IE(e,c,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const SF=34918,AF=34919,PF=35007,CF=36795,IF=35976,LF=35887,MF=36202;class Dm extends ta{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Yt(e),s=Ex(e,In.TIMER_QUERY);let c=i||s;for(const d of n)switch(d){case"queries":c=c&&i;break;case"timers":c=c&&s;break;default:ut(!1)}return c}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(PF)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?MF:LF)}beginTransformFeedbackQuery(){return this.begin(IF)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,AF);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(CF)}getResult(){return this.gl2.getQueryParameter(this.handle,SF)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,s)=>{const c=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(c)}),this._pollingPromise}_createHandle(){return Dm.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class rP extends ta{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};nr(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,yu(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:s,byteSize:c,byteOffset:d}=this._getBufferParams(n);return i<0?(this.unused[e]=s,Tt.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,s,d,c),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,s;return e instanceof yn?s=e:(s=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||s.byteLength-n),{buffer:s,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:s}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,s,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;const c=n&&n.handle;return!c||s===void 0?this.gl.bindBufferBase(35982,e,c):this.gl.bindBufferRange(35982,e,c,i,s),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let wp=null;function kF(t){return(!wp||wp.byteLength<t)&&(wp=new ArrayBuffer(t)),wp}function RF(t,e){const n=kF(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function zF(t){let{target:e,source:n,start:i=0,count:s=1}=t;const c=n.length,d=s*c;let l=0;for(let y=i;l<c;l++)e[y++]=n[l];for(;l<d;)l<d-l?(e.copyWithin(i+l,i,i+l),l*=2):(e.copyWithin(i+l,i,i+d-l),l=d);return e}const DF="elements must be GL.ELEMENT_ARRAY_BUFFER";class qr extends ta{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Yt(e)||FA()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new qr(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return qr.MAX_ATTRIBUTES=qr.MAX_ATTRIBUTES||e.getParameter(34921),qr.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:qr._setConstantFloatArray(e,n,i);break;case Int32Array:qr._setConstantIntArray(e,n,i);break;case Uint32Array:qr._setConstantUintArray(e,n,i);break;default:ut(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return qr.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return ut(!e||e.target===34963,DF),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:s,type:c,stride:d,offset:l,normalized:y,integer:w,divisor:S}=i,{gl:I,gl2:P}=this;return e=Number(e),this.bind(()=>{I.bindBuffer(34962,n.handle),w?(ut(Yt(I)),P.vertexAttribIPointer(e,s,c,d,l)):I.vertexAttribPointer(e,s,c,y,d,l),I.enableVertexAttribArray(e),P.vertexAttribDivisor(e,S||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!qr.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),s=i.byteLength*e,c=i.length*e;let d=!this.buffer;if(this.buffer=this.buffer||new yn(this.gl,s),d=d||this.buffer.reallocate(s),d=d||!this._compareConstantArrayValues(i,this.bufferValue),d){const l=RF(n.constructor,c);zF({target:l,source:i,start:0,count:c}),this.buffer.subData(l),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:ut(!1)}}static _setConstantIntArray(e,n,i){switch(ut(Yt(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:ut(!1)}}static _setConstantUintArray(e,n,i){switch(ut(Yt(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:ut(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return ut(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const OF="VertexArray: attributes must be Buffers or constants (i.e. typed array)",FF=/^(.+)__LOCATION_([0-9]+)$/,BF=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class NF{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new qr(e),$A(this,"VertexArray","v6.0",BF),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:s,accessor:c}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return s>=0&&(this.values[s]=n,this.accessors[s]=c,this.clearDrawParams(),this.vertexArrayObject.setBuffer(s,n,c)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:s,accessor:c}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return s>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[s]=n,this.accessors[s]=c,this.clearDrawParams(),this.vertexArrayObject.enable(s,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new yn(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof yn&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof yn&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let s;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),s=i()}),s}_resolveLocationAndAccessor(e,n,i,s){const c={location:-1,accessor:null},{location:d,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(d)||d<0)return this.unused[e]=n,Tt.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),c;const y=this._getAttributeInfo(l||d);if(!y)return c;const w=this.accessors[d]||{},S=Yr.resolve(y.accessor,w,i,s),{size:I,type:P}=S;return ut(Number.isFinite(I)&&Number.isFinite(P)),{location:d,accessor:S}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=FF.exec(e),s=i?i[1]:e,c=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(s)+c,name:s}:{location:-1}}_setAttribute(e,n){if(n instanceof yn)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof yn){const i=n[0],s=n[1];this.setBuffer(e,i,s)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof yn){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(OF)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let s=this.values[0];ArrayBuffer.isView(s)&&this._setConstantAttributeZero(s,i);for(let c=1;c<this.vertexArrayObject.MAX_ATTRIBUTES;c++)s=this.values[c],ArrayBuffer.isView(s)&&this._setConstantAttribute(c,s)}_setConstantAttributeZero(e,n){if(qr.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){qr.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],s=this.accessors[n];if(!i)return;const{divisor:c}=s,d=c>0;if(e.isInstanced=e.isInstanced||d,i instanceof yn){const l=i;if(d){const y=l.getVertexCount(s);e.instanceCount=Math.min(e.instanceCount,y)}else{const y=l.getVertexCount(s);e.vertexCount=Math.min(e.vertexCount,y)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Tt.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function UF(t,e){const{maxElts:n=16,size:i=1}=e;let s="[";for(let d=0;d<t.length&&d<n;++d)d>0&&(s+=",".concat(d%i===0?" ":"")),s+=Ad(t[d],e);const c=t.length>n?"...":"]";return"".concat(s).concat(c)}function Ad(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return UF(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const s=t.toPrecision(2);return s.indexOf(".0")===s.length-2?s.slice(0,-1):s}function RE(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:s=!1}=t;ut(n);const c=".*_.*",d=".*Matrix",l=n._uniformSetters,y={},w=Object.keys(l).sort();let S=0;for(const B of w)!B.match(c)&&!B.match(d)&&my({table:y,header:e,uniforms:i,uniformName:B,undefinedOnly:s})&&S++;for(const B of w)B.match(d)&&my({table:y,header:e,uniforms:i,uniformName:B,undefinedOnly:s})&&S++;for(const B of w)y[B]||my({table:y,header:e,uniforms:i,uniformName:B,undefinedOnly:s})&&S++;let I=0;const P={};if(!s)for(const B in i){const G=i[B];y[B]||(I++,P[B]={Type:"NOT USED: ".concat(G),[e]:Ad(G)})}return{table:y,count:S,unusedTable:P,unusedCount:I}}function my(t){let{table:e,header:n,uniforms:i,uniformName:s,undefinedOnly:c}=t;const d=i[s],l=VF(d);return!c||!l?(e[s]={[n]:l?Ad(d):"N/A","Uniform Type":l?d:"NOT PROVIDED"},!0):!1}function VF(t){return t!=null}function jF(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=zE(e,e.elements,null,n));const s=e.values;for(const c in s){const d=e._getAttributeInfo(c);if(d){let l="".concat(c,": ").concat(d.name);const y=e.accessors[d.location];y&&(l="".concat(c,": ").concat(GF(d.name,y))),i[l]=zE(e,s[c],y,n)}}return i}function zE(t,e,n,i){const{gl:s}=t;if(!e)return{[i]:"null","Format ":"N/A"};let c="NOT PROVIDED",d=1,l=0,y=0,w,S,I;if(n&&(c=n.type,d=n.size,c=String(c).replace("Array",""),w=c.indexOf("nt")!==-1),e instanceof yn){const P=e,{data:B,changed:G}=P.getDebugData();S=G?"*":"",I=B,y=P.byteLength,l=y/B.BYTES_PER_ELEMENT/d;let K;if(n){const ue=n.divisor>0;K="".concat(ue?"I ":"P "," ").concat(l," (x").concat(d,"=").concat(y," bytes ").concat(Ha(s,c),")")}else w=!0,K="".concat(y," bytes");return{[i]:"".concat(S).concat(Ad(I,{size:d,isInteger:w})),"Format ":K}}return I=e,d=e.length,c=String(e.constructor.name).replace("Array",""),w=c.indexOf("nt")!==-1,{[i]:"".concat(Ad(I,{size:d,isInteger:w})," (constant)"),"Format ":"".concat(d,"x").concat(c," (constant)")}}function GF(t,e){const{type:n,size:i}=e,s=nP(n,i);return s?"".concat(t," (").concat(s.name,")"):t}function WF(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const s=DE(i);e["in ".concat(s)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const s=DE(i);e["out ".concat(s)]={[n]:JSON.stringify(i.accessor)}}return e}function DE(t){const{type:e,size:n}=t.accessor,i=nP(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const OE=ea()&&typeof document<"u";let $F=0;class HF{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=ue=>WA(ue),onAddHTML:i=null,onInitialize:s=()=>{},onRender:c=()=>{},onFinalize:d=()=>{},onError:l,gl:y=null,glOptions:w={},debug:S=!1,createFramebuffer:I=!1,autoResizeViewport:P=!0,autoResizeDrawingBuffer:B=!0,stats:G=Dl.get("animation-loop-".concat($F++))}=e;let{useDevicePixels:K=!0}=e;"useDevicePixelRatio"in e&&(Tt.deprecated("useDevicePixelRatio","useDevicePixels")(),K=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:s,onRender:c,onFinalize:d,onError:l,gl:y,glOptions:w,debug:S,createFramebuffer:I},this.gl=y,this.needsRedraw=null,this.timeline=null,this.stats=G,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:P,autoResizeDrawingBuffer:B,useDevicePixels:K}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return ut(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Dm.isSupported(this.gl,["timers"])?new Dm(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return Tt.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=OE?new Promise((e,n)=>{if(OE&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):JD(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):KD(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?vx(this.props.gl,e):this.onCreateContext(e),!pg(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");BD(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:s}=this.gl;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&GD(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new xi(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Gd="vs",Sx="fs";function es(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const gy={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function qF(t){const e={};for(const n in t){const i=t[n],s=ZF(i);e[n]=s}return e}function ZF(t){let e=FE(t);return e==="object"?t?"type"in t?Object.assign({},t,gy[t.type]):"value"in t?(e=FE(t.value),Object.assign({type:e},t,gy[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},gy[e])}function FE(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const XF="vs",YF="fs";class BE{constructor(e){let{name:n,vs:i,fs:s,dependencies:c=[],uniforms:d,getUniforms:l,deprecations:y=[],defines:w={},inject:S={},vertexShader:I,fragmentShader:P}=e;es(typeof n=="string"),this.name=n,this.vs=i||I,this.fs=s||P,this.getModuleUniforms=l,this.dependencies=c,this.deprecations=this._parseDeprecationDefinitions(y),this.defines=w,this.injections=KF(S),d&&(this.uniforms=qF(d))}getModuleSource(e){let n;switch(e){case XF:n=this.vs||"";break;case YF:n=this.fs||"";break;default:es(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const s in i){const c=i[s];s in e&&!c.private?(c.validate&&es(c.validate(e[s],c),"".concat(this.name,": invalid ").concat(s)),n[s]=e[s]):n[s]=c.value}return n}}function KF(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const s=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[s][n]=i}return e}function JF(t){return QF(oP(t))}function QF(t){const e={},n={};return sP({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i])}function sP(t){let{modules:e,level:n,moduleMap:i,moduleDepth:s}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const c of e)i[c.name]=c,(s[c.name]===void 0||s[c.name]<n)&&(s[c.name]=n);for(const c of e)c.dependencies&&sP({modules:c.dependencies,level:n+1,moduleMap:i,moduleDepth:s})}function oP(t,e){return t.map(n=>(n instanceof BE||(es(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),es(n.name,"shader module has no name"),n=new BE(n),n.dependencies=oP(n.dependencies)),n))}function eB(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,s=n.indexOf("Trident/")!==-1;return i||s}const tB=7936,nB=7937,iB=7938,rB=35724,Ax={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Ml={};Object.keys(Ax).forEach(t=>{Ml[t]=t});function sB(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function oB(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||tB),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||nB);return{gpuVendor:aB(n,i),vendor:n,renderer:i,version:t.getParameter(iB),shadingLanguageVersion:t.getParameter(rB)}}function aB(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const _y={};function NE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=Ax[e];if(es(i,e),!eB(n))return!0;if(e in _y)return _y[e];const s=i[0],c=n.behavior||"enable",d="#extension GL_".concat(s," : ").concat(c,`
void main(void) {}`),l=t.createShader(35633);t.shaderSource(l,d),t.compileShader(l);const y=t.getShaderParameter(l,35713);return t.deleteShader(l),_y[e]=y,y}function lB(t,e){const n=Ax[e];es(n,e);const i=sB(t)&&n[1]||n[0],s=typeof i=="string"?!!t.getExtension(i):i;return es(s===!1||s===!0),s}function Ep(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>lB(t,n))}function cB(t){switch(oB(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function uB(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Ep(t,Ml.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Ep(t,Ml.GLSL_DERIVATIVES)&&NE(t,Ml.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Ep(t,Ml.GLSL_FRAG_DATA)&&NE(t,Ml.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Ep(t,Ml.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const hB=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,dB=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,fB={[Gd]:hB,[Sx]:dB},Kp="__LUMA_INJECT_DECLARATIONS__",UE=/void\s+main\s*\([^)]*\)\s*\{\n?/,VE=/}\n?[^{}]*$/,yy=[];function jE(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const s=e===Gd;for(const c in n){const d=n[c];d.sort((y,w)=>y.order-w.order),yy.length=d.length;for(let y=0,w=d.length;y<w;++y)yy[y]=d[y].injection;const l="".concat(yy.join(`
`),`
`);switch(c){case"vs:#decl":s&&(t=t.replace(Kp,l));break;case"vs:#main-start":s&&(t=t.replace(UE,y=>y+l));break;case"vs:#main-end":s&&(t=t.replace(VE,y=>l+y));break;case"fs:#decl":s||(t=t.replace(Kp,l));break;case"fs:#main-start":s||(t=t.replace(UE,y=>y+l));break;case"fs:#main-end":s||(t=t.replace(VE,y=>l+y));break;default:t=t.replace(c,y=>y+l)}}return t=t.replace(Kp,""),i&&(t=t.replace(/\}\s*$/,c=>c+fB[e])),t}function j0(t){const e={};return es(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function vu(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const aP=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],pB=[...aP,[vu("attribute"),"in $1"],[vu("varying"),"out $1"]],mB=[...aP,[vu("varying"),"in $1"]],lP=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],gB=[...lP,[vu("in"),"attribute $1"],[vu("out"),"varying $1"]],_B=[...lP,[vu("in"),"varying $1"]],G0="gl_FragColor",W0=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,yB=/void\s+main\s*\([^)]*\)\s*\{\n?/;function vB(t,e,n){switch(e){case 300:return n?Om(t,pB):xB(t);case 100:return n?Om(t,gB):bB(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Om(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function xB(t){t=Om(t,mB);const e=t.match(W0);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(G0,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(yB,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(G0,"\\b"),"g"),n)}return t}function bB(t){t=Om(t,_B);const e=t.match(W0);if(e){const n=e[1];t=t.replace(W0,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),G0)}return t}const wB=`

`.concat(Kp,`

`),cP={[Gd]:"vertex",[Sx]:"fragment"},EB=`precision highp float;

`;function TB(t,e){const{vs:n,fs:i}=e,s=JF(e.modules||[]);return{gl:t,vs:GE(t,Object.assign({},e,{source:n,type:Gd,modules:s})),fs:GE(t,Object.assign({},e,{source:i,type:Sx,modules:s})),getUniforms:SB(s)}}function GE(t,e){let{id:n,source:i,type:s,modules:c,defines:d={},hookFunctions:l=[],inject:y={},transpileToGLSL100:w=!1,prologue:S=!0,log:I}=e;es(typeof i=="string","shader source must be a string");const P=s===Gd,B=i.split(`
`);let G=100,K="",ue=i;B[0].indexOf("#version ")===0?(G=300,K=B[0],ue=B.slice(1).join(`
`)):K="#version ".concat(G);const q={};c.forEach(Re=>{Object.assign(q,Re.getDefines())}),Object.assign(q,d);let j=S?"".concat(K,`
`).concat(PB({id:n,source:i,type:s}),`
`).concat(AB({type:s}),`
`).concat(cB(t),`
`).concat(uB(t),`
`).concat(CB(q),`
`).concat(P?"":EB,`
`):"".concat(K,`
`);const Z=LB(l),re={},pe={},be={};for(const Re in y){const Fe=typeof y[Re]=="string"?{injection:y[Re],order:0}:y[Re],je=Re.match(/^(v|f)s:(#)?([\w-]+)$/);if(je){const Ge=je[2],pt=je[3];Ge?pt==="decl"?pe[Re]=[Fe]:be[Re]=[Fe]:re[Re]=[Fe]}else be[Re]=[Fe]}for(const Re of c){I&&Re.checkDeprecations(ue,I);const Fe=Re.getModuleSource(s,G);j+=Fe;const je=Re.injections[s];for(const Ge in je){const pt=Ge.match(/^(v|f)s:#([\w-]+)$/);if(pt){const St=pt[2]==="decl"?pe:be;St[Ge]=St[Ge]||[],St[Ge].push(je[Ge])}else re[Ge]=re[Ge]||[],re[Ge].push(je[Ge])}}return j+=wB,j=jE(j,s,pe),j+=IB(Z[s],re),j+=ue,j=jE(j,s,be),j=vB(j,w?100:G,P),j}function SB(t){return function(n){const i={};for(const s of t){const c=s.getUniforms(n,i);Object.assign(i,c)}return i}}function AB(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(cP[e].toUpperCase(),`
`)}function PB(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(cP[i],`

`):""}function CB(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const s=t[i];(s||Number.isFinite(s))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function IB(t,e){let n="";for(const i in t){const s=t[i];if(n+="void ".concat(s.signature,` {
`),s.header&&(n+="  ".concat(s.header)),e[i]){const c=e[i];c.sort((d,l)=>d.order-l.order);for(const d of c)n+="  ".concat(d.injection,`
`)}s.footer&&(n+="  ".concat(s.footer)),n+=`}
`}return n}function LB(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[s,c]=n.split(":"),d=n.replace(/\(.+/,"");e[s][d]=Object.assign(i,{signature:c})}),e}const MB="void main() {gl_FragColor = vec4(0);}",uP=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,kB=`#version 300 es
`.concat(uP);function hP(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,s,c]=n;if(!e.includes(i)||!s||!c)return null;const d=c.split(";")[0];return{qualifier:i,type:s,name:d}}function dP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:s}=t;if(!n)return e===300?kB:e>300?"#version ".concat(e,`
`).concat(uP):MB;const c=DB(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(s,`;
void main() {
  `).concat(s," = ").concat(c,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(c,`;
}`)}function RB(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return es(!1),null}}function zB(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return es(!1),null}}function DB(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return es(!1),null}}const OB=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,FB={name:"fp32",vs:OB,fs:null};function WE(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Jr={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function BB(t,{precision:e=Jr.precision}={}){return t=NB(t),"".concat(parseFloat(t.toPrecision(e)))}function xu(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Da(t,e,n){return VB(t,i=>Math.max(e,Math.min(n,i)))}function Fm(t,e,n){return xu(t)?t.map((i,s)=>Fm(i,e[s],n)):n*e+(1-n)*t}function Pd(t,e,n){const i=Jr.EPSILON;n&&(Jr.EPSILON=n);try{if(t===e)return!0;if(xu(t)&&xu(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!Pd(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Jr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Jr.EPSILON=i}}function NB(t){return Math.round(t/Jr.EPSILON)*Jr.EPSILON}function UB(t){return t.clone?t.clone():new Array(t.length)}function VB(t,e,n){if(xu(t)){const i=t;n=n||UB(i);for(let s=0;s<n.length&&s<i.length;++s)n[s]=e(t[s],s,n);return n}return e(t)}function jB(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class fP extends jB(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:xu(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Jr)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+BB(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Pd(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let s=0;s<this.ELEMENTS;++s){const c=e[s];this[s]=c+i*(n[s]-c)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Jr.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function GB(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Xr(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function vy(t,e,n=""){if(Jr.debug&&!GB(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class WB extends fP{get x(){return this[0]}set x(e){this[0]=Xr(e)}get y(){return this[1]}set y(e){this[1]=Xr(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];n+=s*s}return Xr(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return Xr(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return WE(e>=0&&e<this.ELEMENTS,"index is out of range"),Xr(this[e])}setComponent(e,n){return WE(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Jp=1e-6,bu=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function $B(){var t=new bu(2);return bu!=Float32Array&&(t[0]=0,t[1]=0),t}function $E(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function HB(t,e){return t[0]=-e[0],t[1]=-e[1],t}function pP(t,e,n,i){var s=e[0],c=e[1];return t[0]=s+i*(n[0]-s),t[1]=c+i*(n[1]-c),t}function qB(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[4]*s+n[12],t[1]=n[1]*i+n[5]*s+n[13],t}(function(){var t=$B();return function(e,n,i,s,c,d){var l,y;for(n||(n=2),i||(i=0),s?y=Math.min(s*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],c(t,t,d),e[l]=t[0],e[l+1]=t[1];return e}})();function ZB(t,e,n){const i=e[0],s=e[1],c=n[3]*i+n[7]*s||1;return t[0]=(n[0]*i+n[4]*s)/c,t[1]=(n[1]*i+n[5]*s)/c,t}function mP(t,e,n){const i=e[0],s=e[1],c=e[2],d=n[3]*i+n[7]*s+n[11]*c||1;return t[0]=(n[0]*i+n[4]*s+n[8]*c)/d,t[1]=(n[1]*i+n[5]*s+n[9]*c)/d,t[2]=(n[2]*i+n[6]*s+n[10]*c)/d,t}function XB(t,e,n){const i=e[0],s=e[1];return t[0]=n[0]*i+n[2]*s,t[1]=n[1]*i+n[3]*s,t[2]=e[2],t}function YB(){var t=new bu(3);return bu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function KB(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function JB(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function QB(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function e4(t,e,n){var i=e[0],s=e[1],c=e[2],d=n[0],l=n[1],y=n[2];return t[0]=s*y-c*l,t[1]=c*d-i*y,t[2]=i*l-s*d,t}function gP(t,e,n){var i=e[0],s=e[1],c=e[2],d=n[3]*i+n[7]*s+n[11]*c+n[15];return d=d||1,t[0]=(n[0]*i+n[4]*s+n[8]*c+n[12])/d,t[1]=(n[1]*i+n[5]*s+n[9]*c+n[13])/d,t[2]=(n[2]*i+n[6]*s+n[10]*c+n[14])/d,t}function t4(t,e,n){var i=e[0],s=e[1],c=e[2];return t[0]=i*n[0]+s*n[3]+c*n[6],t[1]=i*n[1]+s*n[4]+c*n[7],t[2]=i*n[2]+s*n[5]+c*n[8],t}function n4(t,e,n){var i=n[0],s=n[1],c=n[2],d=n[3],l=e[0],y=e[1],w=e[2],S=s*w-c*y,I=c*l-i*w,P=i*y-s*l,B=s*P-c*I,G=c*S-i*P,K=i*I-s*S,ue=d*2;return S*=ue,I*=ue,P*=ue,B*=2,G*=2,K*=2,t[0]=l+S+B,t[1]=y+I+G,t[2]=w+P+K,t}function i4(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[0],c[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),c[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function r4(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),c[1]=s[1],c[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function s4(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),c[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),c[2]=s[2],t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function o4(t,e){var n=t[0],i=t[1],s=t[2],c=e[0],d=e[1],l=e[2],y=Math.sqrt(n*n+i*i+s*s),w=Math.sqrt(c*c+d*d+l*l),S=y*w,I=S&&QB(t,e)/S;return Math.acos(Math.min(Math.max(I,-1),1))}var a4=KB;(function(){var t=YB();return function(e,n,i,s,c,d){var l,y;for(n||(n=3),i||(i=0),s?y=Math.min(s*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],c(t,t,d),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const xy=[0,0,0];let Tp;class vo extends WB{static get ZERO(){return Tp||(Tp=new vo(0,0,0),Object.freeze(Tp)),Tp}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&xu(e)?this.copy(e):(Jr.debug&&(Xr(e),Xr(n),Xr(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Jr.debug&&(Xr(e.x),Xr(e.y),Xr(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Xr(e)}angle(e){return o4(this,e)}cross(e){return e4(this,this,e),this.check()}rotateX({radians:e,origin:n=xy}){return i4(this,this,n,e),this.check()}rotateY({radians:e,origin:n=xy}){return r4(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=xy}){return s4(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return gP(this,this,e),this.check()}transformAsVector(e){return mP(this,this,e),this.check()}transformByMatrix3(e){return t4(this,this,e),this.check()}transformByMatrix2(e){return XB(this,this,e),this.check()}transformByQuaternion(e){return n4(this,this,e),this.check()}}class l4 extends fP{toString(){let e="[";if(Jr.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=Xr(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)n[s]=this[i+s];return n}setColumn(e,n){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=n[s];return this}}function c4(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function u4(t,e){if(t===e){var n=e[1],i=e[2],s=e[3],c=e[6],d=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=c,t[11]=e[14],t[12]=s,t[13]=d,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function $0(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=e[4],l=e[5],y=e[6],w=e[7],S=e[8],I=e[9],P=e[10],B=e[11],G=e[12],K=e[13],ue=e[14],q=e[15],j=n*l-i*d,Z=n*y-s*d,re=n*w-c*d,pe=i*y-s*l,be=i*w-c*l,Re=s*w-c*y,Fe=S*K-I*G,je=S*ue-P*G,Ge=S*q-B*G,pt=I*ue-P*K,bt=I*q-B*K,St=P*q-B*ue,kt=j*St-Z*bt+re*pt+pe*Ge-be*je+Re*Fe;return kt?(kt=1/kt,t[0]=(l*St-y*bt+w*pt)*kt,t[1]=(s*bt-i*St-c*pt)*kt,t[2]=(K*Re-ue*be+q*pe)*kt,t[3]=(P*be-I*Re-B*pe)*kt,t[4]=(y*Ge-d*St-w*je)*kt,t[5]=(n*St-s*Ge+c*je)*kt,t[6]=(ue*re-G*Re-q*Z)*kt,t[7]=(S*Re-P*re+B*Z)*kt,t[8]=(d*bt-l*Ge+w*Fe)*kt,t[9]=(i*Ge-n*bt-c*Fe)*kt,t[10]=(G*be-K*re+q*j)*kt,t[11]=(I*re-S*be-B*j)*kt,t[12]=(l*je-d*pt-y*Fe)*kt,t[13]=(n*pt-i*je+s*Fe)*kt,t[14]=(K*Z-G*pe-ue*j)*kt,t[15]=(S*pe-I*Z+P*j)*kt,t):null}function h4(t){var e=t[0],n=t[1],i=t[2],s=t[3],c=t[4],d=t[5],l=t[6],y=t[7],w=t[8],S=t[9],I=t[10],P=t[11],B=t[12],G=t[13],K=t[14],ue=t[15],q=e*d-n*c,j=e*l-i*c,Z=e*y-s*c,re=n*l-i*d,pe=n*y-s*d,be=i*y-s*l,Re=w*G-S*B,Fe=w*K-I*B,je=w*ue-P*B,Ge=S*K-I*G,pt=S*ue-P*G,bt=I*ue-P*K;return q*bt-j*pt+Z*Ge+re*je-pe*Fe+be*Re}function Bl(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],l=e[4],y=e[5],w=e[6],S=e[7],I=e[8],P=e[9],B=e[10],G=e[11],K=e[12],ue=e[13],q=e[14],j=e[15],Z=n[0],re=n[1],pe=n[2],be=n[3];return t[0]=Z*i+re*l+pe*I+be*K,t[1]=Z*s+re*y+pe*P+be*ue,t[2]=Z*c+re*w+pe*B+be*q,t[3]=Z*d+re*S+pe*G+be*j,Z=n[4],re=n[5],pe=n[6],be=n[7],t[4]=Z*i+re*l+pe*I+be*K,t[5]=Z*s+re*y+pe*P+be*ue,t[6]=Z*c+re*w+pe*B+be*q,t[7]=Z*d+re*S+pe*G+be*j,Z=n[8],re=n[9],pe=n[10],be=n[11],t[8]=Z*i+re*l+pe*I+be*K,t[9]=Z*s+re*y+pe*P+be*ue,t[10]=Z*c+re*w+pe*B+be*q,t[11]=Z*d+re*S+pe*G+be*j,Z=n[12],re=n[13],pe=n[14],be=n[15],t[12]=Z*i+re*l+pe*I+be*K,t[13]=Z*s+re*y+pe*P+be*ue,t[14]=Z*c+re*w+pe*B+be*q,t[15]=Z*d+re*S+pe*G+be*j,t}function Bm(t,e,n){var i=n[0],s=n[1],c=n[2],d,l,y,w,S,I,P,B,G,K,ue,q;return e===t?(t[12]=e[0]*i+e[4]*s+e[8]*c+e[12],t[13]=e[1]*i+e[5]*s+e[9]*c+e[13],t[14]=e[2]*i+e[6]*s+e[10]*c+e[14],t[15]=e[3]*i+e[7]*s+e[11]*c+e[15]):(d=e[0],l=e[1],y=e[2],w=e[3],S=e[4],I=e[5],P=e[6],B=e[7],G=e[8],K=e[9],ue=e[10],q=e[11],t[0]=d,t[1]=l,t[2]=y,t[3]=w,t[4]=S,t[5]=I,t[6]=P,t[7]=B,t[8]=G,t[9]=K,t[10]=ue,t[11]=q,t[12]=d*i+S*s+G*c+e[12],t[13]=l*i+I*s+K*c+e[13],t[14]=y*i+P*s+ue*c+e[14],t[15]=w*i+B*s+q*c+e[15]),t}function Px(t,e,n){var i=n[0],s=n[1],c=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function d4(t,e,n,i){var s=i[0],c=i[1],d=i[2],l=Math.hypot(s,c,d),y,w,S,I,P,B,G,K,ue,q,j,Z,re,pe,be,Re,Fe,je,Ge,pt,bt,St,kt,Wn;return l<Jp?null:(l=1/l,s*=l,c*=l,d*=l,y=Math.sin(n),w=Math.cos(n),S=1-w,I=e[0],P=e[1],B=e[2],G=e[3],K=e[4],ue=e[5],q=e[6],j=e[7],Z=e[8],re=e[9],pe=e[10],be=e[11],Re=s*s*S+w,Fe=c*s*S+d*y,je=d*s*S-c*y,Ge=s*c*S-d*y,pt=c*c*S+w,bt=d*c*S+s*y,St=s*d*S+c*y,kt=c*d*S-s*y,Wn=d*d*S+w,t[0]=I*Re+K*Fe+Z*je,t[1]=P*Re+ue*Fe+re*je,t[2]=B*Re+q*Fe+pe*je,t[3]=G*Re+j*Fe+be*je,t[4]=I*Ge+K*pt+Z*bt,t[5]=P*Ge+ue*pt+re*bt,t[6]=B*Ge+q*pt+pe*bt,t[7]=G*Ge+j*pt+be*bt,t[8]=I*St+K*kt+Z*Wn,t[9]=P*St+ue*kt+re*Wn,t[10]=B*St+q*kt+pe*Wn,t[11]=G*St+j*kt+be*Wn,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function _P(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[4],d=e[5],l=e[6],y=e[7],w=e[8],S=e[9],I=e[10],P=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*s+w*i,t[5]=d*s+S*i,t[6]=l*s+I*i,t[7]=y*s+P*i,t[8]=w*s-c*i,t[9]=S*s-d*i,t[10]=I*s-l*i,t[11]=P*s-y*i,t}function f4(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[0],d=e[1],l=e[2],y=e[3],w=e[8],S=e[9],I=e[10],P=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s-w*i,t[1]=d*s-S*i,t[2]=l*s-I*i,t[3]=y*s-P*i,t[8]=c*i+w*s,t[9]=d*i+S*s,t[10]=l*i+I*s,t[11]=y*i+P*s,t}function yP(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[0],d=e[1],l=e[2],y=e[3],w=e[4],S=e[5],I=e[6],P=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s+w*i,t[1]=d*s+S*i,t[2]=l*s+I*i,t[3]=y*s+P*i,t[4]=w*s-c*i,t[5]=S*s-d*i,t[6]=I*s-l*i,t[7]=P*s-y*i,t}function p4(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=n+n,l=i+i,y=s+s,w=n*d,S=i*d,I=i*l,P=s*d,B=s*l,G=s*y,K=c*d,ue=c*l,q=c*y;return t[0]=1-I-G,t[1]=S+q,t[2]=P-ue,t[3]=0,t[4]=S-q,t[5]=1-w-G,t[6]=B+K,t[7]=0,t[8]=P+ue,t[9]=B-K,t[10]=1-w-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function m4(t,e,n,i,s,c,d){var l=1/(n-e),y=1/(s-i),w=1/(c-d);return t[0]=c*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c*2*y,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(s+i)*y,t[10]=(d+c)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=d*c*2*w,t[15]=0,t}function g4(t,e,n,i,s){var c=1/Math.tan(e/2),d;return t[0]=c/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(d=1/(i-s),t[10]=(s+i)*d,t[14]=2*s*i*d):(t[10]=-1,t[14]=-2*i),t}var _4=g4;function y4(t,e,n,i,s,c,d){var l=1/(e-n),y=1/(i-s),w=1/(c-d);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*l,t[13]=(s+i)*y,t[14]=(d+c)*w,t[15]=1,t}var v4=y4;function x4(t,e,n,i){var s,c,d,l,y,w,S,I,P,B,G=e[0],K=e[1],ue=e[2],q=i[0],j=i[1],Z=i[2],re=n[0],pe=n[1],be=n[2];return Math.abs(G-re)<Jp&&Math.abs(K-pe)<Jp&&Math.abs(ue-be)<Jp?c4(t):(S=G-re,I=K-pe,P=ue-be,B=1/Math.hypot(S,I,P),S*=B,I*=B,P*=B,s=j*P-Z*I,c=Z*S-q*P,d=q*I-j*S,B=Math.hypot(s,c,d),B?(B=1/B,s*=B,c*=B,d*=B):(s=0,c=0,d=0),l=I*d-P*c,y=P*s-S*d,w=S*c-I*s,B=Math.hypot(l,y,w),B?(B=1/B,l*=B,y*=B,w*=B):(l=0,y=0,w=0),t[0]=s,t[1]=l,t[2]=S,t[3]=0,t[4]=c,t[5]=y,t[6]=I,t[7]=0,t[8]=d,t[9]=w,t[10]=P,t[11]=0,t[12]=-(s*G+c*K+d*ue),t[13]=-(l*G+y*K+w*ue),t[14]=-(S*G+I*K+P*ue),t[15]=1,t)}function b4(){var t=new bu(4);return bu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function w4(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Wd(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3];return t[0]=n[0]*i+n[4]*s+n[8]*c+n[12]*d,t[1]=n[1]*i+n[5]*s+n[9]*c+n[13]*d,t[2]=n[2]*i+n[6]*s+n[10]*c+n[14]*d,t[3]=n[3]*i+n[7]*s+n[11]*c+n[15]*d,t}(function(){var t=b4();return function(e,n,i,s,c,d){var l,y;for(n||(n=4),i||(i=0),s?y=Math.min(s*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],c(t,t,d),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var H0;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(H0||(H0={}));const E4=45*Math.PI/180,T4=1,by=.1,wy=500,S4=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class xo extends l4{static get IDENTITY(){return P4()}static get ZERO(){return A4()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return H0}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,s,c,d,l,y,w,S,I,P,B,G,K,ue){return this[0]=e,this[1]=n,this[2]=i,this[3]=s,this[4]=c,this[5]=d,this[6]=l,this[7]=y,this[8]=w,this[9]=S,this[10]=I,this[11]=P,this[12]=B,this[13]=G,this[14]=K,this[15]=ue,this.check()}setRowMajor(e,n,i,s,c,d,l,y,w,S,I,P,B,G,K,ue){return this[0]=e,this[1]=c,this[2]=w,this[3]=B,this[4]=n,this[5]=d,this[6]=S,this[7]=G,this[8]=i,this[9]=l,this[10]=I,this[11]=K,this[12]=s,this[13]=y,this[14]=P,this[15]=ue,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(S4)}fromObject(e){return this.check()}fromQuaternion(e){return p4(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:s,top:c,near:d=by,far:l=wy}=e;return l===1/0?C4(this,n,i,s,c,d):m4(this,n,i,s,c,d,l),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:s=[0,1,0]}=e;return x4(this,n,i,s),this.check()}ortho(e){const{left:n,right:i,bottom:s,top:c,near:d=by,far:l=wy}=e;return v4(this,n,i,s,c,d,l),this.check()}orthographic(e){const{fovy:n=E4,aspect:i=T4,focalDistance:s=1,near:c=by,far:d=wy}=e;HE(n);const l=n/2,y=s*Math.tan(l),w=y*i;return this.ortho({left:-w,right:w,bottom:-y,top:y,near:c,far:d})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:s=.1,far:c=500}=e;return HE(n),_4(this,n,i,s,c),this.check()}determinant(){return h4(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),s=1/i[0],c=1/i[1],d=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*c,e[6]=this[6]*d,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*c,e[10]=this[10]*d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),s=1/i[0],c=1/i[1],d=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=this[4]*s,e[4]=this[5]*c,e[5]=this[6]*d,e[6]=this[8]*s,e[7]=this[9]*c,e[8]=this[10]*d,e}transpose(){return u4(this,this),this.check()}invert(){return $0(this,this),this.check()}multiplyLeft(e){return Bl(this,e,this),this.check()}multiplyRight(e){return Bl(this,this,e),this.check()}rotateX(e){return _P(this,this,e),this.check()}rotateY(e){return f4(this,this,e),this.check()}rotateZ(e){return yP(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return d4(this,this,e,n),this.check()}scale(e){return Px(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Bm(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Wd(n||[-0,-0,-0,-0],e,this),vy(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let s;switch(i){case 2:s=qB(n||[-0,-0],e,this);break;case 3:s=gP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return vy(s,e.length),s}transformAsVector(e,n){let i;switch(e.length){case 2:i=ZB(n||[-0,-0],e,this);break;case 3:i=mP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return vy(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let Sp,Ap;function A4(){return Sp||(Sp=new xo([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Sp)),Sp}function P4(){return Ap||(Ap=new xo,Object.freeze(Ap)),Ap}function HE(t){if(t>Math.PI*2)throw Error("expected radians")}function C4(t,e,n,i,s,c){const d=2*c/(n-e),l=2*c/(s-i),y=(n+e)/(n-e),w=(s+i)/(s-i),S=-1,I=-1,P=-2*c;return t[0]=d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=y,t[9]=w,t[10]=S,t[11]=I,t[12]=0,t[13]=0,t[14]=P,t[15]=0,t}const qE=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,I4={lightSources:{}};function Ey(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function L4(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const s={};return e?s["lighting_uAmbientLight.color"]=Ey(e):s["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((c,d)=>{s["lighting_uPointLight[".concat(d,"].color")]=Ey(c),s["lighting_uPointLight[".concat(d,"].position")]=c.position,s["lighting_uPointLight[".concat(d,"].attenuation")]=c.attenuation||[1,0,0]}),s.lighting_uPointLightCount=n.length,i.forEach((c,d)=>{s["lighting_uDirectionalLight[".concat(d,"].color")]=Ey(c),s["lighting_uDirectionalLight[".concat(d,"].direction")]=c.direction}),s.lighting_uDirectionalLightCount=i.length,s}function vP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:I4;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},L4({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return vP({lightSources:e})}return{}}const M4={name:"lights",vs:qE,fs:qE,getUniforms:vP,defines:{MAX_LIGHTS:3}},k4=new Uint8Array([0,255,255,255]),R4={pickingSelectedColor:null,pickingHighlightColor:k4,pickingActive:!1,pickingAttribute:!1};function z4(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:R4;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const D4=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,O4=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,F4={name:"picking",vs:D4,fs:O4,getUniforms:z4},B4=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,N4={};function U4(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:s=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:s.map(c=>c/255)}}function V4(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:N4;if(!("material"in t))return{};const{material:e}=t;return e?U4(e):{lighting_uEnabled:!1}}const j4={name:"gouraud-lighting",dependencies:[M4],vs:B4,defines:{LIGHTING_VERTEX:1},getUniforms:V4},G4=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,W4={name:"transform",vs:G4,fs:null};class $d{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new $d(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:s={},inject:c={},varyings:d=[],bufferMode:l=35981,transpileToGLSL100:y=!1}=e,w=this._getModuleList(e.modules),S=this._getHash(n),I=this._getHash(i),P=w.map(Z=>this._getHash(Z.name)).sort(),B=d.map(Z=>this._getHash(Z)),G=Object.keys(s).sort(),K=Object.keys(c).sort(),ue=[],q=[];for(const Z of G)ue.push(this._getHash(Z)),ue.push(this._getHash(s[Z]));for(const Z of K)q.push(this._getHash(Z)),q.push(this._getHash(c[Z]));const j="".concat(S,"/").concat(I,"D").concat(ue.join("/"),"M").concat(P.join("/"),"I").concat(q.join("/"),"V").concat(B.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(y?"T":"");if(!this._programCache[j]){const Z=TB(this.gl,{vs:n,fs:i,modules:w,inject:c,defines:s,hookFunctions:this._hookFunctions,transpileToGLSL100:y});this._programCache[j]=new iP(this.gl,{hash:j,vs:Z.vs,fs:Z.fs,varyings:d,bufferMode:l}),this._getUniforms[j]=Z.getUniforms||(re=>{}),this._useCounts[j]=0}return this._useCounts[j]++,this._programCache[j]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let c=0,d=this._defaultModules.length;c<d;++c){const l=this._defaultModules[c],y=l.name;n[s++]=l,i[y]=!0}for(let c=0,d=e.length;c<d;++c){const l=e[c],y=l.name;i[y]||(n[s++]=l,i[y]=!0)}return n.length=s,n}}const $4={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function H4(t,e,n){const i={};let s=e.indices;for(const c in e.attributes){const d=e.attributes[c],l=q4(c,n);if(c==="indices")s=d;else if(d.constant)i[l]=d.value;else{const y=d.value,w={...d};delete w.value,i[l]=[new yn(t,y),w],Z4(c,w)}}if(s){const c=s.value||s;ut(c instanceof Uint16Array||c instanceof Uint32Array,'attribute array for "indices" must be of integer type');const d={size:1,isIndexed:s.isIndexed===void 0?!0:s.isIndexed};i.indices=[new yn(t,{data:c,target:34963}),d]}return i}function q4(t,e){const{attributeMap:n=$4}=e||{};return n&&n[t]||t}function Z4(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}ut(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const zc=2,X4=1e4,Y4="Model needs drawMode and vertexCount",ZE=()=>{},K4={};class Hl{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=Ya("model")}=n;ut(pg(e)),this.id=i,this.gl=e,this.id=n.id||Ya("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||$d.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S}=e;this.programProps={program:n,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},ut(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),Y4)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S}=e;this.programProps={program:n,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return ut(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return ut(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=H4(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(yu(e))return this;const n={};for(const i in e){const s=e[i];n[i]=s.getValue?s.getValue():s}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return wx(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:s={},attributes:c={},transformFeedback:d=this.transformFeedback,parameters:l={},vertexArray:y=this.vertexArray}=e;this.setAttributes(c),this.updateModuleSettings(n),this.setUniforms(s);let w;Tt.priority>=zc&&(w=this._logDrawCallStart(zc));const S=this.vertexArray.getDrawParams(),{isIndexed:I=S.isIndexed,indexType:P=S.indexType,indexOffset:B=S.indexOffset,vertexArrayInstanced:G=S.isInstanced}=this.props;G&&!this.isInstanced&&Tt.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:K,instanceCount:ue}=this,{onBeforeRender:q=ZE,onAfterRender:j=ZE}=this.props;q(),this.program.setUniforms(this.uniforms);const Z=this.program.draw(Object.assign(K4,e,{logPriority:w,uniforms:null,framebuffer:i,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:y,transformFeedback:d,isIndexed:I,indexType:P,isInstanced:K,instanceCount:ue,offset:I?B:0}));return j(),Tt.priority>=zc&&this._logDrawCallEnd(w,y,i),Z}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:s=[]}=e;let{parameters:c}=e;i&&this._setFeedbackBuffers(i),n&&(c=Object.assign({},c,{35977:n})),s.forEach(d=>d.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:c}))}finally{s.forEach(d=>d.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Tt.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:s,modules:c,inject:d,defines:l,varyings:y,bufferMode:w,transpileToGLSL100:S}=this.programProps;n=this.programManager.get({vs:i,fs:s,modules:c,inject:d,defines:l,varyings:y,bufferMode:w,transpileToGLSL100:S}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}ut(n instanceof iP,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new NF(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof yn&&n.delete()}}_setAnimationProps(e){this.animated&&ut(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(yu(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new rP(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:X4;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Tt.group(zc,">>> DRAWING MODEL ".concat(this.id),{collapsed:Tt.level<=2})(),e}_logDrawCallEnd(e,n,i,s){if(e===void 0)return;const c=jF({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:d,unusedTable:l,unusedCount:y}=RE({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:w,count:S}=RE({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});S>0&&Tt.log("MISSING UNIFORMS",Object.keys(w))(),y>0&&Tt.log("UNUSED UNIFORMS",Object.keys(l))();const I=WF(this.vertexArray.configuration);Tt.table(e,c)(),Tt.table(e,d)(),Tt.table(e+1,I)(),s&&s.log({logLevel:zc,message:"Rendered to ".concat(s.id)}),Tt.groupEnd(zc)()}}class J4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:s}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:s}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof yn?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&ut(Yt(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const s in this.feedbackMap){const c=this.feedbackMap[s];s in n&&(i[c]=s)}Object.assign(i,e.feedbackBuffers);for(const s in i){const c=i[s];if(typeof c=="string"){const d=n[c],{byteLength:l,usage:y,accessor:w}=d;i[s]=this._createNewBuffer(s,{byteLength:l,usage:y,accessor:w})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:s}=i;e.transformFeedback=new rP(this.gl,{program:s,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const s in this.feedbackMap){const c=this.feedbackMap[s];n[s]=e.feedbackBuffers[c],i[c]=e.sourceBuffers[s],ut(i[c]instanceof yn)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new yn(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const Q4="transform_uSampler_",Nm="transform_uSize_",XE="transform_position";function eN(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:s}=t,d=Object.keys(n).length,l=null;const y={};let w=e,S={};if(d>0||i){const I=w.split(`
`),P=I.slice();if(I.forEach((B,G,K)=>{if(d>0){const ue=sN(B,n);if(ue){const{updatedLine:q,inject:j}=ue;P[G]=q,S=j0([S,j]),Object.assign(y,ue.samplerTextureMap),d--}}i&&!l&&(l=rN(B,i))}),i){ut(s);const B="".concat(Nm).concat(i),G="uniform vec2 ".concat(B,`;
`),K="     vec2 ".concat(XE," = transform_getPos(").concat(B,`);
     gl_Position = vec4(`).concat(XE,`, 0, 1.);
`);S=j0([S,{"vs:#decl":G,"vs:#main-start":K}])}w=P.join(`
`)}return{vs:w,targetTextureType:l,inject:S,samplerTextureMap:y}}function tN(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const s={};let c,d;n&&({width:c,height:d}=i,s["".concat(Nm).concat(n)]=[c,d]);for(const l in e)({width:c,height:d}=e[l]),s["".concat(Nm).concat(l)]=[c,d];return s}function nN(t){return hP(t,["attribute","in"])}function iN(t){const e="".concat(Q4).concat(t),n="".concat(Nm).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function rN(t,e){const n=hP(t,["varying","out"]);return n&&n.name===e?n.type:null}function sN(t,e){const n={},i=nN(t);if(!i)return null;const{type:s,name:c}=i;if(c&&e[c]){const d="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:y,uniformDeclerations:w}=iN(c),S=RB(s),I="  ".concat(s," ").concat(c," = transform_getInput(").concat(l,", ").concat(y,").").concat(S,`;
`);return n[l]=c,{updatedLine:d,inject:{"vs:#decl":w,"vs:#main-start":I},samplerTextureMap:n}}return null}const oN={10241:9728,10240:9728,10242:33071,10243:33071},aN="transform_output";class lN{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:s,targetTexture:c}=this.bindings[this.currentIndex],d=Object.assign({},n,e.attributes),l=Object.assign({},e.uniforms),y=Object.assign({},e.parameters);let w=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){d.transform_elementID=this.elementIDBuffer;for(const I in this.samplerTextureMap){const P=this.samplerTextureMap[I];l[I]=i[P]}this._setSourceTextureParameters();const S=tN({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:c});Object.assign(l,S)}return this.hasTargetTexture&&(w=!1,y.viewport=[0,0,s.width,s.height]),{attributes:d,framebuffer:s,uniforms:l,discard:w,parameters:y}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=gg(n);if(!e)return i;const s=i.constructor,c=zB(this.targetTextureType),d=new s(i.length*c/4);let l=0;for(let y=0;y<i.length;y+=4)for(let w=0;w<c;w++)d[l++]=i[y+w];return d}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof ns)return i;const s=n[i];return s?(this._targetRefTexName=i,this._createNewTexture(s)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:s}=e,c=this._createTargetTexture({sourceTextures:i,textureOrReference:s});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:c}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,s,c)=>{c[s]=s}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new yn(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:s,targetTexture:c}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,s),Object.assign(e.sourceBuffers,i),c){e.targetTexture=c;const{width:d,height:l}=c,{framebuffer:y}=e;y?(y.update({attachments:{36064:c},resizeAttachments:!1}),y.resize({width:d,height:l})):e.framebuffer=new xi(this.gl,{id:"transform-framebuffer",width:d,height:l,attachments:{36064:c}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(oN)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=CO(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:s,uniforms:c,targetTextureType:d,inject:l,samplerTextureMap:y}=eN({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),w=j0([e.inject||{},l]);this.targetTextureType=d,this.samplerTextureMap=y;const S=e._fs||dP({version:tP(s),input:this.targetTextureVarying,inputType:d,output:aN}),I=this.hasSourceTextures||this.targetTextureVarying?[W4].concat(e.modules||[]):e.modules;return{vs:s,fs:S,modules:I,uniforms:c,inject:w}}}class Cx{static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();ut(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const s=i.getData(e);if(s)return s}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Hl(n,Object.assign({},e,{fs:e.fs||dP({version:tP(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of i)n=s.updateModelProps(n);return n}_buildResourceTransforms(e,n){cN(n)&&(this.bufferTransform=new J4(e,n)),uN(n)&&(this.textureTransform=new lN(e,n)),ut(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of i)n=Object.assign(n,s.getDrawOptions(n));return n}}function cN(t){return!!(!yu(t.feedbackBuffers)||!yu(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function uN(t){return!!(!yu(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const YE={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Hd{static get DRAW_MODE(){return YE}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ya("geometry"),drawMode:i=YE.TRIANGLES,attributes:s={},indices:c=null,vertexCount:d=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(s,c),this.vertexCount=d||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let s=e[i];s=ArrayBuffer.isView(s)?{value:s}:s,ut(ArrayBuffer.isView(s.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!s.size&&(s.size=3),i==="indices"?(ut(!this.indices),this.indices=s):this.attributes[i]=s}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const s in e){const c=e[s],{value:d,size:l,constant:y}=c;!y&&d&&l>=1&&(i=Math.min(i,d.length/l))}return ut(Number.isFinite(i)),i}}let hN=1,dN=1;class xP{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:c=1}=e,d=hN++,l={time:0,delay:n,duration:i,rate:s,repeat:c};return this._setChannelTime(l,this.time),this.channels.set(d,l),d}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const s of n)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:c,channel:d}=s;c.setTime(this.getTime(d))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=dN++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const fN=[255,255,255],pN=1;let mN=0;class gN{constructor(e={}){U(this,"id",void 0),U(this,"color",void 0),U(this,"intensity",void 0),U(this,"type","ambient");const{color:n=fN}=e,{intensity:i=pN}=e;this.id=e.id||"ambient-".concat(mN++),this.color=n,this.intensity=i}}const _N=[255,255,255],yN=1,vN=[0,0,-1];let xN=0;class KE{constructor(e={}){U(this,"id",void 0),U(this,"color",void 0),U(this,"intensity",void 0),U(this,"type","directional"),U(this,"direction",void 0),U(this,"shadow",void 0);const{color:n=_N}=e,{intensity:i=yN}=e,{direction:s=vN}=e,{_shadow:c=!1}=e;this.id=e.id||"directional-".concat(xN++),this.color=n,this.intensity=i,this.type="directional",this.direction=new vo(s).normalize().toArray(),this.shadow=c}getProjectedLight(e){return this}}class bN{constructor(e,n={id:"pass"}){U(this,"id",void 0),U(this,"gl",void 0),U(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Ix extends bN{constructor(...e){super(...e),U(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Yo(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:s,views:c,onViewportActive:d,clearStack:l=!0,clearCanvas:y=!0}=e;e.pass=e.pass||"unknown";const w=this.gl;y&&EN(w,n),l&&(this._lastRenderIndex=-1);const S=[];for(const I of s){const P=c&&c[I.id];d==null||d(I);const B=this._getDrawLayerParams(I,e),G=I.subViewports||[I];for(const K of G){const ue=this._drawLayersInViewport(w,{target:n,moduleParameters:i,viewport:K,view:P,pass:e.pass,layers:e.layers},B);S.push(ue)}}return S}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:s=!1,layerFilter:c,cullRect:d,effects:l,moduleParameters:y},w=!1){const S=[],I=bP(this._lastRenderIndex+1),P={layer:n[0],viewport:e,isPicking:s,renderPass:i,cullRect:d},B={};for(let G=0;G<n.length;G++){const K=n[G],ue=this._shouldDrawLayer(K,P,c,B),q={shouldDrawLayer:ue};ue&&!w&&(q.layerRenderIndex=I(K,ue),q.moduleParameters=this._getModuleParameters(K,l,i,y),q.layerParameters=this.getLayerParameters(K,G,e)),S[G]=q}return S}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:s,target:c,viewport:d,view:l},y){const w=wN(e,{moduleParameters:i,target:c,viewport:d});if(l&&l.props.clear){const I=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;Gs(e,{scissorTest:!0,scissor:w},()=>wx(e,I))}const S={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Yo(e,{viewport:w});for(let I=0;I<n.length;I++){const P=n[I],{shouldDrawLayer:B,layerRenderIndex:G,moduleParameters:K,layerParameters:ue}=y[I];if(B&&P.props.pickable&&S.pickableCount++,P.isComposite)S.compositeCount++;else if(B){S.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,G),K.viewport=d;try{P._drawLayer({moduleParameters:K,uniforms:{layerIndex:G},parameters:ue})}catch(q){P.raiseError(q,"drawing ".concat(P," to ").concat(s))}}}return S}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let d=e.parent;for(;d;){if(!d.props.visible||!d.filterSubLayer(n))return!1;n.layer=d,d=d.parent}if(i){const l=n.layer.id;if(l in s||(s[l]=i(n)),!s[l])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,s){var c;const d=Object.assign(Object.create(((c=e.internalState)===null||c===void 0?void 0:c.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:_u(this.gl)});if(n)for(const y of n){var l;Object.assign(d,(l=y.getModuleParameters)===null||l===void 0?void 0:l.call(y,e))}return Object.assign(d,this.getModuleParameters(e,n),s)}}function bP(t=0,e={}){const n={},i=(s,c)=>{const d=s.props._offset,l=s.id,y=s.parent&&s.parent.id;let w;if(y&&!(y in e)&&i(s.parent,!1),y in n){const S=n[y]=n[y]||bP(e[y],e);w=S(s,c),n[l]=S}else Number.isFinite(d)?(w=d+(e[y]||0),n[l]=null):w=t;return c&&w>=t&&(t=w+1),e[l]=w,w};return i}function wN(t,{moduleParameters:e,target:n,viewport:i}){const s=n&&n.id!=="default-framebuffer",c=e&&e.devicePixelRatio||_u(t),d=s?n.height:t.drawingBufferHeight,l=i;return[l.x*c,d-(l.y+l.height)*c,l.width*c,l.height*c]}function EN(t,e){const n=e?e.width:t.drawingBufferWidth,i=e?e.height:t.drawingBufferHeight;Yo(t,{viewport:[0,0,n,i]}),t.clear(16640)}class TN extends Ix{constructor(e,n){super(e,n),U(this,"shadowMap",void 0),U(this,"depthBuffer",void 0),U(this,"fbo",void 0),this.shadowMap=new ns(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Yc(e,{format:33189,width:1,height:1}),this.fbo=new xi(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;Gs(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],s=_u(this.gl),c=i.width*s,d=i.height*s;(c!==n.width||d!==n.height)&&n.resize({width:c,height:d}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const wP="#define SMOOTH_EDGE_RADIUS 0.5",SN=`
`.concat(wP,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),AN=`
`.concat(wP,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),PN={name:"geometry",vs:SN,fs:AN},CN=Object.keys(cn).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(cn[t],";")).join(""),IN=Object.keys(mo).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(mo[t],";")).join(""),LN=Object.keys(Wl).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Wl[t],";")).join(""),MN="".concat(CN,`
`).concat(IN,`
`).concat(LN,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function kN(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function qd(t){let e={},n;return i=>{for(const s in i)if(!kN(i[s],e[s])){n=t(i),e=i;break}return n}}const JE=[0,0,0,0],RN=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],EP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],zN=[0,0,0],TP=[0,0,0],DN=qd(BN);function SP(t,e,n=TP){n.length<3&&(n=[n[0],n[1],0]);let i=n,s,c=!0;switch(e===cn.LNGLAT_OFFSETS||e===cn.METER_OFFSETS?s=n:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case mo.WEB_MERCATOR:(e===cn.LNGLAT||e===cn.CARTESIAN)&&(s=[0,0,0],c=!1);break;case mo.WEB_MERCATOR_AUTO_OFFSET:e===cn.LNGLAT?i=s:e===cn.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case mo.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case mo.GLOBE:c=!1,s=null;break;default:c=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:c}}function ON(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:s}=t;let{viewMatrix:c,viewProjectionMatrix:d}=t,l=JE,y=JE,w=t.cameraPosition;const{geospatialOrigin:S,shaderCoordinateOrigin:I,offsetMode:P}=SP(t,e,n);return P&&(y=t.projectPosition(S||I),w=[w[0]-y[0],w[1]-y[1],w[2]-y[2]],y[3]=1,l=Wd([],y,d),c=i||c,d=Bl([],s,c),d=Bl([],d,RN)),{viewMatrix:c,viewProjectionMatrix:d,projectionCenter:l,originCommon:y,cameraPosCommon:w,shaderCoordinateOrigin:I,geospatialOrigin:S}}function FN({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=cn.DEFAULT,coordinateOrigin:s=TP,autoWrapLongitude:c=!1}){i===cn.DEFAULT&&(i=t.isGeospatial?cn.LNGLAT:cn.CARTESIAN);const d=DN({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return d.project_uWrapLongitude=c,d.project_uModelMatrix=n||EP,d}function BN({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:c,originCommon:d,cameraPosCommon:l,shaderCoordinateOrigin:y,geospatialOrigin:w}=ON(t,n,i),S=t.getDistanceScales(),I=[t.width*e,t.height*e],P=Wd([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,B={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:y,project_uCommonOrigin:d.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:I,project_uDevicePixelRatio:e,project_uFocalDistance:P,project_uCommonUnitsPerMeter:S.unitsPerMeter,project_uCommonUnitsPerWorldUnit:S.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:zN,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:c,project_uModelMatrix:EP,project_uCameraPosition:l};if(w){const G=t.getDistanceScales(w);switch(n){case cn.METER_OFFSETS:B.project_uCommonUnitsPerWorldUnit=G.unitsPerMeter,B.project_uCommonUnitsPerWorldUnit2=G.unitsPerMeter2;break;case cn.LNGLAT:case cn.LNGLAT_OFFSETS:t._pseudoMeters||(B.project_uCommonUnitsPerMeter=G.unitsPerMeter),B.project_uCommonUnitsPerWorldUnit=G.unitsPerDegree,B.project_uCommonUnitsPerWorldUnit2=G.unitsPerDegree2;break;case cn.CARTESIAN:B.project_uCommonUnitsPerWorldUnit=[1,1,G.unitsPerMeter[2]],B.project_uCommonUnitsPerWorldUnit2=[0,0,G.unitsPerMeter2[2]];break}}return B}const NN={};function UN(t=NN){return"viewport"in t?FN(t):{}}const Lx={name:"project",dependencies:[FB,PN],vs:MN,getUniforms:UN};function VN(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function su(t,e){const n=Wd([],e,t);return w4(n,n,1/n[3]),n}function QE(t,e){const n=t%e;return n<0?e+n:n}function q0(t,e,n){return t<e?e:t>n?n:t}function jN(t){return Math.log(t)*Math.LOG2E}const Mx=Math.log2||jN;function Ko(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ns=Math.PI,AP=Ns/4,ws=Ns/180,Z0=180/Ns,wu=512,Um=4003e4,Pp=85.051129,GN=1.5;function WN(t){return Mx(t)}function Vm(t){const[e,n]=t;Ko(Number.isFinite(e)),Ko(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*ws,s=n*ws,c=wu*(i+Ns)/(2*Ns),d=wu*(Ns+Math.log(Math.tan(AP+s*.5)))/(2*Ns);return[c,d]}function Eu(t){const[e,n]=t,i=e/wu*(2*Ns)-Ns,s=2*(Math.atan(Math.exp(n/wu*(2*Ns)-Ns))-AP);return[i*Z0,s*Z0]}function $N(t){const{latitude:e}=t;Ko(Number.isFinite(e));const n=Math.cos(e*ws);return WN(Um*n)-9}function Ty(t){const e=Math.cos(t*ws);return wu/Um/e}function X0(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Ko(Number.isFinite(e)&&Number.isFinite(n));const s=wu,c=Math.cos(e*ws),d=s/360,l=d/c,y=s/Um/c,w={unitsPerMeter:[y,y,y],metersPerUnit:[1/y,1/y,1/y],unitsPerDegree:[d,l,y],degreesPerUnit:[1/d,1/l,1/y]};if(i){const S=ws*Math.tan(e*ws)/c,I=d*S/2,P=s/Um*S,B=P/l*y;w.unitsPerDegree2=[0,I,P],w.unitsPerMeter2=[B,0,B]}return w}function PP(t,e){const[n,i,s]=t,[c,d,l]=e,{unitsPerMeter:y,unitsPerMeter2:w}=X0({longitude:n,latitude:i,highPrecision:!0}),S=Vm(t);S[0]+=c*(y[0]+w[0]*d),S[1]+=d*(y[1]+w[1]*d);const I=Eu(S),P=(s||0)+(l||0);return Number.isFinite(s)||Number.isFinite(l)?[I[0],I[1],P]:I}function HN(t){const{height:e,pitch:n,bearing:i,altitude:s,scale:c,center:d}=t,l=VN();Bm(l,l,[0,0,-s]),_P(l,l,-n*ws),yP(l,l,i*ws);const y=c/e;return Px(l,l,[y,y,y]),d&&Bm(l,l,JB([],d)),l}function qN(t){const{width:e,height:n,altitude:i,pitch:s=0,offset:c,center:d,scale:l,nearZMultiplier:y=1,farZMultiplier:w=1}=t;let{fovy:S=jm(GN)}=t;i!==void 0&&(S=jm(i));const I=S*ws,P=s*ws,B=CP(S);let G=B;d&&(G+=d[2]*l/Math.cos(P)/n);const K=I*(.5+(c?c[1]:0)/n),ue=Math.sin(K)*G/Math.sin(q0(Math.PI/2-P-K,.01,Math.PI-.01)),q=Math.sin(P)*ue+G,j=G*10,Z=Math.min(q*w,j);return{fov:I,aspect:e/n,focalDistance:B,near:y,far:Z}}function jm(t){return 2*Math.atan(.5/t)*Z0}function CP(t){return .5/Math.tan(.5*t*ws)}function IP(t,e){const[n,i,s=0]=t;return Ko(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),su(e,[n,i,s,1])}function kx(t,e,n=0){const[i,s,c]=t;if(Ko(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(c))return su(e,[i,s,c,1]);const d=su(e,[i,s,0,1]),l=su(e,[i,s,1,1]),y=d[2],w=l[2],S=y===w?0:((n||0)-y)/(w-y);return pP([],d,l,S)}function ZN(t){const{width:e,height:n,bounds:i,minExtent:s=0,maxZoom:c=24,offset:d=[0,0]}=t,[[l,y],[w,S]]=i,I=XN(t.padding),P=Vm([l,q0(S,-Pp,Pp)]),B=Vm([w,q0(y,-Pp,Pp)]),G=[Math.max(Math.abs(B[0]-P[0]),s),Math.max(Math.abs(B[1]-P[1]),s)],K=[e-I.left-I.right-Math.abs(d[0])*2,n-I.top-I.bottom-Math.abs(d[1])*2];Ko(K[0]>0&&K[1]>0);const ue=K[0]/G[0],q=K[1]/G[1],j=(I.right-I.left)/2/ue,Z=(I.top-I.bottom)/2/q,re=[(B[0]+P[0])/2+j,(B[1]+P[1])/2+Z],pe=Eu(re),be=Math.min(c,Mx(Math.abs(Math.min(ue,q))));return Ko(Number.isFinite(be)),{longitude:pe[0],latitude:pe[1],zoom:be}}function XN(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Ko(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const eT=Math.PI/180;function YN(t,e=0){const{width:n,height:i,unproject:s}=t,c={targetZ:e},d=s([0,i],c),l=s([n,i],c);let y,w;const S=t.fovy?.5*t.fovy*eT:Math.atan(.5/t.altitude),I=(90-t.pitch)*eT;return S>I-.01?(y=tT(t,0,e),w=tT(t,n,e)):(y=s([0,0],c),w=s([n,0],c)),[d,l,w,y]}function tT(t,e,n){const{pixelUnprojectionMatrix:i}=t,s=su(i,[e,0,1,1]),c=su(i,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-s[2])/(c[2]-s[2]),y=pP([],s,c,l),w=Eu(y);return w.push(n),w}const nT=512;function KN(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:s,latitude:c,zoom:d,bearing:l=0}=t;(s<-180||s>180)&&(s=QE(s+180,360)-180),(l<-180||l>180)&&(l=QE(l+180,360)-180);const y=Mx(n/nT);if(d<=y)d=y,c=0;else{const w=n/2/Math.pow(2,d),S=Eu([0,w])[1];if(c<S)c=S;else{const I=Eu([0,nT-w])[1];c>I&&(c=I)}}return{width:e,height:n,longitude:s,latitude:c,zoom:d,pitch:i,bearing:l}}const JN=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,QN=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,e5=qd(s5),t5=qd(o5),n5=[0,0,0,1],i5=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function r5(t,e){const[n,i,s]=t,c=kx([n,i,s],e);return Number.isFinite(s)?c:[c[0],c[1],0]}function s5({viewport:t,center:e}){return new xo(t.viewProjectionMatrix).invert().transform(e)}function o5({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,c=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(d=>r5(d,i));for(const d of e){const l=d.clone().translate(new vo(t.center).negate()),y=c.map(S=>l.transform(S)),w=new xo().ortho({left:Math.min(...y.map(S=>S[0])),right:Math.max(...y.map(S=>S[0])),bottom:Math.min(...y.map(S=>S[1])),top:Math.max(...y.map(S=>S[1])),near:Math.min(...y.map(S=>-S[2])),far:Math.max(...y.map(S=>-S[2]))});n.push(w.multiplyRight(d))}return n}function a5(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||n5,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},s=e5({viewport:t.viewport,center:e.project_uCenter}),c=[],d=t5({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const y=d[l],w=y.clone().translate(new vo(t.viewport.center).negate());e.project_uCoordinateSystem===cn.LNGLAT&&e.project_uProjectionMode===mo.WEB_MERCATOR?(d[l]=w,c[l]=s):(d[l]=y.clone().multiplyRight(i5),c[l]=w.transform(s))}for(let l=0;l<d.length;l++)i["shadow_uViewProjectionMatrices[".concat(l,"]")]=d[l],i["shadow_uProjectCenters[".concat(l,"]")]=c[l],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(l)]=t.shadowMaps[l]:i["shadow_uShadowMap".concat(l)]=t.dummyShadowMap;return i}const Sy={name:"shadow",dependencies:[Lx],vs:JN,fs:QN,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?a5(t,e):{}},l5={color:[255,255,255],intensity:1},iT=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],c5=[0,0,0,200/255];class LP{constructor(e={}){U(this,"id","lighting-effect"),U(this,"props",void 0),U(this,"shadowColor",c5),U(this,"shadow",void 0),U(this,"ambientLight",void 0),U(this,"directionalLights",void 0),U(this,"pointLights",void 0),U(this,"shadowPasses",[]),U(this,"shadowMaps",[]),U(this,"dummyShadowMap",null),U(this,"programManager",void 0),U(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:i,viewports:s,onViewportActive:c,views:d}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=$d.getDefaultProgramManager(e),Sy&&this.programManager.addDefaultModule(Sy)),this.dummyShadowMap||(this.dummyShadowMap=new ns(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:n,layerFilter:i,viewports:s,onViewportActive:c,views:d,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Sy),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new xo().lookAt({eye:new vo(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new TN(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new gN(l5),this.directionalLights.push(new KE(iT[0]),new KE(iT[1])))}}class u5{constructor(e={}){U(this,"_pool",[]),U(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:s,padding:c=0,copy:d=!1,initialize:l=!1,maxCount:y}){const w=s||e&&e.constructor||Float32Array,S=n*i+c;if(ArrayBuffer.isView(e)){if(S<=e.length)return e;if(S*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new w(e.buffer,0,S)}let I=1/0;y&&(I=y*i+c);const P=this._allocate(w,S,l,I);return e&&d?P.set(e):l||P.fill(0,0,4),this._release(e),P}release(e){this._release(e)}_allocate(e,n,i,s){let c=Math.max(Math.ceil(n*this.opts.overAlloc),1);c>s&&(c=s);const d=this._pool,l=e.BYTES_PER_ELEMENT*c,y=d.findIndex(w=>w.byteLength>=l);if(y>=0){const w=new e(d.splice(y,1)[0],0,c);return i&&w.fill(0),w}return new e(c)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:s}=i,c=n.findIndex(d=>d.byteLength>=s);c<0?n.push(i):(c>0||n.length<this.opts.poolSize)&&n.splice(c,0,i),n.length>this.opts.poolSize&&n.shift()}}const Tu=new u5;function $h(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function h5(t){return[t[12],t[13],t[14]]}function d5(t){return{left:Dc(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Dc(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Dc(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Dc(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Dc(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Dc(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const rT=new vo;function Dc(t,e,n,i){rT.set(t,e,n);const s=rT.len();return{distance:i/s,normal:new vo(-t/s,-e/s,-n/s)}}function f5(t){return t-Math.fround(t)}let Fh;function Ay(t,e){const{size:n=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:t.length,c=(s-i)/n;Fh=Tu.allocate(Fh,c,{type:Float32Array,size:n*2});let d=i,l=0;for(;d<s;){for(let y=0;y<n;y++){const w=t[d++];Fh[l+y]=w,Fh[l+y+n]=f5(w)}l+=n*2}return Fh.subarray(0,c*n*2)}function p5(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const m5=Math.PI/180,g5=$h(),sT=[0,0,0],_5={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function y5({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:s,padding:c,near:d,far:l}){const y=t/e,w=n?new xo().orthographic({fovy:i,aspect:y,focalDistance:s,near:d,far:l}):new xo().perspective({fovy:i,aspect:y,near:d,far:l});if(c){const{left:S=0,right:I=0,top:P=0,bottom:B=0}=c,G=Da((S+t-I)/2,0,t)-t/2,K=Da((P+e-B)/2,0,e)-e/2;w[8]-=G*2/t,w[9]+=K*2/e}return w}class Mu{constructor(e={}){U(this,"id",void 0),U(this,"x",void 0),U(this,"y",void 0),U(this,"width",void 0),U(this,"height",void 0),U(this,"padding",void 0),U(this,"isGeospatial",void 0),U(this,"zoom",void 0),U(this,"focalDistance",void 0),U(this,"position",void 0),U(this,"modelMatrix",void 0),U(this,"distanceScales",void 0),U(this,"scale",void 0),U(this,"center",void 0),U(this,"cameraPosition",void 0),U(this,"projectionMatrix",void 0),U(this,"viewMatrix",void 0),U(this,"viewMatrixUncentered",void 0),U(this,"viewMatrixInverse",void 0),U(this,"viewProjectionMatrix",void 0),U(this,"pixelProjectionMatrix",void 0),U(this,"pixelUnprojectionMatrix",void 0),U(this,"resolution",void 0),U(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||_5,this.focalDistance=e.focalDistance||1,this.position=e.position||sT,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?mo.WEB_MERCATOR:mo.WEB_MERCATOR_AUTO_OFFSET:mo.IDENTITY}equals(e){return e instanceof Mu?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Pd(e.projectionMatrix,this.projectionMatrix)&&Pd(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),s=IP(i,this.pixelProjectionMatrix),[c,d]=s,l=n?d:this.height-d;return e.length===2?[c,l]:[c,l,s[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[s,c,d]=e,l=n?c:this.height-c,y=i&&i*this.distanceScales.unitsPerMeter[2],w=kx([s,l,d],this.pixelUnprojectionMatrix,y),[S,I,P]=this.unprojectPosition(w);return Number.isFinite(d)?[S,I,P]:Number.isFinite(i)?[S,I,i]:[S,I]}projectPosition(e){const[n,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,s]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,s]}projectFlat(e){if(this.isGeospatial){const n=Vm(e);return n[1]=Da(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Eu(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),s=this.unproject([this.width,0],n),c=this.unproject([0,this.height],n),d=this.unproject([this.width,this.height],n);return[Math.min(i[0],s[0],c[0],d[0]),Math.min(i[1],s[1],c[1],d[1]),Math.max(i[0],s[0],c[0],d[0]),Math.max(i[1],s[1],c[1],d[1])]}getDistanceScales(e){return e?X0({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,d5(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=$N({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||X0({latitude:i,longitude:n}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:c,modelMatrix:d}=e;let l=sT;if(c&&(l=d?new xo(d).transformAsVector(c,[]):c),this.isGeospatial){const y=this.projectPosition([n,i,0]);this.center=new vo(l).scale(this.distanceScales.unitsPerMeter).add(y)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=g5,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:c,fovy:d=75,near:l=.1,far:y=1e3,padding:w=null,focalDistance:S=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new xo().multiplyRight(n).translate(new vo(this.center).negate()),this.projectionMatrix=i||y5({width:this.width,height:this.height,orthographic:s,fovyRadians:c||d*m5,focalDistance:S,padding:w,near:l,far:y});const I=$h();Bl(I,I,this.projectionMatrix),Bl(I,I,this.viewMatrix),this.viewProjectionMatrix=I,this.viewMatrixInverse=$0([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=h5(this.viewMatrixInverse);const P=$h(),B=$h();Px(P,P,[this.width/2,-this.height/2,1]),Bm(P,P,[1,-1,0]),Bl(B,P,this.viewProjectionMatrix),this.pixelProjectionMatrix=B,this.pixelUnprojectionMatrix=$0($h(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Zt.warn("Pixel project matrix not invertible")()}}U(Mu,"displayName","Viewport");class Su extends Mu{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:s=0,pitch:c=0,bearing:d=0,nearZMultiplier:l=.1,farZMultiplier:y=1.01,nearZ:w,farZ:S,orthographic:I=!1,projectionMatrix:P,repeat:B=!1,worldOffset:G=0,position:K,padding:ue,legacyMeterSizes:q=!1}=e;let{width:j,height:Z,altitude:re=1.5}=e;const pe=Math.pow(2,s);j=j||1,Z=Z||1;let be,Re=null;if(P)re=P[5]/2,be=jm(re);else{e.fovy?(be=e.fovy,re=CP(be)):be=jm(re);let je;if(ue){const{top:Ge=0,bottom:pt=0}=ue;je=[0,Da((Ge+Z-pt)/2,0,Z)-Z/2]}Re=qN({width:j,height:Z,scale:pe,center:K&&[0,0,K[2]*Ty(n)],offset:je,pitch:c,fovy:be,nearZMultiplier:l,farZMultiplier:y}),Number.isFinite(w)&&(Re.near=w),Number.isFinite(S)&&(Re.far=S)}let Fe=HN({height:Z,pitch:c,bearing:d,scale:pe,altitude:re});G&&(Fe=new xo().translate([512*G,0,0]).multiplyLeft(Fe)),super({...e,width:j,height:Z,viewMatrix:Fe,longitude:i,latitude:n,zoom:s,...Re,fovy:be,focalDistance:re}),U(this,"longitude",void 0),U(this,"latitude",void 0),U(this,"pitch",void 0),U(this,"bearing",void 0),U(this,"altitude",void 0),U(this,"fovy",void 0),U(this,"orthographic",void 0),U(this,"_subViewports",void 0),U(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=s,this.pitch=c,this.bearing=d,this.altitude=re,this.fovy=be,this.orthographic=I,this._subViewports=B?[]:null,this._pseudoMeters=q,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=n;s<=i;s++){const c=s?new Su({...this,worldOffset:s}):this;this._subViewports.push(c)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),s=(e[2]||0)*Ty(e[1]);return[n,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),s=(e[2]||0)/Ty(i);return[n,i,s]}addMetersToLngLat(e,n){return PP(e,n)}panByPosition(e,n){const i=kx(n,this.pixelUnprojectionMatrix),s=this.projectFlat(e),c=$E([],s,HB([],i)),d=$E([],this.center,c),[l,y]=this.unprojectFlat(d);return{longitude:l,latitude:y}}getBounds(e={}){const n=YN(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:s}=this,{longitude:c,latitude:d,zoom:l}=ZN({width:i,height:s,bounds:e,...n});return new Su({width:i,height:s,longitude:c,latitude:d,zoom:l})}}U(Su,"displayName","WebMercatorViewport");const oT=[0,0,0];function Py(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof Su){const[s,c,d=0]=t,l=e.getDistanceScales([s,c]);i[2]=d*l.unitsPerMeter[2]}return i}function v5(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:s,fromCoordinateSystem:c,fromCoordinateOrigin:d}=t;return s===cn.DEFAULT&&(s=e.isGeospatial?cn.LNGLAT:cn.CARTESIAN),c===void 0&&(c=s),d===void 0&&(d=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:c,fromCoordinateOrigin:d}}function MP(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:s,offsetMode:c}){let[d,l,y=0]=t;switch(n&&([d,l,y]=Wd([],[d,l,y,1],n)),i){case cn.LNGLAT:return Py([d,l,y],e,c);case cn.LNGLAT_OFFSETS:return Py([d+s[0],l+s[1],y+(s[2]||0)],e,c);case cn.METER_OFFSETS:return Py(PP(s,[d,l,y]),e,c);case cn.CARTESIAN:default:return e.isGeospatial?[d+s[0],l+s[1],y+s[2]]:e.projectPosition([d,l,y])}}function x5(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:s,modelMatrix:c,fromCoordinateSystem:d,fromCoordinateOrigin:l}=v5(e),{autoOffset:y=!0}=e,{geospatialOrigin:w=oT,shaderCoordinateOrigin:S=oT,offsetMode:I=!1}=y?SP(n,i,s):{},P=MP(t,{viewport:n,modelMatrix:c,coordinateSystem:d,coordinateOrigin:l,offsetMode:I});if(I){const B=n.projectPosition(w||S);a4(P,P,B)}return P}const aT={blendFunc:[1,0,32771,0],blendEquation:32774};class kP extends Ix{constructor(...e){super(...e),U(this,"pickZ",void 0),U(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:c,pickingFBO:d,deviceRect:{x:l,y,width:w,height:S},cullRect:I,effects:P,pass:B="picking",pickZ:G,moduleParameters:K}){const ue=this.gl;this.pickZ=G;const q=this._resetColorEncoder(G),j=Gs(ue,{scissorTest:!0,scissor:[l,y,w,S],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...aT,blend:!G},()=>super.render({target:d,layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:c,cullRect:I,effects:P==null?void 0:P.filter(re=>re.useInPicking),pass:B,isPicking:!0,moduleParameters:K}));return this._colorEncoderState=null,{decodePickingColor:q&&w5.bind(null,q),stats:j}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const s={...e.props.parameters},{pickable:c,operation:d}=e.props;return this._colorEncoderState?c&&d.includes("draw")&&(Object.assign(s,aT),s.blend=!0,s.blendColor=b5(this._colorEncoderState,e,i)):s.blend=!1,d.includes("terrain")&&(s.blend=!1),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function b5(t,e,n){const{byLayer:i,byAlpha:s}=t;let c,d=i.get(e);return d?(d.viewports.push(n),c=d.a):(c=i.size+1,c<=255?(d={a:c,layer:e,viewports:[n]},i.set(e,d),s[c]=d):(Zt.warn("Too many pickable layers, only picking the first 255")(),c=0)),[0,0,0,c/255]}function w5(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Fc={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Gm=Symbol.for("component"),qa=Symbol.for("propTypes"),Cy=Symbol.for("deprecatedProps"),ou=Symbol.for("asyncPropDefaults"),ql=Symbol.for("asyncPropOriginal"),Oa=Symbol.for("asyncPropResolved");function Rx(t,e=()=>!0){return Array.isArray(t)?RP(t,e,[]):e(t)?[t]:[]}function RP(t,e,n){let i=-1;for(;++i<t.length;){const s=t[i];Array.isArray(s)?RP(s,e,n):e(s)&&n.push(s)}return n}function E5({target:t,source:e,start:n=0,count:i=1}){const s=e.length,c=i*s;let d=0;for(let l=n;d<s;d++)t[l++]=e[d];for(;d<c;)d<c-d?(t.copyWithin(n+d,n,n+d),d*=2):(t.copyWithin(n+d,n,n+c-d),d=c);return t}class T5{constructor(e,n,i){U(this,"id",void 0),U(this,"context",void 0),U(this,"isLoaded",void 0),U(this,"persistent",void 0),U(this,"_loadCount",0),U(this,"_subscribers",new Set),U(this,"_data",void 0),U(this,"_loader",void 0),U(this,"_error",void 0),U(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=km(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=c)}).catch(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=c||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const c of this._subscribers)c.onChange(this.getData())}}class S5{constructor({gl:e,protocol:n}){U(this,"protocol",void 0),U(this,"_context",void 0),U(this,"_resources",void 0),U(this,"_consumers",void 0),U(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:s=!0}){let c=this._resources[e];c?c.setData(n,i):(c=new T5(e,n,this._context),this._resources[e]=c),c.persistent=s}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const s=n[i],c=this._resources[s.resourceId];c&&c.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:s="default"}){const{_resources:c,protocol:d}=this;e.startsWith(d)&&(e=e.replace(d,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=c[e];if(this._track(i,s,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,s){const c=this._consumers,d=c[e]=c[e]||{},l=d[n]||{},y=l.resourceId&&this._resources[l.resourceId];y&&(y.unsubscribe(l),this.prune()),i&&(d[n]=l,l.onChange=s,l.resourceId=i.id,i.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const A5=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Zd={name:"project32",dependencies:[Lx],vs:A5},Xd={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...F4},P5=[Lx],C5=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function I5(t){const e=$d.getDefaultProgramManager(t);for(const n of P5)e.addDefaultModule(n);for(const n of C5)e.addShaderHook(n);return e}const L5="layerManager.setLayers",M5="layerManager.activateViewport";class k5{constructor(e,{deck:n,stats:i,viewport:s,timeline:c}={}){U(this,"layers",void 0),U(this,"context",void 0),U(this,"resourceManager",void 0),U(this,"_lastRenderedLayers",[]),U(this,"_needsRedraw",!1),U(this,"_needsUpdate",!1),U(this,"_nextLayers",null),U(this,"_debug",!1),U(this,"activateViewport",d=>{er(M5,this,d),d&&(this.context.viewport=d)}),this.layers=[],this.resourceManager=new S5({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&I5(e),stats:i||new xx({id:"deck.gl"}),viewport:s||new Mu({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new xP,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);n=n||s}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){er(L5,this,n,e),this._lastRenderedLayers=e;const i=Rx(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const d of e)i[d.id]?Zt.warn("Multiple old layers with same id ".concat(d.id))():i[d.id]=d;const s=[];this._updateSublayersRecursively(n,i,s),this._finalizeOldLayers(i);let c=!1;for(const d of s)if(d.hasUniformTransition()){c="Uniform transition in ".concat(d);break}this._needsUpdate=c,this.layers=s}_updateSublayersRecursively(e,n,i){for(const s of e){s.context=this.context;const c=n[s.id];c===null&&Zt.warn("Multiple new layers with same id ".concat(s.id))(),n[s.id]=null;let d=null;try{this._debug&&c!==s&&s.validateProps(),c?(this._transferLayerState(c,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),d=s.isComposite?s.getSubLayers():null}catch(l){this._handleError("matching",l,s)}d&&this._updateSublayersRecursively(d,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Fc.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Fc.MATCHED,n!==e&&(e.lifecycle=Fc.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Fc.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Fc.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function go(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!go(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(const c of i)if(!e.hasOwnProperty(c)||!go(t[c],e[c],n-1))return!1;return!0}return!1}class R5{constructor(e){U(this,"width",void 0),U(this,"height",void 0),U(this,"views",void 0),U(this,"viewState",void 0),U(this,"controllers",void 0),U(this,"timeline",void 0),U(this,"_viewports",void 0),U(this,"_viewportMap",void 0),U(this,"_isUpdating",void 0),U(this,"_needsRedraw",void 0),U(this,"_needsUpdate",void 0),U(this,"_eventManager",void 0),U(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let c=i.length-1;c>=0;--c){const d=i[c];if(d.containsPixel(s)){const l=e.slice();return l[0]-=d.x,l[1]-=d.y,d.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Rx(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!go(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Zt.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:c=>{var d;return(d=this.getView(e.id))===null||d===void 0?void 0:d.makeViewport({viewState:c,width:this.width,height:this.height})}})}_updateController(e,n,i,s){const c=e.controller;if(c&&i){const d={...n,...c,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==c.type)&&(s=this._createController(e,d)),s&&s.setProps(d),s}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const c=e[s],d=this.getViewState(c),l=c.makeViewport({viewState:d,width:this.width,height:this.height});let y=n[c.id];const w=!!c.controller;w&&!y&&(i=!0),(i||!w)&&y&&(y.finalize(),y=null),this.controllers[c.id]=this._updateController(c,d,l,y),l&&this._viewports.unshift(l)}for(const s in n){const c=n[s];c&&!this.controllers[s]&&c.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,s)=>!e[s].equals(n[s]))}}const z5=/([0-9]+\.?[0-9]*)(%|px)/;function Aa(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=z5.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function Pa(t,e){return t.relative?Math.round(t.position*e):t.position}function Li(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Au{constructor(e){U(this,"id",void 0),U(this,"viewportInstance",void 0),U(this,"_x",void 0),U(this,"_y",void 0),U(this,"_width",void 0),U(this,"_height",void 0),U(this,"_padding",void 0),U(this,"props",void 0);const{id:n,x:i=0,y:s=0,width:c="100%",height:d="100%",padding:l=null,viewportInstance:y}=e||{};Li(!y||y instanceof Mu),this.viewportInstance=y,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Aa(i),this._y=Aa(s),this._width=Aa(c),this._height=Aa(d),this._padding=l&&{left:Aa(l.left||0),right:Aa(l.right||0),top:Aa(l.top||0),bottom:Aa(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&go(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const s=this.getDimensions({width:e,height:n});return!s.height||!s.width?null:new this.ViewportType({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:Pa(this._x,e),y:Pa(this._y,n),width:Pa(this._width,e),height:Pa(this._height,n)};return this._padding&&(i.padding={left:Pa(this._padding.left,e),top:Pa(this._padding.top,n),right:Pa(this._padding.right,e),bottom:Pa(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Yd{constructor(e){U(this,"_inProgress",void 0),U(this,"_handle",void 0),U(this,"_timeline",void 0),U(this,"time",void 0),U(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:s}=this;this._handle=i.addChannel({delay:i.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const lT=()=>{},Y0={BREAK:1,SNAP_TO_END:2,IGNORE:3},D5=t=>t,O5=Y0.BREAK;class F5{constructor(e){U(this,"getControllerState",void 0),U(this,"props",void 0),U(this,"propsInTransition",void 0),U(this,"transition",void 0),U(this,"onViewStateChange",void 0),U(this,"onStateChange",void 0),U(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:s,startProps:c,endProps:d,duration:l,easing:y}}=n,w=y(i/l),S=s.interpolateProps(c,d,w);this.propsInTransition=this.getControllerState({...this.props,...S}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Yd(e.timeline),this.onViewStateChange=e.onViewStateChange||lT,this.onStateChange=e.onStateChange||lT}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:c,endProps:d}=this.transition.settings;s={...i,...c===Y0.SNAP_TO_END?d:this.propsInTransition||i}}this._triggerTransition(s,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Y0.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),s=this.getControllerState(n).shortestPathFrom(i),c=n.transitionInterpolator,d=c.getDuration?c.getDuration(e,n):n.transitionDuration;if(d===0)return;const l=c.initializeProps(e,s);this.propsInTransition={};const y={duration:d,easing:n.transitionEasing||D5,interpolator:c,interruption:n.transitionInterruption||O5,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(y),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class B5{constructor(e){U(this,"_propsToCompare",void 0),U(this,"_propsToExtract",void 0),U(this,"_requiredProps",void 0);const{compare:n,extract:i,required:s}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=s}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!Pd(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},s={};for(const c of this._propsToExtract)(c in e||c in n)&&(i[c]=e[c],s[c]=n[c]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Li(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const N5=["longitude","latitude","zoom","bearing","pitch"],U5=["longitude","latitude","zoom"];class zP extends B5{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:N5,required:U5},super(i.transitionProps),U(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:s,around:c}=this.opts;if(s&&c){const d=s(e),l=s(n),y=d.unproject(c);i.start.around=c,Object.assign(i.end,{around:l.project(y),aroundPosition:y,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const s={};for(const c of this._propsToExtract)s[c]=Fm(e[c]||0,n[c]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const c=this.opts.makeViewport({...n,...s});Object.assign(s,c.panByPosition(n.aroundPosition,Fm(e.around,n.around,i)))}return s}}const Ca={transitionDuration:0},V5=300,Cp=t=>1-(1-t)*(1-t),Oc={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Pl={};class j5{constructor(e){U(this,"props",void 0),U(this,"state",{}),U(this,"transitionManager",void 0),U(this,"eventManager",void 0),U(this,"onViewStateChange",void 0),U(this,"onStateChange",void 0),U(this,"makeViewport",void 0),U(this,"_controllerState",void 0),U(this,"_events",{}),U(this,"_interactionState",{isDragging:!1}),U(this,"_customEvents",[]),U(this,"_eventStartBlocked",null),U(this,"_panMove",!1),U(this,"invertPan",!1),U(this,"dragMode","rotate"),U(this,"inertia",0),U(this,"scrollZoom",!0),U(this,"dragPan",!0),U(this,"dragRotate",!0),U(this,"doubleClickZoom",!0),U(this,"touchZoom",!0),U(this,"touchRotate",!1),U(this,"keyboard",!0),this.transitionManager=new F5({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:s}=e;return[s.x-n,s.y-i]}isPointInBounds(e,n){const{width:i,height:s}=this.props;if(n&&n.handled)return!1;const c=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return c&&n&&n.stopPropagation(),c}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?V5:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:c=!0,doubleClickZoom:d=!0,touchZoom:l=!0,touchRotate:y=!1,keyboard:w=!0}=e,S=!!this.onViewStateChange;this.toggleEvents(Oc.WHEEL,S&&i),this.toggleEvents(Oc.PAN,S),this.toggleEvents(Oc.PINCH,S&&(l||y)),this.toggleEvents(Oc.TRIPLE_PAN,S&&y),this.toggleEvents(Oc.DOUBLE_TAP,S&&d),this.toggleEvents(Oc.KEYBOARD,S&&w),this.scrollZoom=i,this.dragPan=s,this.dragRotate=c,this.doubleClickZoom=d,this.touchZoom=l,this.touchRotate=y,this.keyboard=w}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const s={...e.getViewportProps(),...n},c=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),c){const d=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:d})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(s,Ca,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Ca,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],c=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Cp},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Ca,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],c=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Cp},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:c}=e;let d=2/(1+Math.exp(-Math.abs(c*i)));c<0&&d!==0&&(d=1/d);const l=this.controllerState.zoom({pos:n,scale:d});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Ca,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Ca,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*n/2],c=this.controllerState.rotate({pos:s});this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Cp},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Pl._startPinchRotation=e.rotation,Pl._lastPinchEvent=e,this.updateViewport(i,Ca,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);n=n.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:Pl._startPinchRotation-i})}return this.updateViewport(n,Ca,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Pl._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=Pl;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const s=this.getCenter(e);let c=this.controllerState.rotateEnd();const d=Math.log2(e.scale),l=(d-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),y=Math.pow(2,d+l*n/2);c=c.zoom({pos:s,scale:y}).zoomEnd(),this.updateViewport(c,{...this._getTransitionProps({around:s}),transitionDuration:n,transitionEasing:Cp},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Pl._startPinchRotation=null,Pl._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:c,rotateSpeedY:d}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let y;const w={};switch(e.srcEvent.code){case"Minus":y=n?l.zoomOut(i).zoomOut(i):l.zoomOut(i),w.isZooming=!0;break;case"Equal":y=n?l.zoomIn(i).zoomIn(i):l.zoomIn(i),w.isZooming=!0;break;case"ArrowLeft":n?(y=l.rotateLeft(c),w.isRotating=!0):(y=l.moveLeft(s),w.isPanning=!0);break;case"ArrowRight":n?(y=l.rotateRight(c),w.isRotating=!0):(y=l.moveRight(s),w.isPanning=!0);break;case"ArrowUp":n?(y=l.rotateUp(d),w.isRotating=!0):(y=l.moveUp(s),w.isPanning=!0);break;case"ArrowDown":n?(y=l.rotateDown(d),w.isRotating=!0):(y=l.moveDown(s),w.isPanning=!0);break;default:return!1}return this.updateViewport(y,this._getTransitionProps(),w),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Ca:e?{...n,transitionInterpolator:new zP({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class G5{constructor(e,n){U(this,"_viewportProps",void 0),U(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const cT=5,W5=1.2;class $5 extends G5{constructor(e){const{width:n,height:i,latitude:s,longitude:c,zoom:d,bearing:l=0,pitch:y=0,altitude:w=1.5,position:S=[0,0,0],maxZoom:I=20,minZoom:P=0,maxPitch:B=60,minPitch:G=0,startPanLngLat:K,startZoomLngLat:ue,startRotatePos:q,startBearing:j,startPitch:Z,startZoom:re,normalize:pe=!0}=e;Li(Number.isFinite(c)),Li(Number.isFinite(s)),Li(Number.isFinite(d)),super({width:n,height:i,latitude:s,longitude:c,zoom:d,bearing:l,pitch:y,altitude:w,maxZoom:I,minZoom:P,maxPitch:B,minPitch:G,normalize:pe,position:S},{startPanLngLat:K,startZoomLngLat:ue,startRotatePos:q,startBearing:j,startPitch:Z,startZoom:re}),U(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const c=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(c)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:c,startPitch:d}=this.getState();if(!s||c===void 0||d===void 0)return this;let l;return e?l=this._getNewRotation(e,s,d,c):l={bearing:c+n,pitch:d+i},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:s,startZoomLngLat:c}=this.getState();if(c||(s=this.getViewportProps().zoom,c=this._unproject(n)||this._unproject(e)),!c)return this;const{maxZoom:d,minZoom:l}=this.getViewportProps();let y=s+Math.log2(i);y=Da(y,l,d);const w=this.makeViewport({...this.getViewportProps(),zoom:y});return this._getUpdatedState({zoom:y,...w.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:c}=i;return Math.abs(s-n.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(c-n.longitude)>180&&(i.longitude=c<0?c+360:c-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:s}=e;e.zoom=Da(s,i,n);const{maxPitch:c,minPitch:d,pitch:l}=e;e.pitch=Da(l,d,c);const{normalize:y=!0}=e;return y&&Object.assign(e,KN(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,s){const c=e[0]-n[0],d=e[1]-n[1],l=e[1],y=n[1],{width:w,height:S}=this.getViewportProps(),I=c/w;let P=0;d>0?Math.abs(S-y)>cT&&(P=d/(y-S)*W5):d<0&&y>cT&&(P=1-l/y),P=Da(P,-1,1);const{minPitch:B,maxPitch:G}=this.getViewportProps(),K=s+180*I;let ue=i;return P>0?ue=i+P*(G-i):P<0&&(ue=i-P*(B-i)),{pitch:ue,bearing:K}}}class H5 extends j5{constructor(...e){super(...e),U(this,"ControllerState",$5),U(this,"transition",{transitionDuration:300,transitionInterpolator:new zP({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),U(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class DP extends Au{get ViewportType(){return Su}get ControllerType(){return H5}}U(DP,"displayName","MapView");const q5=new LP;function Z5(t,e){var n,i;const s=(n=t.order)!==null&&n!==void 0?n:1/0,c=(i=e.order)!==null&&i!==void 0?i:1/0;return s-c}class X5{constructor(){U(this,"effects",void 0),U(this,"_resolvedEffects",[]),U(this,"_defaultEffects",[]),U(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(s=>Z5(s,e)>0);i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(go(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const s of this.effects)n[s.id]=s;const i=[];for(const s of e){const c=n[s.id];c&&c!==s?c.setProps?(c.setProps(s.props),i.push(c)):(c.cleanup(),i.push(s)):i.push(s),delete n[s.id]}for(const s in n)n[s].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof LP)||this._resolvedEffects.push(q5),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Y5 extends Ix{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const K5="deckRenderer.renderLayers";class J5{constructor(e){U(this,"gl",void 0),U(this,"layerFilter",void 0),U(this,"drawPickingColors",void 0),U(this,"drawLayersPass",void 0),U(this,"pickLayersPass",void 0),U(this,"renderCount",void 0),U(this,"_needsRedraw",void 0),U(this,"renderBuffers",void 0),U(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Y5(e),this.pickLayersPass=new kP(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||xi.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,c=n.render({...i,target:s});i.effects&&this._postRender(i.effects,i),this.renderCount++,er(K5,this,c,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(this.gl,n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new xi(this.gl),new xi(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,s={...n,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const c of e)if(c.postRender){if(c.id===this.lastPostProcessEffect){s.target=n.target,c.postRender(this.gl,s);break}const d=c.postRender(this.gl,s);s.inputBuffer=d,s.swapBuffer=d===i[0]?i[1]:i[0]}}}const Q5={pickedColor:null,pickedObjectIndex:-1};function e6({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:s,deviceRect:c}){const{x:d,y:l,width:y,height:w}=c;let S=s*s,I=-1,P=0;for(let B=0;B<w;B++){const G=B+l-i,K=G*G;if(K>S)P+=4*y;else for(let ue=0;ue<y;ue++){if(t[P+3]-1>=0){const j=ue+d-n,Z=j*j+K;Z<=S&&(S=Z,I=P)}P+=4}}if(I>=0){const B=t.slice(I,I+4),G=e(B);if(G){const K=Math.floor(I/4/y),ue=I/4-K*y;return{...G,pickedColor:B,pickedX:d+ue,pickedY:l+K}}Zt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Q5}function t6({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const c=t.slice(i,i+4),d=c.join(",");if(!n.has(d)){const l=e(c);l?n.set(d,{...l,color:c}):Zt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function OP({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:s,z:c}){let d=e[0];e.length>1&&(d=i6((t==null?void 0:t.pickedViewports)||e,{x:i,y:s}));let l;if(d){const y=[i-d.x,s-d.y];c!==void 0&&(y[2]=c),l=d.unproject(y)}return{color:null,layer:null,viewport:d,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function n6(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:s}=t,{pickedColor:c,pickedLayer:d,pickedObjectIndex:l}=e,y=d?[d]:[];if(i==="hover"){const I=n.index,P=n.layerId,B=d?d.props.id:null;if(B!==P||l!==I){if(B!==P){const G=s.find(K=>K.props.id===P);G&&y.unshift(G)}n.layerId=B,n.index=l,n.info=null}}const w=OP(t),S=new Map;return S.set(null,w),y.forEach(I=>{let P={...w};I===d&&(P.color=c,P.index=l,P.picked=!0),P=FP({layer:I,info:P,mode:i});const B=P.layer;I===d&&i==="hover"&&(n.info=P),S.set(B.id,P),i==="hover"&&B.updateAutoHighlight(P)}),S}function FP({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function i6(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class r6{constructor(e){U(this,"gl",void 0),U(this,"pickingFBO",void 0),U(this,"depthFBO",void 0),U(this,"pickLayersPass",void 0),U(this,"layerFilter",void 0),U(this,"lastPickedInfo",void 0),U(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new kP(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:s},c=this.lastPickedInfo.info){const d=c&&c.layer&&c.layer.id,l=c&&c.viewport&&c.viewport.id,y=d?i.find(P=>P.id===d):null,w=l&&s.find(P=>P.id===l)||s[0],S=w&&w.unproject([e-w.x,n-w.y]);return{...c,...{x:e,y:n,viewport:w,coordinate:S,layer:y}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new xi(i),xi.isSupported(i,{colorBufferFloat:!0}))){const s=new xi(i);s.attach({36064:new ns(i,{format:Yt(i)?34836:6408,type:5126})}),this.depthFBO=s}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:s,y:c,radius:d=0,depth:l=1,mode:y="query",unproject3D:w,onViewportActive:S,effects:I}){const P=this._getPickable(e),B=_u(this.gl);if(!P)return{result:[],emptyInfo:OP({viewports:i,x:s,y:c,pixelRatio:B})};this._resizeBuffer();const G=uy(this.gl,[s,c],!0),K=[G.x+Math.floor(G.width/2),G.y+Math.floor(G.height/2)],ue=Math.round(d*B),{width:q,height:j}=this.pickingFBO,Z=this._getPickingRect({deviceX:K[0],deviceY:K[1],deviceRadius:ue,deviceWidth:q,deviceHeight:j}),re={x:s-d,y:c-d,width:d*2+1,height:d*2+1};let pe;const be=[],Re=new Set;for(let Fe=0;Fe<l;Fe++){let je;if(Z){const pt=this._drawAndSample({layers:P,views:n,viewports:i,onViewportActive:S,deviceRect:Z,cullRect:re,effects:I,pass:"picking:".concat(y)});je=e6({...pt,deviceX:K[0],deviceY:K[1],deviceRadius:ue,deviceRect:Z})}else je={pickedColor:null,pickedObjectIndex:-1};let Ge;if(je.pickedLayer&&w&&this.depthFBO){const{pickedColors:pt}=this._drawAndSample({layers:[je.pickedLayer],views:n,viewports:i,onViewportActive:S,deviceRect:{x:je.pickedX,y:je.pickedY,width:1,height:1},cullRect:re,effects:I,pass:"picking:".concat(y,":z")},!0);pt[3]&&(Ge=pt[0])}je.pickedLayer&&Fe+1<l&&(Re.add(je.pickedLayer),je.pickedLayer.disablePickingIndex(je.pickedObjectIndex)),pe=n6({pickInfo:je,lastPickedInfo:this.lastPickedInfo,mode:y,layers:P,viewports:i,x:s,y:c,z:Ge,pixelRatio:B});for(const pt of pe.values())pt.layer&&be.push(pt);if(!je.pickedColor)break}for(const Fe of Re)Fe.restorePickingColors();return{result:be,emptyInfo:pe.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:s,y:c,width:d=1,height:l=1,mode:y="query",maxObjects:w=null,onViewportActive:S,effects:I}){const P=this._getPickable(e);if(!P)return[];this._resizeBuffer();const B=_u(this.gl),G=uy(this.gl,[s,c],!0),K=G.x,ue=G.y+G.height,q=uy(this.gl,[s+d,c+l],!0),j=q.x+q.width,Z=q.y,re={x:K,y:Z,width:j-K,height:ue-Z},pe=this._drawAndSample({layers:P,views:n,viewports:i,onViewportActive:S,deviceRect:re,cullRect:{x:s,y:c,width:d,height:l},effects:I,pass:"picking:".concat(y)}),be=t6(pe),Re=new Map,Fe=Number.isFinite(w);for(let Ge=0;Ge<be.length;Ge++){var je;if(Fe&&w&&Re.size>=w)break;const pt=be[Ge];let bt={color:pt.pickedColor,layer:null,index:pt.pickedObjectIndex,picked:!0,x:s,y:c,pixelRatio:B};bt=FP({layer:pt.pickedLayer,info:bt,mode:y});const St=(je=bt.object)!==null&&je!==void 0?je:"".concat(bt.layer.id,"[").concat(bt.index,"]");Re.has(St)||Re.set(St,bt)}return Array.from(Re.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:s,deviceRect:c,cullRect:d,effects:l,pass:y},w=!1){const S=w?this.depthFBO:this.pickingFBO,I={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:s,pickingFBO:S,deviceRect:c,cullRect:d,effects:l,pass:y,pickZ:w,preRenderStats:{}};for(const j of l)j.useInPicking&&(I.preRenderStats[j.id]=j.preRender(this.gl,I));const{decodePickingColor:P}=this.pickLayersPass.render(I),{x:B,y:G,width:K,height:ue}=c,q=new(w?Float32Array:Uint8Array)(K*ue*4);return gg(S,{sourceX:B,sourceY:G,sourceWidth:K,sourceHeight:ue,target:q}),{pickedColors:q,decodePickingColor:P}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:s,deviceHeight:c}){const d=Math.max(0,e-i),l=Math.max(0,n-i),y=Math.min(s,e+i+1)-d,w=Math.min(c,n+i+1)-l;return y<=0||w<=0?null:{x:d,y:l,width:y,height:w}}}const s6={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class o6{constructor(e){U(this,"el",null),U(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,s6),n.appendChild(this.el))}setTooltip(e,n,i){const s=this.el;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var BP={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,s){var c=["","webkit","Moz","MS","ms","o"],d=n.createElement("div"),l="function",y=Math.round,w=Math.abs,S=Date.now;function I($,Q,he){return setTimeout(Z($,he),Q)}function P($,Q,he){return Array.isArray($)?(B($,he[Q],he),!0):!1}function B($,Q,he){var Ae;if($)if($.forEach)$.forEach(Q,he);else if($.length!==s)for(Ae=0;Ae<$.length;)Q.call(he,$[Ae],Ae,$),Ae++;else for(Ae in $)$.hasOwnProperty(Ae)&&Q.call(he,$[Ae],Ae,$)}function G($,Q,he){var Ae="DEPRECATED METHOD: "+Q+`
`+he+` AT 
`;return function(){var Ue=new Error("get-stack-trace"),at=Ue&&Ue.stack?Ue.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Bt=e.console&&(e.console.warn||e.console.log);return Bt&&Bt.call(e.console,Ae,at),$.apply(this,arguments)}}var K;typeof Object.assign!="function"?K=function(Q){if(Q===s||Q===null)throw new TypeError("Cannot convert undefined or null to object");for(var he=Object(Q),Ae=1;Ae<arguments.length;Ae++){var Ue=arguments[Ae];if(Ue!==s&&Ue!==null)for(var at in Ue)Ue.hasOwnProperty(at)&&(he[at]=Ue[at])}return he}:K=Object.assign;var ue=G(function(Q,he,Ae){for(var Ue=Object.keys(he),at=0;at<Ue.length;)(!Ae||Ae&&Q[Ue[at]]===s)&&(Q[Ue[at]]=he[Ue[at]]),at++;return Q},"extend","Use `assign`."),q=G(function(Q,he){return ue(Q,he,!0)},"merge","Use `assign`.");function j($,Q,he){var Ae=Q.prototype,Ue;Ue=$.prototype=Object.create(Ae),Ue.constructor=$,Ue._super=Ae,he&&K(Ue,he)}function Z($,Q){return function(){return $.apply(Q,arguments)}}function re($,Q){return typeof $==l?$.apply(Q&&Q[0]||s,Q):$}function pe($,Q){return $===s?Q:$}function be($,Q,he){B(Ge(Q),function(Ae){$.addEventListener(Ae,he,!1)})}function Re($,Q,he){B(Ge(Q),function(Ae){$.removeEventListener(Ae,he,!1)})}function Fe($,Q){for(;$;){if($==Q)return!0;$=$.parentNode}return!1}function je($,Q){return $.indexOf(Q)>-1}function Ge($){return $.trim().split(/\s+/g)}function pt($,Q,he){if($.indexOf&&!he)return $.indexOf(Q);for(var Ae=0;Ae<$.length;){if(he&&$[Ae][he]==Q||!he&&$[Ae]===Q)return Ae;Ae++}return-1}function bt($){return Array.prototype.slice.call($,0)}function St($,Q,he){for(var Ae=[],Ue=[],at=0;at<$.length;){var Bt=Q?$[at][Q]:$[at];pt(Ue,Bt)<0&&Ae.push($[at]),Ue[at]=Bt,at++}return he&&(Q?Ae=Ae.sort(function(zt,Bn){return zt[Q]>Bn[Q]}):Ae=Ae.sort()),Ae}function kt($,Q){for(var he,Ae,Ue=Q[0].toUpperCase()+Q.slice(1),at=0;at<c.length;){if(he=c[at],Ae=he?he+Ue:Q,Ae in $)return Ae;at++}return s}var Wn=1;function xt(){return Wn++}function bi($){var Q=$.ownerDocument||$;return Q.defaultView||Q.parentWindow||e}var nt=/mobile|tablet|ip(ad|hone|od)|android/i,Et="ontouchstart"in e,Pt=kt(e,"PointerEvent")!==s,nn=Et&&nt.test(navigator.userAgent),rn="touch",rr="pen",ri="mouse",wi="kinect",si=25,un=1,Ei=2,qt=4,On=8,ss=1,ki=2,Kn=4,Rr=8,Gi=16,fi=ki|Kn,Wi=Rr|Gi,$s=fi|Wi,Gt=["x","y"],Ri=["clientX","clientY"];function Fn($,Q){var he=this;this.manager=$,this.callback=Q,this.element=$.element,this.target=$.options.inputTarget,this.domHandler=function(Ae){re($.options.enable,[$])&&he.handler(Ae)},this.init()}Fn.prototype={handler:function(){},init:function(){this.evEl&&be(this.element,this.evEl,this.domHandler),this.evTarget&&be(this.target,this.evTarget,this.domHandler),this.evWin&&be(bi(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Re(this.element,this.evEl,this.domHandler),this.evTarget&&Re(this.target,this.evTarget,this.domHandler),this.evWin&&Re(bi(this.element),this.evWin,this.domHandler)}};function os($){var Q,he=$.options.inputClass;return he?Q=he:Pt?Q=sr:nn?Q=wr:Et?Q=ee:Q=Lt,new Q($,bo)}function bo($,Q,he){var Ae=he.pointers.length,Ue=he.changedPointers.length,at=Q&un&&Ae-Ue===0,Bt=Q&(qt|On)&&Ae-Ue===0;he.isFirst=!!at,he.isFinal=!!Bt,at&&($.session={}),he.eventType=Q,zr($,he),$.emit("hammer.input",he),$.recognize(he),$.session.prevInput=he}function zr($,Q){var he=$.session,Ae=Q.pointers,Ue=Ae.length;he.firstInput||(he.firstInput=xr(Q)),Ue>1&&!he.firstMultiple?he.firstMultiple=xr(Q):Ue===1&&(he.firstMultiple=!1);var at=he.firstInput,Bt=he.firstMultiple,En=Bt?Bt.center:at.center,zt=Q.center=Le(Ae);Q.timeStamp=S(),Q.deltaTime=Q.timeStamp-at.timeStamp,Q.angle=Ut(En,zt),Q.distance=Ti(En,zt),Dr(he,Q),Q.offsetDirection=as(Q.deltaX,Q.deltaY);var Bn=qe(Q.deltaTime,Q.deltaX,Q.deltaY);Q.overallVelocityX=Bn.x,Q.overallVelocityY=Bn.y,Q.overallVelocity=w(Bn.x)>w(Bn.y)?Bn.x:Bn.y,Q.scale=Bt?zi(Bt.pointers,Ae):1,Q.rotation=Bt?$i(Bt.pointers,Ae):0,Q.maxPointers=he.prevInput?Q.pointers.length>he.prevInput.maxPointers?Q.pointers.length:he.prevInput.maxPointers:Q.pointers.length,Hs(he,Q);var or=$.element;Fe(Q.srcEvent.target,or)&&(or=Q.srcEvent.target),Q.target=or}function Dr($,Q){var he=Q.center,Ae=$.offsetDelta||{},Ue=$.prevDelta||{},at=$.prevInput||{};(Q.eventType===un||at.eventType===qt)&&(Ue=$.prevDelta={x:at.deltaX||0,y:at.deltaY||0},Ae=$.offsetDelta={x:he.x,y:he.y}),Q.deltaX=Ue.x+(he.x-Ae.x),Q.deltaY=Ue.y+(he.y-Ae.y)}function Hs($,Q){var he=$.lastInterval||Q,Ae=Q.timeStamp-he.timeStamp,Ue,at,Bt,En;if(Q.eventType!=On&&(Ae>si||he.velocity===s)){var zt=Q.deltaX-he.deltaX,Bn=Q.deltaY-he.deltaY,or=qe(Ae,zt,Bn);at=or.x,Bt=or.y,Ue=w(or.x)>w(or.y)?or.x:or.y,En=as(zt,Bn),$.lastInterval=Q}else Ue=he.velocity,at=he.velocityX,Bt=he.velocityY,En=he.direction;Q.velocity=Ue,Q.velocityX=at,Q.velocityY=Bt,Q.direction=En}function xr($){for(var Q=[],he=0;he<$.pointers.length;)Q[he]={clientX:y($.pointers[he].clientX),clientY:y($.pointers[he].clientY)},he++;return{timeStamp:S(),pointers:Q,center:Le(Q),deltaX:$.deltaX,deltaY:$.deltaY}}function Le($){var Q=$.length;if(Q===1)return{x:y($[0].clientX),y:y($[0].clientY)};for(var he=0,Ae=0,Ue=0;Ue<Q;)he+=$[Ue].clientX,Ae+=$[Ue].clientY,Ue++;return{x:y(he/Q),y:y(Ae/Q)}}function qe($,Q,he){return{x:Q/$||0,y:he/$||0}}function as($,Q){return $===Q?ss:w($)>=w(Q)?$<0?ki:Kn:Q<0?Rr:Gi}function Ti($,Q,he){he||(he=Gt);var Ae=Q[he[0]]-$[he[0]],Ue=Q[he[1]]-$[he[1]];return Math.sqrt(Ae*Ae+Ue*Ue)}function Ut($,Q,he){he||(he=Gt);var Ae=Q[he[0]]-$[he[0]],Ue=Q[he[1]]-$[he[1]];return Math.atan2(Ue,Ae)*180/Math.PI}function $i($,Q){return Ut(Q[1],Q[0],Ri)+Ut($[1],$[0],Ri)}function zi($,Q){return Ti(Q[0],Q[1],Ri)/Ti($[0],$[1],Ri)}var Di={mousedown:un,mousemove:Ei,mouseup:qt},ls="mousedown",He="mousemove mouseup";function Lt(){this.evEl=ls,this.evWin=He,this.pressed=!1,Fn.apply(this,arguments)}j(Lt,Fn,{handler:function(Q){var he=Di[Q.type];he&un&&Q.button===0&&(this.pressed=!0),he&Ei&&Q.which!==1&&(he=qt),this.pressed&&(he&qt&&(this.pressed=!1),this.callback(this.manager,he,{pointers:[Q],changedPointers:[Q],pointerType:ri,srcEvent:Q}))}});var It={pointerdown:un,pointermove:Ei,pointerup:qt,pointercancel:On,pointerout:On},Jn={2:rn,3:rr,4:ri,5:wi},Or="pointerdown",Ct="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Or="MSPointerDown",Ct="MSPointerMove MSPointerUp MSPointerCancel");function sr(){this.evEl=Or,this.evWin=Ct,Fn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}j(sr,Fn,{handler:function(Q){var he=this.store,Ae=!1,Ue=Q.type.toLowerCase().replace("ms",""),at=It[Ue],Bt=Jn[Q.pointerType]||Q.pointerType,En=Bt==rn,zt=pt(he,Q.pointerId,"pointerId");at&un&&(Q.button===0||En)?zt<0&&(he.push(Q),zt=he.length-1):at&(qt|On)&&(Ae=!0),!(zt<0)&&(he[zt]=Q,this.callback(this.manager,at,{pointers:he,changedPointers:[Q],pointerType:Bt,srcEvent:Q}),Ae&&he.splice(zt,1))}});var $n={touchstart:un,touchmove:Ei,touchend:qt,touchcancel:On},qs="touchstart",Mn="touchstart touchmove touchend touchcancel";function oi(){this.evTarget=qs,this.evWin=Mn,this.started=!1,Fn.apply(this,arguments)}j(oi,Fn,{handler:function(Q){var he=$n[Q.type];if(he===un&&(this.started=!0),!!this.started){var Ae=en.call(this,Q,he);he&(qt|On)&&Ae[0].length-Ae[1].length===0&&(this.started=!1),this.callback(this.manager,he,{pointers:Ae[0],changedPointers:Ae[1],pointerType:rn,srcEvent:Q})}}});function en($,Q){var he=bt($.touches),Ae=bt($.changedTouches);return Q&(qt|On)&&(he=St(he.concat(Ae),"identifier",!0)),[he,Ae]}var Zs={touchstart:un,touchmove:Ei,touchend:qt,touchcancel:On},br="touchstart touchmove touchend touchcancel";function wr(){this.evTarget=br,this.targetIds={},Fn.apply(this,arguments)}j(wr,Fn,{handler:function(Q){var he=Zs[Q.type],Ae=As.call(this,Q,he);Ae&&this.callback(this.manager,he,{pointers:Ae[0],changedPointers:Ae[1],pointerType:rn,srcEvent:Q})}});function As($,Q){var he=bt($.touches),Ae=this.targetIds;if(Q&(un|Ei)&&he.length===1)return Ae[he[0].identifier]=!0,[he,he];var Ue,at,Bt=bt($.changedTouches),En=[],zt=this.target;if(at=he.filter(function(Bn){return Fe(Bn.target,zt)}),Q===un)for(Ue=0;Ue<at.length;)Ae[at[Ue].identifier]=!0,Ue++;for(Ue=0;Ue<Bt.length;)Ae[Bt[Ue].identifier]&&En.push(Bt[Ue]),Q&(qt|On)&&delete Ae[Bt[Ue].identifier],Ue++;if(En.length)return[St(at.concat(En),"identifier",!0),En]}var Xs=2500,cs=25;function ee(){Fn.apply(this,arguments);var $=Z(this.handler,this);this.touch=new wr(this.manager,$),this.mouse=new Lt(this.manager,$),this.primaryTouch=null,this.lastTouches=[]}j(ee,Fn,{handler:function(Q,he,Ae){var Ue=Ae.pointerType==rn,at=Ae.pointerType==ri;if(!(at&&Ae.sourceCapabilities&&Ae.sourceCapabilities.firesTouchEvents)){if(Ue)R.call(this,he,Ae);else if(at&&Y.call(this,Ae))return;this.callback(Q,he,Ae)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function R($,Q){$&un?(this.primaryTouch=Q.changedPointers[0].identifier,F.call(this,Q)):$&(qt|On)&&F.call(this,Q)}function F($){var Q=$.changedPointers[0];if(Q.identifier===this.primaryTouch){var he={x:Q.clientX,y:Q.clientY};this.lastTouches.push(he);var Ae=this.lastTouches,Ue=function(){var at=Ae.indexOf(he);at>-1&&Ae.splice(at,1)};setTimeout(Ue,Xs)}}function Y($){for(var Q=$.srcEvent.clientX,he=$.srcEvent.clientY,Ae=0;Ae<this.lastTouches.length;Ae++){var Ue=this.lastTouches[Ae],at=Math.abs(Q-Ue.x),Bt=Math.abs(he-Ue.y);if(at<=cs&&Bt<=cs)return!0}return!1}var J=kt(d.style,"touchAction"),ce=J!==s,me="compute",de="auto",le="manipulation",ge="none",Ce="pan-x",Oe="pan-y",Pe=Ke();function st($,Q){this.manager=$,this.set(Q)}st.prototype={set:function($){$==me&&($=this.compute()),ce&&this.manager.element.style&&Pe[$]&&(this.manager.element.style[J]=$),this.actions=$.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var $=[];return B(this.manager.recognizers,function(Q){re(Q.options.enable,[Q])&&($=$.concat(Q.getTouchAction()))}),lt($.join(" "))},preventDefaults:function($){var Q=$.srcEvent,he=$.offsetDirection;if(this.manager.session.prevented){Q.preventDefault();return}var Ae=this.actions,Ue=je(Ae,ge)&&!Pe[ge],at=je(Ae,Oe)&&!Pe[Oe],Bt=je(Ae,Ce)&&!Pe[Ce];if(Ue){var En=$.pointers.length===1,zt=$.distance<2,Bn=$.deltaTime<250;if(En&&zt&&Bn)return}if(!(Bt&&at)&&(Ue||at&&he&fi||Bt&&he&Wi))return this.preventSrc(Q)},preventSrc:function($){this.manager.session.prevented=!0,$.preventDefault()}};function lt($){if(je($,ge))return ge;var Q=je($,Ce),he=je($,Oe);return Q&&he?ge:Q||he?Q?Ce:Oe:je($,le)?le:de}function Ke(){if(!ce)return!1;var $={},Q=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(he){$[he]=Q?e.CSS.supports("touch-action",he):!0}),$}var gt=1,dt=2,Rt=4,vt=8,At=vt,Ft=16,Vt=32;function dn($){this.options=K({},this.defaults,$||{}),this.id=xt(),this.manager=null,this.options.enable=pe(this.options.enable,!0),this.state=gt,this.simultaneous={},this.requireFail=[]}dn.prototype={defaults:{},set:function($){return K(this.options,$),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function($){if(P($,"recognizeWith",this))return this;var Q=this.simultaneous;return $=Fr($,this),Q[$.id]||(Q[$.id]=$,$.recognizeWith(this)),this},dropRecognizeWith:function($){return P($,"dropRecognizeWith",this)?this:($=Fr($,this),delete this.simultaneous[$.id],this)},requireFailure:function($){if(P($,"requireFailure",this))return this;var Q=this.requireFail;return $=Fr($,this),pt(Q,$)===-1&&(Q.push($),$.requireFailure(this)),this},dropRequireFailure:function($){if(P($,"dropRequireFailure",this))return this;$=Fr($,this);var Q=pt(this.requireFail,$);return Q>-1&&this.requireFail.splice(Q,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function($){return!!this.simultaneous[$.id]},emit:function($){var Q=this,he=this.state;function Ae(Ue){Q.manager.emit(Ue,$)}he<vt&&Ae(Q.options.event+fn(he)),Ae(Q.options.event),$.additionalEvent&&Ae($.additionalEvent),he>=vt&&Ae(Q.options.event+fn(he))},tryEmit:function($){if(this.canEmit())return this.emit($);this.state=Vt},canEmit:function(){for(var $=0;$<this.requireFail.length;){if(!(this.requireFail[$].state&(Vt|gt)))return!1;$++}return!0},recognize:function($){var Q=K({},$);if(!re(this.options.enable,[this,Q])){this.reset(),this.state=Vt;return}this.state&(At|Ft|Vt)&&(this.state=gt),this.state=this.process(Q),this.state&(dt|Rt|vt|Ft)&&this.tryEmit(Q)},process:function($){},getTouchAction:function(){},reset:function(){}};function fn($){return $&Ft?"cancel":$&vt?"end":$&Rt?"move":$&dt?"start":""}function Qn($){return $==Gi?"down":$==Rr?"up":$==ki?"left":$==Kn?"right":""}function Fr($,Q){var he=Q.manager;return he?he.get($):$}function pi(){dn.apply(this,arguments)}j(pi,dn,{defaults:{pointers:1},attrTest:function($){var Q=this.options.pointers;return Q===0||$.pointers.length===Q},process:function($){var Q=this.state,he=$.eventType,Ae=Q&(dt|Rt),Ue=this.attrTest($);return Ae&&(he&On||!Ue)?Q|Ft:Ae||Ue?he&qt?Q|vt:Q&dt?Q|Rt:dt:Vt}});function Xt(){pi.apply(this,arguments),this.pX=null,this.pY=null}j(Xt,pi,{defaults:{event:"pan",threshold:10,pointers:1,direction:$s},getTouchAction:function(){var $=this.options.direction,Q=[];return $&fi&&Q.push(Oe),$&Wi&&Q.push(Ce),Q},directionTest:function($){var Q=this.options,he=!0,Ae=$.distance,Ue=$.direction,at=$.deltaX,Bt=$.deltaY;return Ue&Q.direction||(Q.direction&fi?(Ue=at===0?ss:at<0?ki:Kn,he=at!=this.pX,Ae=Math.abs($.deltaX)):(Ue=Bt===0?ss:Bt<0?Rr:Gi,he=Bt!=this.pY,Ae=Math.abs($.deltaY))),$.direction=Ue,he&&Ae>Q.threshold&&Ue&Q.direction},attrTest:function($){return pi.prototype.attrTest.call(this,$)&&(this.state&dt||!(this.state&dt)&&this.directionTest($))},emit:function($){this.pX=$.deltaX,this.pY=$.deltaY;var Q=Qn($.direction);Q&&($.additionalEvent=this.options.event+Q),this._super.emit.call(this,$)}});function wo(){pi.apply(this,arguments)}j(wo,pi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ge]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.scale-1)>this.options.threshold||this.state&dt)},emit:function($){if($.scale!==1){var Q=$.scale<1?"in":"out";$.additionalEvent=this.options.event+Q}this._super.emit.call(this,$)}});function Eo(){dn.apply(this,arguments),this._timer=null,this._input=null}j(Eo,dn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[de]},process:function($){var Q=this.options,he=$.pointers.length===Q.pointers,Ae=$.distance<Q.threshold,Ue=$.deltaTime>Q.time;if(this._input=$,!Ae||!he||$.eventType&(qt|On)&&!Ue)this.reset();else if($.eventType&un)this.reset(),this._timer=I(function(){this.state=At,this.tryEmit()},Q.time,this);else if($.eventType&qt)return At;return Vt},reset:function(){clearTimeout(this._timer)},emit:function($){this.state===At&&($&&$.eventType&qt?this.manager.emit(this.options.event+"up",$):(this._input.timeStamp=S(),this.manager.emit(this.options.event,this._input)))}});function ia(){pi.apply(this,arguments)}j(ia,pi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ge]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.rotation)>this.options.threshold||this.state&dt)}});function ra(){pi.apply(this,arguments)}j(ra,pi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:fi|Wi,pointers:1},getTouchAction:function(){return Xt.prototype.getTouchAction.call(this)},attrTest:function($){var Q=this.options.direction,he;return Q&(fi|Wi)?he=$.overallVelocity:Q&fi?he=$.overallVelocityX:Q&Wi&&(he=$.overallVelocityY),this._super.attrTest.call(this,$)&&Q&$.offsetDirection&&$.distance>this.options.threshold&&$.maxPointers==this.options.pointers&&w(he)>this.options.velocity&&$.eventType&qt},emit:function($){var Q=Qn($.offsetDirection);Q&&this.manager.emit(this.options.event+Q,$),this.manager.emit(this.options.event,$)}});function Ys(){dn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}j(Ys,dn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[le]},process:function($){var Q=this.options,he=$.pointers.length===Q.pointers,Ae=$.distance<Q.threshold,Ue=$.deltaTime<Q.time;if(this.reset(),$.eventType&un&&this.count===0)return this.failTimeout();if(Ae&&Ue&&he){if($.eventType!=qt)return this.failTimeout();var at=this.pTime?$.timeStamp-this.pTime<Q.interval:!0,Bt=!this.pCenter||Ti(this.pCenter,$.center)<Q.posThreshold;this.pTime=$.timeStamp,this.pCenter=$.center,!Bt||!at?this.count=1:this.count+=1,this._input=$;var En=this.count%Q.taps;if(En===0)return this.hasRequireFailures()?(this._timer=I(function(){this.state=At,this.tryEmit()},Q.interval,this),dt):At}return Vt},failTimeout:function(){return this._timer=I(function(){this.state=Vt},this.options.interval,this),Vt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==At&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Br($,Q){return Q=Q||{},Q.recognizers=pe(Q.recognizers,Br.defaults.preset),new aa($,Q)}Br.VERSION="2.0.7",Br.defaults={domEvents:!1,touchAction:me,enable:!0,inputTarget:null,inputClass:null,preset:[[ia,{enable:!1}],[wo,{enable:!1},["rotate"]],[ra,{direction:fi}],[Xt,{direction:fi},["swipe"]],[Ys],[Ys,{event:"doubletap",taps:2},["tap"]],[Eo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var sa=1,oa=2;function aa($,Q){this.options=K({},Br.defaults,Q||{}),this.options.inputTarget=this.options.inputTarget||$,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=$,this.input=os(this),this.touchAction=new st(this,this.options.touchAction),el(this,!0),B(this.options.recognizers,function(he){var Ae=this.add(new he[0](he[1]));he[2]&&Ae.recognizeWith(he[2]),he[3]&&Ae.requireFailure(he[3])},this)}aa.prototype={set:function($){return K(this.options,$),$.touchAction&&this.touchAction.update(),$.inputTarget&&(this.input.destroy(),this.input.target=$.inputTarget,this.input.init()),this},stop:function($){this.session.stopped=$?oa:sa},recognize:function($){var Q=this.session;if(!Q.stopped){this.touchAction.preventDefaults($);var he,Ae=this.recognizers,Ue=Q.curRecognizer;(!Ue||Ue&&Ue.state&At)&&(Ue=Q.curRecognizer=null);for(var at=0;at<Ae.length;)he=Ae[at],Q.stopped!==oa&&(!Ue||he==Ue||he.canRecognizeWith(Ue))?he.recognize($):he.reset(),!Ue&&he.state&(dt|Rt|vt)&&(Ue=Q.curRecognizer=he),at++}},get:function($){if($ instanceof dn)return $;for(var Q=this.recognizers,he=0;he<Q.length;he++)if(Q[he].options.event==$)return Q[he];return null},add:function($){if(P($,"add",this))return this;var Q=this.get($.options.event);return Q&&this.remove(Q),this.recognizers.push($),$.manager=this,this.touchAction.update(),$},remove:function($){if(P($,"remove",this))return this;if($=this.get($),$){var Q=this.recognizers,he=pt(Q,$);he!==-1&&(Q.splice(he,1),this.touchAction.update())}return this},on:function($,Q){if($!==s&&Q!==s){var he=this.handlers;return B(Ge($),function(Ae){he[Ae]=he[Ae]||[],he[Ae].push(Q)}),this}},off:function($,Q){if($!==s){var he=this.handlers;return B(Ge($),function(Ae){Q?he[Ae]&&he[Ae].splice(pt(he[Ae],Q),1):delete he[Ae]}),this}},emit:function($,Q){this.options.domEvents&&tc($,Q);var he=this.handlers[$]&&this.handlers[$].slice();if(!(!he||!he.length)){Q.type=$,Q.preventDefault=function(){Q.srcEvent.preventDefault()};for(var Ae=0;Ae<he.length;)he[Ae](Q),Ae++}},destroy:function(){this.element&&el(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function el($,Q){var he=$.element;if(he.style){var Ae;B($.options.cssProps,function(Ue,at){Ae=kt(he.style,at),Q?($.oldCssProps[Ae]=he.style[Ae],he.style[Ae]=Ue):he.style[Ae]=$.oldCssProps[Ae]||""}),Q||($.oldCssProps={})}}function tc($,Q){var he=n.createEvent("Event");he.initEvent($,!0,!0),he.gesture=Q,Q.target.dispatchEvent(he)}K(Br,{INPUT_START:un,INPUT_MOVE:Ei,INPUT_END:qt,INPUT_CANCEL:On,STATE_POSSIBLE:gt,STATE_BEGAN:dt,STATE_CHANGED:Rt,STATE_ENDED:vt,STATE_RECOGNIZED:At,STATE_CANCELLED:Ft,STATE_FAILED:Vt,DIRECTION_NONE:ss,DIRECTION_LEFT:ki,DIRECTION_RIGHT:Kn,DIRECTION_UP:Rr,DIRECTION_DOWN:Gi,DIRECTION_HORIZONTAL:fi,DIRECTION_VERTICAL:Wi,DIRECTION_ALL:$s,Manager:aa,Input:Fn,TouchAction:st,TouchInput:wr,MouseInput:Lt,PointerEventInput:sr,TouchMouseInput:ee,SingleTouchInput:oi,Recognizer:dn,AttrRecognizer:pi,Tap:Ys,Pan:Xt,Swipe:ra,Pinch:wo,Rotate:ia,Press:Eo,on:be,off:Re,each:B,merge:q,extend:ue,assign:K,inherit:j,bindFn:Z,prefixed:kt});var Ps=typeof e<"u"?e:typeof self<"u"?self:{};Ps.Hammer=Br,typeof s=="function"&&s.amd?s(function(){return Br}):t.exports?t.exports=Br:e[i]=Br})(window,document,"Hammer")})(BP);var Kd=BP.exports;const a6=Pu(Kd),lo=LL({__proto__:null,default:a6},[Kd]),NP=1,UP=2,K0=4,l6={mousedown:NP,mousemove:UP,mouseup:K0};function c6(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function u6(t){const e=t.prototype.handler;t.prototype.handler=function(i){const s=this.store;i.button>0&&i.type==="pointerdown"&&(c6(s,c=>c.pointerId===i.pointerId)||s.push(i)),e.call(this,i)}}function h6(t){t.prototype.handler=function(n){let i=l6[n.type];i&NP&&n.button>=0&&(this.pressed=!0),i&UP&&n.which===0&&(i=K0),this.pressed&&(i&K0&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}u6(Kd.PointerEventInput);h6(Kd.MouseInput);const d6=Kd.Manager;class _g{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const f6=lo?[[lo.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[lo.Rotate,{enable:!1}],[lo.Pinch,{enable:!1}],[lo.Swipe,{enable:!1}],[lo.Pan,{threshold:0,enable:!1}],[lo.Press,{enable:!1}],[lo.Tap,{event:"doubletap",taps:2,enable:!1}],[lo.Tap,{event:"anytap",enable:!1}],[lo.Tap,{enable:!1}]]:null,uT={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},p6={doubletap:["tap"]},m6={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},zx={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},g6={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},hT={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},_6=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Kc=typeof window<"u"?window:global;let J0=!1;try{const t={get passive(){return J0=!0,!0}};Kc.addEventListener("test",null,t),Kc.removeEventListener("test",null)}catch{J0=!1}const y6=_6.indexOf("firefox")!==-1,{WHEEL_EVENTS:v6}=zx,dT="wheel",fT=4.000244140625,x6=40,b6=.25;class w6 extends _g{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{if(!this.options.enable)return;let c=s.deltaY;Kc.WheelEvent&&(y6&&s.deltaMode===Kc.WheelEvent.DOM_DELTA_PIXEL&&(c/=Kc.devicePixelRatio),s.deltaMode===Kc.WheelEvent.DOM_DELTA_LINE&&(c*=x6)),c!==0&&c%fT===0&&(c=Math.floor(c/fT)),s.shiftKey&&c&&(c=c*b6),this.callback({type:dT,center:{x:s.clientX,y:s.clientY},delta:-c,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(v6),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,J0?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===dT&&(this.options.enable=n)}}const{MOUSE_EVENTS:E6}=zx,pT="pointermove",mT="pointerover",gT="pointerout",_T="pointerenter",yT="pointerleave";class T6 extends _g{constructor(e,n,i){super(e,n,i),this.handleEvent=c=>{this.handleOverEvent(c),this.handleOutEvent(c),this.handleEnterEvent(c),this.handleLeaveEvent(c),this.handleMoveEvent(c)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(E6),this.events.forEach(c=>e.addEventListener(c,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===pT&&(this.enableMoveEvent=n),e===mT&&(this.enableOverEvent=n),e===gT&&(this.enableOutEvent=n),e===_T&&(this.enableEnterEvent=n),e===yT&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(mT,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(gT,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(_T,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(yT,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(pT,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:S6}=zx,vT="keydown",xT="keyup";class A6 extends _g{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{const c=s.target||s.srcElement;c.tagName==="INPUT"&&c.type==="text"||c.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:vT,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:xT,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(S6),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===vT&&(this.enableDownEvent=n),e===xT&&(this.enableUpEvent=n)}}const bT="contextmenu";class P6 extends _g{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:bT,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===bT&&(this.options.enable=n)}}const Q0=1,Wm=2,ev=4,C6={pointerdown:Q0,pointermove:Wm,pointerup:ev,mousedown:Q0,mousemove:Wm,mouseup:ev},I6=1,L6=2,M6=3,k6=0,R6=1,z6=2,D6=1,O6=2,F6=4;function B6(t){const e=C6[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:s}=t.srcEvent;let c=!1,d=!1,l=!1;return e===ev||e===Wm&&!Number.isFinite(n)?(c=s===I6,d=s===L6,l=s===M6):e===Wm?(c=!!(n&D6),d=!!(n&F6),l=!!(n&O6)):e===Q0&&(c=i===k6,d=i===R6,l=i===z6),{leftButton:c,middleButton:d,rightButton:l}}function N6(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,c=i.height/e.offsetHeight||1,d={x:(n.x-i.left-e.clientLeft)/s,y:(n.y-i.top-e.clientTop)/c};return{center:n,offsetCenter:d}}const Iy={srcElement:"root",priority:0};class U6{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let s=n.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,s=!1,c=!1){const{handlers:d,handlersByElement:l}=this;let y=Iy;typeof i=="string"||i&&i.addEventListener?y={...Iy,srcElement:i}:i&&(y={...Iy,...i});let w=l.get(y.srcElement);w||(w=[],l.set(y.srcElement,w));const S={type:e,handler:n,srcElement:y.srcElement,priority:y.priority};s&&(S.once=!0),c&&(S.passive=!0),d.push(S),this._active=this._active||!S.passive;let I=w.length-1;for(;I>=0&&!(w[I].priority>=S.priority);)I--;w.splice(I+1,0,S)}remove(e,n){const{handlers:i,handlersByElement:s}=this;for(let c=i.length-1;c>=0;c--){const d=i[c];if(d.type===e&&d.handler===n){i.splice(c,1);const l=s.get(d.srcElement);l.splice(l.indexOf(d),1),l.length===0&&s.delete(d.srcElement)}}this._active=i.some(c=>!c.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let s=!1;const c=()=>{e.handled=!0},d=()=>{e.handled=!0,s=!0},l=[];for(let y=0;y<i.length;y++){const{type:w,handler:S,once:I}=i[y];if(S({...e,type:w,stopPropagation:c,stopImmediatePropagation:d}),I&&l.push(i[y]),s)break}for(let y=0;y<l.length;y++){const{type:w,handler:S}=l[y];this.remove(w,S)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...B6(e),...N6(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const V6={events:null,recognizers:null,recognizerOptions:{},Manager:d6,touchAction:"none",tabIndex:0};class j6{constructor(e=null,n){this._onBasicInput=s=>{const{srcEvent:c}=s,d=m6[c.type];d&&this.manager.emit(d,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...V6,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||f6}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(uT).forEach(s=>{const c=this.manager.get(s);c&&uT[s].forEach(d=>{c.recognizeWith(d)})});for(const s in n.recognizerOptions){const c=this.manager.get(s);if(c){const d=n.recognizerOptions[s];delete d.enable,c.set(d)}}this.wheelInput=new w6(e,this._onOtherEvent,{enable:!1}),this.moveInput=new T6(e,this._onOtherEvent,{enable:!1}),this.keyInput=new A6(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new P6(e,this._onOtherEvent,{enable:!1});for(const[s,c]of this.events)c.isEmpty()||(this._toggleRecognizer(c.recognizerName,!0),this.manager.on(s,c.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const s=i.get(e);if(s&&s.options.enable!==n){s.set({enable:n});const c=p6[e];c&&!this.options.recognizers&&c.forEach(d=>{const l=i.get(d);n?(l.requireFailure(e),s.dropRequireFailure(d)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,s,c){if(typeof e!="string"){i=n;for(const S in e)this._addEventHandler(S,e[S],i,s,c);return}const{manager:d,events:l}=this,y=hT[e]||e;let w=l.get(y);w||(w=new U6(this),l.set(y,w),w.recognizerName=g6[y]||y,d&&d.on(y,w.handleEvent)),w.add(e,n,i,s,c),w.isEmpty()||this._toggleRecognizer(w.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const d in e)this._removeEventHandler(d,e[d]);return}const{events:i}=this,s=hT[e]||e,c=i.get(s);if(c&&(c.remove(e,n),c.isEmpty())){const{recognizerName:d}=c;let l=!1;for(const y of i.values())if(y.recognizerName===d&&!y.isEmpty()){l=!0;break}l||this._toggleRecognizer(d,!1)}}}function Cl(){}const G6=({isDragging:t})=>t?"grabbing":"grab",VP={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Cl,onResize:Cl,onViewStateChange:Cl,onInteractionStateChange:Cl,onBeforeRender:Cl,onAfterRender:Cl,onLoad:Cl,onError:t=>Zt.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:G6,getTooltip:null,debug:!1,drawPickingColors:!1};class yg{constructor(e){U(this,"props",void 0),U(this,"width",0),U(this,"height",0),U(this,"userData",{}),U(this,"canvas",null),U(this,"viewManager",null),U(this,"layerManager",null),U(this,"effectManager",null),U(this,"deckRenderer",null),U(this,"deckPicker",null),U(this,"eventManager",null),U(this,"tooltip",null),U(this,"metrics",void 0),U(this,"animationLoop",void 0),U(this,"stats",void 0),U(this,"viewState",void 0),U(this,"cursorState",void 0),U(this,"_needsRedraw",void 0),U(this,"_pickRequest",void 0),U(this,"_lastPointerDownInfo",null),U(this,"_metricsCounter",void 0),U(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const s=n.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),U(this,"_onEvent",n=>{const i=rE[n.type],s=n.offsetCenter;if(!i||!s||!this.layerManager)return;const c=this.layerManager.getLayers(),d=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:c,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=d,y=l&&(l[i.handler]||l.props[i.handler]),w=this.props[i.handler];let S=!1;y&&(S=y.call(l,d,n)),!S&&w&&w(d,n)}),U(this,"_onPointerDown",n=>{const i=n.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo}),this.props={...VP,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Zt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),FA()==="IE"&&Zt.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new xx({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Tu.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,s,c,d,l,y;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(s=this.effectManager)===null||s===void 0||s.finalize(),this.effectManager=null,(c=this.deckRenderer)===null||c===void 0||c.finalize(),this.deckRenderer=null,(d=this.deckPicker)===null||d===void 0||d.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(y=this.tooltip)===null||y===void 0||y.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var w;(w=this.canvas.parentElement)===null||w===void 0||w.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Zt.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Zt.removed("onLayerClick","onClick")(),e.initialViewState&&!go(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),c=this.effectManager.needsRedraw(e),d=this.deckRenderer.needsRedraw(e);return n=n||i||s||c||d,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Li(this.viewManager),this.viewManager.views}getViewports(e){return Li(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,i){Li(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(n).timeStart();const c=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(n).timeEnd(),c}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Li(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const c=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=c}if(i||i===0){var s;const c=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((s=e.style)===null||s===void 0?void 0:s.position)||"absolute",this.canvas.style.height=c}}_updateCanvasSize(){var e,n;const{canvas:i}=this;if(!i)return;const s=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,c=(n=i.clientHeight)!==null&&n!==void 0?n:i.height;if(s!==this.width||c!==this.height){var d,l;this.width=s,this.height=c,(d=this.viewManager)===null||d===void 0||d.setProps({width:s,height:c}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:s,height:c})}}_createAnimationLoop(e){const{width:n,height:i,gl:s,glOptions:c,debug:d,onError:l,onBeforeRender:y,onAfterRender:w,useDevicePixels:S}=e;return new HF({width:n,height:i,useDevicePixels:S,autoResizeDrawingBuffer:!s,autoResizeViewport:!1,gl:s,onCreateContext:I=>WA({...c,...I,canvas:this.canvas,debug:d,onContextLost:()=>this._onContextLost()}),onInitialize:I=>this._setGLContext(I.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:y,onAfterRender:w,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new DP({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:s}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let c=s,d=!1;for(const l of i){var n;c=l,d=((n=l.layer)===null||n===void 0?void 0:n.onHover(l,e.event))||d}if(!d&&this.props.onHover&&this.props.onHover(c,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(c);this.tooltip.setTooltip(l,c.x,c.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,vx(e,{enable:!0,copyState:!0})),this.tooltip=new o6(this.canvas),Yo(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new xP;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new j6(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in rE)this.eventManager.on(s,this._onEvent);this.viewManager=new R5({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new k5(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new X5,this.deckRenderer=new J5(e),this.deckPicker=new r6(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;Yo(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Zt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Dl.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}U(yg,"defaultProps",VP);U(yg,"VERSION",Kz);class Ly{constructor(e,n){U(this,"opts",void 0),U(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:s}=n;let c=i;if(i&&i.length!==s){c=new Float32Array(s);const d=n.elementOffset||0;for(let l=0;l<s;++l)c[l]=i[d+l]}return c}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function W6(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Qp(t){return t.stride||t.size*t.bytesPerElement}function jP(t,e){e.offset&&Zt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Qp(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,s=e.elementOffset||0,c=i*n+s*t.bytesPerElement+(t.offset||0);return{...e,offset:c,stride:n}}function $6(t,e){const n=jP(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class H6{constructor(e,n,i){U(this,"gl",void 0),U(this,"id",void 0),U(this,"size",void 0),U(this,"settings",void 0),U(this,"value",void 0),U(this,"doublePrecision",void 0),U(this,"_buffer",void 0),U(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const s=n.logicalType||n.type,c=s===5130;let{defaultValue:d}=n;d=Number.isFinite(d)?[d]:d||new Array(this.size).fill(0);let l;c?l=5126:!s&&n.isIndexed?l=e&&wO(e,In.ELEMENT_INDEX_UINT32)?5125:5123:l=s||5126;let y=W6(s||l||5126);this.doublePrecision=c,c&&n.fp64===!1&&(y=Float32Array),this.value=null,this.settings={...n,defaultType:y,defaultValue:d,logicalType:s,type:l,size:this.size,bytesPerElement:y.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new yn(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Qp(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Tu.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},s=this.value instanceof Float64Array,c=$6(this.getAccessor(),n||{});return i[e]=new Ly(this,c.high),i["".concat(e,"64Low")]=s?new Ly(this,c.low):new Float32Array(this.size),i}if(n){const i=jP(this.getAccessor(),n);return{[e]:new Ly(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:s}=this,c=i*s;if(n&&c&&n.length>=c){const d=new Array(s).fill(1/0),l=new Array(s).fill(-1/0);for(let y=0;y<c;)for(let w=0;w<s;w++){const S=n[y++];S<d[w]&&(d[w]=S),S>l[w]&&(l[w]=S)}e=[d,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof yn?i={buffer:e}:i=e;const s={...this.settings,...i};if(n.bufferAccessor=s,n.bounds=null,i.constant){let c=i.value;if(c=this._normalizeValue(c,[],0),this.settings.normalized&&(c=this.normalizeConstant(c)),!(!n.constant||!this._areValuesEqual(c,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=c}else if(i.buffer){const c=i.buffer;n.externalBuffer=c,n.constant=!1,this.value=i.value||null;const d=i.value instanceof Float64Array;s.type=i.type||c.accessor.type,s.bytesPerElement=c.accessor.BYTES_PER_ELEMENT*(d?2:1),s.stride=Qp(s)}else if(i.value){this._checkExternalBuffer(i);let c=i.value;n.externalBuffer=null,n.constant=!1,this.value=c,s.bytesPerElement=c.BYTES_PER_ELEMENT,s.stride=Qp(s);const{buffer:d,byteOffset:l}=this;this.doublePrecision&&c instanceof Float64Array&&(c=Ay(c,s));const y=c.byteLength+l+s.stride*2;d.byteLength<y&&d.reallocate(y),d.setAccessor(null),d.subData({data:c,offset:l}),s.type=i.type||d.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?Ay(n,{size:this.size,startIndex:i,endIndex:s}):n.subarray(i,s),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,s=i.allocatedValue,c=Tu.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=c;const{buffer:d,byteOffset:l}=this;return d.byteLength<c.byteLength+l&&(d.reallocate(c.byteLength+l),n&&s&&d.subData({data:s instanceof Float64Array?Ay(s,this):s,offset:l})),i.allocatedValue=c,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=n.BYTES_PER_ELEMENT<4),s)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Zt.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:s,size:c}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let d=c;for(;--d>=0;)n[i+d]=s[d];return n}switch(c){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let d=c;for(;--d>=0;)n[i+d]=Number.isFinite(e[d])?e[d]:s[d]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==n[s])return!1;return!0}}const wT=[],ET=[];function vg(t,e=0,n=1/0){let i=wT;const s={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(ET.length=t.length,i=ET):i=wT,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),s.index=e-1),{iterable:i,objectInfo:s}}function GP(t){return t&&t[Symbol.asyncIterator]}function WP(t,e){const{size:n,stride:i,offset:s,startIndices:c,nested:d}=e,l=t.BYTES_PER_ELEMENT,y=i?i/l:n,w=s?s/l:0,S=Math.floor((t.length-w)/y);return(I,{index:P,target:B})=>{if(!c){const q=P*y+w;for(let j=0;j<n;j++)B[j]=t[q+j];return B}const G=c[P],K=c[P+1]||S;let ue;if(d){ue=new Array(K-G);for(let q=G;q<K;q++){const j=q*y+w;B=new Array(n);for(let Z=0;Z<n;Z++)B[Z]=t[j+Z];ue[q-G]=B}}else if(y===n)ue=t.subarray(G*n+w,K*n+w);else{ue=new t.constructor((K-G)*n);let q=0;for(let j=G;j<K;j++){const Z=j*y+w;for(let re=0;re<n;re++)ue[q++]=t[Z+re]}}return ue}}const q6=[],em=[[0,1/0]];function Z6(t,e){if(t===em||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let s=0;for(let c=0;c<i;c++){const d=t[c];d[1]<e[0]?(n.push(d),s=c+1):d[0]>e[1]?n.push(d):e=[Math.min(d[0],e[0]),Math.max(d[1],e[1])]}return n.splice(s,0,e),n}function My(t){const{source:e,target:n,start:i=0,size:s,getData:c}=t,d=t.end||n.length,l=e.length,y=d-i;if(l>y){n.set(e.subarray(0,y),i);return}if(n.set(e,i),!c)return;let w=l;for(;w<y;){const S=c(w,e);for(let I=0;I<s;I++)n[i+w]=S[I]||0,w++}}function X6({source:t,target:e,size:n,getData:i,sourceStartIndices:s,targetStartIndices:c}){if(!Array.isArray(c))return My({source:t,target:e,size:n,getData:i}),e;let d=0,l=0;const y=i&&((S,I)=>i(S+l,I)),w=Math.min(s.length,c.length);for(let S=1;S<w;S++){const I=s[S]*n,P=c[S]*n;My({source:t.subarray(d,I),target:e,start:l,end:P,size:n,getData:y}),d=I,l=P}return l<e.length&&My({source:[],target:e,start:l,size:n,getData:y}),e}const Y6={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function $P(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...Y6[n],...e,...t,type:n}}function HP(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function qP(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function ZP(t){t.push(t.shift())}function Dx(t,e){const{doublePrecision:n,settings:i,value:s,size:c}=t,d=n&&s instanceof Float64Array?2:1;return(i.noAlloc?s.length:e*c)*d}function XP({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:s,getData:c=d=>d}){const d=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*d,y=n.byteOffset,w=n.startIndices,S=s&&w,I=Dx(n,e),P=n.isConstant;if(!S&&i>=I)return;const B=P?n.value:n.getBuffer().getData({srcByteOffset:y});if(n.settings.normalized&&!P){const q=c;c=(j,Z)=>n.normalizeConstant(q(j,Z))}const G=P?(q,j)=>c(B,j):(q,j)=>c(B.subarray(q,q+l),j),K=t.getData({length:i}),ue=new Float32Array(I);X6({source:K,target:ue,sourceStartIndices:s,targetStartIndices:w,size:l,getData:G}),t.byteLength<ue.byteLength+y&&t.reallocate(ue.byteLength+y),t.subData({data:ue,offset:y})}class Ox extends H6{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:em}),U(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,s=Array.isArray(n)?e[n.find(c=>e[c])]:e[n];return $P(s,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:s=1/0}=n;this.state.updateRanges=Z6(this.state.updateRanges,[i,s])}else this.state.updateRanges=em}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=q6}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==em),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:d,noAlloc:l}}=this;let y=!0;if(d){for(const[w,S]of c)d.call(s,this,{data:n,startRow:w,endRow:S,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[w,S]of c){const I=Number.isFinite(w)?this.getVertexOffset(w):0,P=Number.isFinite(S)?this.getVertexOffset(S):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:I,endOffset:P})}this._checkAttributeArray()}else y=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),y}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const d=e;Li(ArrayBuffer.isView(d.value),"invalid ".concat(s.accessor));const l=!!d.size&&d.size!==this.size;return i.binaryAccessor=WP(d.value,{size:d.size||this.size,stride:d.stride,offset:d.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:s,props:c,numInstances:d}){if(e.constant)return;const{settings:l,state:y,value:w,size:S,startIndices:I}=e,{accessor:P,transform:B}=l,G=y.binaryAccessor||(typeof P=="function"?P:c[P]);Li(typeof G=="function",'accessor "'.concat(P,'" is not a function'));let K=e.getVertexOffset(i);const{iterable:ue,objectInfo:q}=vg(n,i,s);for(const j of ue){q.index++;let Z=G(j,q);if(B&&(Z=B.call(this,Z)),I){const re=(q.index<I.length-1?I[q.index+1]:d)-I[q.index];if(Z&&Array.isArray(Z[0])){let pe=K;for(const be of Z)e._normalizeValue(be,w,pe),pe+=S}else Z&&Z.length>S?w.set(Z,K):(e._normalizeValue(Z,q.target,0),E5({target:w,source:q.target,start:K,count:re}));K+=re*S}else e._normalizeValue(Z,w,K),K+=S}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class K6{constructor({gl:e,attribute:n,timeline:i}){U(this,"gl",void 0),U(this,"type","interpolation"),U(this,"attributeInTransition",void 0),U(this,"settings",void 0),U(this,"attribute",void 0),U(this,"transition",void 0),U(this,"currentStartIndices",void 0),U(this,"currentLength",void 0),U(this,"transform",void 0),U(this,"buffers",void 0),this.gl=e,this.transition=new Yd(i),this.attribute=n,this.attributeInTransition=new Ox(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=Q6(e,n);const s={byteLength:0,usage:35050};this.buffers=[new yn(e,s),new yn(e,s)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:s,attribute:c}=this;ZP(s);const d={numInstances:n,attribute:c,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of s)XP({buffer:l,...d});this.currentStartIndices=c.startIndices,this.currentLength=Dx(c,n),this.attributeInTransition.setData({buffer:s[1],value:c.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/c.size),sourceBuffers:{aFrom:s[0],aTo:HP(i,c)},feedbackBuffers:{vCurrent:s[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:s}=this.transition;let c=s/n;i&&(c=i(c)),this.transform.run({uniforms:{time:c}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const J6=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function Q6(t,e){const n=qP(e.size);return new Cx(t,{vs:J6,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class eU{constructor({gl:e,attribute:n,timeline:i}){U(this,"gl",void 0),U(this,"type","spring"),U(this,"attributeInTransition",void 0),U(this,"settings",void 0),U(this,"attribute",void 0),U(this,"transition",void 0),U(this,"currentStartIndices",void 0),U(this,"currentLength",void 0),U(this,"texture",void 0),U(this,"framebuffer",void 0),U(this,"transform",void 0),U(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Yd(i),this.attribute=n,this.attributeInTransition=new Ox(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=nU(e),this.framebuffer=iU(e,this.texture),this.transform=tU(e,n,this.framebuffer);const s={byteLength:0,usage:35050};this.buffers=[new yn(e,s),new yn(e,s),new yn(e,s)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:s,attribute:c}=this,d={numInstances:n,attribute:c,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of s)XP({buffer:l,...d});this.settings=e,this.currentStartIndices=c.startIndices,this.currentLength=Dx(c,n),this.attributeInTransition.setData({buffer:s[1],value:c.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/c.size),sourceBuffers:{aTo:HP(i,c)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:s}=this;if(!s.update())return!1;const d=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:d.stiffness,damping:d.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),ZP(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),gg(i)[0]>0||s.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function tU(t,e,n){const i=qP(e.size);return new Cx(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function nU(t){return new ns(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function iU(t,e){return new xi(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const rU={interpolation:K6,spring:eU};class sU{constructor(e,{id:n,timeline:i}){U(this,"id",void 0),U(this,"isSupported",void 0),U(this,"gl",void 0),U(this,"timeline",void 0),U(this,"transitions",void 0),U(this,"needsRedraw",void 0),U(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Cx.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const s in e){const c=e[s],d=c.getTransitionSetting(n);d&&this._updateAttribute(s,c,d)}for(const s in this.transitions){const c=e[s];(!c||!c.getTransitionSetting(n))&&this._removeTransition(s)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const s=this.transitions[e];let c=!s||s.type!==i.type;if(c){if(!this.isSupported){Zt.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}s&&this._removeTransition(e);const d=rU[i.type];d?this.transitions[e]=new d({attribute:n,timeline:this.timeline,gl:this.gl}):(Zt.error("unsupported transition type '".concat(i.type,"'"))(),c=!1)}(c||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const TT="attributeManager.invalidate",oU="attributeManager.updateStart",aU="attributeManager.updateEnd",lU="attribute.updateStart",cU="attribute.allocate",uU="attribute.updateEnd";class hU{constructor(e,{id:n="attribute-manager",stats:i,timeline:s}={}){U(this,"id",void 0),U(this,"gl",void 0),U(this,"attributes",void 0),U(this,"updateTriggers",void 0),U(this,"needsRedraw",void 0),U(this,"userData",void 0),U(this,"stats",void 0),U(this,"attributeTransitionManager",void 0),U(this,"mergeBoundsMemoized",qd(p5)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new sU(e,{id:"".concat(n,"-transitions"),timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);er(TT,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);er(TT,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:s,props:c={},buffers:d={},context:l={}}){let y=!1;er(oU,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const w in this.attributes){const S=this.attributes[w],I=S.settings.accessor;S.startIndices=i,S.numInstances=n,c[w]&&Zt.removed("props.".concat(w),"data.attributes.".concat(w))(),S.setExternalBuffer(d[w])||S.setBinaryValue(typeof I=="string"?d[I]:void 0,e.startIndices)||typeof I=="string"&&!d[I]&&S.setConstantValue(c[I])||S.needsUpdate()&&(y=!0,this._updateAttribute({attribute:S,numInstances:n,data:e,props:c,context:l})),this.needsRedraw=this.needsRedraw||S.needsRedraw()}y&&er(aU,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(i=>{var s;return(s=this.attributes[i])===null||s===void 0?void 0:s.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const c in n){const d=n[c];d.needsRedraw(e)&&!i.hasAttribute(c)&&(s[c]=d)}return s}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const s in e)n[s]||Object.assign(i,e[s].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const s=e[i];this.attributes[i]=this._createAttribute(i,s,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const s={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new Ox(this.gl,s)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:s}=this,c=s[e];return c&&c.forEach(d=>{const l=i[d];l&&l.setNeedsUpdate(l.id,n)}),c}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(er(lU,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&er(cU,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,er(uU,n,i))}}class dU extends Yd{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:s,easing:c}}=this,d=c(e/s);this._value=Fm(n,i,d)}}const ST=1e-5;function AT(t,e,n,i,s){const c=e-t,l=(n-e)*s,y=-c*i;return l+y+c+e}function fU(t,e,n,i,s){if(Array.isArray(n)){const c=[];for(let d=0;d<n.length;d++)c[d]=AT(t[d],e[d],n[d],i,s);return c}return AT(t,e,n,i,s)}function PT(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const s=t[i]-e[i];n+=s*s}return Math.sqrt(n)}return Math.abs(t-e)}class pU extends Yd{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:s}=this.settings,{_prevValue:c=e,_currValue:d=e}=this;let l=fU(c,d,n,i,s);const y=PT(l,n),w=PT(l,d);y<ST&&w<ST&&(l=n,this.end()),this._prevValue=d,this._currValue=l}}const mU={interpolation:dU,spring:pU};class gU{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,s){const{transitions:c}=this;if(c.has(e)){const y=c.get(e),{value:w=y.settings.fromValue}=y;n=w,this.remove(e)}if(s=$P(s),!s)return;const d=mU[s.type];if(!d){Zt.error("unsupported transition type '".concat(s.type,"'"))();return}const l=new d(this.timeline);l.start({...s,fromValue:n,toValue:i}),c.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function _U(t){const e=t[qa];for(const n in e){const i=e[n],{validate:s}=i;if(s&&!s(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function yU(t,e){const n=YP({newProps:t,oldProps:e,propTypes:t[qa],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=xU(t,e);let s=!1;return i||(s=bU(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:s,extensionsChanged:wU(t,e),transitionsChanged:vU(t,e)}}function vU(t,e){if(!t.transitions)return!1;const n={},i=t[qa];let s=!1;for(const c in t.transitions){const d=i[c],l=d&&d.type;(l==="number"||l==="color"||l==="array")&&tv(t[c],e[c],d)&&(n[c]=!0,s=!0)}return s?n:!1}function YP({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:s="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(s," changed shallowly");for(const c of Object.keys(t))if(!(c in n)){if(!(c in e))return"".concat(s,".").concat(c," added");const d=tv(t[c],e[c],i[c]);if(d)return"".concat(s,".").concat(c," ").concat(d)}for(const c of Object.keys(e))if(!(c in n)){if(!(c in t))return"".concat(s,".").concat(c," dropped");if(!Object.hasOwnProperty.call(t,c)){const d=tv(t[c],e[c],i[c]);if(d)return"".concat(s,".").concat(c," ").concat(d)}}return!1}function tv(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function xU(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:s}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&s&&(n=s(t.data,e.data)||n),n}function bU(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&CT(t,e,"all"))return{all:!0};const n={};let i=!1;for(const s in t.updateTriggers)s!=="all"&&CT(t,e,s)&&(n[s]=!0,i=!0);return i?n:!1}function wU(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(n[s]))return!0;return!1}function CT(t,e,n){let i=t.updateTriggers[n];i=i??{};let s=e.updateTriggers[n];return s=s??{},YP({oldProps:s,newProps:i,triggerName:n})}const EU="count(): argument not an object",TU="count(): argument not a container";function SU(t){if(!PU(t))throw new Error(EU);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(AU(t))return Object.keys(t).length;throw new Error(TU)}function AU(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function PU(t){return t!==null&&typeof t=="object"}function CU(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(s=>s.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];n.inject=i}return n}const IU={10241:9987,10240:9729,10242:33071,10243:33071},nv={};function LU(t,e,n,i){if(n instanceof ns)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let s=null;n.compressed&&(s={10241:n.data.length>1?9985:9729});const c=new ns(e,{...n,parameters:{...IU,...s,...i}});return nv[c.id]=t,c}function MU(t,e){!e||!(e instanceof ns)||nv[e.id]===t&&(e.delete(),delete nv[e.id])}const kU={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||iv(t)&&(t.length===3||t.length===4)},equal(t,e,n){return go(t,e,1)}},accessor:{validate(t,e){const n=$m(t);return n==="function"||n===$m(e.value)},equal(t,e,n){return typeof e=="function"?!0:go(t,e,1)}},array:{validate(t,e){return e.optional&&!t||iv(t)},equal(t,e,n){const{compare:i}=n,s=Number.isInteger(i)?i:i?1:0;return i?go(t,e,s):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,s=Number.isInteger(i)?i:i?1:0;return i?go(t,e,s):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.gl?null:LU(n.id,i.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{MU(n.id,t)}}};function RU(t){const e={},n={},i={};for(const[s,c]of Object.entries(t)){const d=c==null?void 0:c.deprecatedFor;if(d)i[s]=Array.isArray(d)?d:[d];else{const l=zU(s,c);e[s]=l,n[s]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function zU(t,e){switch($m(e)){case"object":return Bh(t,e);case"array":return Bh(t,{type:"array",value:e,compare:!1});case"boolean":return Bh(t,{type:"boolean",value:e});case"number":return Bh(t,{type:"number",value:e});case"function":return Bh(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Bh(t,e){return"type"in e?{name:t,...kU[e.type],...e}:"value"in e?{name:t,type:$m(e.value),...e}:{name:t,type:"object",value:e}}function iv(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function $m(t){return iv(t)?"array":t===null?"null":typeof t}function DU(t,e){let n;for(let c=e.length-1;c>=0;c--){const d=e[c];"extensions"in d&&(n=d.extensions)}const i=rv(t.constructor,n),s=Object.create(i);s[Gm]=t,s[ql]={},s[Oa]={};for(let c=0;c<e.length;++c){const d=e[c];for(const l in d)s[l]=d[l]}return Object.freeze(s),s}const OU="_mergedDefaultProps";function rv(t,e){let n=OU;if(e)for(const s of e){const c=s.constructor;c&&(n+=":".concat(c.extensionName||c.name))}const i=KP(t,n);return i||(t[n]=FU(t,e||[]))}function FU(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),s=rv(i),c=KP(t,"defaultProps")||{},d=RU(c),l=Object.assign(Object.create(null),s,d.defaultProps),y=Object.assign(Object.create(null),s==null?void 0:s[qa],d.propTypes),w=Object.assign(Object.create(null),s==null?void 0:s[Cy],d.deprecatedProps);for(const S of e){const I=rv(S.constructor);I&&(Object.assign(l,I),Object.assign(y,I[qa]),Object.assign(w,I[Cy]))}return BU(l,t),UU(l,y),NU(l,w),l[qa]=y,l[Cy]=w,e.length===0&&!Fx(t,"_propTypes")&&(t._propTypes=y),l}function BU(t,e){const n=jU(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function NU(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const s="".concat(this.id,": ").concat(n);for(const c of e[n])Fx(this,c)||(this[c]=i);Zt.deprecated(s,e[n].join("/"))()}})}function UU(t,e){const n={},i={};for(const s in e){const c=e[s],{name:d,value:l}=c;c.async&&(n[d]=l,i[d]=VU(d))}t[ou]=n,t[ql]={},Object.defineProperties(t,i)}function VU(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||GP(e)?this[ql][t]=e:this[Oa][t]=e},get(){if(this[Oa]){if(t in this[Oa])return this[Oa][t]||this[ou][t];if(t in this[ql]){const e=this[Gm]&&this[Gm].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[ou][t]}}return this[ou][t]}}}function Fx(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function KP(t,e){return Fx(t,e)&&t[e]}function jU(t){const e=t.componentName;return e||Zt.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let GU=0;class Bx{constructor(...e){U(this,"id",void 0),U(this,"props",void 0),U(this,"count",void 0),this.props=DU(this,e),this.id=this.props.id,this.count=GU++}clone(e){const{props:n}=this,i={};for(const s in n[ou])s in n[Oa]?i[s]=n[Oa][s]:s in n[ql]&&(i[s]=n[ql][s]);return new this.constructor({...n,...i,...e})}}U(Bx,"componentName","Component");U(Bx,"defaultProps",{});const WU=Object.freeze({});class $U{constructor(e){U(this,"component",void 0),U(this,"onAsyncPropUpdated",void 0),U(this,"asyncProps",void 0),U(this,"oldProps",void 0),U(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||WU}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Gm]||this.component;const n=e[Oa]||{},i=e[ql]||e,s=e[ou]||{};for(const c in n){const d=n[c];this._createAsyncPropData(c,s[c]),this._updateAsyncProp(c,d),n[c]=this.getAsyncProp(c)}for(const c in i){const d=i[c];this._createAsyncPropData(c,s[c]),this._updateAsyncProp(c,d)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(GP(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=n,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;n.then(c=>{this.component&&(c=this._postProcessValue(i,c),this._setAsyncPropValue(e,c,s),this._onResolve(e,c))}).catch(c=>{this._onError(e,c)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let c=[],d=0;for await(const l of n){if(!this.component)return;const{dataTransform:y}=this.component.props;y?c=y(l,c):c=c.concat(l),Object.defineProperty(c,"__diff",{enumerable:!1,value:[{startRow:d,endRow:c.length}]}),d=c.length,this._setAsyncPropValue(e,c,s)}this._onResolve(e,c)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const s=this.component&&this.component.props[qa];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class HU extends $U{constructor({attributeManager:e,layer:n}){super(n),U(this,"attributeManager",void 0),U(this,"needsRedraw",void 0),U(this,"needsUpdate",void 0),U(this,"subLayers",void 0),U(this,"usesPickingColorCache",void 0),U(this,"hasPickingBuffer",void 0),U(this,"changeFlags",void 0),U(this,"viewport",void 0),U(this,"uniformTransitions",void 0),U(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,s=i==null?void 0:i.props.fetch;return s?s(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const qU="layer.changeFlag",ZU="layer.initialize",XU="layer.update",YU="layer.finalize",KU="layer.matched",IT=2**24-1,JU=Object.freeze([]),QU=qd(({oldViewport:t,viewport:e})=>t.equals(e));let co=new Uint8ClampedArray(0);const eV={data:{type:"data",value:JU,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:s,signal:c})=>{const{resourceManager:d}=n.context;if(s=s||n.getLoadOptions(),i=i||n.props.loaders,c){var l;s={...s,fetch:{...(l=s)===null||l===void 0?void 0:l.fetch,signal:c}}}let y=d.contains(t);return!y&&!s&&(d.add({resourceId:t,data:km(t,i),persistent:!1}),y=!0),y?d.subscribe({resourceId:t,onChange:w=>{var S;return(S=n.internalState)===null||S===void 0?void 0:S.reloadAsyncProp(e,w)},consumerId:n.id,requestId:e}):km(t,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:cn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class na extends Bx{constructor(...e){super(...e),U(this,"internalState",null),U(this,"lifecycle",Fc.NO_STATE),U(this,"context",void 0),U(this,"state",void 0),U(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Li(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=MP(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,c,d]=IP(i,n.pixelProjectionMatrix);return e.length===2?[s,c]:[s,c,d]}unproject(e){return Li(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Li(this.internalState);const i=this.internalState.viewport||this.context.viewport;return x5(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===cn.DEFAULT||e===cn.LNGLAT||e===cn.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Li(e instanceof Uint8Array);const[n,i,s]=e;return n+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:SU(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=CU(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const s of i)n.invalidateAll(s);else n.invalidateAll();if(n){const{props:s}=e,c=this.internalState.hasPickingBuffer,d=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(c!==d){this.internalState.hasPickingBuffer=d;const{pickingColors:l,instancePickingColors:y}=n.attributes,w=l||y;w&&(d&&w.constant&&(w.constant=!1,n.invalidate(w.id)),!w.value&&!d&&(w.constant=!0,w.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,n){var i,s;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((i=(s=this.props).onError)!==null&&i!==void 0&&i.call(s,e))){var c,d;(c=this.context)===null||c===void 0||(d=c.onError)===null||d===void 0||d.call(c,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!QU({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:s,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const c=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(c)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const s in n)Object.defineProperty(i,s,{value:n[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(co.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>IT&&Zt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),co=Tu.allocate(co,n,{size:3,copy:!0,maxCount:Math.max(n,IT)});const s=Math.floor(co.length/3),c=[];for(let d=i;d<s;d++)this.encodePickingColor(d,c),co[d*3+0]=c[0],co[d*3+1]=c[1],co[d*3+2]=c[2]}e.value=co.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),s=e.userData.excludeAttributes||{},c=i.getShaderAttributes(n,s);e.setAttributes(c)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,c=i||s,d=c&&n.attributes&&n.attributes[c.id];if(d&&d.value){const l=d.value,y=this.encodePickingColor(e);for(let w=0;w<n.length;w++){const S=c.getVertexOffset(w);l[S]===y[0]&&l[S+1]===y[1]&&l[S+2]===y[2]&&this._disablePickingIndex(w)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,s=n||i;if(!s)return;const c=s.getVertexOffset(e),d=s.getVertexOffset(e+1);s.buffer.subData({data:new Uint8Array(d-c),offset:c})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==co.buffer&&(i.value=co.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Li(!this.internalState),Li(Number.isFinite(this.props.coordinateSystem)),er(ZU,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new HU({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Zt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new gU(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){er(KU,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(er(XU,this,e),!e)return;const n=this.props,i=this.context,s=this.internalState,c=i.viewport,d=this._updateUniformTransition();s.propsInTransition=d,i.viewport=s.viewport||c,this.props=d;try{const l=this._getUpdateParams(),y=this.getModels();if(i.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const S of this.props.extensions)S.updateState.call(this,l,S);const w=this.getModels()[0]!==y[0];this._postUpdate(l,w)}finally{i.viewport=c,this.props=n,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){er(YU,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,c=this.context;this.props=this.internalState.propsInTransition||s;const d=this.props.opacity;n.opacity=Math.pow(d,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,y=l&&l(n)||[0,0];Yo(c.gl,{polygonOffset:y}),Gs(c.gl,i,()=>{const w={moduleParameters:e,uniforms:n,parameters:i,context:c};for(const S of this.props.extensions)S.draw.call(this,w,S);this.draw(w)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const s in e)if(e[s]){let c=!1;switch(s){case"dataChanged":const d=e[s],l=n[s];d&&Array.isArray(l)&&(n.dataChanged=Array.isArray(d)?l.concat(d):d,c=!0);default:n[s]||(n[s]=e[s],c=!0)}c&&er(qU,this,s,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=yU(e,n);if(i.updateTriggersChanged)for(const c in i.updateTriggersChanged)i.updateTriggersChanged[c]&&this.invalidateAttribute(c);if(i.transitionsChanged)for(const c in i.transitionsChanged){var s;this.internalState.uniformTransitions.add(c,n[c],e[c],(s=e.transitions)===null||s===void 0?void 0:s[c])}return this.setChangeFlags(i)}validateProps(){_U(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new hU(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:s}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:c}=this.state;c==null||c.setInstanceCount(this.getNumInstances());const{autoHighlight:d,highlightedObjectIndex:l,highlightColor:y}=i;if(n||s.autoHighlight!==d||s.highlightedObjectIndex!==l||s.highlightColor!==y){const w={};d||(w.pickingSelectedColor=null),Array.isArray(y)&&(w.pickingHighlightColor=y),(n||l!==s.highlightedObjectIndex)&&(w.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(w)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(n=n||s,n)for(const c of this.props.extensions)c.onNeedsRedraw.call(this,c);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}U(na,"defaultProps",eV);U(na,"layerName","Layer");const tV="compositeLayer.renderLayers";class Nx extends na{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,s)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:s,visible:c,parameters:d,getPolygonOffset:l,highlightedObjectIndex:y,autoHighlight:w,highlightColor:S,coordinateSystem:I,coordinateOrigin:P,wrapLongitude:B,positionFormat:G,modelMatrix:K,extensions:ue,fetch:q,operation:j,_subLayerProps:Z}=this.props,re={id:"",updateTriggers:{},opacity:i,pickable:s,visible:c,parameters:d,getPolygonOffset:l,highlightedObjectIndex:y,autoHighlight:w,highlightColor:S,coordinateSystem:I,coordinateOrigin:P,wrapLongitude:B,positionFormat:G,modelMatrix:K,extensions:ue,fetch:q,operation:j},pe=Z&&e.id&&Z[e.id],be=pe&&pe.updateTriggers,Re=e.id||"sublayer";if(pe){const Fe=this.props[qa],je=e.type?e.type._propTypes:{};for(const Ge in pe){const pt=je[Ge]||Fe[Ge];pt&&pt.type==="accessor"&&(pe[Ge]=this.getSubLayerAccessor(pe[Ge]))}}Object.assign(re,e,pe),re.id="".concat(this.props.id,"-").concat(Re),re.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...be};for(const Fe of ue){const je=Fe.getSubLayerProps.call(this,Fe);je&&Object.assign(re,je,{updateTriggers:Object.assign(re.updateTriggers,je.updateTriggers)})}return re}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const s=!i||this.needsUpdate();if(s){const c=this.renderLayers();i=Rx(c,Boolean),this.internalState.subLayers=i}er(tV,this,s,i);for(const c of i)c.parent=this}}U(Nx,"layerName","CompositeLayer");class JP{constructor(e){U(this,"opts",void 0),U(this,"typedArrayManager",void 0),U(this,"indexStarts",[0]),U(this,"vertexStarts",[0]),U(this,"vertexCount",0),U(this,"instanceCount",0),U(this,"attributes",void 0),U(this,"_attributeDefs",void 0),U(this,"data",void 0),U(this,"getGeometry",void 0),U(this,"geometryBuffer",void 0),U(this,"buffers",void 0),U(this,"positionSize",void 0),U(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Tu,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:s,geometryBuffer:c,positionFormat:d,dataChanged:l,normalize:y=!0}=this.opts;if(this.data=n,this.getGeometry=s,this.positionSize=c&&c.size||(d==="XY"?2:3),this.buffers=i,this.normalize=y,c&&(Li(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(c),y||(i.positions=c)),this.geometryBuffer=i.positions,Array.isArray(l))for(const w of l)this._rebuildGeometry(w);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?WP(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:s,_attributeDefs:c,typedArrayManager:d}=this;for(const l in c)if(l in s)d.release(i[l]),i[l]=null;else{const y=c[l];y.copy=n,i[l]=d.allocate(i[l],e,y)}}_forEachGeometry(e,n,i){const{data:s,getGeometry:c}=this,{iterable:d,objectInfo:l}=vg(s,n,i);for(const y of d){l.index++;const w=c?c(y,l):null;e(w,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:s}=this;const{data:c,geometryBuffer:d}=this,{startRow:l=0,endRow:y=1/0}=e||{},w={};if(e||(n=[0],i=[0]),this.normalize||!d)this._forEachGeometry((I,P)=>{const B=I&&this.normalizeGeometry(I);w[P]=B,i[P+1]=i[P]+(B?this.getGeometrySize(B):0)},l,y),s=i[i.length-1];else if(i=c.startIndices,s=i[c.length]||0,ArrayBuffer.isView(d))s=s||d.length/this.positionSize;else if(d instanceof yn){const I=d.accessor.stride||this.positionSize*4;s=s||d.byteLength/I}else if(d.buffer){const I=d.stride||this.positionSize*4;s=s||d.buffer.byteLength/I}else if(d.value){const I=d.value,P=d.stride/I.BYTES_PER_ELEMENT||this.positionSize;s=s||I.length/P}this._allocate(s,!!e),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=s;const S={};this._forEachGeometry((I,P)=>{const B=w[P]||I;S.vertexStart=i[P],S.indexStart=n[P];const G=P<i.length-1?i[P+1]:s;S.geometrySize=G-i[P],S.geometryIndex=P,this.updateGeometryAttributes(B,S)},l,y),this.vertexCount=n[n.length-1]}}const nV=typeof window<"u"?Be.useLayoutEffect:Be.useEffect,iV=nV;function Hm(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const rV={position:"absolute",zIndex:-1};function QP(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>QP(n,e));if(xg(t)){if(sV(t))return e.style=rV,Be.cloneElement(t,e);if(oV(t))return Be.cloneElement(t,e)}return t}function xg(t){return t&&typeof t=="object"&&"type"in t||!1}function sV(t){var e;return(e=t.props)===null||e===void 0?void 0:e.mapStyle}function oV(t){const e=t.type;return e&&e.deckGLViewProps}function sv(t){if(typeof t=="function")return Be.createElement(Au,{},t);if(Array.isArray(t))return t.map(sv);if(xg(t)){if(t.type===Be.Fragment)return sv(t.props.children);if(Hm(t.type,Au))return t}return t}function aV({children:t,layers:e=[],views:n=null}){const i=[],s=[],c={};return Be.Children.forEach(sv(t),d=>{if(xg(d)){const l=d.type;if(Hm(l,na)){const y=lV(l,d.props);s.push(y)}else i.push(d);if(Hm(l,Au)&&l!==Au&&d.props.id){const y=new l(d.props);c[y.id]=y}}else d&&i.push(d)}),Object.keys(c).length>0&&(Array.isArray(n)?n.forEach(d=>{c[d.id]=d}):n&&(c[n.id]=n),n=Object.values(c)),e=s.length>0?[...s,...e]:e,{layers:e,children:i,views:n}}function lV(t,e){const n={},i=t.defaultProps||{};for(const s in e)i[s]!==e[s]&&(n[s]=e[s]);return new t(n)}function cV({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const s={},c=i.views[0].id;for(const d of t){let l=c,y=d;xg(d)&&Hm(d.type,Au)&&(l=d.props.id||c,y=d.props.children);const w=i.getViewport(l),S=i.getViewState(l);if(w){S.padding=w.padding;const{x:I,y:P,width:B,height:G}=w;y=QP(y,{x:I,y:P,width:B,height:G,viewport:w,viewState:S}),s[l]||(s[l]={viewport:w,children:[]}),s[l].children.push(y)}}return Object.keys(s).map(d=>{const{viewport:l,children:y}=s[d],{x:w,y:S,width:I,height:P}=l,B={position:"absolute",left:w,top:S,width:I,height:P},G="view-".concat(d),K=Be.createElement("div",{key:G,id:G,style:B},...y);if(n){const ue={viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:q=>{q.viewId=d,e._onViewStateChange(q)}};return Be.createElement(n,{key:G,value:ue},K)}return K})}const uV={mixBlendMode:null};function hV({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},s={left:0,top:0};if(n)for(const c in n)c in uV?s[c]=n[c]:i[c]=n[c];return{containerStyle:i,canvasStyle:s}}function dV(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function eC(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function fV(t,e,n){const i=new e({...n,_customRender:s=>{t.redrawReason=s;const c=i.getViewports();t.lastRenderedViewports!==c?t.forceUpdate():eC(t)}});return i}const tC=Be.forwardRef((t,e)=>{const[n,i]=Be.useState(0),c=Be.useRef({control:null,version:n,forceUpdate:()=>i(pe=>pe+1)}).current,d=Be.useRef(null),l=Be.useRef(null),y=Be.useMemo(()=>aV(t),[t.layers,t.views,t.children]);let w=!0;const S=pe=>{var be;return w&&t.viewState?(c.viewStateUpdateRequested=pe,null):(c.viewStateUpdateRequested=null,(be=t.onViewStateChange)===null||be===void 0?void 0:be.call(t,pe))},I=pe=>{if(w)c.interactionStateUpdateRequested=pe;else{var be;c.interactionStateUpdateRequested=null,(be=t.onInteractionStateChange)===null||be===void 0||be.call(t,pe)}},P=Be.useMemo(()=>{const pe={...t,style:null,width:"100%",height:"100%",parent:d.current,canvas:l.current,layers:y.layers,views:y.views,onViewStateChange:S,onInteractionStateChange:I};return delete pe._customRender,c.deck&&c.deck.setProps(pe),pe},[t]);Be.useEffect(()=>{const pe=t.Deck||yg;return c.deck=fV(c,pe,{...P,parent:d.current,canvas:l.current}),()=>{var be;return(be=c.deck)===null||be===void 0?void 0:be.finalize()}},[]),iV(()=>{eC(c);const{viewStateUpdateRequested:pe,interactionStateUpdateRequested:be}=c;pe&&S(pe),be&&I(be)}),Be.useImperativeHandle(e,()=>dV(c),[]);const B=c.deck&&c.deck.isInitialized?c.deck.getViewports():void 0,{ContextProvider:G,width:K,height:ue,id:q,style:j}=t,{containerStyle:Z,canvasStyle:re}=Be.useMemo(()=>hV({width:K,height:ue,style:j}),[K,ue,j]);if(!c.viewStateUpdateRequested&&c.lastRenderedViewports===B||c.version!==n){c.lastRenderedViewports=B,c.version=n;const pe=cV({children:y.children,deck:c.deck,ContextProvider:G}),be=Be.createElement("canvas",{key:"canvas",id:q||"deckgl-overlay",ref:l,style:re});c.control=Be.createElement("div",{id:"".concat(q||"deckgl","-wrapper"),ref:d,style:Z},[be,pe])}return w=!1,c.control});tC.defaultProps=yg.defaultProps;const pV=tC,mV=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,gV=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,_V=1024,yV=4,LT=()=>{},MT={10241:9987,10240:9729,10242:33071,10243:33071};function vV(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function xV(t,e,n,i){const s=Math.min(n/e.width,i/e.height),c=Math.floor(e.width*s),d=Math.floor(e.height*s);return s===1?{data:e,width:c,height:d}:(t.canvas.height=d,t.canvas.width=c,t.clearRect(0,0,c,d),t.drawImage(e,0,0,e.width,e.height,0,0,c,d),{data:t.canvas,width:c,height:d})}function Cd(t){return t&&(t.id||t.url)}function bV(t,e,n,i){const s=t.width,c=t.height,d=new ns(t.gl,{width:e,height:n,parameters:i});return yO(t,d,{targetY:0,width:s,height:c}),t.delete(),d}function kT(t,e,n){for(let i=0;i<e.length;i++){const{icon:s,xOffset:c}=e[i],d=Cd(s);t[d]={...s,x:c,y:n}}}function wV({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:s=0,rowHeight:c=0,canvasWidth:d}){let l=[];for(let y=0;y<t.length;y++){const w=t[y],S=Cd(w);if(!n[S]){const{height:I,width:P}=w;i+P+e>d&&(kT(n,l,s),i=0,s=c+s+e,c=0,l=[]),l.push({icon:w,xOffset:i}),i=i+P+e,c=Math.max(c,I)}}return l.length>0&&kT(n,l,s),{mapping:n,rowHeight:c,xOffset:i,yOffset:s,canvasWidth:d,canvasHeight:vV(c+s+e)}}function EV(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:s,objectInfo:c}=vg(t);for(const d of s){c.index++;const l=e(d,c),y=Cd(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!i[y]&&(!n[y]||l.url!==n[y].url)&&(i[y]={...l,source:d,sourceIndex:c.index})}return i}class TV{constructor(e,{onUpdate:n=LT,onError:i=LT}){U(this,"gl",void 0),U(this,"onUpdate",void 0),U(this,"onError",void 0),U(this,"_loadOptions",null),U(this,"_texture",null),U(this,"_externalTexture",null),U(this,"_mapping",{}),U(this,"_textureParameters",null),U(this,"_pendingCount",0),U(this,"_autoPacking",!1),U(this,"_xOffset",0),U(this,"_yOffset",0),U(this,"_rowHeight",0),U(this,"_buffer",yV),U(this,"_canvasWidth",_V),U(this,"_canvasHeight",0),U(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Cd(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:s,textureParameters:c}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),s&&(this._mapping=s),i){var d;(d=this._texture)===null||d===void 0||d.delete(),this._texture=null,this._externalTexture=i}c&&(this._textureParameters=c)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(EV(e,n,this._mapping)||{});if(i.length>0){const{mapping:s,xOffset:c,yOffset:d,rowHeight:l,canvasHeight:y}=wV({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=s,this._xOffset=c,this._yOffset=d,this._canvasHeight=y,this._texture||(this._texture=new ns(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||MT})),this._texture.height!==this._canvasHeight&&(this._texture=bV(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||MT)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,km(i.url,this._loadOptions).then(s=>{const c=Cd(i),d=this._mapping[c],{x:l,y,width:w,height:S}=d,{data:I,width:P,height:B}=xV(n,s,w,S);this._texture.setSubImageData({data:I,x:l+(w-P)/2,y:y+(S-B)/2,width:P,height:B}),d.width=P,d.height=B,this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const nC=[0,0,0,255],SV={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:nC},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class bg extends na{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(){return super.getShaders({vs:mV,fs:gV,modules:[Zd,Xd]})}initializeState(){this.state={iconManager:new TV(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:nC},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:s}=e,c=this.getAttributeManager(),{iconAtlas:d,iconMapping:l,data:y,getIcon:w,textureParameters:S}=n,{iconManager:I}=this.state,P=d||this.internalState.isAsyncPropLoading("iconAtlas");if(I.setProps({loadOptions:n.loadOptions,autoPacking:!P,iconAtlas:d,iconMapping:P?l:null,textureParameters:S}),P?i.iconMapping!==n.iconMapping&&c.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&I.packIcons(y,w),s.extensionsChanged){var B;const{gl:G}=this.context;(B=this.state.model)===null||B===void 0||B.delete(),this.state.model=this._getModel(G),c.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:s,sizeUnits:c,billboard:d,alphaCutoff:l}=this.props,{iconManager:y}=this.state,w=y.getTexture();w&&this.state.model.setUniforms(e).setUniforms({iconsTexture:w,iconsTextureDim:[w.width,w.height],sizeUnits:Wl[c],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:s,billboard:d,alphaCutoff:l}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Hl(e,{...this.getShaders(),id:this.props.id,geometry:new Hd({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):Zt.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:s=n/2,anchorY:c=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-s,i/2-c]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:s,height:c}=this.state.iconManager.getIconMapping(e);return[n,i,s,c]}}U(bg,"defaultProps",SV);U(bg,"layerName","IconLayer");const AV=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,PV=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (!filled) {
    discard;
  } else {
    gl_FragColor = vFillColor;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,RT=[0,0,0,255],CV={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:RT},getLineColor:{type:"accessor",value:RT},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Ux extends na{getShaders(){return super.getShaders({vs:AV,fs:PV,modules:[Zd,Xd]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:c,stroked:d,filled:l,billboard:y,antialiasing:w,lineWidthUnits:S,lineWidthScale:I,lineWidthMinPixels:P,lineWidthMaxPixels:B}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:d?1:0,filled:l,billboard:y,antialiasing:w,radiusUnits:Wl[n],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:c,lineWidthUnits:Wl[S],lineWidthScale:I,lineWidthMinPixels:P,lineWidthMaxPixels:B}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Hl(e,{...this.getShaders(),id:this.props.id,geometry:new Hd({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}U(Ux,"defaultProps",CV);U(Ux,"layerName","ScatterplotLayer");const iC={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function rC(t,e,n={}){return IV(t,n)!==e?(MV(t,n),!0):!1}function IV(t,e={}){return Math.sign(LV(t,e))}function LV(t,e={}){const{start:n=0,end:i=t.length}=e,s=e.size||2;let c=0;for(let d=n,l=i-s;d<i;d+=s)c+=(t[d]-t[l])*(t[d+1]+t[l+1]),l=d;return c/2}function MV(t,e){const{start:n=0,end:i=t.length,size:s=2}=e,c=(i-n)/s,d=Math.floor(c/2);for(let l=0;l<d;++l){const y=n+l*s,w=n+(c-1-l)*s;for(let S=0;S<s;++S){const I=t[y+S];t[y+S]=t[w+S],t[w+S]=I}}}function Us(t,e){const n=e.length,i=t.length;if(i>0){let s=!0;for(let c=0;c<n;c++)if(t[i-n+c]!==e[c]){s=!1;break}if(s)return!1}for(let s=0;s<n;s++)t[i+s]=e[s];return!0}function ov(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function Id(t,e,n,i,s=[]){const c=i+e*n;for(let d=0;d<n;d++)s[d]=t[c+d];return s}function av(t,e,n,i,s=[]){let c,d;if(n&8)c=(i[3]-t[1])/(e[1]-t[1]),d=3;else if(n&4)c=(i[1]-t[1])/(e[1]-t[1]),d=1;else if(n&2)c=(i[2]-t[0])/(e[0]-t[0]),d=2;else if(n&1)c=(i[0]-t[0])/(e[0]-t[0]),d=0;else return null;for(let l=0;l<t.length;l++)s[l]=(d&1)===l?i[d]:c*(e[l]-t[l])+t[l];return s}function tm(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function sC(t,e){const{size:n=2,broken:i=!1,gridResolution:s=10,gridOffset:c=[0,0],startIndex:d=0,endIndex:l=t.length}=e||{},y=(l-d)/n;let w=[];const S=[w],I=Id(t,0,n,d);let P,B;const G=aC(I,s,c,[]),K=[];Us(w,I);for(let ue=1;ue<y;ue++){for(P=Id(t,ue,n,d,P),B=tm(P,G);B;){av(I,P,B,G,K);const q=tm(K,G);q&&(av(I,K,q,G,K),B=q),Us(w,K),ov(I,K),RV(G,s,B),i&&w.length>n&&(w=[],S.push(w),Us(w,I)),B=tm(P,G)}Us(w,P),ov(I,P)}return i?S:S[0]}const zT=0,kV=1;function Ip(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function oC(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:s=10,gridOffset:c=[0,0],edgeTypes:d=!1}=n||{},l=[],y=[{pos:t,types:d?new Array(t.length/i).fill(kV):null,holes:e||[]}],w=[[],[]];let S=[];for(;y.length;){const{pos:I,types:P,holes:B}=y.shift();zV(I,i,B[0]||I.length,w),S=aC(w[0],s,c,S);const G=tm(w[1],S);if(G){let K=DT(I,P,i,0,B[0]||I.length,S,G);const ue={pos:K[0].pos,types:K[0].types,holes:[]},q={pos:K[1].pos,types:K[1].types,holes:[]};y.push(ue,q);for(let j=0;j<B.length;j++)K=DT(I,P,i,B[j],B[j+1]||I.length,S,G),K[0]&&(ue.holes.push(ue.pos.length),ue.pos=Ip(ue.pos,K[0].pos),d&&(ue.types=Ip(ue.types,K[0].types))),K[1]&&(q.holes.push(q.pos.length),q.pos=Ip(q.pos,K[1].pos),d&&(q.types=Ip(q.types,K[1].types)))}else{const K={positions:I};d&&(K.edgeTypes=P),B.length&&(K.holeIndices=B),l.push(K)}}return l}function DT(t,e,n,i,s,c,d){const l=(s-i)/n,y=[],w=[],S=[],I=[],P=[];let B,G,K;const ue=Id(t,l-1,n,i);let q=Math.sign(d&8?ue[1]-c[3]:ue[0]-c[2]),j=e&&e[l-1],Z=0,re=0;for(let pe=0;pe<l;pe++)B=Id(t,pe,n,i,B),G=Math.sign(d&8?B[1]-c[3]:B[0]-c[2]),K=e&&e[i/n+pe],G&&q&&q!==G&&(av(ue,B,d,c,P),Us(y,P)&&S.push(j),Us(w,P)&&I.push(j)),G<=0?(Us(y,B)&&S.push(K),Z-=G):S.length&&(S[S.length-1]=zT),G>=0?(Us(w,B)&&I.push(K),re+=G):I.length&&(I[I.length-1]=zT),ov(ue,B),q=G,j=K;return[Z?{pos:y,types:e&&S}:null,re?{pos:w,types:e&&I}:null]}function aC(t,e,n,i){const s=Math.floor((t[0]-n[0])/e)*e+n[0],c=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=s,i[1]=c,i[2]=s+e,i[3]=c+e,i}function RV(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function zV(t,e,n,i){let s=1/0,c=-1/0,d=1/0,l=-1/0;for(let y=0;y<n;y+=e){const w=t[y],S=t[y+1];s=w<s?w:s,c=w>c?w:c,d=S<d?S:d,l=S>l?S:l}return i[0][0]=s,i[0][1]=d,i[1][0]=c,i[1][1]=l,i}const DV=85.051129;function OV(t,e){const{size:n=2,startIndex:i=0,endIndex:s=t.length,normalize:c=!0}=e||{},d=t.slice(i,s);lC(d,n,0,s-i);const l=sC(d,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(c)for(const y of l)cC(y,n);return l}function FV(t,e=null,n){const{size:i=2,normalize:s=!0,edgeTypes:c=!1}=n||{};e=e||[];const d=[],l=[];let y=0,w=0;for(let I=0;I<=e.length;I++){const P=e[I]||t.length,B=w,G=BV(t,i,y,P);for(let K=G;K<P;K++)d[w++]=t[K];for(let K=y;K<G;K++)d[w++]=t[K];lC(d,i,B,w),NV(d,i,B,w,n==null?void 0:n.maxLatitude),y=P,l[I]=w}l.pop();const S=oC(d,l,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:c});if(s)for(const I of S)cC(I.positions,i);return S}function BV(t,e,n,i){let s=-1,c=-1;for(let d=n+1;d<i;d+=e){const l=Math.abs(t[d]);l>s&&(s=l,c=d-1)}return c}function NV(t,e,n,i,s=DV){const c=t[n],d=t[i-e];if(Math.abs(c-d)>180){const l=Id(t,0,e,n);l[0]+=Math.round((d-c)/360)*360,Us(t,l),l[1]=Math.sign(l[1])*s,Us(t,l),l[0]=c,Us(t,l)}}function lC(t,e,n,i){let s=t[0],c;for(let d=n;d<i;d+=e){c=t[d];const l=c-s;(l>180||l<-180)&&(c-=Math.round(l/360)*360),t[d]=s=c}}function cC(t,e){let n;const i=t.length/e;for(let c=0;c<i&&(n=t[c*e],(n+180)%360===0);c++);const s=-Math.round(n/360)*360;if(s!==0)for(let c=0;c<i;c++)t[c*e]+=s}function UV(t,e,n,i){let s;if(Array.isArray(t[0])){const c=t.length*e;s=new Array(c);for(let d=0;d<t.length;d++)for(let l=0;l<e;l++)s[d*e+l]=t[d][l]||0}else s=t;return n?sC(s,{size:e,gridResolution:n}):i?OV(s,{size:e}):s}const VV=1,jV=2,ky=4;class GV extends JP{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?UV(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(OT(e)){let i=0;for(const s of e)i+=this.getGeometrySize(s);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&OT(e))for(const i of e){const s=this.getGeometrySize(i);n.geometrySize=s,this.updateGeometryAttributes(i,n),n.vertexStart+=s}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:c,geometrySize:d}=n;i.fill(0,c,c+d),s?(i[c]=ky,i[c+d-2]=ky):(i[c]+=VV,i[c+d-2]+=jV),i[c+d-1]=ky}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:s,geometrySize:c}=n,d=new Array(3);for(let l=s,y=0;y<c;l++,y++)this.getPointOnPath(e,y,d),i[l*3]=d[0],i[l*3+1]=d[1],i[l*3+2]=d[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:s}=this;n*s>=e.length&&(n+=1-e.length/s);const c=n*s;return i[0]=e[c],i[1]=e[c+1],i[2]=s===3&&e[c+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function OT(t){return Array.isArray(t[0])}const WV=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,$V=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,uC=[0,0,0,255],HV={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:uC},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Ry={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class wg extends na{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(){return super.getShaders({vs:WV,fs:$V,modules:[Zd,Xd]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:Ry,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Ry,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:Ry,defaultValue:uC},instancePickingColors:{size:3,type:5121,accessor:(i,{index:s,target:c})=>this.encodePickingColor(i&&i.__source?i.__source.index:s,c)}}),this.setState({pathTesselator:new GV({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,s=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,y=n.data.attributes||{};l.updateGeometry({data:n.data,geometryBuffer:y.getPath,buffers:y,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),i.dataChanged||s.invalidateAll()}if(i.extensionsChanged){var d;const{gl:l}=this.context;(d=this.state.model)===null||d===void 0||d.delete(),this.state.model=this._getModel(l),s.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:s}=this.props;return s[0]&&s[0].__source&&(n.object=s.find(c=>c.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:s,miterLimit:c,widthUnits:d,widthScale:l,widthMinPixels:y,widthMaxPixels:w}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:s,widthUnits:Wl[d],widthScale:l,miterLimit:c,widthMinPixels:y,widthMaxPixels:w}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Hl(e,{...this.getShaders(),id:this.props.id,geometry:new Hd({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}U(wg,"defaultProps",HV);U(wg,"layerName","PathLayer");var Vx={exports:{}};Vx.exports=Eg;Vx.exports.default=Eg;function Eg(t,e,n){n=n||2;var i=e&&e.length,s=i?e[0]*n:t.length,c=hC(t,0,s,n,!0),d=[];if(!c||c.next===c.prev)return d;var l,y,w,S,I,P,B;if(i&&(c=KV(t,e,c,n)),t.length>80*n){l=w=t[0],y=S=t[1];for(var G=n;G<s;G+=n)I=t[G],P=t[G+1],I<l&&(l=I),P<y&&(y=P),I>w&&(w=I),P>S&&(S=P);B=Math.max(w-l,S-y),B=B!==0?32767/B:0}return Ld(c,d,n,l,y,B,0),d}function hC(t,e,n,i,s){var c,d;if(s===uv(t,e,n,i)>0)for(c=e;c<n;c+=i)d=FT(c,t[c],t[c+1],d);else for(c=n-i;c>=e;c-=i)d=FT(c,t[c],t[c+1],d);return d&&Tg(d,d.next)&&(kd(d),d=d.next),d}function Zl(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(Tg(n,n.next)||Vn(n.prev,n,n.next)===0)){if(kd(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Ld(t,e,n,i,s,c,d){if(t){!d&&c&&nj(t,i,s,c);for(var l=t,y,w;t.prev!==t.next;){if(y=t.prev,w=t.next,c?ZV(t,i,s,c):qV(t)){e.push(y.i/n|0),e.push(t.i/n|0),e.push(w.i/n|0),kd(t),t=w.next,l=w.next;continue}if(t=w,t===l){d?d===1?(t=XV(Zl(t),e,n),Ld(t,e,n,i,s,c,2)):d===2&&YV(t,e,n,i,s,c):Ld(Zl(t),e,n,i,s,c,1);break}}}}function qV(t){var e=t.prev,n=t,i=t.next;if(Vn(e,n,i)>=0)return!1;for(var s=e.x,c=n.x,d=i.x,l=e.y,y=n.y,w=i.y,S=s<c?s<d?s:d:c<d?c:d,I=l<y?l<w?l:w:y<w?y:w,P=s>c?s>d?s:d:c>d?c:d,B=l>y?l>w?l:w:y>w?y:w,G=i.next;G!==e;){if(G.x>=S&&G.x<=P&&G.y>=I&&G.y<=B&&Jc(s,l,c,y,d,w,G.x,G.y)&&Vn(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function ZV(t,e,n,i){var s=t.prev,c=t,d=t.next;if(Vn(s,c,d)>=0)return!1;for(var l=s.x,y=c.x,w=d.x,S=s.y,I=c.y,P=d.y,B=l<y?l<w?l:w:y<w?y:w,G=S<I?S<P?S:P:I<P?I:P,K=l>y?l>w?l:w:y>w?y:w,ue=S>I?S>P?S:P:I>P?I:P,q=lv(B,G,e,n,i),j=lv(K,ue,e,n,i),Z=t.prevZ,re=t.nextZ;Z&&Z.z>=q&&re&&re.z<=j;){if(Z.x>=B&&Z.x<=K&&Z.y>=G&&Z.y<=ue&&Z!==s&&Z!==d&&Jc(l,S,y,I,w,P,Z.x,Z.y)&&Vn(Z.prev,Z,Z.next)>=0||(Z=Z.prevZ,re.x>=B&&re.x<=K&&re.y>=G&&re.y<=ue&&re!==s&&re!==d&&Jc(l,S,y,I,w,P,re.x,re.y)&&Vn(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;Z&&Z.z>=q;){if(Z.x>=B&&Z.x<=K&&Z.y>=G&&Z.y<=ue&&Z!==s&&Z!==d&&Jc(l,S,y,I,w,P,Z.x,Z.y)&&Vn(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;re&&re.z<=j;){if(re.x>=B&&re.x<=K&&re.y>=G&&re.y<=ue&&re!==s&&re!==d&&Jc(l,S,y,I,w,P,re.x,re.y)&&Vn(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function XV(t,e,n){var i=t;do{var s=i.prev,c=i.next.next;!Tg(s,c)&&dC(s,i,i.next,c)&&Md(s,c)&&Md(c,s)&&(e.push(s.i/n|0),e.push(i.i/n|0),e.push(c.i/n|0),kd(i),kd(i.next),i=t=c),i=i.next}while(i!==t);return Zl(i)}function YV(t,e,n,i,s,c){var d=t;do{for(var l=d.next.next;l!==d.prev;){if(d.i!==l.i&&sj(d,l)){var y=fC(d,l);d=Zl(d,d.next),y=Zl(y,y.next),Ld(d,e,n,i,s,c,0),Ld(y,e,n,i,s,c,0);return}l=l.next}d=d.next}while(d!==t)}function KV(t,e,n,i){var s=[],c,d,l,y,w;for(c=0,d=e.length;c<d;c++)l=e[c]*i,y=c<d-1?e[c+1]*i:t.length,w=hC(t,l,y,i,!1),w===w.next&&(w.steiner=!0),s.push(rj(w));for(s.sort(JV),c=0;c<s.length;c++)n=QV(s[c],n);return n}function JV(t,e){return t.x-e.x}function QV(t,e){var n=ej(t,e);if(!n)return e;var i=fC(n,t);return Zl(i,i.next),Zl(n,n.next)}function ej(t,e){var n=e,i=t.x,s=t.y,c=-1/0,d;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var l=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(l<=i&&l>c&&(c=l,d=n.x<n.next.x?n:n.next,l===i))return d}n=n.next}while(n!==e);if(!d)return null;var y=d,w=d.x,S=d.y,I=1/0,P;n=d;do i>=n.x&&n.x>=w&&i!==n.x&&Jc(s<S?i:c,s,w,S,s<S?c:i,s,n.x,n.y)&&(P=Math.abs(s-n.y)/(i-n.x),Md(n,t)&&(P<I||P===I&&(n.x>d.x||n.x===d.x&&tj(d,n)))&&(d=n,I=P)),n=n.next;while(n!==y);return d}function tj(t,e){return Vn(t.prev,t,e.prev)<0&&Vn(e.next,t,t.next)<0}function nj(t,e,n,i){var s=t;do s.z===0&&(s.z=lv(s.x,s.y,e,n,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,ij(s)}function ij(t){var e,n,i,s,c,d,l,y,w=1;do{for(n=t,t=null,c=null,d=0;n;){for(d++,i=n,l=0,e=0;e<w&&(l++,i=i.nextZ,!!i);e++);for(y=w;l>0||y>0&&i;)l!==0&&(y===0||!i||n.z<=i.z)?(s=n,n=n.nextZ,l--):(s=i,i=i.nextZ,y--),c?c.nextZ=s:t=s,s.prevZ=c,c=s;n=i}c.nextZ=null,w*=2}while(d>1);return t}function lv(t,e,n,i,s){return t=(t-n)*s|0,e=(e-i)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function rj(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Jc(t,e,n,i,s,c,d,l){return(s-d)*(e-l)>=(t-d)*(c-l)&&(t-d)*(i-l)>=(n-d)*(e-l)&&(n-d)*(c-l)>=(s-d)*(i-l)}function sj(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!oj(t,e)&&(Md(t,e)&&Md(e,t)&&aj(t,e)&&(Vn(t.prev,t,e.prev)||Vn(t,e.prev,e))||Tg(t,e)&&Vn(t.prev,t,t.next)>0&&Vn(e.prev,e,e.next)>0)}function Vn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Tg(t,e){return t.x===e.x&&t.y===e.y}function dC(t,e,n,i){var s=Mp(Vn(t,e,n)),c=Mp(Vn(t,e,i)),d=Mp(Vn(n,i,t)),l=Mp(Vn(n,i,e));return!!(s!==c&&d!==l||s===0&&Lp(t,n,e)||c===0&&Lp(t,i,e)||d===0&&Lp(n,t,i)||l===0&&Lp(n,e,i))}function Lp(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Mp(t){return t>0?1:t<0?-1:0}function oj(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&dC(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Md(t,e){return Vn(t.prev,t,t.next)<0?Vn(t,e,t.next)>=0&&Vn(t,t.prev,e)>=0:Vn(t,e,t.prev)<0||Vn(t,t.next,e)<0}function aj(t,e){var n=t,i=!1,s=(t.x+e.x)/2,c=(t.y+e.y)/2;do n.y>c!=n.next.y>c&&n.next.y!==n.y&&s<(n.next.x-n.x)*(c-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function fC(t,e){var n=new cv(t.i,t.x,t.y),i=new cv(e.i,e.x,e.y),s=t.next,c=e.prev;return t.next=e,e.prev=t,n.next=s,s.prev=n,i.next=n,n.prev=i,c.next=i,i.prev=c,i}function FT(t,e,n,i){var s=new cv(t,e,n);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function kd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function cv(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Eg.deviation=function(t,e,n,i){var s=e&&e.length,c=s?e[0]*n:t.length,d=Math.abs(uv(t,0,c,n));if(s)for(var l=0,y=e.length;l<y;l++){var w=e[l]*n,S=l<y-1?e[l+1]*n:t.length;d-=Math.abs(uv(t,w,S,n))}var I=0;for(l=0;l<i.length;l+=3){var P=i[l]*n,B=i[l+1]*n,G=i[l+2]*n;I+=Math.abs((t[P]-t[G])*(t[B+1]-t[P+1])-(t[P]-t[B])*(t[G+1]-t[P+1]))}return d===0&&I===0?0:Math.abs((I-d)/d)};function uv(t,e,n,i){for(var s=0,c=e,d=n-i;c<n;c+=i)s+=(t[d]-t[c])*(t[c+1]+t[d+1]),d=c;return s}Eg.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,s=0;s<t.length;s++){for(var c=0;c<t[s].length;c++)for(var d=0;d<e;d++)n.vertices.push(t[s][c][d]);s>0&&(i+=t[s-1].length,n.holes.push(i))}return n};var lj=Vx.exports;const cj=Pu(lj),kp=iC.CLOCKWISE,BT=iC.COUNTER_CLOCKWISE,Fa={isClosed:!0};function uj(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Hh(t){return"positions"in t?t.positions:t}function nm(t){return"holeIndices"in t?t.holeIndices:null}function hj(t){return Array.isArray(t[0])}function dj(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function fj(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function pj(t,e,n,i){for(let s=0;s<e;s++)if(t[n+s]!==t[i-e+s])return!1;return!0}function NT(t,e,n,i,s){let c=e;const d=n.length;for(let l=0;l<d;l++)for(let y=0;y<i;y++)t[c++]=n[l][y]||0;if(!fj(n))for(let l=0;l<i;l++)t[c++]=n[0][l]||0;return Fa.start=e,Fa.end=c,Fa.size=i,rC(t,s,Fa),c}function UT(t,e,n,i,s=0,c,d){c=c||n.length;const l=c-s;if(l<=0)return e;let y=e;for(let w=0;w<l;w++)t[y++]=n[s+w];if(!pj(n,i,s,c))for(let w=0;w<i;w++)t[y++]=n[s+w];return Fa.start=e,Fa.end=y,Fa.size=i,rC(t,d,Fa),y}function mj(t,e){uj(t);const n=[],i=[];if("positions"in t){const{positions:s,holeIndices:c}=t;if(c){let d=0;for(let l=0;l<=c.length;l++)d=UT(n,d,s,e,c[l-1],c[l],l===0?kp:BT),i.push(d);return i.pop(),{positions:n,holeIndices:i}}t=s}if(!hj(t))return UT(n,0,t,e,0,n.length,kp),n;if(!dj(t)){let s=0;for(const[c,d]of t.entries())s=NT(n,s,d,e,c===0?kp:BT),i.push(s);return i.pop(),{positions:n,holeIndices:i}}return NT(n,0,t,e,kp),n}function zy(t,e,n){const i=t.length/3;let s=0;for(let c=0;c<i;c++){const d=(c+1)%i;s+=t[c*3+e]*t[d*3+n],s-=t[d*3+e]*t[c*3+n]}return Math.abs(s/2)}function VT(t,e,n,i){const s=t.length/3;for(let c=0;c<s;c++){const d=c*3,l=t[d+0],y=t[d+1],w=t[d+2];t[d+e]=l,t[d+n]=y,t[d+i]=w}}function gj(t,e,n,i){let s=nm(t);s&&(s=s.map(l=>l/e));let c=Hh(t);const d=i&&e===3;if(n){const l=c.length;c=c.slice();const y=[];for(let w=0;w<l;w+=e){y[0]=c[w],y[1]=c[w+1],d&&(y[2]=c[w+2]);const S=n(y);c[w]=S[0],c[w+1]=S[1],d&&(c[w+2]=S[2])}}if(d){const l=zy(c,0,1),y=zy(c,0,2),w=zy(c,1,2);if(!l&&!y&&!w)return[];l>y&&l>w||(y>w?(n||(c=c.slice()),VT(c,0,2,1)):(n||(c=c.slice()),VT(c,2,0,1)))}return cj(c,s,e)}class _j extends JP{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=mj(e,this.positionSize);return this.opts.resolution?oC(Hh(n),nm(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?FV(Hh(n),nm(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(jT(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return Hh(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&jT(e))for(const i of e){const s=this.getGeometrySize(i);n.geometrySize=s,this.updateGeometryAttributes(i,n),n.vertexStart+=s,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:s}){const{attributes:c,indexStarts:d,typedArrayManager:l}=this;let y=c.indices;if(!y||!e)return;let w=s;const S=gj(e,this.positionSize,this.opts.preproject,this.opts.full3d);y=l.allocate(y,s+S.length,{copy:!0});for(let I=0;I<S.length;I++)y[w++]=S[I]+i;d[n+1]=s+S.length,c.indices=y}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:s},positionSize:c}=this;if(!s||!e)return;const d=Hh(e);for(let l=n,y=0;y<i;l++,y++){const w=d[y*c],S=d[y*c+1],I=c>2?d[y*c+2]:0;s[l*3]=w,s[l*3+1]=S,s[l*3+2]=I}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:s}=this,c=this.attributes.vertexValid,d=e&&nm(e);if(e&&e.edgeTypes?c.set(e.edgeTypes,n):c.fill(1,n,n+i),d)for(let l=0;l<d.length;l++)c[n+d[l]/s-1]=0;c[n+i-1]=0}}function jT(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const pC=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,yj=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(pC,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),vj=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(pC,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),xj=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,qm=[0,0,0,255],bj={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:qm},getLineColor:{type:"accessor",value:qm},material:!0},Rp={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class jx extends na{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?yj:vj,fs:xj,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Zd,j4,Xd]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:s}=this.props;n.isGeospatial&&i===cn.DEFAULT&&(i=cn.LNGLAT);let c;i===cn.LNGLAT&&(s?c=n.projectPosition.bind(n):c=n.projectFlat.bind(n)),this.setState({numInstances:0,polygonTesselator:new _j({preproject:c,fp64:this.use64bitPositions(),IndexType:!e||Ex(e,In.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const d=this.getAttributeManager(),l=!0;d.remove(["instancePickingColors"]),d.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:Rp,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,transition:Rp,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Rp,accessor:"getFillColor",defaultValue:qm,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Rp,accessor:"getLineColor",defaultValue:qm,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(y,{index:w,target:S})=>this.encodePickingColor(y&&y.__source?y.__source.index:w,S),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:s}=this.props;return s[0]&&s[0].__source&&(n.object=s.find(c=>c.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:s,elevationScale:c}=this.props,{topModel:d,sideModel:l,polygonTesselator:y}=this.state,w={...e,extruded:!!n,elevationScale:c};l&&(l.setInstanceCount(y.instanceCount-1),l.setUniforms(w),s&&(l.setDrawMode(3),l.setUniforms({isWireframe:!0}).draw()),i&&(l.setDrawMode(6),l.setUniforms({isWireframe:!1}).draw())),d&&(d.setVertexCount(y.vertexCount),d.setUniforms(w).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:s}=e,c=this.getAttributeManager();if(s.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var l;(l=this.state.models)===null||l===void 0||l.forEach(y=>y.delete()),this.setState(this._getModels(this.context.gl)),c.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:c}=this.state,d=e.data.attributes||{};c.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:d.getPolygon,buffers:d,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:s}=this.props;let c,d;if(i){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1,c=new Hl(e,{...l,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return s&&(d=new Hl(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new Hd({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),d.userData.excludeAttributes={indices:!0}),{models:[d,c].filter(Boolean),topModel:c,sideModel:d}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}U(jx,"defaultProps",bj);U(jx,"layerName","SolidPolygonLayer");function wj({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:s=0,endRow:c=1/0}=n,d=t.length;let l=d,y=d;for(let P=0;P<d;P++){const B=e(t[P]);if(l>P&&B>=s&&(l=P),B>=c){y=P;break}}let w=l;const I=y-l!==i.length?t.slice(y):void 0;for(let P=0;P<i.length;P++)t[w++]=i[P];if(I){for(let P=0;P<I.length;P++)t[w++]=I[P];t.length=w}return{startRow:l,endRow:l+i.length}}function Ej(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?Tj(t,i,n):null}function Tj(t,e,n){const i={properties:{...t.properties[e]}};for(const s in t.numericProps)i.properties[s]=t.numericProps[s].value[n];return i}function Sj(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const s=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(s.length*3);const c=[];for(let d=0;d<s.length;d++)e(s[d],c),n[i][d*3+0]=c[0],n[i][d*3+1]=c[1],n[i][d*3+2]=c[2]}return n}const Aj=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Dy=192/256,GT=[],Pj={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Gx extends bg{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:Aj}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:i,target:s})=>this.encodePickingColor(i,s)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:s}=n;s!==i.outlineColor&&(s=s.map(c=>c/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!n.sdf&&n.outlineWidth&&Zt.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:s}=this.props,{outlineColor:c}=this.state,d=s?Math.max(i,Dy*(1-s)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:Dy,outlineBuffer:d,gamma:i,sdf:!!n,outlineColor:c},super.draw(e),n&&s){const{iconManager:l}=this.state;l.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:Dy}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):GT}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):GT}}U(Gx,"defaultProps",Pj);U(Gx,"layerName","MultiIconLayer");const sd=1e20;class Cj{constructor({fontSize:e=24,buffer:n=3,radius:i=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:l="normal"}={}){this.buffer=n,this.cutoff=s,this.radius=i;const y=this.size=e+n*4,w=this._createCanvas(y),S=this.ctx=w.getContext("2d",{willReadFrequently:!0});S.font=`${l} ${d} ${e}px ${c}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(e),l=Math.ceil(i),y=0,w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),S=Math.min(this.size-this.buffer,l+Math.ceil(s)),I=w+2*this.buffer,P=S+2*this.buffer,B=Math.max(I*P,0),G=new Uint8ClampedArray(B),K={data:G,width:I,height:P,glyphWidth:w,glyphHeight:S,glyphTop:l,glyphLeft:y,glyphAdvance:n};if(w===0||S===0)return K;const{ctx:ue,buffer:q,gridInner:j,gridOuter:Z}=this;ue.clearRect(q,q,w,S),ue.fillText(e,q,q+l);const re=ue.getImageData(q,q,w,S);Z.fill(sd,0,B),j.fill(0,0,B);for(let pe=0;pe<S;pe++)for(let be=0;be<w;be++){const Re=re.data[4*(pe*w+be)+3]/255;if(Re===0)continue;const Fe=(pe+q)*I+be+q;if(Re===1)Z[Fe]=0,j[Fe]=sd;else{const je=.5-Re;Z[Fe]=je>0?je*je:0,j[Fe]=je<0?je*je:0}}WT(Z,0,0,I,P,I,this.f,this.v,this.z),WT(j,q,q,w,S,I,this.f,this.v,this.z);for(let pe=0;pe<B;pe++){const be=Math.sqrt(Z[pe])-Math.sqrt(j[pe]);G[pe]=Math.round(255-255*(be/this.radius+this.cutoff))}return K}}function WT(t,e,n,i,s,c,d,l,y){for(let w=e;w<e+i;w++)$T(t,n*c+w,c,s,d,l,y);for(let w=n;w<n+s;w++)$T(t,w*c+e,1,i,d,l,y)}function $T(t,e,n,i,s,c,d){c[0]=0,d[0]=-sd,d[1]=sd,s[0]=t[e];for(let l=1,y=0,w=0;l<i;l++){s[l]=t[e+l*n];const S=l*l;do{const I=c[y];w=(s[l]-s[I]+S-I*I)/(l-I)/2}while(w<=d[y]&&--y>-1);y++,c[y]=l,d[y]=w,d[y+1]=sd}for(let l=0,y=0;l<i;l++){for(;d[y+1]<l;)y++;const w=c[y],S=l-w;t[e+l*n]=s[w]+S*S}}const Ij=32,Lj=[];function Mj(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function kj({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:s,mapping:c={},xOffset:d=0,yOffset:l=0}){let y=0,w=d;const S=n+i*2;for(const I of t)if(!c[I]){const P=e(I);w+P+i*2>s&&(w=0,y++),c[I]={x:w+i,y:l+y*S+i,width:P,height:S,layoutWidth:P,layoutHeight:n},w+=P+i*2}return{mapping:c,xOffset:w,yOffset:l+y*S,canvasHeight:Mj(l+(y+1)*S)}}function mC(t,e,n,i){let s=0;for(let d=e;d<n;d++){var c;const l=t[d];s+=((c=i[l])===null||c===void 0?void 0:c.layoutWidth)||0}return s}function gC(t,e,n,i,s,c){let d=e,l=0;for(let y=e;y<n;y++){const w=mC(t,y,y+1,s);l+w>i&&(d<y&&c.push(y),d=y,l=0),l+=w}return l}function Rj(t,e,n,i,s,c){let d=e,l=e,y=e,w=0;for(let S=e;S<n;S++)if((t[S]===" "||t[S+1]===" "||S+1===n)&&(y=S+1),y>l){let I=mC(t,l,y,s);w+I>i&&(d<l&&(c.push(l),d=l,w=0),I>i&&(I=gC(t,l,y,i,s,c),d=c[c.length-1])),l=y,w+=I}return w}function zj(t,e,n,i,s=0,c){c===void 0&&(c=t.length);const d=[];return e==="break-all"?gC(t,s,c,n,i,d):Rj(t,s,c,n,i,d),d}function Dj(t,e,n,i,s,c){let d=0,l=0;for(let y=e;y<n;y++){const w=t[y],S=i[w];S?(l||(l=S.layoutHeight),s[y]=d+S.layoutWidth/2,d+=S.layoutWidth):(Zt.warn("Missing character: ".concat(w," (").concat(w.codePointAt(0),")"))(),s[y]=d,d+=Ij)}c[0]=d,c[1]=l}function Oj(t,e,n,i,s){const c=Array.from(t),d=c.length,l=new Array(d),y=new Array(d),w=new Array(d),S=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,I=[0,0],P=[0,0];let B=0,G=0,K=0;for(let q=0;q<=d;q++){const j=c[q];if((j===`
`||q===d)&&(K=q),K>G){const Z=S?zj(c,n,i,s,G,K):Lj;for(let re=0;re<=Z.length;re++){const pe=re===0?G:Z[re-1],be=re<Z.length?Z[re]:K;Dj(c,pe,be,s,l,P);for(let Re=pe;Re<be;Re++){var ue;const Fe=c[Re],je=((ue=s[Fe])===null||ue===void 0?void 0:ue.layoutOffsetY)||0;y[Re]=B+P[1]/2+je,w[Re]=P[0]}B=B+P[1]*e,I[0]=Math.max(I[0],P[0])}G=K}j===`
`&&(l[G]=0,y[G]=0,w[G]=0,G++)}return I[1]=B,{x:l,y,rowWidth:w,size:I}}function Fj({value:t,length:e,stride:n,offset:i,startIndices:s,characterSet:c}){const d=t.BYTES_PER_ELEMENT,l=n?n/d:1,y=i?i/d:0,w=s[e]||Math.ceil((t.length-y)/l),S=c&&new Set,I=new Array(e);let P=t;if(l>1||y>0){const B=t.constructor;P=new B(w);for(let G=0;G<w;G++)P[G]=t[G*l+y]}for(let B=0;B<e;B++){const G=s[B],K=s[B+1]||w,ue=P.subarray(G,K);I[B]=String.fromCodePoint.apply(null,ue),S&&ue.forEach(S.add,S)}if(S)for(const B of S)c.add(String.fromCodePoint(B));return{texts:I,characterCount:w}}class _C{constructor(e=5){U(this,"limit",void 0),U(this,"_cache",{}),U(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function Bj(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const au={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:Bj(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},HT=1024,qT=.9,ZT=1.2,yC=3;let Zm=new _C(yC);function Nj(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=Zm.get(t);if(!i)return n;for(const s in i.mapping)n.has(s)&&n.delete(s);return n}function Uj(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function XT(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function Vj(t){Zt.assert(Number.isFinite(t)&&t>=yC,"Invalid cache limit"),Zm=new _C(t)}class jj{constructor(){U(this,"props",{...au}),U(this,"_key",void 0),U(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*ZT+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=Nj(this._key,this.props.characterSet),i=Zm.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}const s=this._generateFontAtlas(n,i);this._atlas=s,Zm.set(this._key,s)}_generateFontAtlas(e,n){const{fontFamily:i,fontWeight:s,fontSize:c,buffer:d,sdf:l,radius:y,cutoff:w}=this.props;let S=n&&n.data;S||(S=document.createElement("canvas"),S.width=HT);const I=S.getContext("2d",{willReadFrequently:!0});XT(I,i,c,s);const{mapping:P,canvasHeight:B,xOffset:G,yOffset:K}=kj({getFontWidth:ue=>I.measureText(ue).width,fontHeight:c*ZT,buffer:d,characterSet:e,maxCanvasWidth:HT,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(S.height!==B){const ue=I.getImageData(0,0,S.width,S.height);S.height=B,I.putImageData(ue,0,0)}if(XT(I,i,c,s),l){const ue=new Cj({fontSize:c,buffer:d,radius:y,cutoff:w,fontFamily:i,fontWeight:"".concat(s)});for(const q of e){const{data:j,width:Z,height:re,glyphTop:pe}=ue.draw(q);P[q].width=Z,P[q].layoutOffsetY=c*qT-pe;const be=I.createImageData(Z,re);Uj(j,be),I.putImageData(be,P[q].x,P[q].y)}}else for(const ue of e)I.fillText(ue,P[ue].x,P[ue].y+d+c*qT);return{xOffset:G,yOffset:K,mapping:P,data:S,width:S.width,height:S.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:s,sdf:c,radius:d,cutoff:l}=this.props;return c?"".concat(e," ").concat(n," ").concat(i," ").concat(s," ").concat(d," ").concat(l):"".concat(e," ").concat(n," ").concat(i," ").concat(s)}}const Gj=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Wj=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,$j={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Wx extends na{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(){return super.getShaders({vs:Gj,fs:Wj,modules:[Zd,Xd]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var i;const{gl:s}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:s,sizeMinPixels:c,sizeMaxPixels:d,getLineWidth:l}=this.props;let{padding:y}=this.props;y.length<4&&(y=[y[0],y[1],y[0],y[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:!!l,padding:y,sizeUnits:Wl[s],sizeScale:i,sizeMinPixels:c,sizeMaxPixels:d}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Hl(e,{...this.getShaders(),id:this.props.id,geometry:new Hd({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}U(Wx,"defaultProps",$j);U(Wx,"layerName","TextBackgroundLayer");const YT={start:1,middle:0,end:-1},KT={top:1,center:0,bottom:-1},Oy=[0,0,0,255],Hj=1,qj={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Oy},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:au.characterSet},fontFamily:au.fontFamily,fontWeight:au.fontWeight,lineHeight:Hj,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Oy},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Oy},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class $x extends Nx{constructor(...e){super(...e),U(this,"state",void 0),U(this,"getBoundingRect",(n,i)=>{let{size:[s,c]}=this.transformParagraph(n,i);const{fontSize:d}=this.state.fontAtlasManager.props;s/=d,c/=d;const{getTextAnchor:l,getAlignmentBaseline:y}=this.props,w=YT[typeof l=="function"?l(n,i):l],S=KT[typeof y=="function"?y(n,i):y];return[(w-1)*s/2,(S-1)*c/2,s,c]}),U(this,"getIconOffsets",(n,i)=>{const{getTextAnchor:s,getAlignmentBaseline:c}=this.props,{x:d,y:l,rowWidth:y,size:[w,S]}=this.transformParagraph(n,i),I=YT[typeof s=="function"?s(n,i):s],P=KT[typeof c=="function"?c(n,i):c],B=d.length,G=new Array(B*2);let K=0;for(let ue=0;ue<B;ue++){const q=(1-I)*(w-y[ue])/2;G[K++]=(I-1)*w/2+q+d[ue],G[K++]=(P-1)*S/2+l[ue]}return G})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new jj},this.props.maxWidth>0&&Zt.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:i,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:s,characterSet:c}=this.state,d={...e,characterSet:c,fontFamily:n,fontWeight:i};if(!s.mapping)return s.setProps(d),!0;for(const l in d)if(d[l]!==s.props[l])return s.setProps(d),!0;return!1}_updateText(){var e;const{data:n,characterSet:i}=this.props,s=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:c}=this.props,d=n.startIndices,l;const y=i==="auto"&&new Set;if(s&&d){const{texts:w,characterCount:S}=Fj({...ArrayBuffer.isView(s)?{value:s}:s,length:n.length,startIndices:d,characterSet:y});l=S,c=(I,{index:P})=>w[P]}else{const{iterable:w,objectInfo:S}=vg(n);d=[0],l=0;for(const I of w){S.index++;const P=Array.from(c(I,S)||"");y&&P.forEach(y.add,y),l+=P.length,d.push(l)}}this.setState({getText:c,startIndices:d,numInstances:l,characterSet:y||i})}transformParagraph(e,n){const{fontAtlasManager:i}=this.state,s=i.mapping,c=this.state.getText,{wordBreak:d,lineHeight:l,maxWidth:y}=this.props,w=c(e,n)||"";return Oj(w,l,d,y*i.props.fontSize,s)}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:s,texture:c,mapping:d},styleVersion:l}=this.state,{data:y,_dataDiff:w,getPosition:S,getColor:I,getSize:P,getAngle:B,getPixelOffset:G,getBackgroundColor:K,getBorderColor:ue,getBorderWidth:q,backgroundPadding:j,background:Z,billboard:re,fontSettings:pe,outlineWidth:be,outlineColor:Re,sizeScale:Fe,sizeUnits:je,sizeMinPixels:Ge,sizeMaxPixels:pt,transitions:bt,updateTriggers:St}=this.props,kt=this.getSubLayerClass("characters",Gx),Wn=this.getSubLayerClass("background",Wx);return[Z&&new Wn({getFillColor:K,getLineColor:ue,getLineWidth:q,padding:j,getPosition:S,getSize:P,getAngle:B,getPixelOffset:G,billboard:re,sizeScale:Fe,sizeUnits:je,sizeMinPixels:Ge,sizeMaxPixels:pt,transitions:bt&&{getPosition:bt.getPosition,getAngle:bt.getAngle,getSize:bt.getSize,getFillColor:bt.getBackgroundColor,getLineColor:bt.getBorderColor,getLineWidth:bt.getBorderWidth,getPixelOffset:bt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:St.getPosition,getAngle:St.getAngle,getSize:St.getSize,getFillColor:St.getBackgroundColor,getLineColor:St.getBorderColor,getLineWidth:St.getBorderWidth,getPixelOffset:St.getPixelOffset,getBoundingRect:{getText:St.getText,getTextAnchor:St.getTextAnchor,getAlignmentBaseline:St.getAlignmentBaseline,styleVersion:l}}}),{data:y.attributes&&y.attributes.background?{length:y.length,attributes:y.attributes.background}:y,_dataDiff:w,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new kt({sdf:pe.sdf,smoothing:Number.isFinite(pe.smoothing)?pe.smoothing:au.smoothing,outlineWidth:be/(pe.radius||au.radius),outlineColor:Re,iconAtlas:c,iconMapping:d,getPosition:S,getColor:I,getSize:P,getAngle:B,getPixelOffset:G,billboard:re,sizeScale:Fe*s,sizeUnits:je,sizeMinPixels:Ge*s,sizeMaxPixels:pt*s,transitions:bt&&{getPosition:bt.getPosition,getAngle:bt.getAngle,getColor:bt.getColor,getSize:bt.getSize,getPixelOffset:bt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:St.getText,getPosition:St.getPosition,getAngle:St.getAngle,getColor:St.getColor,getSize:St.getSize,getPixelOffset:St.getPixelOffset,getIconOffsets:{getTextAnchor:St.getTextAnchor,getAlignmentBaseline:St.getAlignmentBaseline,styleVersion:l}}}),{data:y,_dataDiff:w,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){Vj(e)}}U($x,"defaultProps",qj);U($x,"layerName","TextLayer");const im={circle:{type:Ux,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:bg,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:$x,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},rm={type:wg,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},hv={type:jx,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Nh({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function Fy(t,e){const{transitions:n,updateTriggers:i}=t.props,s={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const c in e){const d=e[c];let l=t.props[c];c.startsWith("get")&&(l=t.getSubLayerAccessor(l),s.updateTriggers[d]=i[c],n&&(s.transitions[d]=n[c])),s[d]=l}return s}function Zj(t){if(Array.isArray(t))return t;switch(Zt.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Zt.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function JT(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:c=t.length}=n;for(let d=s;d<c;d++){const l=t[d],{geometry:y}=l;if(y)if(y.type==="GeometryCollection"){Zt.assert(Array.isArray(y.geometries),"GeoJSON does not have geometries array");const{geometries:w}=y;for(let S=0;S<w.length;S++){const I=w[S];QT(I,i,e,l,d)}}else QT(y,i,e,l,d)}return i}function QT(t,e,n,i,s){const{type:c,coordinates:d}=t,{pointFeatures:l,lineFeatures:y,polygonFeatures:w,polygonOutlineFeatures:S}=e;if(!Yj(c,d)){Zt.warn("".concat(c," coordinates are malformed"))();return}switch(c){case"Point":l.push(n({geometry:t},i,s));break;case"MultiPoint":d.forEach(I=>{l.push(n({geometry:{type:"Point",coordinates:I}},i,s))});break;case"LineString":y.push(n({geometry:t},i,s));break;case"MultiLineString":d.forEach(I=>{y.push(n({geometry:{type:"LineString",coordinates:I}},i,s))});break;case"Polygon":w.push(n({geometry:t},i,s)),d.forEach(I=>{S.push(n({geometry:{type:"LineString",coordinates:I}},i,s))});break;case"MultiPolygon":d.forEach(I=>{w.push(n({geometry:{type:"Polygon",coordinates:I}},i,s)),I.forEach(P=>{S.push(n({geometry:{type:"LineString",coordinates:P}},i,s))})});break}}const Xj={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Yj(t,e){let n=Xj[t];for(Zt.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function vC(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function zp(t){return t.geometry.coordinates}function Kj(t,e){const n=vC(),{pointFeatures:i,lineFeatures:s,polygonFeatures:c,polygonOutlineFeatures:d}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=zp,n.lines.data=s,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=zp,n.polygons.data=c,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=zp,n.polygonsOutline.data=d,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=zp,n}function Jj(t,e){const n=vC(),{points:i,lines:s,polygons:c}=t,d=Sj(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:d.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:d.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.lines._pathType="open",n.polygons.data={length:c.polygonIndices.value.length-1,startIndices:c.polygonIndices.value,attributes:{...c.attributes,getPolygon:c.positions,pickingColors:{size:3,value:d.polygons}},properties:c.properties,numericProps:c.numericProps,featureIds:c.featureIds},n.polygons._normalize=!1,c.triangles&&(n.polygons.data.attributes.indices=c.triangles.value),n.polygonsOutline.data={length:c.primitivePolygonIndices.value.length-1,startIndices:c.primitivePolygonIndices.value,attributes:{...c.attributes,getPath:c.positions,instancePickingColors:{size:3,value:d.polygons}},properties:c.properties,numericProps:c.numericProps,featureIds:c.featureIds},n.polygonsOutline._pathType="open",n}const Qj=["points","linestrings","polygons"],e8={...Nh(im.circle),...Nh(im.icon),...Nh(im.text),...Nh(rm),...Nh(hv),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Hx extends Nx{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,s=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=Jj(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=Zj(e.data),s=this.getSubLayerRow.bind(this);let c={};const d={};if(Array.isArray(n.dataChanged)){const y=this.state.features;for(const w in y)c[w]=y[w].slice(),d[w]=[];for(const w of n.dataChanged){const S=JT(i,s,w);for(const I in y)d[I].push(wj({data:c[I],getIndex:P=>P.__source.index,dataRange:w,replace:S[I]}))}}else c=JT(i,s);const l=Kj(c,d);this.setState({features:c,featuresDiff:d,layerProps:l})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:s}=n;return n.featureType=Qj.find(c=>s.id.startsWith("".concat(this.id,"-").concat(c,"-"))),i>=0&&s.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),i=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(n)===i&&s.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,s="polygons-fill",c=this.shouldRenderSubLayer(s,i.polygons.data)&&this.getSubLayerClass(s,hv.type);if(c){const d=Fy(this,hv.props),l=e&&n;return l||delete d.getLineColor,d.updateTriggers.lineColors=l,new c(d,this.getSubLayerProps({id:s,updateTriggers:d.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,s="polygons-stroke",c="linestrings",d=!e&&n&&this.shouldRenderSubLayer(s,i.polygonsOutline.data)&&this.getSubLayerClass(s,rm.type),l=this.shouldRenderSubLayer(c,i.lines.data)&&this.getSubLayerClass(c,rm.type);if(d||l){const y=Fy(this,rm.props);return[d&&new d(y,this.getSubLayerProps({id:s,updateTriggers:y.updateTriggers}),i.polygonsOutline),l&&new l(y,this.getSubLayerProps({id:c,updateTriggers:y.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:s}=this.props;!i&&Number.isFinite(s)&&(s=n.points.data.findIndex(l=>l.__source.index===s));const c=new Set(e.split("+")),d=[];for(const l of c){const y="points-".concat(l),w=im[l],S=w&&this.shouldRenderSubLayer(y,n.points.data)&&this.getSubLayerClass(y,w.type);if(S){const I=Fy(this,w.props);let P=n.points;if(l==="text"&&i){const{instancePickingColors:B,...G}=P.data.attributes;P={...P,data:{...P.data,attributes:G}}}d.push(new S(I,this.getSubLayerProps({id:y,updateTriggers:I.updateTriggers,highlightedObjectIndex:s}),P))}}return d}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&n,i,s,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,s)=>{const{data:c,index:d}=s,l=Ej(c,d);return e(l,s)}}}U(Hx,"layerName","GeoJsonLayer");U(Hx,"defaultProps",e8);const t8={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}};class Xm extends wg{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`uniform float trailLength;
attribute float instanceTimestamps;
attribute float instanceNextTimestamps;
varying float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
varying float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:n,trailLength:i,currentTime:s}=this.props;e.uniforms={...e.uniforms,fadeTrail:n,trailLength:i,currentTime:s},super.draw(e)}}U(Xm,"layerName","TripsLayer");U(Xm,"defaultProps",t8);var xC={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function n(){for(var c="",d=0;d<arguments.length;d++){var l=arguments[d];l&&(c=s(c,i(l)))}return c}function i(c){if(typeof c=="string"||typeof c=="number")return c;if(typeof c!="object")return"";if(Array.isArray(c))return n.apply(null,c);if(c.toString!==Object.prototype.toString&&!c.toString.toString().includes("[native code]"))return c.toString();var d="";for(var l in c)e.call(c,l)&&c[l]&&(d=s(d,l));return d}function s(c,d){return d?c?c+" "+d:c+d:c}t.exports?(n.default=n,t.exports=n):window.classNames=n})()})(xC);var n8=xC.exports;const kr=Pu(n8);var bC={exports:{}},i8="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",r8=i8,s8=r8;function wC(){}function EC(){}EC.resetWarningCache=wC;var o8=function(){function t(i,s,c,d,l,y){if(y!==s8){var w=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw w.name="Invariant Violation",w}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:EC,resetWarningCache:wC};return n.PropTypes=n,n};bC.exports=o8();var a8=bC.exports;const lu=Pu(a8);var TC={exports:{}},Sg={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l8=Be,c8=Symbol.for("react.element"),u8=Symbol.for("react.fragment"),h8=Object.prototype.hasOwnProperty,d8=l8.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f8={key:!0,ref:!0,__self:!0,__source:!0};function SC(t,e,n){var i,s={},c=null,d=null;n!==void 0&&(c=""+n),e.key!==void 0&&(c=""+e.key),e.ref!==void 0&&(d=e.ref);for(i in e)h8.call(e,i)&&!f8.hasOwnProperty(i)&&(s[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)s[i]===void 0&&(s[i]=e[i]);return{$$typeof:c8,type:t,key:c,ref:d,props:s,_owner:d8.current}}Sg.Fragment=u8;Sg.jsx=SC;Sg.jsxs=SC;TC.exports=Sg;var zn=TC.exports;const p8={type:lu.string,tooltip:lu.bool,as:lu.elementType},qx=Be.forwardRef(({as:t="div",className:e,type:n="valid",tooltip:i=!1,...s},c)=>zn.jsx(t,{...s,ref:c,className:kr(e,`${n}-${i?"tooltip":"feedback"}`)}));qx.displayName="Feedback";qx.propTypes=p8;const AC=qx,m8=Be.createContext({}),Jo=m8,g8=["xxl","xl","lg","md","sm","xs"],_8="xs",Zx=Be.createContext({prefixes:{},breakpoints:g8,minBreakpoint:_8});function Ss(t,e){const{prefixes:n}=Be.useContext(Zx);return t||n[e]||e}function y8(){const{breakpoints:t}=Be.useContext(Zx);return t}function v8(){const{minBreakpoint:t}=Be.useContext(Zx);return t}const PC=Be.forwardRef(({id:t,bsPrefix:e,className:n,type:i="checkbox",isValid:s=!1,isInvalid:c=!1,as:d="input",...l},y)=>{const{controlId:w}=Be.useContext(Jo);return e=Ss(e,"form-check-input"),zn.jsx(d,{...l,ref:y,type:i,id:t||w,className:kr(n,e,s&&"is-valid",c&&"is-invalid")})});PC.displayName="FormCheckInput";const CC=PC,IC=Be.forwardRef(({bsPrefix:t,className:e,htmlFor:n,...i},s)=>{const{controlId:c}=Be.useContext(Jo);return t=Ss(t,"form-check-label"),zn.jsx("label",{...i,ref:s,htmlFor:n||c,className:kr(e,t)})});IC.displayName="FormCheckLabel";const dv=IC;function x8(t,e){return Be.Children.toArray(t).some(n=>Be.isValidElement(n)&&n.type===e)}const LC=Be.forwardRef(({id:t,bsPrefix:e,bsSwitchPrefix:n,inline:i=!1,reverse:s=!1,disabled:c=!1,isValid:d=!1,isInvalid:l=!1,feedbackTooltip:y=!1,feedback:w,feedbackType:S,className:I,style:P,title:B="",type:G="checkbox",label:K,children:ue,as:q="input",...j},Z)=>{e=Ss(e,"form-check"),n=Ss(n,"form-switch");const{controlId:re}=Be.useContext(Jo),pe=Be.useMemo(()=>({controlId:t||re}),[re,t]),be=!ue&&K!=null&&K!==!1||x8(ue,dv),Re=zn.jsx(CC,{...j,type:G==="switch"?"checkbox":G,ref:Z,isValid:d,isInvalid:l,disabled:c,as:q});return zn.jsx(Jo.Provider,{value:pe,children:zn.jsx("div",{style:P,className:kr(I,be&&e,i&&`${e}-inline`,s&&`${e}-reverse`,G==="switch"&&n),children:ue||zn.jsxs(zn.Fragment,{children:[Re,be&&zn.jsx(dv,{title:B,children:K}),w&&zn.jsx(AC,{type:S,tooltip:y,children:w})]})})})});LC.displayName="FormCheck";const Ym=Object.assign(LC,{Input:CC,Label:dv}),MC=Be.forwardRef(({bsPrefix:t,type:e,size:n,htmlSize:i,id:s,className:c,isValid:d=!1,isInvalid:l=!1,plaintext:y,readOnly:w,as:S="input",...I},P)=>{const{controlId:B}=Be.useContext(Jo);return t=Ss(t,"form-control"),zn.jsx(S,{...I,type:e,size:i,ref:P,readOnly:w,id:s||B,className:kr(c,y?`${t}-plaintext`:t,n&&`${t}-${n}`,e==="color"&&`${t}-color`,d&&"is-valid",l&&"is-invalid")})});MC.displayName="FormControl";const b8=Object.assign(MC,{Feedback:AC}),kC=Be.forwardRef(({className:t,bsPrefix:e,as:n="div",...i},s)=>(e=Ss(e,"form-floating"),zn.jsx(n,{ref:s,className:kr(t,e),...i})));kC.displayName="FormFloating";const w8=kC,RC=Be.forwardRef(({controlId:t,as:e="div",...n},i)=>{const s=Be.useMemo(()=>({controlId:t}),[t]);return zn.jsx(Jo.Provider,{value:s,children:zn.jsx(e,{...n,ref:i})})});RC.displayName="FormGroup";const zC=RC;function E8({as:t,bsPrefix:e,className:n,...i}){e=Ss(e,"col");const s=y8(),c=v8(),d=[],l=[];return s.forEach(y=>{const w=i[y];delete i[y];let S,I,P;typeof w=="object"&&w!=null?{span:S,offset:I,order:P}=w:S=w;const B=y!==c?`-${y}`:"";S&&d.push(S===!0?`${e}${B}`:`${e}${B}-${S}`),P!=null&&l.push(`order${B}-${P}`),I!=null&&l.push(`offset${B}-${I}`)}),[{...i,className:kr(n,...d,...l)},{as:t,bsPrefix:e,spans:d}]}const DC=Be.forwardRef((t,e)=>{const[{className:n,...i},{as:s="div",bsPrefix:c,spans:d}]=E8(t);return zn.jsx(s,{...i,ref:e,className:kr(n,!d.length&&c)})});DC.displayName="Col";const T8=DC,OC=Be.forwardRef(({as:t="label",bsPrefix:e,column:n=!1,visuallyHidden:i=!1,className:s,htmlFor:c,...d},l)=>{const{controlId:y}=Be.useContext(Jo);e=Ss(e,"form-label");let w="col-form-label";typeof n=="string"&&(w=`${w} ${w}-${n}`);const S=kr(s,e,i&&"visually-hidden",n&&w);return c=c||y,n?zn.jsx(T8,{ref:l,as:"label",className:S,htmlFor:c,...d}):zn.jsx(t,{ref:l,className:S,htmlFor:c,...d})});OC.displayName="FormLabel";const S8=OC,FC=Be.forwardRef(({bsPrefix:t,className:e,id:n,...i},s)=>{const{controlId:c}=Be.useContext(Jo);return t=Ss(t,"form-range"),zn.jsx("input",{...i,type:"range",ref:s,className:kr(e,t),id:n||c})});FC.displayName="FormRange";const A8=FC,BC=Be.forwardRef(({bsPrefix:t,size:e,htmlSize:n,className:i,isValid:s=!1,isInvalid:c=!1,id:d,...l},y)=>{const{controlId:w}=Be.useContext(Jo);return t=Ss(t,"form-select"),zn.jsx("select",{...l,size:n,ref:y,className:kr(i,t,e&&`${t}-${e}`,s&&"is-valid",c&&"is-invalid"),id:d||w})});BC.displayName="FormSelect";const P8=BC,NC=Be.forwardRef(({bsPrefix:t,className:e,as:n="small",muted:i,...s},c)=>(t=Ss(t,"form-text"),zn.jsx(n,{...s,ref:c,className:kr(e,t,i&&"text-muted")})));NC.displayName="FormText";const C8=NC,UC=Be.forwardRef((t,e)=>zn.jsx(Ym,{...t,ref:e,type:"switch"}));UC.displayName="Switch";const I8=Object.assign(UC,{Input:Ym.Input,Label:Ym.Label}),VC=Be.forwardRef(({bsPrefix:t,className:e,children:n,controlId:i,label:s,...c},d)=>(t=Ss(t,"form-floating"),zn.jsxs(zC,{ref:d,className:kr(e,t),controlId:i,...c,children:[n,zn.jsx("label",{htmlFor:i,children:s})]})));VC.displayName="FloatingLabel";const L8=VC,M8={_ref:lu.any,validated:lu.bool,as:lu.elementType},Xx=Be.forwardRef(({className:t,validated:e,as:n="form",...i},s)=>zn.jsx(n,{...i,ref:s,className:kr(t,e&&"was-validated")}));Xx.displayName="Form";Xx.propTypes=M8;const By=Object.assign(Xx,{Group:zC,Control:b8,Floating:w8,Check:Ym,Switch:I8,Label:S8,Text:C8,Range:A8,Select:P8,FloatingLabel:L8}),Ny={STRIKE:"./strike.json",NORMAL:"./normal.json",GERMANY:"./germany.json"},k8={trailColor0:[253,128,93],trailColor1:[23,184,190]},R8={borderRadius:"10px",position:"absolute",left:"15px",padding:"10px",top:"15px",zIndex:10};function z8(){const[t,e]=Be.useState(null);return Be.useEffect(()=>{function n(){const i=window.innerWidth;let s=5.25;i<Dp.sm||i<Dp.md?s=4.8:(i<Dp.lg||i<Dp.xl)&&(s=5.25),e(s)}return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}const D8={longitude:10.0933714114978,latitude:50.75073750373195,zoom:5.25,pitch:0,bearing:0},O8="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",Dp={xs:0,sm:576,md:768,lg:992,xl:1200};function F8({normal:t=Ny.NORMAL,strike:e=Ny.STRIKE,germany:n=Ny.GERMANY,initialViewState:i=D8,mapStyle:s=O8,theme:c=k8,loopLength:d=31900,animationSpeed:l=12.5}){const[y,w]=Be.useState(0),[S]=Be.useState({}),[I,P]=Be.useState(!0),B=()=>{w(j=>(j+l)%d),S.id=window.requestAnimationFrame(B)};Be.useEffect(()=>(S.id=window.requestAnimationFrame(B),()=>window.cancelAnimationFrame(S.id)),[S]),i.zoom=z8();const G=new Hx({id:"germany",data:n,opacity:.3,stroked:!0,filled:!1,getFillColor:"#000",getLineColor:[255,255,255],getLineWidth:1,lineWidthMinPixels:1}),K=new Xm({id:"normal",data:t,getPath:j=>j.path,getTimestamps:j=>j.timestamps,getColor:j=>j.vendor===1?c.trailColor0:c.trailColor1,opacity:1,widthMinPixels:2,rounded:!0,trailLength:I?1e3:0,currentTime:y,shadowEnabled:!1}),ue=new Xm({id:"strike",data:e,getPath:j=>j.path,getTimestamps:j=>j.timestamps,getColor:j=>j.vendor===0?c.trailColor0:c.trailColor1,opacity:1,widthMinPixels:2,rounded:!0,trailLength:I?0:1e3,currentTime:y,shadowEnabled:!1}),q=[G,ue,K];return uo.createElement(uo.Fragment,null,uo.createElement(By,{className:"bg-light",style:R8},uo.createElement("div",{key:"inline-radio"},uo.createElement("span",{className:"train-legend mb-2 d-none d-lg-inline-block"},"Long-distance trains during a:"),uo.createElement(By.Check,{className:"train-legend",checked:I,onChange:()=>{P(!0)},label:"Normal day",name:"group1",type:"radio",id:"inline-radio-normal"}),uo.createElement(By.Check,{className:"train-legend",checked:!I,onChange:()=>{P(!1)},label:"Strike",name:"group1",type:"radio",id:"inline-radio-strike"}))),q.length>0&&uo.createElement(pV,{layers:q,effects:c.effects,initialViewState:i,controller:!1},uo.createElement(w3,{reuseMaps:!0,mapLib:T3,mapStyle:s,preventStyleDiffing:!0})))}function B8(t){hA(t).render(uo.createElement(F8,null))}B8(document.getElementById("app"));
